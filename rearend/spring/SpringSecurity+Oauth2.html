<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://chenyl8848.github.io/rearend/spring/SpringSecurity+Oauth2.html"><meta property="og:site_name" content="Javaé™ˆåºå‘˜"><meta property="og:title" content="Spring Security + OAuth2 æƒé™ç®¡ç†å®æˆ˜"><meta property="og:type" content="article"><meta property="og:updated_time" content="2024-11-21T14:14:10.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Spring Security"><meta property="article:tag" content="OAuth2"><meta property="article:published_time" content="2024-09-27T00:00:00.000Z"><meta property="article:modified_time" content="2024-11-21T14:14:10.000Z"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3316994_227lwxrw41z.css"><title>Spring Security + OAuth2 æƒé™ç®¡ç†å®æˆ˜ | Javaé™ˆåºå‘˜</title><meta name="description" content="Javaé™ˆåºå‘˜çš„ä¸ªäººåšå®¢ç½‘ç«™">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.7c8a6ce0.css">
    <link rel="modulepreload" href="/assets/app.06d697e7.js"><link rel="modulepreload" href="/assets/SpringSecurity_Oauth2.html.2a0b166c.js"><link rel="modulepreload" href="/assets/SpringSecurity_Oauth2.html.97f7fc3a.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.webp" alt="Javaé™ˆåºå‘˜"><!----><span class="site-name hide-in-pad">Javaé™ˆåºå‘˜</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" arialabel="é¦–é¡µ"><i class="icon iconfont icon-home"></i>é¦–é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="åç«¯"><span class="title"><i class="icon iconfont icon-rearend"></i>åç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/rearend/java/" class="nav-link" arialabel="Java"><i class="icon iconfont icon-java"></i>Java<!----></a></li><li class="dropdown-item"><a href="/rearend/spring/" class="nav-link active" arialabel="Spring"><i class="icon iconfont icon-spring"></i>Spring<!----></a></li><li class="dropdown-item"><a href="/rearend/springBoot/" class="nav-link" arialabel="Spring Boot"><i class="icon iconfont icon-springboot"></i>Spring Boot<!----></a></li><li class="dropdown-item"><a href="/rearend/microServices/" class="nav-link" arialabel="å¾®æœåŠ¡"><i class="icon iconfont icon-microServices"></i>å¾®æœåŠ¡<!----></a></li><li class="dropdown-item"><a href="/rearend/dataStructure/" class="nav-link" arialabel="æ•°æ®ç»“æ„"><i class="icon iconfont icon-dataStructure"></i>æ•°æ®ç»“æ„<!----></a></li><li class="dropdown-item"><a href="/rearend/algorithm/" class="nav-link" arialabel="ç®—æ³•"><i class="icon iconfont icon-algorithm"></i>ç®—æ³•<!----></a></li><li class="dropdown-item"><a href="/rearend/designPattern/" class="nav-link" arialabel="è®¾è®¡æ¨¡å¼"><i class="icon iconfont icon-designPattern"></i>è®¾è®¡æ¨¡å¼<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="ä¸­é—´ä»¶"><span class="title"><i class="icon iconfont icon-middleware"></i>ä¸­é—´ä»¶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/middleware/database/" class="nav-link" arialabel="æ•°æ®åº“"><i class="icon iconfont icon-database"></i>æ•°æ®åº“<!----></a></li><li class="dropdown-item"><a href="/middleware/noSQL/" class="nav-link" arialabel="NoSQL"><i class="icon iconfont icon-noSQL"></i>NoSQL<!----></a></li><li class="dropdown-item"><a href="/middleware/mq/" class="nav-link" arialabel="MQ"><i class="icon iconfont icon-MQ"></i>MQ<!----></a></li><li class="dropdown-item"><a href="/middleware/zookeeper/" class="nav-link" arialabel="ZooKeeper"><i class="icon iconfont icon-zookeeper"></i>ZooKeeper<!----></a></li><li class="dropdown-item"><a href="/middleware/elasticsearch/" class="nav-link" arialabel="ElasticSearch"><i class="icon iconfont icon-elasticsearch"></i>ElasticSearch<!----></a></li><li class="dropdown-item"><a href="/middleware/prometheus/" class="nav-link" arialabel="Prometheus"><i class="icon iconfont icon-prometheus"></i>Prometheus<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="æœåŠ¡å™¨"><span class="title"><i class="icon iconfont icon-server"></i>æœåŠ¡å™¨</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/server/linux/" class="nav-link" arialabel="Linux"><i class="icon iconfont icon-linux"></i>Linux<!----></a></li><li class="dropdown-item"><a href="/server/docker/" class="nav-link" arialabel="Docker"><i class="icon iconfont icon-docker"></i>Docker<!----></a></li><li class="dropdown-item"><a href="/server/kubernetes/" class="nav-link" arialabel="Kubernetes"><i class="icon iconfont icon-kubernetes"></i>Kubernetes<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="AI"><span class="title"><i class="icon iconfont icon-wuguan"></i>AI</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/ai/assistant/" class="nav-link" arialabel="AI åŠ©æ‰‹"><i class="icon iconfont icon-Cursor"></i>AI åŠ©æ‰‹<!----></a></li><li class="dropdown-item"><a href="/ai/framework/" class="nav-link" arialabel="AI æ¡†æ¶"><i class="icon iconfont icon-Aisucai"></i>AI æ¡†æ¶<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="å‰ç«¯"><span class="title"><i class="icon iconfont icon-wangye"></i>å‰ç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>æ¡†æ¶</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/framework/js/" class="nav-link" arialabel="JavaScript"><i class="icon iconfont icon-java_script"></i>JavaScript<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/nodejs/" class="nav-link" arialabel="Node.js"><i class="icon iconfont icon-node-js"></i>Node.js<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/vue/" class="nav-link" arialabel="Vue.js"><i class="icon iconfont icon-vue"></i>Vue.js<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/react/" class="nav-link" arialabel="React"><i class="icon iconfont icon-react"></i>React<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/mp/" class="nav-link" arialabel="å°ç¨‹åº"><i class="icon iconfont icon-xiaochengxu"></i>å°ç¨‹åº<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/blog/" class="nav-link" arialabel="Blog"><i class="icon iconfont icon-folder-vuepress"></i>Blog<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="ç´¢å¼•"><span class="title"><i class="icon iconfont icon-index"></i>ç´¢å¼•</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article/" class="nav-link" arialabel="æ–‡ç« "><i class="icon iconfont icon-articles"></i>æ–‡ç« <!----></a></li><li class="dropdown-item"><a href="/category/java/" class="nav-link" arialabel="åˆ†ç±»"><i class="icon iconfont icon-category"></i>åˆ†ç±»<!----></a></li><li class="dropdown-item"><a href="/tag/" class="nav-link" arialabel="æ ‡ç­¾"><i class="icon iconfont icon-tag"></i>æ ‡ç­¾<!----></a></li><li class="dropdown-item"><a href="/timeline/" class="nav-link" arialabel="æ—¶é—´è½´"><i class="icon iconfont icon-timeLine"></i>æ—¶é—´è½´<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzkzOTM3NjAzOQ==&amp;action=getalbum&amp;album_id=2783119709868212224&amp;scene=126&amp;sessionid=-659761542&amp;uin=&amp;key=&amp;devicetype=Windows+11+x64&amp;version=6309092b&amp;lang=zh_CN&amp;ascene=0&amp;session_us=gh_b840974cfe99" rel="noopener noreferrer" target="_blank" arialabel="å¼€æºé¡¹ç›®" class="nav-link"><i class="icon iconfont icon-note"></i>å¼€æºé¡¹ç›®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/chenyl8848/chenyl8848.github.io" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" arialabelledby="outlook"><title id="outlook" lang="en">outlook icon</title><g fill="currentColor"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></g></svg><div class="outlook-dropdown"><!----></div></button></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/rearend/spring/" class="nav-link sidebar-link sidebar-page" arialabel="Spring"><i class="icon iconfont icon-spring"></i>Spring<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/rearend/spring/Spring6.html" class="nav-link sidebar-link sidebar-page" arialabel="Spring6 ä¸‡å­—å…¥é—¨æ•™ç¨‹"><!---->Spring6 ä¸‡å­—å…¥é—¨æ•™ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/rearend/spring/Spring_DI.html" class="nav-link sidebar-link sidebar-page" arialabel="Spring æ³¨å…¥æ–¹å¼"><!---->Spring æ³¨å…¥æ–¹å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/rearend/spring/Spring_Retry.html" class="nav-link sidebar-link sidebar-page" arialabel="Spring Retry å®ç°é‡è¯•æœºåˆ¶"><!---->Spring Retry å®ç°é‡è¯•æœºåˆ¶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" arialabel="Spring Security + OAuth2 æƒé™ç®¡ç†å®æˆ˜"><!---->Spring Security + OAuth2 æƒé™ç®¡ç†å®æˆ˜<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-spring-security-å¿«é€Ÿå…¥é—¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1. Spring Security å¿«é€Ÿå…¥é—¨"><!---->1. Spring Security å¿«é€Ÿå…¥é—¨<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-1-spring-security-ä»‹ç»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.1 Spring Security ä»‹ç»"><!---->1.1 Spring Security ä»‹ç»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-2-spring-security-å¿«é€Ÿæ­å»º" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2 Spring Security å¿«é€Ÿæ­å»º"><!---->1.2 Spring Security å¿«é€Ÿæ­å»º<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-3-spring-security-é»˜è®¤åšäº†ä»€ä¹ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3 Spring Security é»˜è®¤åšäº†ä»€ä¹ˆ"><!---->1.3 Spring Security é»˜è®¤åšäº†ä»€ä¹ˆ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-4-spring-security-åº•å±‚åŸç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.4 Spring Security åº•å±‚åŸç†"><!---->1.4 Spring Security åº•å±‚åŸç†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-5-ç¨‹åºçš„å¯åŠ¨å’Œè¿è¡Œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.5 ç¨‹åºçš„å¯åŠ¨å’Œè¿è¡Œ"><!---->1.5 ç¨‹åºçš„å¯åŠ¨å’Œè¿è¡Œ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-spring-security-è‡ªå®šä¹‰é…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2. Spring Security è‡ªå®šä¹‰é…ç½®"><!---->2. Spring Security è‡ªå®šä¹‰é…ç½®<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-1-åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.1 åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯"><!---->2.1 åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-2-åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2 åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯"><!---->2.2 åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-å¯†ç åŠ å¯†ç®—æ³•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3. å¯†ç åŠ å¯†ç®—æ³•"><!---->3. å¯†ç åŠ å¯†ç®—æ³•<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-1-å¯†ç åŠ å¯†æ–¹å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.1 å¯†ç åŠ å¯†æ–¹å¼"><!---->3.1 å¯†ç åŠ å¯†æ–¹å¼<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-2-passwordencoder" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.2 PasswordEncoder"><!---->3.2 PasswordEncoder<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-3-å¯†ç åŠ å¯†å®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.3 å¯†ç åŠ å¯†å®ç°"><!---->3.3 å¯†ç åŠ å¯†å®ç°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-4-delegatingpasswordencoder" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.4 DelegatingPasswordEncoder"><!---->3.4 DelegatingPasswordEncoder<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_4-æ·»åŠ ç”¨æˆ·" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4. æ·»åŠ ç”¨æˆ·"><!---->4. æ·»åŠ ç”¨æˆ·<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_5-spring-security-çš„é»˜è®¤é…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5. Spring Security çš„é»˜è®¤é…ç½®"><!---->5. Spring Security çš„é»˜è®¤é…ç½®<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_6-è‡ªå®šä¹‰ç™»å½•é¡µé¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6. è‡ªå®šä¹‰ç™»å½•é¡µé¢"><!---->6. è‡ªå®šä¹‰ç™»å½•é¡µé¢<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-å‰åç«¯åˆ†ç¦»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7. å‰åç«¯åˆ†ç¦»"><!---->7. å‰åç«¯åˆ†ç¦»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-1-ç”¨æˆ·è®¤è¯æµç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1 ç”¨æˆ·è®¤è¯æµç¨‹"><!---->7.1 ç”¨æˆ·è®¤è¯æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-2-è®¤è¯æˆåŠŸå“åº”å¤„ç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2 è®¤è¯æˆåŠŸå“åº”å¤„ç†"><!---->7.2 è®¤è¯æˆåŠŸå“åº”å¤„ç†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-3-è®¤è¯å¤±è´¥å“åº”å¤„ç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3 è®¤è¯å¤±è´¥å“åº”å¤„ç†"><!---->7.3 è®¤è¯å¤±è´¥å“åº”å¤„ç†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-4-æ³¨é”€å“åº”å¤„ç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4 æ³¨é”€å“åº”å¤„ç†"><!---->7.4 æ³¨é”€å“åº”å¤„ç†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-5-è¯·æ±‚æœªè®¤è¯æ¥å£å¤„ç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.5 è¯·æ±‚æœªè®¤è¯æ¥å£å¤„ç†"><!---->7.5 è¯·æ±‚æœªè®¤è¯æ¥å£å¤„ç†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-6-è·¨åŸŸå¤„ç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.6 è·¨åŸŸå¤„ç†"><!---->7.6 è·¨åŸŸå¤„ç†<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-èº«ä»½è®¤è¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8. èº«ä»½è®¤è¯"><!---->8. èº«ä»½è®¤è¯<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-1-ç”¨æˆ·è®¤è¯ä¿¡æ¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.1 ç”¨æˆ·è®¤è¯ä¿¡æ¯"><!---->8.1 ç”¨æˆ·è®¤è¯ä¿¡æ¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-2-ä¼šè¯å¹¶å‘å¤„ç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.2 ä¼šè¯å¹¶å‘å¤„ç†"><!---->8.2 ä¼šè¯å¹¶å‘å¤„ç†<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-æˆæƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="9. æˆæƒ"><!---->9. æˆæƒ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-1-åŸºäºrequestçš„æˆæƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="9.1 åŸºäºrequestçš„æˆæƒ"><!---->9.1 åŸºäºrequestçš„æˆæƒ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-1-3-ç”¨æˆ·-è§’è‰²-æƒé™-èµ„æº" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="9.1.3 ç”¨æˆ·-è§’è‰²-æƒé™-èµ„æº"><!---->9.1.3 ç”¨æˆ·-è§’è‰²-æƒé™-èµ„æº<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-2-åŸºäºæ–¹æ³•çš„æˆæƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="9.2 åŸºäºæ–¹æ³•çš„æˆæƒ"><!---->9.2 åŸºäºæ–¹æ³•çš„æˆæƒ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-oauth2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10. OAuth2"><!---->10. OAuth2<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-1-oauth2-ç®€ä»‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10.1 OAuth2 ç®€ä»‹"><!---->10.1 OAuth2 ç®€ä»‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-2-springä¸­çš„oauth2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10.2 Springä¸­çš„OAuth2"><!---->10.2 Springä¸­çš„OAuth2<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-3-giuhub-ç¤¾äº¤ç™»å½•æ¡ˆä¾‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10.3 GiuHub ç¤¾äº¤ç™»å½•æ¡ˆä¾‹"><!---->10.3 GiuHub ç¤¾äº¤ç™»å½•æ¡ˆä¾‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-4-æ¡ˆä¾‹åˆ†æ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10.4 æ¡ˆä¾‹åˆ†æ"><!---->10.4 æ¡ˆä¾‹åˆ†æ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Spring Security + OAuth2 æƒé™ç®¡ç†å®æˆ˜</h1><div class="article-info"><span class="author-info" arialabel="ä½œè€…ğŸ–Š" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://chenyl8848.github.io" target="_blank" rel="noopener noreferrer">Javaé™ˆåºå‘˜</a></span><span property="author" content="Javaé™ˆåºå‘˜"></span></span><!----><span class="date-info" arialabel="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2024å¹´9æœˆ27æ—¥</span><meta property="datePublished" content="2024-09-27T00:00:00.000Z"></span><span class="category-info" arialabel="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category category1 clickable" role="navigation">Spring</li><meta property="articleSection" content="Spring"></ul></span><span arialabel="æ ‡ç­¾ğŸ·" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag tag5 clickable" role="navigation">Spring Security</li><li class="tag tag0 clickable" role="navigation">OAuth2</li></ul><meta property="keywords" content="Spring Security,OAuth2"></span><span class="reading-time-info" arialabel="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" arialabelledby="timer"><title id="timer" lang="en">timer icon</title><g fill="currentColor"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></g></svg><span>å¤§çº¦ 34 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT34M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-spring-security-å¿«é€Ÿå…¥é—¨" class="router-link-active router-link-exact-active toc-link level2">1. Spring Security å¿«é€Ÿå…¥é—¨</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-1-spring-security-ä»‹ç»" class="router-link-active router-link-exact-active toc-link level3">1.1 Spring Security ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-2-spring-security-å¿«é€Ÿæ­å»º" class="router-link-active router-link-exact-active toc-link level3">1.2 Spring Security å¿«é€Ÿæ­å»º</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-3-spring-security-é»˜è®¤åšäº†ä»€ä¹ˆ" class="router-link-active router-link-exact-active toc-link level3">1.3 Spring Security é»˜è®¤åšäº†ä»€ä¹ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-4-spring-security-åº•å±‚åŸç†" class="router-link-active router-link-exact-active toc-link level3">1.4 Spring Security åº•å±‚åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-5-ç¨‹åºçš„å¯åŠ¨å’Œè¿è¡Œ" class="router-link-active router-link-exact-active toc-link level3">1.5 ç¨‹åºçš„å¯åŠ¨å’Œè¿è¡Œ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-spring-security-è‡ªå®šä¹‰é…ç½®" class="router-link-active router-link-exact-active toc-link level2">2. Spring Security è‡ªå®šä¹‰é…ç½®</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-1-åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯" class="router-link-active router-link-exact-active toc-link level3">2.1 åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-2-åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯" class="router-link-active router-link-exact-active toc-link level3">2.2 åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-å¯†ç åŠ å¯†ç®—æ³•" class="router-link-active router-link-exact-active toc-link level2">3. å¯†ç åŠ å¯†ç®—æ³•</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-1-å¯†ç åŠ å¯†æ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">3.1 å¯†ç åŠ å¯†æ–¹å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-2-passwordencoder" class="router-link-active router-link-exact-active toc-link level3">3.2 PasswordEncoder</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-3-å¯†ç åŠ å¯†å®ç°" class="router-link-active router-link-exact-active toc-link level3">3.3 å¯†ç åŠ å¯†å®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-4-delegatingpasswordencoder" class="router-link-active router-link-exact-active toc-link level3">3.4 DelegatingPasswordEncoder</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_4-æ·»åŠ ç”¨æˆ·" class="router-link-active router-link-exact-active toc-link level2">4. æ·»åŠ ç”¨æˆ·</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_5-spring-security-çš„é»˜è®¤é…ç½®" class="router-link-active router-link-exact-active toc-link level2">5. Spring Security çš„é»˜è®¤é…ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_6-è‡ªå®šä¹‰ç™»å½•é¡µé¢" class="router-link-active router-link-exact-active toc-link level2">6. è‡ªå®šä¹‰ç™»å½•é¡µé¢</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-å‰åç«¯åˆ†ç¦»" class="router-link-active router-link-exact-active toc-link level2">7. å‰åç«¯åˆ†ç¦»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-1-ç”¨æˆ·è®¤è¯æµç¨‹" class="router-link-active router-link-exact-active toc-link level3">7.1 ç”¨æˆ·è®¤è¯æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-2-è®¤è¯æˆåŠŸå“åº”å¤„ç†" class="router-link-active router-link-exact-active toc-link level3">7.2 è®¤è¯æˆåŠŸå“åº”å¤„ç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-3-è®¤è¯å¤±è´¥å“åº”å¤„ç†" class="router-link-active router-link-exact-active toc-link level3">7.3 è®¤è¯å¤±è´¥å“åº”å¤„ç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-4-æ³¨é”€å“åº”å¤„ç†" class="router-link-active router-link-exact-active toc-link level3">7.4 æ³¨é”€å“åº”å¤„ç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-5-è¯·æ±‚æœªè®¤è¯æ¥å£å¤„ç†" class="router-link-active router-link-exact-active toc-link level3">7.5 è¯·æ±‚æœªè®¤è¯æ¥å£å¤„ç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-6-è·¨åŸŸå¤„ç†" class="router-link-active router-link-exact-active toc-link level3">7.6 è·¨åŸŸå¤„ç†</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-èº«ä»½è®¤è¯" class="router-link-active router-link-exact-active toc-link level2">8. èº«ä»½è®¤è¯</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-1-ç”¨æˆ·è®¤è¯ä¿¡æ¯" class="router-link-active router-link-exact-active toc-link level3">8.1 ç”¨æˆ·è®¤è¯ä¿¡æ¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-2-ä¼šè¯å¹¶å‘å¤„ç†" class="router-link-active router-link-exact-active toc-link level3">8.2 ä¼šè¯å¹¶å‘å¤„ç†</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-æˆæƒ" class="router-link-active router-link-exact-active toc-link level2">9. æˆæƒ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-1-åŸºäºrequestçš„æˆæƒ" class="router-link-active router-link-exact-active toc-link level3">9.1 åŸºäºrequestçš„æˆæƒ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-1-3-ç”¨æˆ·-è§’è‰²-æƒé™-èµ„æº" class="router-link-active router-link-exact-active toc-link level3">9.1.3 ç”¨æˆ·-è§’è‰²-æƒé™-èµ„æº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-2-åŸºäºæ–¹æ³•çš„æˆæƒ" class="router-link-active router-link-exact-active toc-link level3">9.2 åŸºäºæ–¹æ³•çš„æˆæƒ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-oauth2" class="router-link-active router-link-exact-active toc-link level2">10. OAuth2</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-1-oauth2-ç®€ä»‹" class="router-link-active router-link-exact-active toc-link level3">10.1 OAuth2 ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-2-springä¸­çš„oauth2" class="router-link-active router-link-exact-active toc-link level3">10.2 Springä¸­çš„OAuth2</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-3-giuhub-ç¤¾äº¤ç™»å½•æ¡ˆä¾‹" class="router-link-active router-link-exact-active toc-link level3">10.3 GiuHub ç¤¾äº¤ç™»å½•æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-4-æ¡ˆä¾‹åˆ†æ" class="router-link-active router-link-exact-active toc-link level3">10.4 æ¡ˆä¾‹åˆ†æ</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h1 id="spring-security-oauth2-æƒé™ç®¡ç†å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#spring-security-oauth2-æƒé™ç®¡ç†å®æˆ˜" aria-hidden="true">#</a> Spring Security + OAuth2 æƒé™ç®¡ç†å®æˆ˜</h1><blockquote><p>æ³¨æ„ï¼šæœ¬æ–‡åŸºäº SpringBoot3 !</p></blockquote><h2 id="_1-spring-security-å¿«é€Ÿå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_1-spring-security-å¿«é€Ÿå…¥é—¨" aria-hidden="true">#</a> 1. Spring Security å¿«é€Ÿå…¥é—¨</h2><h3 id="_1-1-spring-security-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-1-spring-security-ä»‹ç»" aria-hidden="true">#</a> 1.1 Spring Security ä»‹ç»</h3><p>Spring Security æ˜¯ä¸€ä¸ªæä¾› <strong>èº«ä»½è®¤è¯ï¼ˆauthenticationï¼‰ã€æˆæƒï¼ˆauthorizationï¼‰å’Œé˜²å¾¡å¸¸è§æ”»å‡»ï¼ˆprotection against common attacksï¼‰</strong> çš„ Java æ¡†æ¶ã€‚SpringSecurity åŸºäº<strong>è¿‡æ»¤å™¨é“¾</strong>çš„æ¦‚å¿µï¼Œå¯ä»¥è½»æ¾åœ°é›†æˆåˆ°ä»»ä½•åŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­ã€‚</p><p><strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong> <code>https://docs.spring.io/spring-security/reference/index.html</code></p><p><strong>åŠŸèƒ½ï¼š</strong></p><ul><li><strong>èº«ä»½è®¤è¯ï¼š</strong> èº«ä»½è®¤è¯æ˜¯éªŒè¯<code>è°æ­£åœ¨è®¿é—®ç³»ç»Ÿèµ„æº</code>ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºåˆæ³•ç”¨æˆ·ã€‚è®¤è¯ç”¨æˆ·çš„å¸¸è§æ–¹å¼æ˜¯è¦æ±‚<code>ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç </code>ã€‚</li><li><strong>æˆæƒï¼š</strong> ç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯åï¼Œç³»ç»Ÿä¼šæ§åˆ¶<code>è°èƒ½è®¿é—®å“ªäº›èµ„æº</code>ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšæˆæƒã€‚ç”¨æˆ·æ— æ³•è®¿é—®æ²¡æœ‰æƒé™çš„èµ„æºã€‚</li><li><strong>é˜²å¾¡å¸¸è§æ”»å‡»ï¼š</strong><ul><li>CSRF</li><li>HTTP Headers</li><li>HTTP Requests</li></ul></li></ul><h3 id="_1-2-spring-security-å¿«é€Ÿæ­å»º" tabindex="-1"><a class="header-anchor" href="#_1-2-spring-security-å¿«é€Ÿæ­å»º" aria-hidden="true">#</a> 1.2 Spring Security å¿«é€Ÿæ­å»º</h3><blockquote><p>Spring Security å®˜æ–¹æä¾›äº†ç¤ºä¾‹ä»£ç ï¼Œå¯é€šè¿‡ä¸‹è½½ç¤ºä¾‹ä»£ç å¿«é€Ÿé›†æˆã€‚</p><p>å®˜æ–¹ä»£ç ç¤ºä¾‹ï¼š<code>https://github.com/spring-projects/spring-security-samples/tree/main</code></p></blockquote><p>1ã€åˆ›å»º SpringBoot é¡¹ç›®ï¼ˆJDK17 + SpringBoot3ï¼‰</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.codechen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springsecurity-oatuh2-demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>2ã€åˆ›å»ºå¯åŠ¨ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3ã€å¯åŠ¨é¡¹ç›®ï¼Œæµè§ˆå™¨ä¸­è®¿é—® <code>http://localhost:8080/</code> ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ <code>http://localhost:8080/login</code></p><blockquote><ul><li><code>é»˜è®¤ç”¨æˆ·å</code>ï¼šuser</li><li><code>é»˜è®¤å¯†ç </code>ï¼šåœ¨æ§åˆ¶å°çš„å¯åŠ¨æ—¥å¿—ä¸­æŸ¥æ‰¾åˆå§‹çš„é»˜è®¤å¯†ç  <code>Using generated security password: c52a3686-2ae8-4ec3-896b-efcbe5c99c74</code></li></ul></blockquote><p><strong>é¡µé¢æ ·å¼æ— æ³•åŠ è½½çš„é—®é¢˜</strong>ï¼š</p><p>é¡µé¢æ ·å¼ <code>bootstrap.min.css</code> æ˜¯ä¸€ä¸ª CDN åœ°å€ï¼Œéœ€è¦é€šè¿‡<strong>ç§‘å­¦ä¸Šç½‘</strong>çš„æ–¹å¼æ‰èƒ½è®¿é—®ã€‚</p><p>å¦åˆ™ç™»å½•é¡µä¼šåŠ è½½å¾ˆä¹…ï¼Œå¹¶ä¸”çœ‹åˆ°çš„é¡µé¢æ˜¯è¿™æ ·çš„ï¼ˆç™»å½•æŒ‰é’®æ²¡æœ‰æ ·å¼æ–‡ä»¶æ¸²æŸ“ï¼Œä½†æ˜¯ä¸å½±å“ç™»å½•åŠŸèƒ½çš„æ‰§è¡Œï¼‰ã€‚</p><h3 id="_1-3-spring-security-é»˜è®¤åšäº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_1-3-spring-security-é»˜è®¤åšäº†ä»€ä¹ˆ" aria-hidden="true">#</a> 1.3 Spring Security é»˜è®¤åšäº†ä»€ä¹ˆ</h3><ul><li>ä¿æŠ¤åº”ç”¨ç¨‹åºURLï¼Œè¦æ±‚å¯¹åº”ç”¨ç¨‹åºçš„ä»»ä½•äº¤äº’è¿›è¡Œèº«ä»½éªŒè¯ã€‚</li><li>ç¨‹åºå¯åŠ¨æ—¶ç”Ÿæˆä¸€ä¸ªé»˜è®¤ç”¨æˆ·â€œuserâ€ã€‚</li><li>ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„éšæœºå¯†ç ï¼Œå¹¶å°†æ­¤å¯†ç è®°å½•åœ¨æ§åˆ¶å°ä¸Šã€‚</li><li>ç”Ÿæˆé»˜è®¤çš„ç™»å½•è¡¨å•å’Œæ³¨é”€é¡µé¢ã€‚</li><li>æä¾›åŸºäºè¡¨å•çš„ç™»å½•å’Œæ³¨é”€æµç¨‹ã€‚</li><li>å¯¹äºWebè¯·æ±‚ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼›</li><li>å¯¹äºæœåŠ¡è¯·æ±‚ï¼Œè¿”å›401æœªç»æˆæƒã€‚</li><li>å¤„ç†è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ”»å‡»ã€‚</li><li>å¤„ç†ä¼šè¯åŠ«æŒæ”»å‡»ã€‚</li><li>å†™å…¥Strict-Transport-Securityä»¥ç¡®ä¿HTTPSã€‚</li><li>å†™å…¥X-Content-Type-Optionsä»¥å¤„ç†å—…æ¢æ”»å‡»ã€‚</li><li>å†™å…¥Cache Controlå¤´æ¥ä¿æŠ¤ç»è¿‡èº«ä»½éªŒè¯çš„èµ„æºã€‚</li><li>å†™å…¥X-Frame-Optionsä»¥å¤„ç†ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚</li></ul><h3 id="_1-4-spring-security-åº•å±‚åŸç†" tabindex="-1"><a class="header-anchor" href="#_1-4-spring-security-åº•å±‚åŸç†" aria-hidden="true">#</a> 1.4 Spring Security åº•å±‚åŸç†</h3><p>Spring Security ä¹‹æ‰€ä»¥å¯ä»¥é»˜è®¤åšè¿™ä¹ˆå¤šäº‹æƒ…ï¼Œå®ƒçš„åº•å±‚åŸç†æ˜¯ç”±å¾ˆå¤šä¸ª <strong>è¿‡æ»¤å™¨ï¼ˆServlet Filtersï¼‰</strong> å®ç°çš„ã€‚</p><p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<code>https://docs.spring.io/spring-security/reference/servlet/architecture.html</code></p><ul><li>Filterï¼ˆè¿‡æ»¤å™¨ï¼‰</li></ul><p>ä¸‹å›¾å±•ç¤ºäº† Spring Security å¤„ç†ä¸€ä¸ª Http è¯·æ±‚æ—¶ï¼Œè¿‡æ»¤å™¨å’Œ Servlet çš„å·¥ä½œæµç¨‹ï¼š</p><p>å®¢æˆ·ç«¯å‘åº”ç”¨ç¨‹åºå‘é€è¯·æ±‚ï¼Œå®¹å™¨æ ¹æ®è¯·æ±‚ URI çš„è·¯å¾„åˆ›å»ºä¸€ä¸ª <code>FilterChain</code>ï¼Œå…¶ä¸­åŒ…å«åº”å¤„ç† <code>HttpServletRequest</code> çš„ <code>Filter</code> å®ä¾‹å’Œ <code>Servlet</code>. åœ¨ Spring MVC åº”ç”¨ç¨‹åºä¸­ï¼Œ<code>Servlet</code> æ˜¯ <code>DispatcherServlet</code> çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ä»£ç ä¸­çš„ <code>Controller</code>.</p><ul><li>DelegatingFilterProxyï¼ˆå§”æ‰˜è¿‡æ»¤ä»£ç†ç±»ï¼‰</li></ul><p><code>DelegatingFilterProxy</code> æ˜¯ Spring Security æä¾›çš„ä¸€ä¸ª <code>Filter</code> å®ç°ï¼Œå¯ä»¥åœ¨ <code>Servlet</code> å®¹å™¨å’Œ Spring å®¹å™¨ä¹‹é—´å»ºç«‹æ¡¥æ¢ã€‚é€šè¿‡ä½¿ç”¨ <code>DelegatingFilterProxy</code>ï¼Œè¿™æ ·å°±å¯ä»¥å°† Servlet å®¹å™¨ä¸­çš„ <code>Filter</code> å®ä¾‹æ”¾åœ¨ Spring å®¹å™¨ä¸­ç®¡ç†ã€‚</p><ul><li>FilterChainProxyï¼ˆè¿‡æ»¤å™¨é“¾ä»£ç†ç±»ï¼‰</li></ul><p>å¤æ‚çš„ä¸šåŠ¡ä¸­ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚å› æ­¤ <code>FilterChainProxy</code> æ˜¯ Spring Security æä¾›çš„ä¸€ä¸ªç‰¹æ®Šçš„ Filterï¼Œå®ƒé€šè¿‡ <code>SecurityFilterChain</code> å°†è¿‡æ»¤å™¨çš„å·¥ä½œå§”æ‰˜ç»™å¤šä¸ª <code>Bean Filter</code> å®ä¾‹ã€‚ç”±äº <code>FilterChainProxy</code> æ˜¯ä¸€ä¸ª Beanï¼Œå› æ­¤å®ƒé€šå¸¸åŒ…è£…åœ¨ <code>DelegatingFilterProxy</code> ä¸­ã€‚</p><ul><li>SecurityFilterChainï¼ˆè¿‡æ»¤å™¨é“¾ï¼‰</li></ul><p><code>SecurityFilterChain</code> è¢« <code>FilterChainProxy</code> ä½¿ç”¨ï¼Œè´Ÿè´£æŸ¥æ‰¾å½“å‰çš„è¯·æ±‚éœ€è¦æ‰§è¡Œçš„ <code>Security Filter</code> åˆ—è¡¨ã€‚</p><ul><li>1.4.5 Multiple SecurityFilterChain</li></ul><p>å¯ä»¥æœ‰å¤šä¸ª <code>SecurityFilterChain</code> çš„é…ç½®ï¼Œ<code>FilterChainProxy</code> å†³å®šä½¿ç”¨å“ªä¸ª <code>SecurityFilterChain</code>.</p><ul><li>å¦‚æœè¯·æ±‚çš„ URL æ˜¯ <code>/api/messages/</code>ï¼Œå®ƒé¦–å…ˆåŒ¹é… <code>SecurityFilterChain0</code> çš„æ¨¡å¼ <code>/api/\*\*</code>ï¼Œå› æ­¤åªè°ƒç”¨ <code>SecurityFilterChain 0</code>ã€‚</li><li>å‡è®¾æ²¡æœ‰å…¶ä»– <code>SecurityFilterChain</code> å®ä¾‹åŒ¹é…ï¼Œé‚£ä¹ˆå°†è°ƒç”¨ <code>SecurityFilterChain n</code>.</li></ul><h3 id="_1-5-ç¨‹åºçš„å¯åŠ¨å’Œè¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#_1-5-ç¨‹åºçš„å¯åŠ¨å’Œè¿è¡Œ" aria-hidden="true">#</a> 1.5 ç¨‹åºçš„å¯åŠ¨å’Œè¿è¡Œ</h3><ul><li>DefaultSecurityFilterChain</li></ul><p>SecurityFilterChain æ¥å£çš„é»˜è®¤å®ç°ï¼Œåˆå§‹åŒ–å®ä¾‹æ—¶é»˜è®¤åŠ è½½äº† 16 ä¸ª <code>Filter</code>.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">DefaultSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">RequestMatcher</span> requestMatcher<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Filter</span><span class="token punctuation">&gt;</span></span> filters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>filters<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Will not secure %s&quot;</span><span class="token punctuation">,</span> requestMatcher<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Will secure %s with %s&quot;</span><span class="token punctuation">,</span> requestMatcher<span class="token punctuation">,</span> filters<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>requestMatcher <span class="token operator">=</span> requestMatcher<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>filters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span>filters<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>2024-09-28T20:54:54.048+08:00  INFO 6312 --- [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [
org.springframework.security.web.session.DisableEncodeUrlFilter@2be21396,
org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@124dac75,
org.springframework.security.web.context.SecurityContextHolderFilter@53b1a3f8, 
org.springframework.security.web.header.HeaderWriterFilter@45c9b3, 
org.springframework.web.filter.CorsFilter@315105f, 
org.springframework.security.web.csrf.CsrfFilter@3252747e, 
org.springframework.security.web.authentication.logout.LogoutFilter@7327a447, 
org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter@21263314, 
org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter@3eb292cd, 
org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter@7b61bf11, 
org.springframework.security.web.authentication.www.BasicAuthenticationFilter@b73433, 
org.springframework.security.web.savedrequest.RequestCacheAwareFilter@5a936e64, 
org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@3b4a1a75, 
org.springframework.security.web.authentication.AnonymousAuthenticationFilter@40247d48, 
org.springframework.security.web.access.ExceptionTranslationFilter@68d6d775, 
org.springframework.security.web.access.intercept.AuthorizationFilter@4c6b4ed7]
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>SecurityProperties</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ <code>Spring Security</code> å°†åˆå§‹çš„ç”¨æˆ·åå’Œå¯†ç å­˜åœ¨äº† <code>SecurityProperties</code> ç±»ä¸­ã€‚è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±» <code>User</code>ï¼Œé…ç½®äº†é»˜è®¤çš„ç”¨æˆ·åï¼ˆ<code>name = &quot;user&quot;</code>ï¼‰å’Œå¯†ç ï¼ˆ<code>password = uuid</code>ï¼‰</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>
    prefix <span class="token operator">=</span> <span class="token string">&quot;spring.security&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> password <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>å¯ä»¥å°†ç”¨æˆ·åã€å¯†ç é…ç½®åœ¨ SpringBoot çš„é…ç½®æ–‡ä»¶ä¸­ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">security</span><span class="token punctuation">:</span> 
    <span class="token key atrule">user</span><span class="token punctuation">:</span> 
      <span class="token key atrule">name</span><span class="token punctuation">:</span> admin
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_2-spring-security-è‡ªå®šä¹‰é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-spring-security-è‡ªå®šä¹‰é…ç½®" aria-hidden="true">#</a> 2. Spring Security è‡ªå®šä¹‰é…ç½®</h2><h3 id="_2-1-åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_2-1-åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯" aria-hidden="true">#</a> 2.1 åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯</h3><h4 id="_2-1-1-åˆ›å»ºè‡ªå®šä¹‰é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-1-1-åˆ›å»ºè‡ªå®šä¹‰é…ç½®" aria-hidden="true">#</a> 2.1.1 åˆ›å»ºè‡ªå®šä¹‰é…ç½®</h4><p>å®é™…å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åº”ç”¨ç¨‹åºæ›´åŠ çµæ´»ï¼Œå¯ä»¥åœ¨ Spring Security ä¸­åˆ›å»ºè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚</p><blockquote><p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼šhttps://docs.spring.io/spring-security/reference/servlet/configuration/java.html</p></blockquote><p>1ã€åˆ›å»ºä¸€ä¸ª <code>WebSecurityConfig</code> æ–‡ä»¶</p><p>2ã€å®šä¹‰ä¸€ä¸ª <code>@Bean</code>ï¼Œç±»å‹æ˜¯ <code>UserDetailsService</code>ï¼Œå®ç°æ˜¯ <code>InMemoryUserDetailsManager</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token comment">// å¼€å¯ Security é…ç½®ï¼Œåœ¨ SpringBoot ç¯å¢ƒä¸­ï¼Œæ— éœ€å¼•å…¥è¯¥æ³¨è§£</span>
<span class="token comment">// åœ¨ SpringBootWebSecurityConfiguration ä¸­å·²ç»å¼•å…¥</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// åˆ›å»ºåŸºäºå†…å­˜çš„ç”¨æˆ·ä¿¡æ¯ç®¡ç†å™¨</span>
        <span class="token class-name">InMemoryUserDetailsManager</span> userDetailsManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä½¿ç”¨ userDetailsManager ç®¡ç† UserDetails å¯¹è±¡</span>
        userDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>
                <span class="token comment">// åˆ›å»º UserDetails å¯¹è±¡ï¼Œç”¨äºç®¡ç†ç”¨æˆ·åã€ç”¨æˆ·å¯†ç ã€ç”¨æˆ·è§’è‰²ã€ç”¨æˆ·æƒé™ç­‰å†…å®¹</span>
                <span class="token class-name">User</span>
                <span class="token punctuation">.</span><span class="token function">withDefaultPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">&quot;CodeChen&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> userDetailsManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong>UserDetailsService</strong> ç”¨æ¥ç®¡ç†ç”¨æˆ·ä¿¡æ¯ï¼Œ<strong>InMemoryUserDetailsManager</strong> æ˜¯ <code>UserDetailsService</code> çš„ä¸€ä¸ªå®ç°ï¼Œç”¨æ¥ç®¡ç†åŸºäºå†…å­˜çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶é…ç½® <code>SecurityProperties</code> ä¸­çš„ç”¨æˆ·åã€å¯†ç ä¼šå¤±æ•ˆï¼</p></blockquote><h4 id="_2-1-2-åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-1-2-åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯æµç¨‹" aria-hidden="true">#</a> 2.1.2 åŸºäºå†…å­˜çš„ç”¨æˆ·è®¤è¯æµç¨‹</h4><ul><li>ç¨‹åºå¯åŠ¨æ—¶ï¼š <ul><li>åˆ›å»º <code>InMemoryUserDetailsManager</code> å¯¹è±¡</li><li>åˆ›å»º <code>User</code> å¯¹è±¡ï¼Œå°è£…ç”¨æˆ·åå¯†ç </li><li>ä½¿ç”¨ <code>InMemoryUserDetailsManager</code> å°† <code>User</code> å­˜å…¥å†…å­˜</li></ul></li><li>æ ¡éªŒç”¨æˆ·æ—¶ï¼š <ul><li>Spring Security è‡ªåŠ¨ä½¿ç”¨ <code>InMemoryUserDetailsManager</code> çš„ <code>loadUserByUsername</code> æ–¹æ³•ä»<strong>å†…å­˜ä¸­</strong>è·å– <code>User</code> å¯¹è±¡</li><li>åœ¨ <code>UsernamePasswordAuthenticationFilter</code> è¿‡æ»¤å™¨ä¸­çš„ <code>attemptAuthentication</code> æ–¹æ³•ä¸­å°†ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå¯†ç å’Œä»å†…å­˜ä¸­è·å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œè¿›è¡Œç”¨æˆ·è®¤è¯</li></ul></li></ul><h3 id="_2-2-åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_2-2-åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯" aria-hidden="true">#</a> 2.2 åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯</h3><h4 id="_2-2-1-æ•°æ®åº“ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#_2-2-1-æ•°æ®åº“ç¯å¢ƒæ­å»º" aria-hidden="true">#</a> 2.2.1 æ•°æ®åº“ç¯å¢ƒæ­å»º</h4><p>1ã€åˆ›å»ºæ•°æ®åº“è¡¨å¹¶æ’å…¥æµ‹è¯•æ•°æ®</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- åˆ›å»ºæ•°æ®åº“</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token identifier"><span class="token punctuation">`</span>security-demo<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">USE</span> <span class="token identifier"><span class="token punctuation">`</span>security-demo<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token comment">-- åˆ›å»ºç”¨æˆ·è¡¨</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>enabled<span class="token punctuation">`</span></span> <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- å”¯ä¸€ç´¢å¼•</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user_username_uindex<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">-- æ’å…¥ç”¨æˆ·æ•°æ®(å¯†ç æ˜¯ &quot;123456&quot; )</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>enabled<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;{bcrypt}$2a$10$E49Zm6HtzhSYvCcYkj5dve7Gc3Biu.iZ680bfiqx6Go6iodgL4VTa&#39;</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&#39;Helen&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;{bcrypt}$2a$10$E49Zm6HtzhSYvCcYkj5dve7Gc3Biu.iZ680bfiqx6Go6iodgL4VTa&#39;</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&#39;Tom&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;{bcrypt}$2a$10$E49Zm6HtzhSYvCcYkj5dve7Gc3Biu.iZ680bfiqx6Go6iodgL4VTa&#39;</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>2ã€å¼•å…¥ä¾èµ–</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.31<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-spring-boot3-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>3ã€é…ç½®æ•°æ®æº</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># MySQL æ•°æ®æº</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
<span class="token comment">#    todo ä¿®æ”¹å¯†ç </span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/security<span class="token punctuation">-</span>demo
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root

<span class="token comment"># æ‰“å°SQLæ—¥å¿—</span>
<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>4ã€å®ä½“ç±»</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUser</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/** ä¸»é”® */</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** ç”¨æˆ·å */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** å¯†ç  */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** æ˜¯å¦å¯ç”¨ */</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> enabled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>5ã€Mapper</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SysUserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>6ã€Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISysUserService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUserImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUserMapper</span><span class="token punctuation">,</span> <span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">ISysUserService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>7ã€Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;sysuser&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysUserService</span> sysUserService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/getSysUserList&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSysUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sysUserService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>æµ‹è¯•</strong>ï¼š<code>http://localhost:8080/sysuser/list</code></p><h4 id="_2-2-2-åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-2-2-åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯æµç¨‹" aria-hidden="true">#</a> 2.2.2 åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯æµç¨‹</h4><ul><li>ç¨‹åºå¯åŠ¨æ—¶ï¼š <ul><li>åˆ›å»º <code>UserDetailServiceImpl</code> ç±»ï¼Œå®ç° <code>UserDetailsService</code> æ¥å£çš„ <code>loadUserByUsername</code> æ–¹æ³•</li><li>å°† <code>UserDetailServiceImpl</code> ç±»æ³¨å…¥åˆ° IOC å®¹å™¨ä¸­</li></ul></li><li>æ ¡éªŒç”¨æˆ·æ—¶ï¼š <ul><li>Spring Security è‡ªåŠ¨ä½¿ç”¨ <code>UserDetailServiceImpl</code> çš„ <code>loadUserByUsername</code> æ–¹æ³•ä»<strong>æ•°æ®åº“ä¸­</strong>è·å– <code>SysUser</code> å¯¹è±¡ï¼Œå¹¶å°è£…ä¸º <code>UserDetails</code></li><li>åœ¨ <code>UsernamePasswordAuthenticationFilter</code> è¿‡æ»¤å™¨ä¸­çš„ <code>attemptAuthentication</code> æ–¹æ³•ä¸­å°†ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå¯†ç å’Œä»æ•°æ®åº“ä¸­è·å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œè¿›è¡Œç”¨æˆ·è®¤è¯</li></ul></li></ul><h4 id="_2-2-3-å®šä¹‰-userdetailserviceimpl" tabindex="-1"><a class="header-anchor" href="#_2-2-3-å®šä¹‰-userdetailserviceimpl" aria-hidden="true">#</a> 2.2.3 å®šä¹‰ <code>UserDetailServiceImpl</code></h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDetailServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysUserService</span> sysUserService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SysUser</span> sysUser <span class="token operator">=</span> sysUserService<span class="token punctuation">.</span><span class="token function">getSysUserByUerName</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>
                sysUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                sysUser<span class="token punctuation">.</span><span class="token function">getEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">// ç”¨æˆ·è´¦å·ä¸è¿‡æœŸ</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token comment">// ç”¨æˆ·å‡­è¯ä¸è¿‡æœŸ</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token comment">// ç”¨æˆ·ä¸é”å®š</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token comment">// ç”¨æˆ·æƒé™</span>
                authorities<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>æµ‹è¯•</strong>ï¼šä½¿ç”¨æ•°æ®åº“ä¸­é…ç½®çš„ç”¨æˆ·å <code>admin</code> å’Œå¯†ç  <code>123456</code> è¿›è¡Œç™»å½•ã€‚</p><h2 id="_3-å¯†ç åŠ å¯†ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#_3-å¯†ç åŠ å¯†ç®—æ³•" aria-hidden="true">#</a> 3. å¯†ç åŠ å¯†ç®—æ³•</h2><p>åœ¨å‰é¢åŸºäºæ•°æ®åº“çš„ç”¨æˆ·è®¤è¯ä¸­ï¼Œæˆ‘ä»¬è¾“å…¥ç”¨æˆ·å <code>admin</code>ã€å¯†ç  <code>123456</code> å°±èƒ½å®ç°ç”¨æˆ·è®¤è¯ç™»å½•ã€‚</p><p>ä½†æ˜¯æ•°æ®åº“ä¸­ <code>admin</code> çš„å¯†ç æ˜æ˜æ˜¯ <code>{bcrypt}$2a$10$E49Zm6HtzhSYvCcYkj5dve7Gc3Biu.iZ680bfiqx6Go6iodgL4VTa</code>, ä¸ºä»€ä¹ˆç™»å½•å¯†ç åè€Œæ˜¯ <code>123456</code> å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆå›é¡¾ä¸‹å¸¸ç”¨çš„å¯†ç åŠ å¯†æ–¹å¼ã€‚</p><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š<code>https://docs.spring.io/spring-security/reference/features/authentication/password-storage.html</code></p><h3 id="_3-1-å¯†ç åŠ å¯†æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_3-1-å¯†ç åŠ å¯†æ–¹å¼" aria-hidden="true">#</a> 3.1 å¯†ç åŠ å¯†æ–¹å¼</h3><ul><li>æ˜æ–‡å¯†ç </li></ul><p>æœ€åˆï¼Œå¯†ç ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä½†æ˜¯æ¶æ„ç”¨æˆ·å¯èƒ½ä¼šé€šè¿‡ SQL æ³¨å…¥ç­‰æ‰‹æ®µè·å–åˆ°æ˜æ–‡å¯†ç ï¼Œæˆ–è€…ç¨‹åºå‘˜å°†æ•°æ®åº“æ•°æ®æ³„éœ²çš„æƒ…å†µä¹Ÿå¯èƒ½å‘ç”Ÿã€‚</p><ul><li>å“ˆå¸Œç®—æ³•</li></ul><p>ä½¿ç”¨<strong>å“ˆå¸Œç®—æ³•</strong>å¯¹å¯†ç è¿›è¡Œ<strong>å•å‘è½¬æ¢</strong>ï¼Œå¸¸è§çš„å“ˆå¸Œç®—æ³•å¦‚ <code>MD5</code>ã€<code>SHA-256</code>ã€<code>SHA-512</code> ç­‰ã€‚</p><p><strong>å“ˆå¸Œç®—æ³•æ˜¯å•å‘çš„ï¼Œåªèƒ½åŠ å¯†ï¼Œä¸èƒ½è§£å¯†</strong>ã€‚</p><p>å› æ­¤ï¼Œ<strong>æ•°æ®åº“ä¸­å­˜å‚¨çš„æ˜¯å•å‘è½¬æ¢åçš„å¯†ç </strong>ï¼Œåœ¨è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯æ—¶éœ€è¦å°†ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡Œå•å‘è½¬æ¢ï¼Œç„¶åä¸æ•°æ®åº“çš„å¯†ç è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å¦‚æœå‘ç”Ÿæ•°æ®æ³„éœ²ï¼Œåªæœ‰å¯†ç çš„å•å‘å“ˆå¸Œä¼šè¢«æš´éœ²ã€‚ç”±äºå“ˆå¸Œæ˜¯å•å‘çš„ï¼Œå¹¶ä¸”åœ¨ç»™å®šå“ˆå¸Œçš„æƒ…å†µä¸‹åªèƒ½é€šè¿‡<strong>æš´åŠ›ç ´è§£çš„æ–¹å¼çŒœæµ‹å¯†ç </strong>ã€‚</p><ul><li>å½©è™¹è¡¨</li></ul><p>å½©è™¹è¡¨å°±æ˜¯ä¸€ä¸ªåºå¤§çš„ã€é’ˆå¯¹å„ç§å¯èƒ½çš„å­—æ¯ç»„åˆé¢„å…ˆç”Ÿæˆçš„å“ˆå¸Œå€¼é›†åˆï¼Œæœ‰äº†å®ƒå¯ä»¥å¿«é€Ÿç ´è§£å„ç±»å¯†ç ã€‚</p><p>è¶Šæ˜¯å¤æ‚çš„å¯†ç ï¼Œéœ€è¦çš„å½©è™¹è¡¨å°±è¶Šå¤§ï¼Œä¸»æµçš„å½©è™¹è¡¨éƒ½æ˜¯100Gä»¥ä¸Šï¼Œç›®å‰ä¸»è¦çš„ç®—æ³•æœ‰LMã€NTLMã€MD5ã€SHA1ã€MYSQLSHA1ã€HALFLMCHALLã€NTLMCHALLã€ORACLE-SYSTEMã€MD5-HALF.</p><ul><li>åŠ ç›å¯†ç </li></ul><p>ä¸ºäº†å‡è½»å½©è™¹è¡¨çš„æ•ˆæœï¼Œå¼€å‘äººå‘˜å¼€å§‹ä½¿ç”¨<strong>åŠ ç›å¯†ç </strong>ã€‚</p><p>ä¸å†åªä½¿ç”¨å¯†ç ä½œä¸ºå“ˆå¸Œå‡½æ•°çš„è¾“å…¥ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªç”¨æˆ·çš„å¯†ç ç”Ÿæˆ<strong>éšæœºå­—èŠ‚ï¼ˆç§°ä¸ºç›ï¼‰</strong>ã€‚</p><p><strong>ç›å’Œç”¨æˆ·çš„å¯†ç å°†ä¸€èµ·ç»è¿‡å“ˆå¸Œå‡½æ•°è¿ç®—ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„å“ˆå¸Œ</strong>ã€‚</p><p>ç›å°†ä»¥æ˜æ–‡å½¢å¼ä¸ç”¨æˆ·çš„å¯†ç ä¸€èµ·å­˜å‚¨ï¼Œç„¶åï¼Œå½“ç”¨æˆ·å°è¯•è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œç›å’Œç”¨æˆ·è¾“å…¥çš„å¯†ç ä¸€èµ·ç»è¿‡å“ˆå¸Œå‡½æ•°è¿ç®—ï¼Œå†ä¸å­˜å‚¨çš„å¯†ç è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å”¯ä¸€çš„ç›æ„å‘³ç€å½©è™¹è¡¨ä¸å†æœ‰æ•ˆï¼Œå› ä¸ºå¯¹äºæ¯ä¸ªç›å’Œå¯†ç çš„ç»„åˆï¼Œå“ˆå¸Œéƒ½æ˜¯ä¸åŒçš„ã€‚</p><ul><li>è‡ªé€‚åº”å•å‘å‡½æ•°</li></ul><p>éšç€ç¡¬ä»¶çš„ä¸æ–­å‘å±•ï¼ŒåŠ ç›å¯†ç ä¹Ÿä¸å†å®‰å…¨ã€‚åŸå› æ˜¯ï¼Œè®¡ç®—æœºå¯ä»¥æ¯ç§’æ‰§è¡Œæ•°åäº¿æ¬¡å“ˆå¸Œè®¡ç®—ï¼Œè¿™æ„å‘³ç€å¯ä»¥è½»æ¾åœ°ç ´è§£æ¯ä¸ªå¯†ç ã€‚</p><p>ç°åœ¨ï¼Œå¼€å‘äººå‘˜å¼€å§‹ä½¿ç”¨è‡ªé€‚åº”å•å‘å‡½æ•°æ¥å­˜å‚¨å¯†ç ã€‚</p><p>ä½¿ç”¨è‡ªé€‚åº”å•å‘å‡½æ•°éªŒè¯å¯†ç æ—¶ï¼Œ<strong>æ•…æ„å ç”¨èµ„æºï¼ˆæ•…æ„ä½¿ç”¨å¤§é‡çš„CPUã€å†…å­˜æˆ–å…¶ä»–èµ„æºï¼‰</strong>ã€‚è‡ªé€‚åº”å•å‘å‡½æ•°å…è®¸é…ç½®ä¸€ä¸ª<strong>å·¥ä½œå› å­</strong>ï¼Œéšç€ç¡¬ä»¶çš„æ”¹è¿›è€Œå¢åŠ ã€‚</p><blockquote><p>å»ºè®®å°†<strong>å·¥ä½œå› å­</strong>è°ƒæ•´åˆ°ç³»ç»Ÿä¸­éªŒè¯å¯†ç éœ€è¦çº¦ä¸€ç§’é’Ÿçš„æ—¶é—´ï¼Œè¿™ç§æƒè¡¡æ˜¯ä¸ºäº†<strong>è®©æ”»å‡»è€…éš¾ä»¥ç ´è§£å¯†ç </strong>ã€‚</p></blockquote><p>è‡ªé€‚åº”å•å‘å‡½æ•°åŒ…æ‹¬ <code>BCrypt</code>ã€<code>PBKDF2</code>ã€<code>Scrypt</code> å’Œ <code>Argon2</code>.</p><h3 id="_3-2-passwordencoder" tabindex="-1"><a class="header-anchor" href="#_3-2-passwordencoder" aria-hidden="true">#</a> 3.2 PasswordEncoder</h3><p>Spring Security ä¸­ä¸€ä¸ªåŸºäºè‡ªé€‚åº”å•é¡¹å‡½æ•°å®ç°çš„å¯†ç è§£æå™¨æ¥å£ï¼Œç”¨ä»¥è¿›è¡Œå¯†ç å­˜å‚¨å’Œæ ¡éªŒã€‚</p><p>PasswordEncoder æ¥å£å…·ä½“çš„å®ç°ç±»æœ‰ï¼š</p><ul><li>BCryptPasswordEncoder</li></ul><p>ä½¿ç”¨å¹¿æ³›æ”¯æŒçš„ BCrypt ç®—æ³•æ¥å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œã€‚</p><p>ä¸ºäº†å¢åŠ å¯¹å¯†ç ç ´è§£çš„æŠµæŠ—åŠ›ï¼ŒBCrypt æ•…æ„è®¾è®¡å¾—è¾ƒæ…¢ã€‚å’Œå…¶ä»–è‡ªé€‚åº”å•å‘å‡½æ•°ä¸€æ ·ï¼Œåº”è¯¥è°ƒæ•´å…¶å‚æ•°ï¼Œä½¿å…¶åœ¨æ‚¨çš„ç³»ç»Ÿä¸ŠéªŒè¯ä¸€ä¸ªå¯†ç å¤§çº¦éœ€è¦ 1 ç§’çš„æ—¶é—´ã€‚</p><p><strong>BCryptPasswordEncoder è‡ªå¸¦ Salt åŠ ç›æœºåˆ¶ï¼Œå³ä½¿ç›¸åŒçš„æ˜æ–‡æ¯æ¬¡ç”Ÿæˆçš„åŠ å¯†å­—ç¬¦ä¸²éƒ½ä¸ç›¸åŒã€‚é»˜è®¤å®ç°ä½¿ç”¨å¼ºåº¦ 10, å»ºè®®æ‚¨åœ¨è‡ªå·±çš„ç³»ç»Ÿä¸Šè°ƒæ•´å’Œæµ‹è¯•å¼ºåº¦å‚æ•°ï¼Œä»¥ä¾¿éªŒè¯å¯†ç æ—¶å¤§çº¦éœ€è¦ 1 ç§’çš„æ—¶é—´</strong>ã€‚</p><ul><li>Argon2PasswordEncoder</li></ul><p>ä½¿ç”¨ Argon2 ç®—æ³•å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚</p><p>ä¸ºäº†é˜²æ­¢åœ¨è‡ªå®šä¹‰ç¡¬ä»¶ä¸Šè¿›è¡Œå¯†ç ç ´è§£ï¼ŒArgon2 æ˜¯ä¸€ç§æ•…æ„ç¼“æ…¢çš„ç®—æ³•ï¼Œéœ€è¦å¤§é‡å†…å­˜ã€‚</p><p>å½“å‰çš„ Argon2PasswordEncoder å®ç°éœ€è¦ä½¿ç”¨ BouncyCastle åº“ã€‚</p><ul><li>Pbkdf2PasswordEncoder</li></ul><p>ä½¿ç”¨ PBKDF2 ç®—æ³•å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚</p><p>ä¸ºäº†é˜²æ­¢å¯†ç ç ´è§£ï¼ŒPBKDF2 æ˜¯ä¸€ç§æ•…æ„ç¼“æ…¢çš„ç®—æ³•ã€‚</p><p>å½“éœ€è¦ FIPS è®¤è¯æ—¶ï¼Œè¿™ç§ç®—æ³•æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p><ul><li>SCryptPasswordEncoder</li></ul><p>ä½¿ç”¨ SCrypt ç®—æ³•å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚</p><h3 id="_3-3-å¯†ç åŠ å¯†å®ç°" tabindex="-1"><a class="header-anchor" href="#_3-3-å¯†ç åŠ å¯†å®ç°" aria-hidden="true">#</a> 3.3 å¯†ç åŠ å¯†å®ç°</h3><p>åœ¨æµ‹è¯•ç±»ä¸­ç¼–å†™ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// å·¥ä½œå› å­ï¼Œé»˜è®¤å€¼æ˜¯ 10ï¼Œæœ€å°å€¼æ˜¯ 4ï¼Œæœ€å¤§å€¼æ˜¯ 31ï¼Œå€¼è¶Šå¤§è¿ç®—é€Ÿåº¦è¶Šæ…¢</span>
    <span class="token class-name">PasswordEncoder</span> encoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ˜æ–‡ï¼š&quot;123456&quot;</span>
    <span class="token comment">// å¯†æ–‡ï¼šresultï¼Œå³ä½¿æ˜æ–‡å¯†ç ç›¸åŒï¼Œæ¯æ¬¡ç”Ÿæˆçš„å¯†æ–‡ä¹Ÿä¸ä¸€è‡´</span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//å¯†ç æ ¡éªŒ</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>encoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;å¯†ç ä¸ä¸€è‡´&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-4-delegatingpasswordencoder" tabindex="-1"><a class="header-anchor" href="#_3-4-delegatingpasswordencoder" aria-hidden="true">#</a> 3.4 DelegatingPasswordEncoder</h3><ul><li>è¡¨ä¸­å­˜å‚¨çš„å¯†ç å½¢å¼ï¼š<code>{bcrypt}$2a$10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW</code></li><li>é€šè¿‡å¦‚ä¸‹æºç å¯ä»¥çŸ¥é“ï¼šå¯ä»¥é€šè¿‡ <code>{bcrypt}</code> å‰ç¼€åŠ¨æ€è·å–å’Œå¯†ç çš„å½¢å¼ç±»å‹ä¸€è‡´çš„ PasswordEncoder å¯¹è±¡</li><li>ç›®çš„ï¼šæ–¹ä¾¿éšæ—¶åšå¯†ç ç­–ç•¥çš„å‡çº§ï¼Œå…¼å®¹æ•°æ®åº“ä¸­çš„è€ç‰ˆæœ¬å¯†ç ç­–ç•¥ç”Ÿæˆçš„å¯†ç </li></ul><h2 id="_4-æ·»åŠ ç”¨æˆ·" tabindex="-1"><a class="header-anchor" href="#_4-æ·»åŠ ç”¨æˆ·" aria-hidden="true">#</a> 4. æ·»åŠ ç”¨æˆ·</h2><p>1ã€<code>SysUserController</code> ä¸­æ·»åŠ æ–¹æ³•</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSysUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sysUserService<span class="token punctuation">.</span><span class="token function">addSysUser</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2ã€<code>ISysUserService</code> æ¥å£ä¸­æ·»åŠ æ–¹æ³•</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">addSysUser</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3ã€<code>SysUserImpl</code> å®ç°ä¸­æ·»åŠ æ–¹æ³•å®ç°</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">PasswordEncoder</span> passwordEncoder <span class="token operator">=</span> <span class="token class-name">PasswordEncoderFactories</span><span class="token punctuation">.</span><span class="token function">createDelegatingPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSysUser</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// ä½¿ç”¨ PasswordEncoder åŠ å¯†ç”¨æˆ·è¾“å…¥çš„å¯†ç </span>
    sysUser<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">save</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>4ã€ä½¿ç”¨ Swagger æµ‹è¯•</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- å¼•å…¥ Swagger ä¾èµ– --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.xiaoymin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>knife4j-openapi3-jakarta-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Swaggeræµ‹è¯•åœ°å€</strong>ï¼š<code>http://localhost:8080/doc.html</code></p><p>5ã€å…³é—­ CSRF æ”»å‡»é˜²å¾¡</p><p>é»˜è®¤æƒ…å†µä¸‹ Spring Security å¼€å¯äº† CSRF æ”»å‡»é˜²å¾¡çš„åŠŸèƒ½ï¼Œè¿™è¦æ±‚è¯·æ±‚å‚æ•°ä¸­å¿…é¡»æœ‰ä¸€ä¸ªéšè—çš„ <code>_csrf</code> å­—æ®µï¼Œå¦‚ä¸‹ï¼š</p><p>éœ€è¦åœ¨ Spring Security çš„é»˜è®¤é…ç½®ä¸­å…³é—­ CSRF æ”»å‡»é˜²å¾¡ã€‚</p><p>åœ¨ <code>WebSecurityConfig</code> ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_5-spring-security-çš„é»˜è®¤é…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-spring-security-çš„é»˜è®¤é…ç½®" aria-hidden="true">#</a> 5. Spring Security çš„é»˜è®¤é…ç½®</h2><p>æˆ‘ä»¬ä¸ºäº†å…³é—­ CSRF æ”»å‡»é˜²å¾¡ï¼Œåœ¨ <code>WebSecurityConfig</code> ä¸­æ³¨å…¥äº† <code>SecurityFilterChain</code>. åœ¨è¿™é‡Œå¯ä»¥ä¿®æ”¹æ·»åŠ  Spring Security çš„é»˜è®¤é…ç½®ï¼Œæ¯”å¦‚<strong>å¼€å¯æˆæƒä¿æŠ¤ã€ä¿®æ”¹è¡¨å•æˆæƒæ¨¡å¼ã€è‡ªå®šä¹‰ç™»å½•é¡µç­‰ç­‰</strong>ã€‚</p><p>1ã€å¼€å¯æˆæƒä¿æŠ¤</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>å¼€å¯åï¼Œæ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦ç»è¿‡ç™»å½•åæ‰èƒ½è®¿é—®ã€‚</p><p>2ã€ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦ç™»å½•è¡¨å•æˆæƒ</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> httpSecurity
                <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
                <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
                <span class="token comment">// åŸºæœ¬æˆæƒæ–¹å¼</span>
                <span class="token punctuation">.</span><span class="token function">httpBasic</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="_6-è‡ªå®šä¹‰ç™»å½•é¡µé¢" tabindex="-1"><a class="header-anchor" href="#_6-è‡ªå®šä¹‰ç™»å½•é¡µé¢" aria-hidden="true">#</a> 6. è‡ªå®šä¹‰ç™»å½•é¡µé¢</h2><p>åœ¨å¼€å‘ä¸­ï¼Œä¸ºäº†å®ç°æ›´å¥½çš„äº¤äº’ï¼Œå¾€å¾€éƒ½æ˜¯è‡ªå·±å¼€å‘ç™»å½•é¡µé¢ã€‚é‚£ä¹ˆï¼Œåœ¨ Spring Security è¦æ€ä¹ˆé…ç½®è‡ªå®šä¹‰ç™»å½•é¡µé¢å‘¢ï¼Ÿ</p><p>1ã€å¼•å…¥æ¨¡æ¿å¼•æ“ <code>thymeleaf</code> ä¾èµ–</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2ã€åˆ›å»º <code>LoginController</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>3ã€åœ¨ <code>resources/templates/</code> ç›®å½•ä¸‹åˆ›å»ºç™»å½•é¡µé¢ <code>login.html</code></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>ç™»å½•<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>ç™»å½•<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${param.error}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    é”™è¯¯çš„ç”¨æˆ·åå’Œå¯†ç .<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--methodå¿…é¡»ä¸º&quot;post&quot;--&gt;</span>
<span class="token comment">&lt;!--th:action=&quot;@{/login}&quot; ï¼Œ
ä½¿ç”¨åŠ¨æ€å‚æ•°ï¼Œè¡¨å•ä¸­ä¼šè‡ªåŠ¨ç”Ÿæˆ_csrféšè—å­—æ®µï¼Œç”¨äºé˜²æ­¢csrfæ”»å‡»
login: å’Œç™»å½•é¡µé¢ä¿æŒä¸€è‡´å³å¯ï¼ŒSpringSecurityè‡ªåŠ¨è¿›è¡Œç™»å½•è®¤è¯--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/login}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nameå¿…é¡»ä¸º&quot;username&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ç”¨æˆ·å<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nameå¿…é¡»ä¸º&quot;password&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>å¯†ç <span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ç™»å½•<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>4ã€é…ç½® <code>WebSecurityConfig</code> ä¸­çš„ <code>SecurityFilterChain</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// åŸºæœ¬æˆæƒæ–¹å¼</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// é…ç½®è‡ªå®šä¹‰ç™»å½•é¡µ</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®ç™»å½•é¡µæ— éœ€æˆæƒå³å¯è®¿é—®</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><blockquote><p>æ³¨æ„ï¼šéœ€è¦é…ç½®ç™»å½•é¡µæ— éœ€æˆæƒå³å¯è®¿é—®ï¼Œå¦åˆ™ä¼šç”±äº<strong>é‡å®šå‘çš„æ¬¡æ•°è¿‡å¤šå¯¼è‡´é¡µé¢å´©æºƒ</strong>ã€‚</p></blockquote><p>5ã€ä¿®æ”¹ç”¨æˆ·åã€å¯†ç è¡¨å•å­—æ®µ</p><p>åœ¨å‰é¢çš„ HTML ä¸­ï¼Œç”¨æˆ·åã€å¯†ç çš„è¡¨å• <code>name</code> ä¸º <code>username</code>ã€<code>password</code>, æ˜¯å¦å¯ä»¥ä¿®æ”¹ä¸ºå…¶ä»–åç§°å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚</p><p>æ¯”å¦‚åœ¨ HTML ä¸­å°†ç”¨æˆ·åã€å¯†ç çš„è¡¨å• <code>name</code> ä¿®æ”¹ä¸º <code>myusername</code>ã€<code>pwd</code>.</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/login}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nameå¿…é¡»ä¸º&quot;username&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myusername<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ç”¨æˆ·å<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--nameå¿…é¡»ä¸º&quot;password&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>å¯†ç <span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ç™»å½•<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>æ­¤æ—¶ï¼Œä¼šå‘ç°ç™»å½•ä¸äº†ï¼Œæç¤º<strong>é”™è¯¯çš„ç”¨æˆ·åå’Œå¯†ç .</strong>ã€‚</p><p>è¿™æ˜¯å› ä¸ºåœ¨ Spring Security ä¸­é»˜è®¤çš„å­—æ®µä¸º <code>username</code>ã€<code>password</code>, åœ¨ <code>UsernamePasswordAuthenticationFilter</code> æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">String</span> usernameParameter <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> passwordParameter <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å› æ­¤ï¼Œéœ€è¦åœ¨ Spring Security çš„é»˜è®¤é…ç½®ä¸­è¿›è¡ŒåŒæ­¥ä¿®æ”¹ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// åŸºæœ¬æˆæƒæ–¹å¼</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// é…ç½®è‡ªå®šä¹‰ç™»å½•é¡µ</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®è‡ªå®šä¹‰çš„è¡¨å•ç”¨æˆ·åå‚æ•° é»˜è®¤ï¼šusername</span>
                        <span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;myusername&quot;</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®è‡ªå®šä¹‰çš„è¡¨å•å¯†ç å‚æ•° é»˜è®¤ï¼špassword</span>
                        <span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®ç™»å½•é¡µæ— éœ€æˆæƒå³å¯è®¿é—®</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="_7-å‰åç«¯åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#_7-å‰åç«¯åˆ†ç¦»" aria-hidden="true">#</a> 7. å‰åç«¯åˆ†ç¦»</h2><h3 id="_7-1-ç”¨æˆ·è®¤è¯æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_7-1-ç”¨æˆ·è®¤è¯æµç¨‹" aria-hidden="true">#</a> 7.1 ç”¨æˆ·è®¤è¯æµç¨‹</h3><ul><li>ç™»å½•æˆåŠŸåè°ƒç”¨ï¼šAuthenticationSuccessHandler</li><li>ç™»å½•å¤±è´¥åè°ƒç”¨ï¼šAuthenticationFailureHandler</li></ul><h3 id="_7-2-è®¤è¯æˆåŠŸå“åº”å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_7-2-è®¤è¯æˆåŠŸå“åº”å¤„ç†" aria-hidden="true">#</a> 7.2 è®¤è¯æˆåŠŸå“åº”å¤„ç†</h3><p>1ã€å¼•å…¥ fastjson2</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.40<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>2ã€åˆ›å»º <code>CustomAuthenticationSuccessHandler</code> ç™»å½•æˆåŠŸå¤„ç†ç±»å¹¶å®ç° <code>AuthenticationSuccessHandler</code> æ¥å£</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationSuccessHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                                        <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                                        <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token comment">// è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯</span>
        <span class="token class-name">Object</span> principal <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–ç”¨æˆ·å‡­è¯ä¿¡æ¯</span>
        <span class="token class-name">Object</span> credentials <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–ç”¨æˆ·æƒé™ä¿¡æ¯</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç™»å½•æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¾“å‡ºå“åº”ç»“æœ</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>3ã€åœ¨ Spring Security çš„é»˜è®¤é…ç½®ä¸­é…ç½®<strong>è®¤è¯æˆåŠŸæ—¶çš„å¤„ç†ç±»</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// åŸºæœ¬æˆæƒæ–¹å¼</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// é…ç½®è‡ªå®šä¹‰ç™»å½•é¡µ</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•ç”¨æˆ·åå‚æ•° é»˜è®¤ï¼šusername</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•å¯†ç å‚æ•° é»˜è®¤ï¼špassword</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                        <span class="token comment">// é…ç½®è®¤è¯æˆåŠŸè‡ªå®šä¹‰å¤„ç†ç±»</span>
                        <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®ç™»å½•é¡µæ— éœ€æˆæƒå³å¯è®¿é—®</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_7-3-è®¤è¯å¤±è´¥å“åº”å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_7-3-è®¤è¯å¤±è´¥å“åº”å¤„ç†" aria-hidden="true">#</a> 7.3 è®¤è¯å¤±è´¥å“åº”å¤„ç†</h3><p>1ã€åˆ›å»º <code>CustomAuthenticationFailureHandler</code> ç™»å½•å¤±è´¥å¤„ç†ç±»å¹¶å®ç° <code>AuthenticationFailureHandler</code> æ¥å£</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAuthenticationFailureHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationFailureHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationFailure</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                                        <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                                        <span class="token class-name">AuthenticationException</span> exception<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç™»å½•å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¾“å‡ºå“åº”ç»“æœ</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>2ã€åœ¨ Spring Security çš„é»˜è®¤é…ç½®ä¸­é…ç½®<strong>è®¤è¯å¤±è´¥æ—¶çš„å¤„ç†ç±»</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// åŸºæœ¬æˆæƒæ–¹å¼</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// é…ç½®è‡ªå®šä¹‰ç™»å½•é¡µ</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•ç”¨æˆ·åå‚æ•° é»˜è®¤ï¼šusername</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•å¯†ç å‚æ•° é»˜è®¤ï¼špassword</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                        <span class="token comment">// é…ç½®è®¤è¯æˆåŠŸè‡ªå®šä¹‰å¤„ç†ç±»</span>
                        <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®è®¤è¯å¤±è´¥è‡ªå®šä¹‰å¤„ç†ç±»</span>
                        <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®ç™»å½•é¡µæ— éœ€æˆæƒå³å¯è®¿é—®</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_7-4-æ³¨é”€å“åº”å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_7-4-æ³¨é”€å“åº”å¤„ç†" aria-hidden="true">#</a> 7.4 æ³¨é”€å“åº”å¤„ç†</h3><p>1ã€åˆ›å»º <code>CustomLogoutSuccessHandler</code> ç™»å½•å¤±è´¥å¤„ç†ç±»å¹¶å®ç° <code>LogoutSuccessHandler</code> æ¥å£</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomLogoutSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">LogoutSuccessHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLogoutSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                                <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                                <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ³¨é”€æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¾“å‡ºå“åº”ç»“æœ</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>2ã€åœ¨ Spring Security çš„é»˜è®¤é…ç½®ä¸­é…ç½®<strong>æ³¨é”€æˆåŠŸæ—¶çš„å¤„ç†ç±»</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// åŸºæœ¬æˆæƒæ–¹å¼</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// é…ç½®è‡ªå®šä¹‰ç™»å½•é¡µ</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•ç”¨æˆ·åå‚æ•° é»˜è®¤ï¼šusername</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•å¯†ç å‚æ•° é»˜è®¤ï¼špassword</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                        <span class="token comment">// é…ç½®è®¤è¯æˆåŠŸè‡ªå®šä¹‰å¤„ç†ç±»</span>
                        <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®è®¤è¯å¤±è´¥è‡ªå®šä¹‰å¤„ç†ç±»</span>
                        <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®ç™»å½•é¡µæ— éœ€æˆæƒå³å¯è®¿é—®</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// é…ç½®æ³¨é”€æˆåŠŸè‡ªå®šä¹‰å¤„ç†ç±»</span>
            <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>logout <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                logout<span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_7-5-è¯·æ±‚æœªè®¤è¯æ¥å£å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_7-5-è¯·æ±‚æœªè®¤è¯æ¥å£å¤„ç†" aria-hidden="true">#</a> 7.5 è¯·æ±‚æœªè®¤è¯æ¥å£å¤„ç†</h3><p>å½“è®¿é—®ä¸€ä¸ªéœ€è¦è®¤è¯ä¹‹åæ‰èƒ½è®¿é—®çš„æ¥å£æ—¶ï¼ŒSpring Security ä¼šä½¿ç”¨ <code>AuthenticationEntryPoint</code> å°†ç”¨æˆ·è¯·æ±‚è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè¦æ±‚ç”¨æˆ·æä¾›ç™»å½•å‡­è¯ã€‚</p><p>åœ¨å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ä¸‹ï¼Œå¸Œæœ›<strong>è¿”å› JSON ç»“æœ</strong>ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰ç±»å¹¶å®ç° <code>AuthenticationEntryPoint</code> æ¥å£æ¥å®ç°åŠŸèƒ½ã€‚</p><p>1ã€åˆ›å»º <code>CustomAuthenticationEntryPoint</code> æœªè®¤è¯æ¥å£çš„å¤„ç†ç±»å¹¶å®ç° <code>AuthenticationEntryPoint</code> æ¥å£</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAuthenticationEntryPoint</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationEntryPoint</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commence</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                         <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                         <span class="token class-name">AuthenticationException</span> authException<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;è¯·å…ˆç™»å½•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¾“å‡ºå“åº”ç»“æœ</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>2ã€åœ¨ Spring Security çš„é»˜è®¤é…ç½®ä¸­é…ç½®<strong>è¯·æ±‚æœªè®¤è¯æ¥å£çš„å¤„ç†ç±»</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//é”™è¯¯å¤„ç†</span>
http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception  <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¯·æ±‚æœªè®¤è¯çš„æ¥å£</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_7-6-è·¨åŸŸå¤„ç†" tabindex="-1"><a class="header-anchor" href="#_7-6-è·¨åŸŸå¤„ç†" aria-hidden="true">#</a> 7.6 è·¨åŸŸå¤„ç†</h3><p>è·¨åŸŸ(CORS)å…¨ç§°æ˜¯è·¨åŸŸèµ„æºå…±äº«(Cross-Origin Resources Sharing)ï¼Œå®ƒæ˜¯æµè§ˆå™¨çš„ä¿æŠ¤æœºåˆ¶ï¼Œåªå…è®¸ç½‘é¡µè¯·æ±‚åŒä¸€åŸŸåä¸‹çš„æœåŠ¡ã€‚</p><blockquote><p>åŒä¸€åŸŸåæŒ‡åè®®ã€åŸŸåã€ç«¯å£å·éƒ½è¦ä¿æŒä¸€è‡´ï¼Œå¦‚æœæœ‰ä¸€é¡¹ä¸åŒï¼Œé‚£ä¹ˆå°±æ˜¯è·¨åŸŸè¯·æ±‚ã€‚</p></blockquote><p>åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦è§£å†³è·¨åŸŸçš„é—®é¢˜ã€‚</p><p>åœ¨ Spring Security ä¸­è§£å†³è·¨åŸŸå¾ˆç®€å•ï¼Œåœ¨é»˜è®¤é…ç½®ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®å³å¯ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//è·¨åŸŸ</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// åŸºæœ¬æˆæƒæ–¹å¼</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// é…ç½®è‡ªå®šä¹‰ç™»å½•é¡µ</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•ç”¨æˆ·åå‚æ•° é»˜è®¤ï¼šusername</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•å¯†ç å‚æ•° é»˜è®¤ï¼špassword</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                        <span class="token comment">// é…ç½®è®¤è¯æˆåŠŸè‡ªå®šä¹‰å¤„ç†ç±»</span>
                        <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®è®¤è¯å¤±è´¥è‡ªå®šä¹‰å¤„ç†ç±»</span>
                        <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// é…ç½®ç™»å½•é¡µæ— éœ€æˆæƒå³å¯è®¿é—®</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// é…ç½®æ³¨é”€æˆåŠŸè‡ªå®šä¹‰å¤„ç†ç±»</span>
            <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>logout <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                logout<span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// é…ç½®è¯·æ±‚æœªè®¤è¯æ¥å£çš„å¤„ç†ç±»</span>
            <span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// è·¨åŸŸå¤„ç†</span>
            <span class="token punctuation">.</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h2 id="_8-èº«ä»½è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_8-èº«ä»½è®¤è¯" aria-hidden="true">#</a> 8. èº«ä»½è®¤è¯</h2><h3 id="_8-1-ç”¨æˆ·è®¤è¯ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_8-1-ç”¨æˆ·è®¤è¯ä¿¡æ¯" aria-hidden="true">#</a> 8.1 ç”¨æˆ·è®¤è¯ä¿¡æ¯</h3><h4 id="_8-1-1-åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_8-1-1-åŸºæœ¬æ¦‚å¿µ" aria-hidden="true">#</a> 8.1.1 åŸºæœ¬æ¦‚å¿µ</h4><p>åœ¨ Spring Security æ¡†æ¶ä¸­ï¼Œ<code>SecurityContextHolder</code>ã€<code>SecurityContext</code>ã€<code>Authentication</code>ã€<code>Principal</code> å’Œ <code>Credential</code> æ˜¯ä¸€äº›ä¸èº«ä»½éªŒè¯å’Œæˆæƒç›¸å…³çš„é‡è¦æ¦‚å¿µã€‚</p><p>å®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š</p><ol><li><code>SecurityContextHolder</code>ï¼šSpring Security å­˜å‚¨å·²è®¤è¯ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„åœ°æ–¹</li><li><code>SecurityContext</code>ï¼šä» SecurityContextHolder è·å–å†…å®¹ï¼ŒåŒ…å«å½“å‰å·²è®¤è¯ç”¨æˆ·çš„ Authentication ä¿¡æ¯</li><li><code>Authentication</code>ï¼šAuthentication è¡¨ç¤ºç”¨æˆ·çš„èº«ä»½è®¤è¯ä¿¡æ¯ï¼Œå®ƒåŒ…å«äº†ç”¨æˆ·çš„ <code>Principal</code>ã€<code>Credential</code> å’Œ <code>Authority</code> ä¿¡æ¯</li><li><code>Principal</code>ï¼šè¡¨ç¤ºç”¨æˆ·çš„èº«ä»½æ ‡è¯†ï¼Œå®ƒé€šå¸¸æ˜¯ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·çš„å®ä½“å¯¹è±¡ã€‚å¯ä»¥é€šè¿‡ <code>Authentication</code> å¯¹è±¡çš„ <code>getPrincipal()</code> æ–¹æ³•è·å–</li><li><code>Credentials</code>ï¼šè¡¨ç¤ºç”¨æˆ·çš„å‡­è¯ä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€è¯ä¹¦æˆ–å…¶ä»–è®¤è¯å‡­æ®ã€‚å¯ä»¥é€šè¿‡ <code>Authentication</code> å¯¹è±¡çš„ <code>getCredentials()</code> æ–¹æ³•è·å–</li><li><code>GrantedAuthority</code>ï¼šè¡¨ç¤ºç”¨æˆ·è¢«æˆäºˆçš„æƒé™</li></ol><p>æ€»ç»“èµ·æ¥ï¼š</p><ul><li><code>SecurityContextHolder</code> ç”¨äºç®¡ç†å½“å‰çº¿ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå­˜å‚¨å·²è®¤è¯ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº† <code>SecurityContext</code> å¯¹è±¡</li><li><code>SecurityContext</code> å¯¹è±¡åŒ…å«äº† <code>Authentication</code> å¯¹è±¡ï¼Œ<code>Authentication</code> è¡¨ç¤ºç”¨æˆ·çš„èº«ä»½éªŒè¯ä¿¡æ¯</li><li><code>Authentication</code> å¯¹è±¡åŒ…æ‹¬ <code>Principal</code>ï¼ˆç”¨æˆ·çš„èº«ä»½æ ‡è¯†ï¼‰ã€<code>Credential</code>ï¼ˆç”¨æˆ·çš„å‡­è¯ä¿¡æ¯ï¼‰å’Œ <code>GrantedAuthority</code>ï¼ˆç”¨æˆ·çš„æƒé™ä¿¡æ¯ï¼‰</li></ul><h4 id="_8-1-2-åœ¨-controller-ä¸­è·å–ç”¨æˆ·ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_8-1-2-åœ¨-controller-ä¸­è·å–ç”¨æˆ·ä¿¡æ¯" aria-hidden="true">#</a> 8.1.2 åœ¨ Controller ä¸­è·å–ç”¨æˆ·ä¿¡æ¯</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// å­˜å‚¨è®¤è¯å¯¹è±¡çš„ä¸Šä¸‹æ–‡</span>
        <span class="token class-name">SecurityContext</span> securityContext <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¤è¯å¯¹è±¡</span>
        <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> securityContext<span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”¨æˆ·å</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”¨æˆ·ä¿¡æ¯ org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[]]</span>
        <span class="token class-name">Object</span> principal <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”¨æˆ·å‡­è¯ï¼ˆè„±æ•å¤„ç† nullï¼‰</span>
        <span class="token class-name">Object</span> credentials <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”¨æˆ·æƒé™</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºç»“æœå¯¹è±¡</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> resultMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_8-2-ä¼šè¯å¹¶å‘å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_8-2-ä¼šè¯å¹¶å‘å¤„ç†" aria-hidden="true">#</a> 8.2 ä¼šè¯å¹¶å‘å¤„ç†</h3><p>åœ¨ Spring Security æ¡†æ¶ä¸­å¯ä»¥å®ç°ä¼šè¯å¹¶å‘å¤„ç†ï¼Œåç™»å½•çš„è´¦å·ä¼šä½¿å…ˆç™»å½•çš„è´¦å·å¤±æ•ˆã€‚</p><p>1ã€åˆ›å»º <code>CustomSessionInformationExpiredStrategy</code> ç±»å¹¶å®ç°æ¥å£ <code>SessionInformationExpiredStrategy</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomSessionInformationExpiredStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">SessionInformationExpiredStrategy</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onExpiredSessionDetected</span><span class="token punctuation">(</span><span class="token class-name">SessionInformationExpiredEvent</span> event<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;è¯¥è´¦å·å·²ä»å…¶ä»–è®¾å¤‡ç™»å½•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¾“å‡ºå“åº”ç»“æœ</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>2ã€åœ¨ Spring Security çš„é»˜è®¤é…ç½®ä¸­é…ç½®<strong>ä¼šè¯å¹¶å‘çš„å¤„ç†ç±»</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> httpSecurity
                <span class="token comment">// å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯è¯·æ±‚ä¿æŠ¤</span>
                <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// ä½¿ç”¨é»˜è®¤ç™»å½•é¡µ</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
                <span class="token comment">// åŸºæœ¬æˆæƒæ–¹å¼</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
                <span class="token comment">// é…ç½®è‡ªå®šä¹‰ç™»å½•é¡µ</span>
                <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•ç”¨æˆ·åå‚æ•° é»˜è®¤ï¼šusername</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // é…ç½®è‡ªå®šä¹‰çš„è¡¨å•å¯†ç å‚æ•° é»˜è®¤ï¼špassword</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                            <span class="token comment">// é…ç½®è®¤è¯æˆåŠŸè‡ªå®šä¹‰å¤„ç†ç±»</span>
                            <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token comment">// é…ç½®è®¤è¯å¤±è´¥è‡ªå®šä¹‰å¤„ç†ç±»</span>
                            <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token comment">// é…ç½®ç™»å½•é¡µæ— éœ€æˆæƒå³å¯è®¿é—®</span>
                            <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// é…ç½®æ³¨é”€æˆåŠŸè‡ªå®šä¹‰å¤„ç†ç±»</span>
                <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>logout <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    logout<span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// é…ç½®è¯·æ±‚æœªè®¤è¯æ¥å£çš„å¤„ç†ç±»</span>
                <span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// è·¨åŸŸå¤„ç†</span>
                <span class="token punctuation">.</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯å¹¶å‘å¤„ç†</span>
                <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span>session <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// è®¾ç½®ç”¨æˆ·çš„æœ€å¤§ä¼šè¯æ•°ä¸º 1ï¼Œå³åªå…è®¸ä¸€ä¸ªç”¨æˆ·ï¼ˆåŒä¸ªç”¨æˆ·ï¼‰åœ¨çº¿ï¼Œä¸å…è®¸åŒä¸€ä¸ªç”¨æˆ·å¤šç«¯å¤šè®¾å¤‡åŒæ—¶åœ¨çº¿</span>
                    session<span class="token punctuation">.</span><span class="token function">maximumSessions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">expiredSessionStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomSessionInformationExpiredStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// å…³é—­è·¨ç«™ä¼ªé€ æ”»å‡»</span>
                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="_9-æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_9-æˆæƒ" aria-hidden="true">#</a> 9. æˆæƒ</h2><p>æˆæƒç®¡ç†çš„å®ç°åœ¨SpringSecurityä¸­éå¸¸çµæ´»ï¼Œå¯ä»¥å¸®åŠ©åº”ç”¨ç¨‹åºå®ç°ä»¥ä¸‹ä¸¤ç§å¸¸è§çš„æˆæƒéœ€æ±‚ï¼š</p><ul><li><p>ç”¨æˆ·-æƒé™-èµ„æºï¼šä¾‹å¦‚å¼ ä¸‰çš„æƒé™æ˜¯æ·»åŠ ç”¨æˆ·ã€æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼Œæå››çš„æƒé™æ˜¯æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨</p></li><li><p>ç”¨æˆ·-è§’è‰²-æƒé™-èµ„æºï¼šä¾‹å¦‚ å¼ ä¸‰æ˜¯è§’è‰²æ˜¯ç®¡ç†å‘˜ã€æå››çš„è§’è‰²æ˜¯æ™®é€šç”¨æˆ·ï¼Œç®¡ç†å‘˜èƒ½åšæ‰€æœ‰æ“ä½œï¼Œæ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹ä¿¡æ¯</p></li></ul><h3 id="_9-1-åŸºäºrequestçš„æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_9-1-åŸºäºrequestçš„æˆæƒ" aria-hidden="true">#</a> 9.1 åŸºäºrequestçš„æˆæƒ</h3><h4 id="_9-1-1-ç”¨æˆ·-æƒé™-èµ„æº" tabindex="-1"><a class="header-anchor" href="#_9-1-1-ç”¨æˆ·-æƒé™-èµ„æº" aria-hidden="true">#</a> 9.1.1 ç”¨æˆ·-æƒé™-èµ„æº</h4><p><strong>éœ€æ±‚ï¼š</strong></p><ul><li>å…·æœ‰USER_LISTæƒé™çš„ç”¨æˆ·å¯ä»¥è®¿é—®/user/listæ¥å£</li><li>å…·æœ‰USER_ADDæƒé™çš„ç”¨æˆ·å¯ä»¥è®¿é—®/user/addæ¥å£</li></ul><p>1ã€é…ç½®æƒé™</p><p>SecurityFilterChain</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//å¼€å¯æˆæƒä¿æŠ¤</span>
http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>
        authorize <span class="token operator">-&gt;</span> authorize
    			<span class="token comment">//å…·æœ‰USER_LISTæƒé™çš„ç”¨æˆ·å¯ä»¥è®¿é—®/user/list</span>
                <span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;USER_LIST&quot;</span><span class="token punctuation">)</span>
    			<span class="token comment">//å…·æœ‰USER_ADDæƒé™çš„ç”¨æˆ·å¯ä»¥è®¿é—®/user/add</span>
    			<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;USER_ADD&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯æˆæƒä¿æŠ¤</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//å·²è®¤è¯çš„è¯·æ±‚ä¼šè¢«è‡ªåŠ¨æˆæƒ</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>2ã€æˆäºˆæƒé™</p><p>DBUserDetailsManagerä¸­çš„loadUserByUsernameæ–¹æ³•ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authorities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token string">&quot;USER_LIST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authorities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token string">&quot;USER_ADD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*authorities.add(new GrantedAuthority() {
    @Override
    public String getAuthority() {
        return &quot;USER_LIST&quot;;
    }
});
authorities.add(new GrantedAuthority() {
    @Override
    public String getAuthority() {
        return &quot;USER_ADD&quot;;
    }
});*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>3ã€è¯·æ±‚æœªæˆæƒçš„æ¥å£</p><p>SecurityFilterChain</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//é”™è¯¯å¤„ç†</span>
http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception  <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¯·æ±‚æœªè®¤è¯çš„æ¥å£</span>
    exception<span class="token punctuation">.</span><span class="token function">accessDeniedHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> <span class="token comment">//è¯·æ±‚æœªæˆæƒçš„æ¥å£</span>

        <span class="token comment">//åˆ›å»ºç»“æœå¯¹è±¡</span>
        <span class="token class-name">HashMap</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ²¡æœ‰æƒé™&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è½¬æ¢æˆjsonå­—ç¬¦ä¸²</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è¿”å›å“åº”</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>æ›´å¤šçš„ä¾‹å­</strong>ï¼šhttps://docs.spring.io/spring-security/reference/servlet/authorization/authorize-http-requests.html</p><h4 id="_9-1-2-ç”¨æˆ·-è§’è‰²-èµ„æº" tabindex="-1"><a class="header-anchor" href="#_9-1-2-ç”¨æˆ·-è§’è‰²-èµ„æº" aria-hidden="true">#</a> 9.1.2 ç”¨æˆ·-è§’è‰²-èµ„æº</h4><p><strong>éœ€æ±‚</strong>ï¼šè§’è‰²ä¸º ADMIN çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—® <code>/user/**</code> è·¯å¾„ä¸‹çš„èµ„æº</p><p>1ã€é…ç½®è§’è‰²</p><p>SecurityFilterChain</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//å¼€å¯æˆæƒä¿æŠ¤</span>
http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>
        authorize <span class="token operator">-&gt;</span> authorize
                <span class="token comment">//å…·æœ‰ç®¡ç†å‘˜è§’è‰²çš„ç”¨æˆ·å¯ä»¥è®¿é—®/user/**</span>
                <span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//å¯¹æ‰€æœ‰è¯·æ±‚å¼€å¯æˆæƒä¿æŠ¤</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//å·²è®¤è¯çš„è¯·æ±‚ä¼šè¢«è‡ªåŠ¨æˆæƒ</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>2ã€æˆäºˆè§’è‰²</p><p>DBUserDetailsManagerä¸­çš„loadUserByUsernameæ–¹æ³•ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span>
        <span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_9-1-3-ç”¨æˆ·-è§’è‰²-æƒé™-èµ„æº" tabindex="-1"><a class="header-anchor" href="#_9-1-3-ç”¨æˆ·-è§’è‰²-æƒé™-èµ„æº" aria-hidden="true">#</a> 9.1.3 ç”¨æˆ·-è§’è‰²-æƒé™-èµ„æº</h3><p>RBACï¼ˆRole-Based Access Controlï¼ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆï¼Œå®ƒå°†ç”¨æˆ·çš„æƒé™åˆ†é…å’Œç®¡ç†ä¸è§’è‰²ç›¸å…³è”ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„RBACæ•°æ®åº“è®¾è®¡æ–¹æ¡ˆçš„ç¤ºä¾‹ï¼š</p><ol><li>ç”¨æˆ·è¡¨ï¼ˆUser tableï¼‰ï¼šåŒ…å«ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·åã€å¯†ç å’Œå…¶ä»–èº«ä»½éªŒè¯ä¿¡æ¯ã€‚</li></ol><table><thead><tr><th>åˆ—å</th><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>user_id</td><td>int</td><td>ç”¨æˆ·ID</td></tr><tr><td>username</td><td>varchar</td><td>ç”¨æˆ·å</td></tr><tr><td>password</td><td>varchar</td><td>å¯†ç </td></tr><tr><td>email</td><td>varchar</td><td>ç”µå­é‚®ä»¶åœ°å€</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><ol start="2"><li>è§’è‰²è¡¨ï¼ˆRole tableï¼‰ï¼šå­˜å‚¨æ‰€æœ‰å¯èƒ½çš„è§’è‰²åŠå…¶æè¿°ã€‚</li></ol><table><thead><tr><th>åˆ—å</th><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>role_id</td><td>int</td><td>è§’è‰²ID</td></tr><tr><td>role_name</td><td>varchar</td><td>è§’è‰²åç§°</td></tr><tr><td>description</td><td>varchar</td><td>è§’è‰²æè¿°</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><ol start="3"><li>æƒé™è¡¨ï¼ˆPermission tableï¼‰ï¼šå®šä¹‰ç³»ç»Ÿä¸­æ‰€æœ‰å¯èƒ½çš„æƒé™ã€‚</li></ol><table><thead><tr><th>åˆ—å</th><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>permission_id</td><td>int</td><td>æƒé™ID</td></tr><tr><td>permission_name</td><td>varchar</td><td>æƒé™åç§°</td></tr><tr><td>description</td><td>varchar</td><td>æƒé™æè¿°</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><ol start="4"><li>ç”¨æˆ·è§’è‰²å…³è”è¡¨ï¼ˆUser-Role tableï¼‰ï¼šå°†ç”¨æˆ·ä¸è§’è‰²å…³è”èµ·æ¥ã€‚</li></ol><table><thead><tr><th>åˆ—å</th><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>user_role_id</td><td>int</td><td>ç”¨æˆ·è§’è‰²å…³è”ID</td></tr><tr><td>user_id</td><td>int</td><td>ç”¨æˆ·ID</td></tr><tr><td>role_id</td><td>int</td><td>è§’è‰²ID</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><ol start="5"><li>è§’è‰²æƒé™å…³è”è¡¨ï¼ˆRole-Permission tableï¼‰ï¼šå°†è§’è‰²ä¸æƒé™å…³è”èµ·æ¥ã€‚</li></ol><table><thead><tr><th>åˆ—å</th><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>role_permission_id</td><td>int</td><td>è§’è‰²æƒé™å…³è”ID</td></tr><tr><td>role_id</td><td>int</td><td>è§’è‰²ID</td></tr><tr><td>permission_id</td><td>int</td><td>æƒé™ID</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><p>åœ¨è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆä¸­ï¼Œç”¨æˆ·å¯ä»¥è¢«åˆ†é…ä¸€ä¸ªæˆ–å¤šä¸ªè§’è‰²ï¼Œè€Œæ¯ä¸ªè§’è‰²åˆå¯ä»¥å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæƒé™ã€‚é€šè¿‡å¯¹ç”¨æˆ·è§’è‰²å…³è”å’Œè§’è‰²æƒé™å…³è”è¡¨è¿›è¡Œæ“ä½œï¼Œå¯ä»¥å®ç°çµæ´»çš„æƒé™ç®¡ç†å’Œè®¿é—®æ§åˆ¶ã€‚</p><p>å½“ç”¨æˆ·å°è¯•è®¿é—®ç³»ç»Ÿèµ„æºæ—¶ï¼Œç³»ç»Ÿå¯ä»¥æ ¹æ®ç”¨æˆ·çš„è§’è‰²å’Œæƒé™å†³å®šæ˜¯å¦å…è®¸è®¿é—®ã€‚è¿™æ ·çš„è®¾è®¡æ–¹æ¡ˆä½¿å¾—æƒé™ç®¡ç†æ›´åŠ ç®€å•å’Œå¯ç»´æŠ¤ï¼Œå› ä¸ºåªéœ€è°ƒæ•´è§’è‰²å’Œæƒé™çš„åˆ†é…å³å¯ï¼Œè€Œä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç”¨æˆ·è¿›è¡Œå•ç‹¬çš„è®¾ç½®ã€‚</p><h3 id="_9-2-åŸºäºæ–¹æ³•çš„æˆæƒ" tabindex="-1"><a class="header-anchor" href="#_9-2-åŸºäºæ–¹æ³•çš„æˆæƒ" aria-hidden="true">#</a> 9.2 åŸºäºæ–¹æ³•çš„æˆæƒ</h3><p>1ã€å¼€å¯æ–¹æ³•æˆæƒ</p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æ³¨è§£</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableMethodSecurity</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2ã€ç»™ç”¨æˆ·æˆäºˆè§’è‰²å’Œæƒé™</p><p>DBUserDetailsManagerä¸­çš„loadUserByUsernameæ–¹æ³•ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span>
        <span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;USER_ADD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;USER_UPDATE&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>3ã€å¸¸ç”¨æˆæƒæ³¨è§£</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//ç”¨æˆ·å¿…é¡»æœ‰ ADMIN è§’è‰² å¹¶ä¸” ç”¨æˆ·åæ˜¯ admin æ‰èƒ½è®¿é—®æ­¤æ–¹æ³•</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasRole(&#39;ADMIN&#39;) and authentication.name == &#39;admim&#39;&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//ç”¨æˆ·å¿…é¡»æœ‰ USER_ADD æƒé™ æ‰èƒ½è®¿é—®æ­¤æ–¹æ³•</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;USER_ADD&#39;)&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    userService<span class="token punctuation">.</span><span class="token function">saveUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>æ›´å¤šçš„ä¾‹å­</strong>ï¼šhttps://docs.spring.io/spring-security/reference/servlet/authorization/method-security.html</p><h2 id="_10-oauth2" tabindex="-1"><a class="header-anchor" href="#_10-oauth2" aria-hidden="true">#</a> 10. OAuth2</h2><h3 id="_10-1-oauth2-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_10-1-oauth2-ç®€ä»‹" aria-hidden="true">#</a> 10.1 OAuth2 ç®€ä»‹</h3><h4 id="_10-1-1-oauth2-ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_10-1-1-oauth2-ä»€ä¹ˆ" aria-hidden="true">#</a> 10.1.1 OAuth2 ä»€ä¹ˆ</h4><p>â€œAuthâ€ è¡¨ç¤º â€œæˆæƒâ€ Authorization</p><p>â€œOâ€ æ˜¯ Open çš„ç®€ç§°ï¼Œè¡¨ç¤º â€œå¼€æ”¾â€</p><p>è¿åœ¨ä¸€èµ·å°±è¡¨ç¤º <strong>â€œå¼€æ”¾æˆæƒâ€</strong>ï¼ŒOAuth2æ˜¯ä¸€ç§å¼€æ”¾æˆæƒåè®®ã€‚</p><p><strong>OAuth2æœ€ç®€å‘å¯¼</strong>ï¼šhttps://darutk.medium.com/the-simplest-guide-to-oauth-2-0-8c71bd9a15bb</p><h4 id="_10-1-2-oauth2-çš„è§’è‰²" tabindex="-1"><a class="header-anchor" href="#_10-1-2-oauth2-çš„è§’è‰²" aria-hidden="true">#</a> 10.1.2 OAuth2 çš„è§’è‰²</h4><p>OAuth 2åè®®åŒ…å«ä»¥ä¸‹è§’è‰²ï¼š</p><ol><li>èµ„æºæ‰€æœ‰è€…ï¼ˆResource Ownerï¼‰ï¼šå³ç”¨æˆ·ï¼Œèµ„æºçš„æ‹¥æœ‰äººï¼Œæƒ³è¦é€šè¿‡å®¢æˆ·åº”ç”¨è®¿é—®èµ„æºæœåŠ¡å™¨ä¸Šçš„èµ„æºã€‚</li><li>å®¢æˆ·åº”ç”¨ï¼ˆClientï¼‰ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªWebæˆ–è€…æ— çº¿åº”ç”¨ï¼Œå®ƒéœ€è¦è®¿é—®ç”¨æˆ·çš„å—ä¿æŠ¤èµ„æºã€‚</li><li>èµ„æºæœåŠ¡å™¨ï¼ˆResource Serverï¼‰ï¼šå­˜å‚¨å—ä¿æŠ¤èµ„æºçš„æœåŠ¡å™¨æˆ–å®šä¹‰äº†å¯ä»¥è®¿é—®åˆ°èµ„æºçš„APIï¼Œæ¥æ”¶å¹¶éªŒè¯å®¢æˆ·ç«¯çš„è®¿é—®ä»¤ç‰Œï¼Œä»¥å†³å®šæ˜¯å¦æˆæƒè®¿é—®èµ„æºã€‚</li><li>æˆæƒæœåŠ¡å™¨ï¼ˆAuthorization Serverï¼‰ï¼šè´Ÿè´£éªŒè¯èµ„æºæ‰€æœ‰è€…çš„èº«ä»½å¹¶å‘å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œã€‚</li></ol><h4 id="_10-1-3-oauth2çš„ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_10-1-3-oauth2çš„ä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a> 10.1.3 OAuth2çš„ä½¿ç”¨åœºæ™¯</h4><ul><li><p>å¼€æ”¾ç³»ç»Ÿé—´æˆæƒ</p></li><li><p>ç¤¾äº¤ç™»å½•</p></li></ul><p>åœ¨ä¼ ç»Ÿçš„èº«ä»½éªŒè¯ä¸­ï¼Œç”¨æˆ·éœ€è¦æä¾›ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿˜æœ‰å¾ˆå¤šç½‘ç«™ç™»å½•æ—¶ï¼Œå…è®¸ä½¿ç”¨ç¬¬ä¸‰æ–¹ç½‘ç«™çš„èº«ä»½ï¼Œè¿™ç§°ä¸º&quot;ç¬¬ä¸‰æ–¹ç™»å½•&quot;ã€‚æ‰€è°“ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œå®è´¨å°±æ˜¯ OAuth æˆæƒã€‚ç”¨æˆ·æƒ³è¦ç™»å½• A ç½‘ç«™ï¼ŒA ç½‘ç«™è®©ç”¨æˆ·æä¾›ç¬¬ä¸‰æ–¹ç½‘ç«™çš„æ•°æ®ï¼Œè¯æ˜è‡ªå·±çš„èº«ä»½ã€‚è·å–ç¬¬ä¸‰æ–¹ç½‘ç«™çš„èº«ä»½æ•°æ®ï¼Œå°±éœ€è¦ OAuth æˆæƒã€‚</p><ul><li>å¼€æ”¾API</li></ul><p>ä¾‹å¦‚äº‘å†²å°æœåŠ¡çš„å®ç°</p><ul><li><p>ç°ä»£å¾®æœåŠ¡å®‰å…¨</p></li><li><p>å•å—åº”ç”¨å®‰å…¨</p></li></ul><ul><li>å¾®æœåŠ¡å®‰å…¨</li></ul><ul><li><p>ä¼ä¸šå†…éƒ¨åº”ç”¨è®¤è¯æˆæƒ</p></li><li><p>SSOï¼šSingle Sign On å•ç‚¹ç™»å½•</p></li><li><p>IAMï¼šIdentity and Access Management èº«ä»½è¯†åˆ«ä¸è®¿é—®ç®¡ç†</p></li></ul><h4 id="_10-1-4-oauth2-çš„å››ç§æˆæƒæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_10-1-4-oauth2-çš„å››ç§æˆæƒæ¨¡å¼" aria-hidden="true">#</a> 10.1.4 OAuth2 çš„å››ç§æˆæƒæ¨¡å¼</h4><p>RFC6749ï¼š</p><p><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_blank" rel="noopener noreferrer">RFC 6749 - The OAuth 2.0 Authorization Framework (ietf.org)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>é˜®ä¸€å³°ï¼š</p><p><a href="https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html" target="_blank" rel="noopener noreferrer">OAuth 2.0 çš„å››ç§æ–¹å¼ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— (ruanyifeng.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å››ç§æ¨¡å¼ï¼š</p><ul><li>æˆæƒç ï¼ˆauthorization-codeï¼‰</li><li>éšè—å¼ï¼ˆimplicitï¼‰</li><li>å¯†ç å¼ï¼ˆpasswordï¼‰</li><li>å®¢æˆ·ç«¯å‡­è¯ï¼ˆclient credentialsï¼‰</li></ul><h4 id="ç¬¬ä¸€ç§æ–¹å¼-æˆæƒç " tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€ç§æ–¹å¼-æˆæƒç " aria-hidden="true">#</a> ç¬¬ä¸€ç§æ–¹å¼ï¼šæˆæƒç </h4><p><strong>æˆæƒç ï¼ˆauthorization codeï¼‰ï¼ŒæŒ‡çš„æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨å…ˆç”³è¯·ä¸€ä¸ªæˆæƒç ï¼Œç„¶åå†ç”¨è¯¥ç è·å–ä»¤ç‰Œã€‚</strong></p><p>è¿™ç§æ–¹å¼æ˜¯æœ€å¸¸ç”¨ï¼Œæœ€å¤æ‚ï¼Œä¹Ÿæ˜¯æœ€å®‰å…¨çš„ï¼Œå®ƒé€‚ç”¨äºé‚£äº›æœ‰åç«¯çš„ Web åº”ç”¨ã€‚æˆæƒç é€šè¿‡å‰ç«¯ä¼ é€ï¼Œä»¤ç‰Œåˆ™æ˜¯å‚¨å­˜åœ¨åç«¯ï¼Œè€Œä¸”æ‰€æœ‰ä¸èµ„æºæœåŠ¡å™¨çš„é€šä¿¡éƒ½åœ¨åç«¯å®Œæˆã€‚è¿™æ ·çš„å‰åç«¯åˆ†ç¦»ï¼Œå¯ä»¥é¿å…ä»¤ç‰Œæ³„æ¼ã€‚</p><ul><li>æ³¨å†Œå®¢æˆ·åº”ç”¨ï¼šå®¢æˆ·åº”ç”¨å¦‚æœæƒ³è¦è®¿é—®èµ„æºæœåŠ¡å™¨éœ€è¦æœ‰å‡­è¯ï¼Œéœ€è¦åœ¨æˆæƒæœåŠ¡å™¨ä¸Šæ³¨å†Œå®¢æˆ·åº”ç”¨ã€‚æ³¨å†Œåä¼š<strong>è·å–åˆ°ä¸€ä¸ªClientIDå’ŒClientSecrets</strong></li></ul><h4 id="ç¬¬äºŒç§æ–¹å¼-éšè—å¼" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒç§æ–¹å¼-éšè—å¼" aria-hidden="true">#</a> ç¬¬äºŒç§æ–¹å¼ï¼šéšè—å¼</h4><p><strong>éšè—å¼ï¼ˆimplicitï¼‰ï¼Œä¹Ÿå«ç®€åŒ–æ¨¡å¼ï¼Œæœ‰äº› Web åº”ç”¨æ˜¯çº¯å‰ç«¯åº”ç”¨ï¼Œæ²¡æœ‰åç«¯ã€‚è¿™æ—¶å°±ä¸èƒ½ç”¨ä¸Šé¢çš„æ–¹å¼äº†ï¼Œå¿…é¡»å°†ä»¤ç‰Œå‚¨å­˜åœ¨å‰ç«¯ã€‚</strong></p><p>RFC 6749 è§„å®šäº†è¿™ç§æ–¹å¼ï¼Œå…è®¸ç›´æ¥å‘å‰ç«¯é¢å‘ä»¤ç‰Œã€‚è¿™ç§æ–¹å¼æ²¡æœ‰æˆæƒç è¿™ä¸ªä¸­é—´æ­¥éª¤ï¼Œæ‰€ä»¥ç§°ä¸ºéšè—å¼ã€‚è¿™ç§æ–¹å¼æŠŠä»¤ç‰Œç›´æ¥ä¼ ç»™å‰ç«¯ï¼Œæ˜¯å¾ˆä¸å®‰å…¨çš„ã€‚å› æ­¤ï¼Œåªèƒ½ç”¨äºä¸€äº›å®‰å…¨è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼Œå¹¶ä¸”ä»¤ç‰Œçš„æœ‰æ•ˆæœŸå¿…é¡»éå¸¸çŸ­ï¼Œé€šå¸¸å°±æ˜¯ä¼šè¯æœŸé—´ï¼ˆsessionï¼‰æœ‰æ•ˆï¼Œæµè§ˆå™¨å…³æ‰ï¼Œä»¤ç‰Œå°±å¤±æ•ˆäº†ã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://a.com/callback#token=ACCESS_TOKEN
å°†è®¿é—®ä»¤ç‰ŒåŒ…å«åœ¨URLé”šç‚¹ä¸­çš„å¥½å¤„ï¼šé”šç‚¹åœ¨HTTPè¯·æ±‚ä¸­ä¸ä¼šå‘é€åˆ°æœåŠ¡å™¨ï¼Œå‡å°‘äº†æ³„æ¼ä»¤ç‰Œçš„é£é™©ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="ç¬¬ä¸‰ç§æ–¹å¼-å¯†ç å¼" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰ç§æ–¹å¼-å¯†ç å¼" aria-hidden="true">#</a> ç¬¬ä¸‰ç§æ–¹å¼ï¼šå¯†ç å¼</h4><p><strong>å¯†ç å¼ï¼ˆResource Owner Password Credentialsï¼‰ï¼šå¦‚æœä½ é«˜åº¦ä¿¡ä»»æŸä¸ªåº”ç”¨ï¼ŒRFC 6749 ä¹Ÿå…è®¸ç”¨æˆ·æŠŠç”¨æˆ·åå’Œå¯†ç ï¼Œç›´æ¥å‘Šè¯‰è¯¥åº”ç”¨ã€‚è¯¥åº”ç”¨å°±ä½¿ç”¨ä½ çš„å¯†ç ï¼Œç”³è¯·ä»¤ç‰Œã€‚</strong></p><p>è¿™ç§æ–¹å¼éœ€è¦ç”¨æˆ·ç»™å‡ºè‡ªå·±çš„ç”¨æˆ·å/å¯†ç ï¼Œæ˜¾ç„¶é£é™©å¾ˆå¤§ï¼Œå› æ­¤åªé€‚ç”¨äºå…¶ä»–æˆæƒæ–¹å¼éƒ½æ— æ³•é‡‡ç”¨çš„æƒ…å†µï¼Œè€Œä¸”å¿…é¡»æ˜¯ç”¨æˆ·é«˜åº¦ä¿¡ä»»çš„åº”ç”¨ã€‚</p><h4 id="ç¬¬å››ç§æ–¹å¼-å‡­è¯å¼" tabindex="-1"><a class="header-anchor" href="#ç¬¬å››ç§æ–¹å¼-å‡­è¯å¼" aria-hidden="true">#</a> ç¬¬å››ç§æ–¹å¼ï¼šå‡­è¯å¼</h4><p><strong>å‡­è¯å¼ï¼ˆclient credentialsï¼‰ï¼šä¹Ÿå«å®¢æˆ·ç«¯æ¨¡å¼ï¼Œé€‚ç”¨äºæ²¡æœ‰å‰ç«¯çš„å‘½ä»¤è¡Œåº”ç”¨ï¼Œå³åœ¨å‘½ä»¤è¡Œä¸‹è¯·æ±‚ä»¤ç‰Œã€‚</strong></p><p>è¿™ç§æ–¹å¼ç»™å‡ºçš„ä»¤ç‰Œï¼Œæ˜¯é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç”¨æˆ·çš„ï¼Œå³æœ‰å¯èƒ½å¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€ä¸ªä»¤ç‰Œã€‚</p><h4 id="_10-1-5-æˆæƒç±»å‹çš„é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#_10-1-5-æˆæƒç±»å‹çš„é€‰æ‹©" aria-hidden="true">#</a> 10.1.5 æˆæƒç±»å‹çš„é€‰æ‹©</h4><h3 id="_10-2-springä¸­çš„oauth2" tabindex="-1"><a class="header-anchor" href="#_10-2-springä¸­çš„oauth2" aria-hidden="true">#</a> 10.2 Springä¸­çš„OAuth2</h3><h4 id="_10-2-1-ç›¸å…³è§’è‰²" tabindex="-1"><a class="header-anchor" href="#_10-2-1-ç›¸å…³è§’è‰²" aria-hidden="true">#</a> 10.2.1 ç›¸å…³è§’è‰²</h4><p>**å›é¡¾ï¼š**OAuth 2ä¸­çš„è§’è‰²</p><ol><li>èµ„æºæ‰€æœ‰è€…ï¼ˆResource Ownerï¼‰</li><li>å®¢æˆ·åº”ç”¨ï¼ˆClientï¼‰</li><li>èµ„æºæœåŠ¡å™¨ï¼ˆResource Serverï¼‰</li><li>æˆæƒæœåŠ¡å™¨ï¼ˆAuthorization Serverï¼‰</li></ol><h4 id="_10-2-2-springä¸­çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#_10-2-2-springä¸­çš„å®ç°" aria-hidden="true">#</a> 10.2.2 Springä¸­çš„å®ç°</h4><p><a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html" target="_blank" rel="noopener noreferrer">OAuth2 :: Spring Security<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>Spring Security</strong></p><ul><li>å®¢æˆ·åº”ç”¨ï¼ˆOAuth2 Clientï¼‰ï¼šOAuth2å®¢æˆ·ç«¯åŠŸèƒ½ä¸­åŒ…å«OAuth2 Login</li><li>èµ„æºæœåŠ¡å™¨ï¼ˆOAuth2 Resource Serverï¼‰</li></ul><p><strong>Spring</strong></p><ul><li>æˆæƒæœåŠ¡å™¨ï¼ˆSpring Authorization Serverï¼‰ï¼šå®ƒæ˜¯åœ¨Spring Securityä¹‹ä¸Šçš„ä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ã€‚</li></ul><h4 id="_10-2-3-ç›¸å…³ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_10-2-3-ç›¸å…³ä¾èµ–" aria-hidden="true">#</a> 10.2.3 ç›¸å…³ä¾èµ–</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- èµ„æºæœåŠ¡å™¨ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-resource-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- å®¢æˆ·åº”ç”¨ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- æˆæƒæœåŠ¡å™¨ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-authorization-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_10-2-4-æˆæƒç™»å½•çš„å®ç°æ€è·¯" tabindex="-1"><a class="header-anchor" href="#_10-2-4-æˆæƒç™»å½•çš„å®ç°æ€è·¯" aria-hidden="true">#</a> 10.2.4 æˆæƒç™»å½•çš„å®ç°æ€è·¯</h4><p>ä½¿ç”¨OAuth2 Login</p><h3 id="_10-3-giuhub-ç¤¾äº¤ç™»å½•æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_10-3-giuhub-ç¤¾äº¤ç™»å½•æ¡ˆä¾‹" aria-hidden="true">#</a> 10.3 GiuHub ç¤¾äº¤ç™»å½•æ¡ˆä¾‹</h3><h4 id="_10-3-1-åˆ›å»ºåº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_10-3-1-åˆ›å»ºåº”ç”¨" aria-hidden="true">#</a> 10.3.1 åˆ›å»ºåº”ç”¨</h4><p><strong>æ³¨å†Œå®¢æˆ·åº”ç”¨ï¼š</strong></p><p>ç™»å½•GitHubï¼Œåœ¨å¼€å‘è€…è®¾ç½®ä¸­æ‰¾åˆ°OAuth Appsï¼Œåˆ›å»ºä¸€ä¸ªapplicationï¼Œä¸ºå®¢æˆ·åº”ç”¨åˆ›å»ºè®¿é—®GitHubçš„å‡­æ®ï¼š</p><p>å¡«å†™åº”ç”¨ä¿¡æ¯ï¼š<code>é»˜è®¤çš„é‡å®šå‘URIæ¨¡æ¿ä¸º{baseUrl}/login/oauth2/code/{registrationId}</code>ã€‚registrationIdæ˜¯ClientRegistrationçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p><p>è·å–åº”ç”¨ç¨‹åºidï¼Œç”Ÿæˆåº”ç”¨ç¨‹åºå¯†é’¥ï¼š</p><h4 id="_10-3-2-åˆ›å»ºæµ‹è¯•é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_10-3-2-åˆ›å»ºæµ‹è¯•é¡¹ç›®" aria-hidden="true">#</a> 10.3.2 åˆ›å»ºæµ‹è¯•é¡¹ç›®</h4><p>åˆ›å»ºä¸€ä¸ªspringbooté¡¹ç›®oauth2-login-demoï¼Œåˆ›å»ºæ—¶å¼•å…¥å¦‚ä¸‹ä¾èµ–</p><p>ç¤ºä¾‹ä»£ç å‚è€ƒï¼š<a href="https://github.com/spring-projects/spring-security-samples/tree/6.2.x/servlet/spring-boot/java/oauth2/login" target="_blank" rel="noopener noreferrer">spring-security-samples/servlet/spring-boot/java/oauth2/login at 6.2.x Â· spring-projects/spring-security-samples (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_10-3-3-é…ç½®-oauth-å®¢æˆ·ç«¯å±æ€§" tabindex="-1"><a class="header-anchor" href="#_10-3-3-é…ç½®-oauth-å®¢æˆ·ç«¯å±æ€§" aria-hidden="true">#</a> 10.3.3 é…ç½® OAuth å®¢æˆ·ç«¯å±æ€§</h4><p>application.ymlï¼š</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">spring</span><span class="token punctuation">:</span>
<span class="token attr-name">  security</span><span class="token punctuation">:</span>
<span class="token attr-name">    oauth2</span><span class="token punctuation">:</span>
<span class="token attr-name">      client</span><span class="token punctuation">:</span>
<span class="token attr-name">        registration</span><span class="token punctuation">:</span>
<span class="token attr-name">          github</span><span class="token punctuation">:</span>
<span class="token attr-name">            client-id</span><span class="token punctuation">:</span> <span class="token attr-value">7807cc3bb1534abce9f2</span>
<span class="token attr-name">            client-secret</span><span class="token punctuation">:</span> <span class="token attr-value">008dc141879134433f4db7f62b693c4a5361771b</span>
<span class="token comment">#            redirectUri: http://localhost:8200/login/oauth2/code/github</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_10-3-4-åˆ›å»ºcontroller" tabindex="-1"><a class="header-anchor" href="#_10-3-4-åˆ›å»ºcontroller" aria-hidden="true">#</a> 10.3.4 åˆ›å»ºController</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>oauthdemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span>
            <span class="token class-name">Model</span> model<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RegisteredOAuth2AuthorizedClient</span> <span class="token class-name">OAuth2AuthorizedClient</span> authorizedClient<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@AuthenticationPrincipal</span> <span class="token class-name">OAuth2User</span> oauth2User<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;userName&quot;</span><span class="token punctuation">,</span> oauth2User<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;clientName&quot;</span><span class="token punctuation">,</span> authorizedClient<span class="token punctuation">.</span><span class="token function">getClientRegistration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClientName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;userAttributes&quot;</span><span class="token punctuation">,</span> oauth2User<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_10-3-5-åˆ›å»º-html-é¡µé¢" tabindex="-1"><a class="header-anchor" href="#_10-3-5-åˆ›å»º-html-é¡µé¢" aria-hidden="true">#</a> 10.3.5 åˆ›å»º html é¡µé¢</h4><p>resources/templates/index.html</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xhtml<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org/thymeleaf-extras-springsecurity5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Spring Security - OAuth 2.0 Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span> right</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logout<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isAuthenticated()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span>left</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>User: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span>none</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="Â ">&amp;nbsp;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span>right</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/logout}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Logout<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>OAuth 2.0 Login with Spring Security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    You are successfully logged in <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${userName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    via the OAuth 2.0 Client <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${clientName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="Â ">&amp;nbsp;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>User Attributes:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userAttribute : ${userAttributes}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${userAttribute.key}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${userAttribute.value}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="_10-3-6-å¯åŠ¨åº”ç”¨ç¨‹åº" tabindex="-1"><a class="header-anchor" href="#_10-3-6-å¯åŠ¨åº”ç”¨ç¨‹åº" aria-hidden="true">#</a> 10.3.6 å¯åŠ¨åº”ç”¨ç¨‹åº</h4><ul><li>å¯åŠ¨ç¨‹åºå¹¶è®¿é—®localhost:8080ã€‚æµè§ˆå™¨å°†è¢«é‡å®šå‘åˆ°é»˜è®¤çš„è‡ªåŠ¨ç”Ÿæˆçš„ç™»å½•é¡µé¢ï¼Œè¯¥é¡µé¢æ˜¾ç¤ºäº†ä¸€ä¸ªç”¨äºGitHubç™»å½•çš„é“¾æ¥ã€‚</li><li>ç‚¹å‡»GitHubé“¾æ¥ï¼Œæµè§ˆå™¨å°†è¢«é‡å®šå‘åˆ°GitHubè¿›è¡Œèº«ä»½éªŒè¯ã€‚</li><li>ä½¿ç”¨GitHubè´¦æˆ·å‡­æ®è¿›è¡Œèº«ä»½éªŒè¯åï¼Œç”¨æˆ·ä¼šçœ‹åˆ°æˆæƒé¡µé¢ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦å…è®¸æˆ–æ‹’ç»å®¢æˆ·åº”ç”¨è®¿é—®GitHubä¸Šçš„ç”¨æˆ·æ•°æ®ã€‚ç‚¹å‡»å…è®¸ä»¥æˆæƒOAuthå®¢æˆ·ç«¯è®¿é—®ç”¨æˆ·çš„åŸºæœ¬ä¸ªäººèµ„æ–™ä¿¡æ¯ã€‚</li><li>æ­¤æ—¶ï¼ŒOAuthå®¢æˆ·ç«¯è®¿é—®GitHubçš„è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£è·å–åŸºæœ¬ä¸ªäººèµ„æ–™ä¿¡æ¯ï¼Œå¹¶å»ºç«‹ä¸€ä¸ªå·²è®¤è¯çš„ä¼šè¯ã€‚</li></ul><h3 id="_10-4-æ¡ˆä¾‹åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_10-4-æ¡ˆä¾‹åˆ†æ" aria-hidden="true">#</a> 10.4 æ¡ˆä¾‹åˆ†æ</h3><h4 id="_10-4-1-ç™»å½•æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_10-4-1-ç™»å½•æµç¨‹" aria-hidden="true">#</a> 10.4.1 ç™»å½•æµç¨‹</h4><ol><li><strong>A ç½‘ç«™è®©ç”¨æˆ·è·³è½¬åˆ° GitHubï¼Œå¹¶æºå¸¦å‚æ•°ClientID ä»¥åŠ Redirection URIã€‚</strong></li><li>GitHub è¦æ±‚ç”¨æˆ·ç™»å½•ï¼Œç„¶åè¯¢é—®ç”¨æˆ·&quot;A ç½‘ç«™è¦æ±‚è·å–ç”¨æˆ·ä¿¡æ¯çš„æƒé™ï¼Œä½ æ˜¯å¦åŒæ„ï¼Ÿ&quot;</li><li>ç”¨æˆ·åŒæ„ï¼ŒGitHub å°±ä¼šé‡å®šå‘å› A ç½‘ç«™ï¼ŒåŒæ—¶å‘å›ä¸€ä¸ªæˆæƒç ã€‚</li><li><strong>A ç½‘ç«™ä½¿ç”¨æˆæƒç ï¼Œå‘ GitHub è¯·æ±‚ä»¤ç‰Œã€‚</strong></li><li>GitHub è¿”å›ä»¤ç‰Œ.</li><li><strong>A ç½‘ç«™ä½¿ç”¨ä»¤ç‰Œï¼Œå‘ GitHub è¯·æ±‚ç”¨æˆ·æ•°æ®ã€‚</strong></li><li>GitHubè¿”å›ç”¨æˆ·æ•°æ®</li><li><strong>A ç½‘ç«™ä½¿ç”¨ GitHubç”¨æˆ·æ•°æ®ç™»å½•</strong></li></ol><h4 id="_10-4-2-commonoauth2provider" tabindex="-1"><a class="header-anchor" href="#_10-4-2-commonoauth2provider" aria-hidden="true">#</a> 10.4.2 CommonOAuth2Provider</h4><p>CommonOAuth2Provideræ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„é€šç”¨OAuth2Providerï¼Œä¸ºä¸€äº›çŸ¥åèµ„æºæœåŠ¡APIæä¾›å•†ï¼ˆå¦‚Googleã€GitHubã€Facebookï¼‰é¢„å®šä¹‰äº†ä¸€ç»„é»˜è®¤çš„å±æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œ<strong>æˆæƒURIã€ä»¤ç‰ŒURIå’Œç”¨æˆ·ä¿¡æ¯URI</strong>é€šå¸¸ä¸ç»å¸¸å˜åŒ–ã€‚å› æ­¤ï¼Œæä¾›é»˜è®¤å€¼ä»¥å‡å°‘æ‰€éœ€çš„é…ç½®ã€‚</p><p>å› æ­¤ï¼Œå½“æˆ‘ä»¬é…ç½®GitHubå®¢æˆ·ç«¯æ—¶ï¼Œåªéœ€è¦æä¾›client-idå’Œclient-secretå±æ€§ã€‚</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>GITHUB <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">ClientRegistration<span class="token punctuation">.</span>Builder</span> <span class="token function">getBuilder</span><span class="token punctuation">(</span><span class="token class-name">String</span> registrationId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClientRegistration<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBuilder</span><span class="token punctuation">(</span>
        registrationId<span class="token punctuation">,</span> 
        <span class="token class-name">ClientAuthenticationMethod</span><span class="token punctuation">.</span>CLIENT_SECRET_BASIC<span class="token punctuation">,</span> 
        
        <span class="token comment">//æˆæƒå›è°ƒåœ°å€(GitHubå‘å®¢æˆ·åº”ç”¨å‘é€å›è°ƒè¯·æ±‚ï¼Œå¹¶æºå¸¦æˆæƒç )   </span>
		<span class="token string">&quot;{baseUrl}/{action}/oauth2/code/{registrationId}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;read:user&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æˆæƒé¡µé¢</span>
        builder<span class="token punctuation">.</span><span class="token function">authorizationUri</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/login/oauth/authorize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å®¢æˆ·åº”ç”¨ä½¿ç”¨æˆæƒç ï¼Œå‘ GitHub è¯·æ±‚ä»¤ç‰Œ</span>
        builder<span class="token punctuation">.</span><span class="token function">tokenUri</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/login/oauth/access_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å®¢æˆ·åº”ç”¨ä½¿ç”¨ä»¤ç‰Œå‘GitHubè¯·æ±‚ç”¨æˆ·æ•°æ®</span>
        builder<span class="token punctuation">.</span><span class="token function">userInfoUri</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.github.com/user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//usernameå±æ€§æ˜¾ç¤ºGitHubä¸­è·å–çš„å“ªä¸ªå±æ€§çš„ä¿¡æ¯</span>
        builder<span class="token punctuation">.</span><span class="token function">userNameAttributeName</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç™»å½•é¡µé¢è¶…é“¾æ¥çš„æ–‡æœ¬</span>
        builder<span class="token punctuation">.</span><span class="token function">clientName</span><span class="token punctuation">(</span><span class="token string">&quot;GitHub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/chenyl8848/chenyl8848.github.io/edit/master/docs/rearend/spring/SpringSecurity+Oauth2.md" rel="noopener noreferrer" target="_blank" arialabel="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2024/11/21 14:14:10</span></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 1063415880@qq.com">chenyl8848</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/rearend/spring/Spring_Retry.html" class="nav-link prev" arialabel="Spring Retry å®ç°é‡è¯•æœºåˆ¶"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Spring Retry å®ç°é‡è¯•æœºåˆ¶</div></a><!----></nav><div class="giscus-wrapper input-top" style="display:block;"><giscus-widget repo="chenyl8848/chenyl8848.github.io" repoId="R_kgDOHJ-qSQ" category="Announcements" categoryId="DIC_kwDOHJ-qSc4COg8Z" lang="zh-CN" theme="light" mapping="pathname" inputPosition="top" reactionsEnabled="1" emitMetadata="0"></giscus-widget></div><!----></main><!--]--><footer class="footer-wrapper"><div class="footer">æ²¡æœ‰æœ€å¥½ï¼Œåªæœ‰æ›´å¥½ï¼</div><div class="copyright">Copyright Â© 2025 Javaé™ˆåºå‘˜</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.06d697e7.js" defer></script>
  </body>
</html>
