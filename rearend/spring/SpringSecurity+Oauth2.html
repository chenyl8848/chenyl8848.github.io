<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://chenyl8848.github.io/rearend/spring/SpringSecurity+Oauth2.html"><meta property="og:site_name" content="Java陈序员"><meta property="og:title" content="Spring Security + OAuth2 权限管理实战"><meta property="og:type" content="article"><meta property="og:updated_time" content="2024-11-21T14:14:10.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Spring Security"><meta property="article:tag" content="OAuth2"><meta property="article:published_time" content="2024-09-27T00:00:00.000Z"><meta property="article:modified_time" content="2024-11-21T14:14:10.000Z"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3316994_227lwxrw41z.css"><title>Spring Security + OAuth2 权限管理实战 | Java陈序员</title><meta name="description" content="Java陈序员的个人博客网站">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.7c8a6ce0.css">
    <link rel="modulepreload" href="/assets/app.06d697e7.js"><link rel="modulepreload" href="/assets/SpringSecurity_Oauth2.html.2a0b166c.js"><link rel="modulepreload" href="/assets/SpringSecurity_Oauth2.html.97f7fc3a.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.webp" alt="Java陈序员"><!----><span class="site-name hide-in-pad">Java陈序员</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" arialabel="首页"><i class="icon iconfont icon-home"></i>首页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="后端"><span class="title"><i class="icon iconfont icon-rearend"></i>后端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/rearend/java/" class="nav-link" arialabel="Java"><i class="icon iconfont icon-java"></i>Java<!----></a></li><li class="dropdown-item"><a href="/rearend/spring/" class="nav-link active" arialabel="Spring"><i class="icon iconfont icon-spring"></i>Spring<!----></a></li><li class="dropdown-item"><a href="/rearend/springBoot/" class="nav-link" arialabel="Spring Boot"><i class="icon iconfont icon-springboot"></i>Spring Boot<!----></a></li><li class="dropdown-item"><a href="/rearend/microServices/" class="nav-link" arialabel="微服务"><i class="icon iconfont icon-microServices"></i>微服务<!----></a></li><li class="dropdown-item"><a href="/rearend/dataStructure/" class="nav-link" arialabel="数据结构"><i class="icon iconfont icon-dataStructure"></i>数据结构<!----></a></li><li class="dropdown-item"><a href="/rearend/algorithm/" class="nav-link" arialabel="算法"><i class="icon iconfont icon-algorithm"></i>算法<!----></a></li><li class="dropdown-item"><a href="/rearend/designPattern/" class="nav-link" arialabel="设计模式"><i class="icon iconfont icon-designPattern"></i>设计模式<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="中间件"><span class="title"><i class="icon iconfont icon-middleware"></i>中间件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/middleware/database/" class="nav-link" arialabel="数据库"><i class="icon iconfont icon-database"></i>数据库<!----></a></li><li class="dropdown-item"><a href="/middleware/noSQL/" class="nav-link" arialabel="NoSQL"><i class="icon iconfont icon-noSQL"></i>NoSQL<!----></a></li><li class="dropdown-item"><a href="/middleware/mq/" class="nav-link" arialabel="MQ"><i class="icon iconfont icon-MQ"></i>MQ<!----></a></li><li class="dropdown-item"><a href="/middleware/zookeeper/" class="nav-link" arialabel="ZooKeeper"><i class="icon iconfont icon-zookeeper"></i>ZooKeeper<!----></a></li><li class="dropdown-item"><a href="/middleware/elasticsearch/" class="nav-link" arialabel="ElasticSearch"><i class="icon iconfont icon-elasticsearch"></i>ElasticSearch<!----></a></li><li class="dropdown-item"><a href="/middleware/prometheus/" class="nav-link" arialabel="Prometheus"><i class="icon iconfont icon-prometheus"></i>Prometheus<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="服务器"><span class="title"><i class="icon iconfont icon-server"></i>服务器</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/server/linux/" class="nav-link" arialabel="Linux"><i class="icon iconfont icon-linux"></i>Linux<!----></a></li><li class="dropdown-item"><a href="/server/docker/" class="nav-link" arialabel="Docker"><i class="icon iconfont icon-docker"></i>Docker<!----></a></li><li class="dropdown-item"><a href="/server/kubernetes/" class="nav-link" arialabel="Kubernetes"><i class="icon iconfont icon-kubernetes"></i>Kubernetes<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="AI"><span class="title"><i class="icon iconfont icon-wuguan"></i>AI</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/ai/assistant/" class="nav-link" arialabel="AI 助手"><i class="icon iconfont icon-Cursor"></i>AI 助手<!----></a></li><li class="dropdown-item"><a href="/ai/framework/" class="nav-link" arialabel="AI 框架"><i class="icon iconfont icon-Aisucai"></i>AI 框架<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="前端"><span class="title"><i class="icon iconfont icon-wangye"></i>前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>框架</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/framework/js/" class="nav-link" arialabel="JavaScript"><i class="icon iconfont icon-java_script"></i>JavaScript<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/nodejs/" class="nav-link" arialabel="Node.js"><i class="icon iconfont icon-node-js"></i>Node.js<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/vue/" class="nav-link" arialabel="Vue.js"><i class="icon iconfont icon-vue"></i>Vue.js<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/react/" class="nav-link" arialabel="React"><i class="icon iconfont icon-react"></i>React<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/mp/" class="nav-link" arialabel="小程序"><i class="icon iconfont icon-xiaochengxu"></i>小程序<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/blog/" class="nav-link" arialabel="Blog"><i class="icon iconfont icon-folder-vuepress"></i>Blog<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="索引"><span class="title"><i class="icon iconfont icon-index"></i>索引</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article/" class="nav-link" arialabel="文章"><i class="icon iconfont icon-articles"></i>文章<!----></a></li><li class="dropdown-item"><a href="/category/java/" class="nav-link" arialabel="分类"><i class="icon iconfont icon-category"></i>分类<!----></a></li><li class="dropdown-item"><a href="/tag/" class="nav-link" arialabel="标签"><i class="icon iconfont icon-tag"></i>标签<!----></a></li><li class="dropdown-item"><a href="/timeline/" class="nav-link" arialabel="时间轴"><i class="icon iconfont icon-timeLine"></i>时间轴<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzkzOTM3NjAzOQ==&amp;action=getalbum&amp;album_id=2783119709868212224&amp;scene=126&amp;sessionid=-659761542&amp;uin=&amp;key=&amp;devicetype=Windows+11+x64&amp;version=6309092b&amp;lang=zh_CN&amp;ascene=0&amp;session_us=gh_b840974cfe99" rel="noopener noreferrer" target="_blank" arialabel="开源项目" class="nav-link"><i class="icon iconfont icon-note"></i>开源项目<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/chenyl8848/chenyl8848.github.io" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" arialabelledby="outlook"><title id="outlook" lang="en">outlook icon</title><g fill="currentColor"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></g></svg><div class="outlook-dropdown"><!----></div></button></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/rearend/spring/" class="nav-link sidebar-link sidebar-page" arialabel="Spring"><i class="icon iconfont icon-spring"></i>Spring<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/rearend/spring/Spring6.html" class="nav-link sidebar-link sidebar-page" arialabel="Spring6 万字入门教程"><!---->Spring6 万字入门教程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/rearend/spring/Spring_DI.html" class="nav-link sidebar-link sidebar-page" arialabel="Spring 注入方式"><!---->Spring 注入方式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/rearend/spring/Spring_Retry.html" class="nav-link sidebar-link sidebar-page" arialabel="Spring Retry 实现重试机制"><!---->Spring Retry 实现重试机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" arialabel="Spring Security + OAuth2 权限管理实战"><!---->Spring Security + OAuth2 权限管理实战<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-spring-security-快速入门" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1. Spring Security 快速入门"><!---->1. Spring Security 快速入门<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-1-spring-security-介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.1 Spring Security 介绍"><!---->1.1 Spring Security 介绍<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-2-spring-security-快速搭建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2 Spring Security 快速搭建"><!---->1.2 Spring Security 快速搭建<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-3-spring-security-默认做了什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3 Spring Security 默认做了什么"><!---->1.3 Spring Security 默认做了什么<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-4-spring-security-底层原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.4 Spring Security 底层原理"><!---->1.4 Spring Security 底层原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-5-程序的启动和运行" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.5 程序的启动和运行"><!---->1.5 程序的启动和运行<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-spring-security-自定义配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2. Spring Security 自定义配置"><!---->2. Spring Security 自定义配置<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-1-基于内存的用户认证" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.1 基于内存的用户认证"><!---->2.1 基于内存的用户认证<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-2-基于数据库的用户认证" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2 基于数据库的用户认证"><!---->2.2 基于数据库的用户认证<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-密码加密算法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3. 密码加密算法"><!---->3. 密码加密算法<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-1-密码加密方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.1 密码加密方式"><!---->3.1 密码加密方式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-2-passwordencoder" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.2 PasswordEncoder"><!---->3.2 PasswordEncoder<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-3-密码加密实现" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.3 密码加密实现"><!---->3.3 密码加密实现<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-4-delegatingpasswordencoder" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.4 DelegatingPasswordEncoder"><!---->3.4 DelegatingPasswordEncoder<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_4-添加用户" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4. 添加用户"><!---->4. 添加用户<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_5-spring-security-的默认配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5. Spring Security 的默认配置"><!---->5. Spring Security 的默认配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_6-自定义登录页面" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6. 自定义登录页面"><!---->6. 自定义登录页面<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-前后端分离" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7. 前后端分离"><!---->7. 前后端分离<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-1-用户认证流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1 用户认证流程"><!---->7.1 用户认证流程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-2-认证成功响应处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2 认证成功响应处理"><!---->7.2 认证成功响应处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-3-认证失败响应处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3 认证失败响应处理"><!---->7.3 认证失败响应处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-4-注销响应处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4 注销响应处理"><!---->7.4 注销响应处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-5-请求未认证接口处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.5 请求未认证接口处理"><!---->7.5 请求未认证接口处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-6-跨域处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.6 跨域处理"><!---->7.6 跨域处理<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-身份认证" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8. 身份认证"><!---->8. 身份认证<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-1-用户认证信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.1 用户认证信息"><!---->8.1 用户认证信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-2-会话并发处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.2 会话并发处理"><!---->8.2 会话并发处理<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-授权" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="9. 授权"><!---->9. 授权<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-1-基于request的授权" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="9.1 基于request的授权"><!---->9.1 基于request的授权<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-1-3-用户-角色-权限-资源" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="9.1.3 用户-角色-权限-资源"><!---->9.1.3 用户-角色-权限-资源<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-2-基于方法的授权" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="9.2 基于方法的授权"><!---->9.2 基于方法的授权<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-oauth2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10. OAuth2"><!---->10. OAuth2<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-1-oauth2-简介" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10.1 OAuth2 简介"><!---->10.1 OAuth2 简介<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-2-spring中的oauth2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10.2 Spring中的OAuth2"><!---->10.2 Spring中的OAuth2<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-3-giuhub-社交登录案例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10.3 GiuHub 社交登录案例"><!---->10.3 GiuHub 社交登录案例<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-4-案例分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10.4 案例分析"><!---->10.4 案例分析<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Spring Security + OAuth2 权限管理实战</h1><div class="article-info"><span class="author-info" arialabel="作者🖊" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://chenyl8848.github.io" target="_blank" rel="noopener noreferrer">Java陈序员</a></span><span property="author" content="Java陈序员"></span></span><!----><span class="date-info" arialabel="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2024年9月27日</span><meta property="datePublished" content="2024-09-27T00:00:00.000Z"></span><span class="category-info" arialabel="分类🌈" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category category1 clickable" role="navigation">Spring</li><meta property="articleSection" content="Spring"></ul></span><span arialabel="标签🏷" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag tag5 clickable" role="navigation">Spring Security</li><li class="tag tag0 clickable" role="navigation">OAuth2</li></ul><meta property="keywords" content="Spring Security,OAuth2"></span><span class="reading-time-info" arialabel="阅读时间⌛" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" arialabelledby="timer"><title id="timer" lang="en">timer icon</title><g fill="currentColor"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></g></svg><span>大约 34 分钟</span><meta property="timeRequired" content="PT34M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-spring-security-快速入门" class="router-link-active router-link-exact-active toc-link level2">1. Spring Security 快速入门</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-1-spring-security-介绍" class="router-link-active router-link-exact-active toc-link level3">1.1 Spring Security 介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-2-spring-security-快速搭建" class="router-link-active router-link-exact-active toc-link level3">1.2 Spring Security 快速搭建</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-3-spring-security-默认做了什么" class="router-link-active router-link-exact-active toc-link level3">1.3 Spring Security 默认做了什么</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-4-spring-security-底层原理" class="router-link-active router-link-exact-active toc-link level3">1.4 Spring Security 底层原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_1-5-程序的启动和运行" class="router-link-active router-link-exact-active toc-link level3">1.5 程序的启动和运行</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-spring-security-自定义配置" class="router-link-active router-link-exact-active toc-link level2">2. Spring Security 自定义配置</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-1-基于内存的用户认证" class="router-link-active router-link-exact-active toc-link level3">2.1 基于内存的用户认证</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_2-2-基于数据库的用户认证" class="router-link-active router-link-exact-active toc-link level3">2.2 基于数据库的用户认证</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-密码加密算法" class="router-link-active router-link-exact-active toc-link level2">3. 密码加密算法</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-1-密码加密方式" class="router-link-active router-link-exact-active toc-link level3">3.1 密码加密方式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-2-passwordencoder" class="router-link-active router-link-exact-active toc-link level3">3.2 PasswordEncoder</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-3-密码加密实现" class="router-link-active router-link-exact-active toc-link level3">3.3 密码加密实现</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_3-4-delegatingpasswordencoder" class="router-link-active router-link-exact-active toc-link level3">3.4 DelegatingPasswordEncoder</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_4-添加用户" class="router-link-active router-link-exact-active toc-link level2">4. 添加用户</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_5-spring-security-的默认配置" class="router-link-active router-link-exact-active toc-link level2">5. Spring Security 的默认配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_6-自定义登录页面" class="router-link-active router-link-exact-active toc-link level2">6. 自定义登录页面</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-前后端分离" class="router-link-active router-link-exact-active toc-link level2">7. 前后端分离</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-1-用户认证流程" class="router-link-active router-link-exact-active toc-link level3">7.1 用户认证流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-2-认证成功响应处理" class="router-link-active router-link-exact-active toc-link level3">7.2 认证成功响应处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-3-认证失败响应处理" class="router-link-active router-link-exact-active toc-link level3">7.3 认证失败响应处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-4-注销响应处理" class="router-link-active router-link-exact-active toc-link level3">7.4 注销响应处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-5-请求未认证接口处理" class="router-link-active router-link-exact-active toc-link level3">7.5 请求未认证接口处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_7-6-跨域处理" class="router-link-active router-link-exact-active toc-link level3">7.6 跨域处理</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-身份认证" class="router-link-active router-link-exact-active toc-link level2">8. 身份认证</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-1-用户认证信息" class="router-link-active router-link-exact-active toc-link level3">8.1 用户认证信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_8-2-会话并发处理" class="router-link-active router-link-exact-active toc-link level3">8.2 会话并发处理</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-授权" class="router-link-active router-link-exact-active toc-link level2">9. 授权</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-1-基于request的授权" class="router-link-active router-link-exact-active toc-link level3">9.1 基于request的授权</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-1-3-用户-角色-权限-资源" class="router-link-active router-link-exact-active toc-link level3">9.1.3 用户-角色-权限-资源</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_9-2-基于方法的授权" class="router-link-active router-link-exact-active toc-link level3">9.2 基于方法的授权</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-oauth2" class="router-link-active router-link-exact-active toc-link level2">10. OAuth2</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-1-oauth2-简介" class="router-link-active router-link-exact-active toc-link level3">10.1 OAuth2 简介</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-2-spring中的oauth2" class="router-link-active router-link-exact-active toc-link level3">10.2 Spring中的OAuth2</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-3-giuhub-社交登录案例" class="router-link-active router-link-exact-active toc-link level3">10.3 GiuHub 社交登录案例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/rearend/spring/SpringSecurity+Oauth2.html#_10-4-案例分析" class="router-link-active router-link-exact-active toc-link level3">10.4 案例分析</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h1 id="spring-security-oauth2-权限管理实战" tabindex="-1"><a class="header-anchor" href="#spring-security-oauth2-权限管理实战" aria-hidden="true">#</a> Spring Security + OAuth2 权限管理实战</h1><blockquote><p>注意：本文基于 SpringBoot3 !</p></blockquote><h2 id="_1-spring-security-快速入门" tabindex="-1"><a class="header-anchor" href="#_1-spring-security-快速入门" aria-hidden="true">#</a> 1. Spring Security 快速入门</h2><h3 id="_1-1-spring-security-介绍" tabindex="-1"><a class="header-anchor" href="#_1-1-spring-security-介绍" aria-hidden="true">#</a> 1.1 Spring Security 介绍</h3><p>Spring Security 是一个提供 <strong>身份认证（authentication）、授权（authorization）和防御常见攻击（protection against common attacks）</strong> 的 Java 框架。SpringSecurity 基于<strong>过滤器链</strong>的概念，可以轻松地集成到任何基于 Spring 的应用程序中。</p><p><strong>官方文档：</strong> <code>https://docs.spring.io/spring-security/reference/index.html</code></p><p><strong>功能：</strong></p><ul><li><strong>身份认证：</strong> 身份认证是验证<code>谁正在访问系统资源</code>，判断用户是否为合法用户。认证用户的常见方式是要求<code>用户输入用户名和密码</code>。</li><li><strong>授权：</strong> 用户进行身份认证后，系统会控制<code>谁能访问哪些资源</code>，这个过程叫做授权。用户无法访问没有权限的资源。</li><li><strong>防御常见攻击：</strong><ul><li>CSRF</li><li>HTTP Headers</li><li>HTTP Requests</li></ul></li></ul><h3 id="_1-2-spring-security-快速搭建" tabindex="-1"><a class="header-anchor" href="#_1-2-spring-security-快速搭建" aria-hidden="true">#</a> 1.2 Spring Security 快速搭建</h3><blockquote><p>Spring Security 官方提供了示例代码，可通过下载示例代码快速集成。</p><p>官方代码示例：<code>https://github.com/spring-projects/spring-security-samples/tree/main</code></p></blockquote><p>1、创建 SpringBoot 项目（JDK17 + SpringBoot3）</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.codechen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springsecurity-oatuh2-demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>2、创建启动类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3、启动项目，浏览器中访问 <code>http://localhost:8080/</code> 会自动跳转到登录页面 <code>http://localhost:8080/login</code></p><blockquote><ul><li><code>默认用户名</code>：user</li><li><code>默认密码</code>：在控制台的启动日志中查找初始的默认密码 <code>Using generated security password: c52a3686-2ae8-4ec3-896b-efcbe5c99c74</code></li></ul></blockquote><p><strong>页面样式无法加载的问题</strong>：</p><p>页面样式 <code>bootstrap.min.css</code> 是一个 CDN 地址，需要通过<strong>科学上网</strong>的方式才能访问。</p><p>否则登录页会加载很久，并且看到的页面是这样的（登录按钮没有样式文件渲染，但是不影响登录功能的执行）。</p><h3 id="_1-3-spring-security-默认做了什么" tabindex="-1"><a class="header-anchor" href="#_1-3-spring-security-默认做了什么" aria-hidden="true">#</a> 1.3 Spring Security 默认做了什么</h3><ul><li>保护应用程序URL，要求对应用程序的任何交互进行身份验证。</li><li>程序启动时生成一个默认用户“user”。</li><li>生成一个默认的随机密码，并将此密码记录在控制台上。</li><li>生成默认的登录表单和注销页面。</li><li>提供基于表单的登录和注销流程。</li><li>对于Web请求，重定向到登录页面；</li><li>对于服务请求，返回401未经授权。</li><li>处理跨站请求伪造（CSRF）攻击。</li><li>处理会话劫持攻击。</li><li>写入Strict-Transport-Security以确保HTTPS。</li><li>写入X-Content-Type-Options以处理嗅探攻击。</li><li>写入Cache Control头来保护经过身份验证的资源。</li><li>写入X-Frame-Options以处理点击劫持攻击。</li></ul><h3 id="_1-4-spring-security-底层原理" tabindex="-1"><a class="header-anchor" href="#_1-4-spring-security-底层原理" aria-hidden="true">#</a> 1.4 Spring Security 底层原理</h3><p>Spring Security 之所以可以默认做这么多事情，它的底层原理是由很多个 <strong>过滤器（Servlet Filters）</strong> 实现的。</p><p><strong>官方文档</strong>：<code>https://docs.spring.io/spring-security/reference/servlet/architecture.html</code></p><ul><li>Filter（过滤器）</li></ul><p>下图展示了 Spring Security 处理一个 Http 请求时，过滤器和 Servlet 的工作流程：</p><p>客户端向应用程序发送请求，容器根据请求 URI 的路径创建一个 <code>FilterChain</code>，其中包含应处理 <code>HttpServletRequest</code> 的 <code>Filter</code> 实例和 <code>Servlet</code>. 在 Spring MVC 应用程序中，<code>Servlet</code> 是 <code>DispatcherServlet</code> 的实例，也就是代码中的 <code>Controller</code>.</p><ul><li>DelegatingFilterProxy（委托过滤代理类）</li></ul><p><code>DelegatingFilterProxy</code> 是 Spring Security 提供的一个 <code>Filter</code> 实现，可以在 <code>Servlet</code> 容器和 Spring 容器之间建立桥梁。通过使用 <code>DelegatingFilterProxy</code>，这样就可以将 Servlet 容器中的 <code>Filter</code> 实例放在 Spring 容器中管理。</p><ul><li>FilterChainProxy（过滤器链代理类）</li></ul><p>复杂的业务中不可能只有一个过滤器。因此 <code>FilterChainProxy</code> 是 Spring Security 提供的一个特殊的 Filter，它通过 <code>SecurityFilterChain</code> 将过滤器的工作委托给多个 <code>Bean Filter</code> 实例。由于 <code>FilterChainProxy</code> 是一个 Bean，因此它通常包装在 <code>DelegatingFilterProxy</code> 中。</p><ul><li>SecurityFilterChain（过滤器链）</li></ul><p><code>SecurityFilterChain</code> 被 <code>FilterChainProxy</code> 使用，负责查找当前的请求需要执行的 <code>Security Filter</code> 列表。</p><ul><li>1.4.5 Multiple SecurityFilterChain</li></ul><p>可以有多个 <code>SecurityFilterChain</code> 的配置，<code>FilterChainProxy</code> 决定使用哪个 <code>SecurityFilterChain</code>.</p><ul><li>如果请求的 URL 是 <code>/api/messages/</code>，它首先匹配 <code>SecurityFilterChain0</code> 的模式 <code>/api/\*\*</code>，因此只调用 <code>SecurityFilterChain 0</code>。</li><li>假设没有其他 <code>SecurityFilterChain</code> 实例匹配，那么将调用 <code>SecurityFilterChain n</code>.</li></ul><h3 id="_1-5-程序的启动和运行" tabindex="-1"><a class="header-anchor" href="#_1-5-程序的启动和运行" aria-hidden="true">#</a> 1.5 程序的启动和运行</h3><ul><li>DefaultSecurityFilterChain</li></ul><p>SecurityFilterChain 接口的默认实现，初始化实例时默认加载了 16 个 <code>Filter</code>.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">DefaultSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">RequestMatcher</span> requestMatcher<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Filter</span><span class="token punctuation">&gt;</span></span> filters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>filters<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Will not secure %s&quot;</span><span class="token punctuation">,</span> requestMatcher<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Will secure %s with %s&quot;</span><span class="token punctuation">,</span> requestMatcher<span class="token punctuation">,</span> filters<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>requestMatcher <span class="token operator">=</span> requestMatcher<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>filters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span>filters<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>2024-09-28T20:54:54.048+08:00  INFO 6312 --- [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [
org.springframework.security.web.session.DisableEncodeUrlFilter@2be21396,
org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@124dac75,
org.springframework.security.web.context.SecurityContextHolderFilter@53b1a3f8, 
org.springframework.security.web.header.HeaderWriterFilter@45c9b3, 
org.springframework.web.filter.CorsFilter@315105f, 
org.springframework.security.web.csrf.CsrfFilter@3252747e, 
org.springframework.security.web.authentication.logout.LogoutFilter@7327a447, 
org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter@21263314, 
org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter@3eb292cd, 
org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter@7b61bf11, 
org.springframework.security.web.authentication.www.BasicAuthenticationFilter@b73433, 
org.springframework.security.web.savedrequest.RequestCacheAwareFilter@5a936e64, 
org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@3b4a1a75, 
org.springframework.security.web.authentication.AnonymousAuthenticationFilter@40247d48, 
org.springframework.security.web.access.ExceptionTranslationFilter@68d6d775, 
org.springframework.security.web.access.intercept.AuthorizationFilter@4c6b4ed7]
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>SecurityProperties</li></ul><p>默认情况下 <code>Spring Security</code> 将初始的用户名和密码存在了 <code>SecurityProperties</code> 类中。这个类中有一个静态内部类 <code>User</code>，配置了默认的用户名（<code>name = &quot;user&quot;</code>）和密码（<code>password = uuid</code>）</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>
    prefix <span class="token operator">=</span> <span class="token string">&quot;spring.security&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> password <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>可以将用户名、密码配置在 SpringBoot 的配置文件中：</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">security</span><span class="token punctuation">:</span> 
    <span class="token key atrule">user</span><span class="token punctuation">:</span> 
      <span class="token key atrule">name</span><span class="token punctuation">:</span> admin
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_2-spring-security-自定义配置" tabindex="-1"><a class="header-anchor" href="#_2-spring-security-自定义配置" aria-hidden="true">#</a> 2. Spring Security 自定义配置</h2><h3 id="_2-1-基于内存的用户认证" tabindex="-1"><a class="header-anchor" href="#_2-1-基于内存的用户认证" aria-hidden="true">#</a> 2.1 基于内存的用户认证</h3><h4 id="_2-1-1-创建自定义配置" tabindex="-1"><a class="header-anchor" href="#_2-1-1-创建自定义配置" aria-hidden="true">#</a> 2.1.1 创建自定义配置</h4><p>实际开发的过程中，我们需要应用程序更加灵活，可以在 Spring Security 中创建自定义配置文件。</p><blockquote><p><strong>官方文档</strong>：https://docs.spring.io/spring-security/reference/servlet/configuration/java.html</p></blockquote><p>1、创建一个 <code>WebSecurityConfig</code> 文件</p><p>2、定义一个 <code>@Bean</code>，类型是 <code>UserDetailsService</code>，实现是 <code>InMemoryUserDetailsManager</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 标识这是一个配置类</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token comment">// 开启 Security 配置，在 SpringBoot 环境中，无需引入该注解</span>
<span class="token comment">// 在 SpringBootWebSecurityConfiguration 中已经引入</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 创建基于内存的用户信息管理器</span>
        <span class="token class-name">InMemoryUserDetailsManager</span> userDetailsManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用 userDetailsManager 管理 UserDetails 对象</span>
        userDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>
                <span class="token comment">// 创建 UserDetails 对象，用于管理用户名、用户密码、用户角色、用户权限等内容</span>
                <span class="token class-name">User</span>
                <span class="token punctuation">.</span><span class="token function">withDefaultPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">&quot;CodeChen&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> userDetailsManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong>UserDetailsService</strong> 用来管理用户信息，<strong>InMemoryUserDetailsManager</strong> 是 <code>UserDetailsService</code> 的一个实现，用来管理基于内存的用户信息。</p><blockquote><p><strong>注意</strong>：此时，通过配置文件配置 <code>SecurityProperties</code> 中的用户名、密码会失效！</p></blockquote><h4 id="_2-1-2-基于内存的用户认证流程" tabindex="-1"><a class="header-anchor" href="#_2-1-2-基于内存的用户认证流程" aria-hidden="true">#</a> 2.1.2 基于内存的用户认证流程</h4><ul><li>程序启动时： <ul><li>创建 <code>InMemoryUserDetailsManager</code> 对象</li><li>创建 <code>User</code> 对象，封装用户名密码</li><li>使用 <code>InMemoryUserDetailsManager</code> 将 <code>User</code> 存入内存</li></ul></li><li>校验用户时： <ul><li>Spring Security 自动使用 <code>InMemoryUserDetailsManager</code> 的 <code>loadUserByUsername</code> 方法从<strong>内存中</strong>获取 <code>User</code> 对象</li><li>在 <code>UsernamePasswordAuthenticationFilter</code> 过滤器中的 <code>attemptAuthentication</code> 方法中将用户输入的用户名密码和从内存中获取到的用户信息进行比较，进行用户认证</li></ul></li></ul><h3 id="_2-2-基于数据库的用户认证" tabindex="-1"><a class="header-anchor" href="#_2-2-基于数据库的用户认证" aria-hidden="true">#</a> 2.2 基于数据库的用户认证</h3><h4 id="_2-2-1-数据库环境搭建" tabindex="-1"><a class="header-anchor" href="#_2-2-1-数据库环境搭建" aria-hidden="true">#</a> 2.2.1 数据库环境搭建</h4><p>1、创建数据库表并插入测试数据</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建数据库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token identifier"><span class="token punctuation">`</span>security-demo<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">USE</span> <span class="token identifier"><span class="token punctuation">`</span>security-demo<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token comment">-- 创建用户表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>enabled<span class="token punctuation">`</span></span> <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 唯一索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user_username_uindex<span class="token punctuation">`</span></span> <span class="token keyword">ON</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">-- 插入用户数据(密码是 &quot;123456&quot; )</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>enabled<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;{bcrypt}$2a$10$E49Zm6HtzhSYvCcYkj5dve7Gc3Biu.iZ680bfiqx6Go6iodgL4VTa&#39;</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&#39;Helen&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;{bcrypt}$2a$10$E49Zm6HtzhSYvCcYkj5dve7Gc3Biu.iZ680bfiqx6Go6iodgL4VTa&#39;</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&#39;Tom&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;{bcrypt}$2a$10$E49Zm6HtzhSYvCcYkj5dve7Gc3Biu.iZ680bfiqx6Go6iodgL4VTa&#39;</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>2、引入依赖</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.31<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-spring-boot3-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>3、配置数据源</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># MySQL 数据源</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
<span class="token comment">#    todo 修改密码</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/security<span class="token punctuation">-</span>demo
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root

<span class="token comment"># 打印SQL日志</span>
<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>4、实体类</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUser</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/** 主键 */</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** 用户名 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** 密码 */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** 是否启用 */</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> enabled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>5、Mapper</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SysUserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>6、Service</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISysUserService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUserImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUserMapper</span><span class="token punctuation">,</span> <span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">ISysUserService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>7、Controller</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;sysuser&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysUserService</span> sysUserService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/getSysUserList&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSysUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sysUserService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>测试</strong>：<code>http://localhost:8080/sysuser/list</code></p><h4 id="_2-2-2-基于数据库的用户认证流程" tabindex="-1"><a class="header-anchor" href="#_2-2-2-基于数据库的用户认证流程" aria-hidden="true">#</a> 2.2.2 基于数据库的用户认证流程</h4><ul><li>程序启动时： <ul><li>创建 <code>UserDetailServiceImpl</code> 类，实现 <code>UserDetailsService</code> 接口的 <code>loadUserByUsername</code> 方法</li><li>将 <code>UserDetailServiceImpl</code> 类注入到 IOC 容器中</li></ul></li><li>校验用户时： <ul><li>Spring Security 自动使用 <code>UserDetailServiceImpl</code> 的 <code>loadUserByUsername</code> 方法从<strong>数据库中</strong>获取 <code>SysUser</code> 对象，并封装为 <code>UserDetails</code></li><li>在 <code>UsernamePasswordAuthenticationFilter</code> 过滤器中的 <code>attemptAuthentication</code> 方法中将用户输入的用户名密码和从数据库中获取到的用户信息进行比较，进行用户认证</li></ul></li></ul><h4 id="_2-2-3-定义-userdetailserviceimpl" tabindex="-1"><a class="header-anchor" href="#_2-2-3-定义-userdetailserviceimpl" aria-hidden="true">#</a> 2.2.3 定义 <code>UserDetailServiceImpl</code></h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDetailServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysUserService</span> sysUserService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SysUser</span> sysUser <span class="token operator">=</span> sysUserService<span class="token punctuation">.</span><span class="token function">getSysUserByUerName</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>
                sysUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                sysUser<span class="token punctuation">.</span><span class="token function">getEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">// 用户账号不过期</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token comment">// 用户凭证不过期</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token comment">// 用户不锁定</span>
                <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token comment">// 用户权限</span>
                authorities<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>测试</strong>：使用数据库中配置的用户名 <code>admin</code> 和密码 <code>123456</code> 进行登录。</p><h2 id="_3-密码加密算法" tabindex="-1"><a class="header-anchor" href="#_3-密码加密算法" aria-hidden="true">#</a> 3. 密码加密算法</h2><p>在前面基于数据库的用户认证中，我们输入用户名 <code>admin</code>、密码 <code>123456</code> 就能实现用户认证登录。</p><p>但是数据库中 <code>admin</code> 的密码明明是 <code>{bcrypt}$2a$10$E49Zm6HtzhSYvCcYkj5dve7Gc3Biu.iZ680bfiqx6Go6iodgL4VTa</code>, 为什么登录密码反而是 <code>123456</code> 呢？</p><p>我们先回顾下常用的密码加密方式。</p><p><strong>参考文档</strong>：<code>https://docs.spring.io/spring-security/reference/features/authentication/password-storage.html</code></p><h3 id="_3-1-密码加密方式" tabindex="-1"><a class="header-anchor" href="#_3-1-密码加密方式" aria-hidden="true">#</a> 3.1 密码加密方式</h3><ul><li>明文密码</li></ul><p>最初，密码以明文形式存储在数据库中，但是恶意用户可能会通过 SQL 注入等手段获取到明文密码，或者程序员将数据库数据泄露的情况也可能发生。</p><ul><li>哈希算法</li></ul><p>使用<strong>哈希算法</strong>对密码进行<strong>单向转换</strong>，常见的哈希算法如 <code>MD5</code>、<code>SHA-256</code>、<code>SHA-512</code> 等。</p><p><strong>哈希算法是单向的，只能加密，不能解密</strong>。</p><p>因此，<strong>数据库中存储的是单向转换后的密码</strong>，在进行用户身份验证时需要将用户输入的密码进行单向转换，然后与数据库的密码进行比较。</p><p>如果发生数据泄露，只有密码的单向哈希会被暴露。由于哈希是单向的，并且在给定哈希的情况下只能通过<strong>暴力破解的方式猜测密码</strong>。</p><ul><li>彩虹表</li></ul><p>彩虹表就是一个庞大的、针对各种可能的字母组合预先生成的哈希值集合，有了它可以快速破解各类密码。</p><p>越是复杂的密码，需要的彩虹表就越大，主流的彩虹表都是100G以上，目前主要的算法有LM、NTLM、MD5、SHA1、MYSQLSHA1、HALFLMCHALL、NTLMCHALL、ORACLE-SYSTEM、MD5-HALF.</p><ul><li>加盐密码</li></ul><p>为了减轻彩虹表的效果，开发人员开始使用<strong>加盐密码</strong>。</p><p>不再只使用密码作为哈希函数的输入，而是为每个用户的密码生成<strong>随机字节（称为盐）</strong>。</p><p><strong>盐和用户的密码将一起经过哈希函数运算，生成一个唯一的哈希</strong>。</p><p>盐将以明文形式与用户的密码一起存储，然后，当用户尝试进行身份验证时，盐和用户输入的密码一起经过哈希函数运算，再与存储的密码进行比较。</p><p>唯一的盐意味着彩虹表不再有效，因为对于每个盐和密码的组合，哈希都是不同的。</p><ul><li>自适应单向函数</li></ul><p>随着硬件的不断发展，加盐密码也不再安全。原因是，计算机可以每秒执行数十亿次哈希计算，这意味着可以轻松地破解每个密码。</p><p>现在，开发人员开始使用自适应单向函数来存储密码。</p><p>使用自适应单向函数验证密码时，<strong>故意占用资源（故意使用大量的CPU、内存或其他资源）</strong>。自适应单向函数允许配置一个<strong>工作因子</strong>，随着硬件的改进而增加。</p><blockquote><p>建议将<strong>工作因子</strong>调整到系统中验证密码需要约一秒钟的时间，这种权衡是为了<strong>让攻击者难以破解密码</strong>。</p></blockquote><p>自适应单向函数包括 <code>BCrypt</code>、<code>PBKDF2</code>、<code>Scrypt</code> 和 <code>Argon2</code>.</p><h3 id="_3-2-passwordencoder" tabindex="-1"><a class="header-anchor" href="#_3-2-passwordencoder" aria-hidden="true">#</a> 3.2 PasswordEncoder</h3><p>Spring Security 中一个基于自适应单项函数实现的密码解析器接口，用以进行密码存储和校验。</p><p>PasswordEncoder 接口具体的实现类有：</p><ul><li>BCryptPasswordEncoder</li></ul><p>使用广泛支持的 BCrypt 算法来对密码进行哈希。</p><p>为了增加对密码破解的抵抗力，BCrypt 故意设计得较慢。和其他自适应单向函数一样，应该调整其参数，使其在您的系统上验证一个密码大约需要 1 秒的时间。</p><p><strong>BCryptPasswordEncoder 自带 Salt 加盐机制，即使相同的明文每次生成的加密字符串都不相同。默认实现使用强度 10, 建议您在自己的系统上调整和测试强度参数，以便验证密码时大约需要 1 秒的时间</strong>。</p><ul><li>Argon2PasswordEncoder</li></ul><p>使用 Argon2 算法对密码进行哈希处理。</p><p>为了防止在自定义硬件上进行密码破解，Argon2 是一种故意缓慢的算法，需要大量内存。</p><p>当前的 Argon2PasswordEncoder 实现需要使用 BouncyCastle 库。</p><ul><li>Pbkdf2PasswordEncoder</li></ul><p>使用 PBKDF2 算法对密码进行哈希处理。</p><p>为了防止密码破解，PBKDF2 是一种故意缓慢的算法。</p><p>当需要 FIPS 认证时，这种算法是一个很好的选择。</p><ul><li>SCryptPasswordEncoder</li></ul><p>使用 SCrypt 算法对密码进行哈希处理。</p><h3 id="_3-3-密码加密实现" tabindex="-1"><a class="header-anchor" href="#_3-3-密码加密实现" aria-hidden="true">#</a> 3.3 密码加密实现</h3><p>在测试类中编写一个测试方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 工作因子，默认值是 10，最小值是 4，最大值是 31，值越大运算速度越慢</span>
    <span class="token class-name">PasswordEncoder</span> encoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 明文：&quot;123456&quot;</span>
    <span class="token comment">// 密文：result，即使明文密码相同，每次生成的密文也不一致</span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//密码校验</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>encoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;密码不一致&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-4-delegatingpasswordencoder" tabindex="-1"><a class="header-anchor" href="#_3-4-delegatingpasswordencoder" aria-hidden="true">#</a> 3.4 DelegatingPasswordEncoder</h3><ul><li>表中存储的密码形式：<code>{bcrypt}$2a$10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW</code></li><li>通过如下源码可以知道：可以通过 <code>{bcrypt}</code> 前缀动态获取和密码的形式类型一致的 PasswordEncoder 对象</li><li>目的：方便随时做密码策略的升级，兼容数据库中的老版本密码策略生成的密码</li></ul><h2 id="_4-添加用户" tabindex="-1"><a class="header-anchor" href="#_4-添加用户" aria-hidden="true">#</a> 4. 添加用户</h2><p>1、<code>SysUserController</code> 中添加方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSysUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sysUserService<span class="token punctuation">.</span><span class="token function">addSysUser</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2、<code>ISysUserService</code> 接口中添加方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">addSysUser</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3、<code>SysUserImpl</code> 实现中添加方法实现</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">PasswordEncoder</span> passwordEncoder <span class="token operator">=</span> <span class="token class-name">PasswordEncoderFactories</span><span class="token punctuation">.</span><span class="token function">createDelegatingPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSysUser</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// 使用 PasswordEncoder 加密用户输入的密码</span>
    sysUser<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">save</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>4、使用 Swagger 测试</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 引入 Swagger 依赖 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.xiaoymin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>knife4j-openapi3-jakarta-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Swagger测试地址</strong>：<code>http://localhost:8080/doc.html</code></p><p>5、关闭 CSRF 攻击防御</p><p>默认情况下 Spring Security 开启了 CSRF 攻击防御的功能，这要求请求参数中必须有一个隐藏的 <code>_csrf</code> 字段，如下：</p><p>需要在 Spring Security 的默认配置中关闭 CSRF 攻击防御。</p><p>在 <code>WebSecurityConfig</code> 中添加如下代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// 对所有请求开启请求保护</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 使用默认登录页</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 关闭跨站伪造攻击</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_5-spring-security-的默认配置" tabindex="-1"><a class="header-anchor" href="#_5-spring-security-的默认配置" aria-hidden="true">#</a> 5. Spring Security 的默认配置</h2><p>我们为了关闭 CSRF 攻击防御，在 <code>WebSecurityConfig</code> 中注入了 <code>SecurityFilterChain</code>. 在这里可以修改添加 Spring Security 的默认配置，比如<strong>开启授权保护、修改表单授权模式、自定义登录页等等</strong>。</p><p>1、开启授权保护</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// 对所有请求开启请求保护</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 使用默认登录页</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 关闭跨站伪造攻击</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>开启后，所有请求都需要经过登录后才能访问。</p><p>2、使用浏览器自带登录表单授权</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> httpSecurity
                <span class="token comment">// 对所有请求开启请求保护</span>
                <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 使用默认登录页</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
                <span class="token comment">// 基本授权方式</span>
                <span class="token punctuation">.</span><span class="token function">httpBasic</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 关闭跨站伪造攻击</span>
                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="_6-自定义登录页面" tabindex="-1"><a class="header-anchor" href="#_6-自定义登录页面" aria-hidden="true">#</a> 6. 自定义登录页面</h2><p>在开发中，为了实现更好的交互，往往都是自己开发登录页面。那么，在 Spring Security 要怎么配置自定义登录页面呢？</p><p>1、引入模板引擎 <code>thymeleaf</code> 依赖</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2、创建 <code>LoginController</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>3、在 <code>resources/templates/</code> 目录下创建登录页面 <code>login.html</code></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${param.error}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    错误的用户名和密码.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--method必须为&quot;post&quot;--&gt;</span>
<span class="token comment">&lt;!--th:action=&quot;@{/login}&quot; ，
使用动态参数，表单中会自动生成_csrf隐藏字段，用于防止csrf攻击
login: 和登录页面保持一致即可，SpringSecurity自动进行登录认证--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/login}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--name必须为&quot;username&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>用户名<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--name必须为&quot;password&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>密码<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登录<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>4、配置 <code>WebSecurityConfig</code> 中的 <code>SecurityFilterChain</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// 对所有请求开启请求保护</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 使用默认登录页</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// 基本授权方式</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// 配置自定义登录页</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置登录页无需授权即可访问</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 关闭跨站伪造攻击</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><blockquote><p>注意：需要配置登录页无需授权即可访问，否则会由于<strong>重定向的次数过多导致页面崩溃</strong>。</p></blockquote><p>5、修改用户名、密码表单字段</p><p>在前面的 HTML 中，用户名、密码的表单 <code>name</code> 为 <code>username</code>、<code>password</code>, 是否可以修改为其他名称呢？</p><p>答案是可以的。</p><p>比如在 HTML 中将用户名、密码的表单 <code>name</code> 修改为 <code>myusername</code>、<code>pwd</code>.</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/login}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--name必须为&quot;username&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myusername<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>用户名<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--name必须为&quot;password&quot;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>密码<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登录<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>此时，会发现登录不了，提示<strong>错误的用户名和密码.</strong>。</p><p>这是因为在 Spring Security 中默认的字段为 <code>username</code>、<code>password</code>, 在 <code>UsernamePasswordAuthenticationFilter</code> 源码中可以看到：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">String</span> usernameParameter <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> passwordParameter <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>因此，需要在 Spring Security 的默认配置中进行同步修改：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// 对所有请求开启请求保护</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 使用默认登录页</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// 基本授权方式</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// 配置自定义登录页</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置自定义的表单用户名参数 默认：username</span>
                        <span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;myusername&quot;</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置自定义的表单密码参数 默认：password</span>
                        <span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置登录页无需授权即可访问</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 关闭跨站伪造攻击</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="_7-前后端分离" tabindex="-1"><a class="header-anchor" href="#_7-前后端分离" aria-hidden="true">#</a> 7. 前后端分离</h2><h3 id="_7-1-用户认证流程" tabindex="-1"><a class="header-anchor" href="#_7-1-用户认证流程" aria-hidden="true">#</a> 7.1 用户认证流程</h3><ul><li>登录成功后调用：AuthenticationSuccessHandler</li><li>登录失败后调用：AuthenticationFailureHandler</li></ul><h3 id="_7-2-认证成功响应处理" tabindex="-1"><a class="header-anchor" href="#_7-2-认证成功响应处理" aria-hidden="true">#</a> 7.2 认证成功响应处理</h3><p>1、引入 fastjson2</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.40<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>2、创建 <code>CustomAuthenticationSuccessHandler</code> 登录成功处理类并实现 <code>AuthenticationSuccessHandler</code> 接口</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationSuccessHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                                        <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                                        <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token comment">// 获取用户身份信息</span>
        <span class="token class-name">Object</span> principal <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取用户凭证信息</span>
        <span class="token class-name">Object</span> credentials <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取用户权限信息</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;登录成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出响应结果</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>3、在 Spring Security 的默认配置中配置<strong>认证成功时的处理类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// 对所有请求开启请求保护</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 使用默认登录页</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// 基本授权方式</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// 配置自定义登录页</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // 配置自定义的表单用户名参数 默认：username</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // 配置自定义的表单密码参数 默认：password</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                        <span class="token comment">// 配置认证成功自定义处理类</span>
                        <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置登录页无需授权即可访问</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 关闭跨站伪造攻击</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_7-3-认证失败响应处理" tabindex="-1"><a class="header-anchor" href="#_7-3-认证失败响应处理" aria-hidden="true">#</a> 7.3 认证失败响应处理</h3><p>1、创建 <code>CustomAuthenticationFailureHandler</code> 登录失败处理类并实现 <code>AuthenticationFailureHandler</code> 接口</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAuthenticationFailureHandler</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationFailureHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAuthenticationFailure</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                                        <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                                        <span class="token class-name">AuthenticationException</span> exception<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;登录失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出响应结果</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>2、在 Spring Security 的默认配置中配置<strong>认证失败时的处理类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// 对所有请求开启请求保护</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 使用默认登录页</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// 基本授权方式</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// 配置自定义登录页</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // 配置自定义的表单用户名参数 默认：username</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // 配置自定义的表单密码参数 默认：password</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                        <span class="token comment">// 配置认证成功自定义处理类</span>
                        <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置认证失败自定义处理类</span>
                        <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置登录页无需授权即可访问</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 关闭跨站伪造攻击</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_7-4-注销响应处理" tabindex="-1"><a class="header-anchor" href="#_7-4-注销响应处理" aria-hidden="true">#</a> 7.4 注销响应处理</h3><p>1、创建 <code>CustomLogoutSuccessHandler</code> 登录失败处理类并实现 <code>LogoutSuccessHandler</code> 接口</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomLogoutSuccessHandler</span> <span class="token keyword">implements</span> <span class="token class-name">LogoutSuccessHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLogoutSuccess</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                                <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                                <span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;注销成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出响应结果</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>2、在 Spring Security 的默认配置中配置<strong>注销成功时的处理类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// 对所有请求开启请求保护</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 使用默认登录页</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// 基本授权方式</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// 配置自定义登录页</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // 配置自定义的表单用户名参数 默认：username</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // 配置自定义的表单密码参数 默认：password</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                        <span class="token comment">// 配置认证成功自定义处理类</span>
                        <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置认证失败自定义处理类</span>
                        <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置登录页无需授权即可访问</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 配置注销成功自定义处理类</span>
            <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>logout <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                logout<span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 关闭跨站伪造攻击</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_7-5-请求未认证接口处理" tabindex="-1"><a class="header-anchor" href="#_7-5-请求未认证接口处理" aria-hidden="true">#</a> 7.5 请求未认证接口处理</h3><p>当访问一个需要认证之后才能访问的接口时，Spring Security 会使用 <code>AuthenticationEntryPoint</code> 将用户请求跳转到登录页面，要求用户提供登录凭证。</p><p>在前后端分离的模式下，希望<strong>返回 JSON 结果</strong>，可以通过定义类并实现 <code>AuthenticationEntryPoint</code> 接口来实现功能。</p><p>1、创建 <code>CustomAuthenticationEntryPoint</code> 未认证接口的处理类并实现 <code>AuthenticationEntryPoint</code> 接口</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomAuthenticationEntryPoint</span> <span class="token keyword">implements</span> <span class="token class-name">AuthenticationEntryPoint</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">commence</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
                         <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
                         <span class="token class-name">AuthenticationException</span> authException<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;请先登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出响应结果</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>2、在 Spring Security 的默认配置中配置<strong>请求未认证接口的处理类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//错误处理</span>
http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception  <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//请求未认证的接口</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_7-6-跨域处理" tabindex="-1"><a class="header-anchor" href="#_7-6-跨域处理" aria-hidden="true">#</a> 7.6 跨域处理</h3><p>跨域(CORS)全称是跨域资源共享(Cross-Origin Resources Sharing)，它是浏览器的保护机制，只允许网页请求同一域名下的服务。</p><blockquote><p>同一域名指协议、域名、端口号都要保持一致，如果有一项不同，那么就是跨域请求。</p></blockquote><p>在前后端分离的项目中，需要解决跨域的问题。</p><p>在 Spring Security 中解决跨域很简单，在默认配置中添加如下配置即可：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//跨域</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> httpSecurity
            <span class="token comment">// 对所有请求开启请求保护</span>
            <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 使用默认登录页</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
            <span class="token comment">// 基本授权方式</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
            <span class="token comment">// 配置自定义登录页</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // 配置自定义的表单用户名参数 默认：username</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // 配置自定义的表单密码参数 默认：password</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                        <span class="token comment">// 配置认证成功自定义处理类</span>
                        <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置认证失败自定义处理类</span>
                        <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// 配置登录页无需授权即可访问</span>
                        <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 配置注销成功自定义处理类</span>
            <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>logout <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                logout<span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 配置请求未认证接口的处理类</span>
            <span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 跨域处理</span>
            <span class="token punctuation">.</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 关闭跨站伪造攻击</span>
            <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h2 id="_8-身份认证" tabindex="-1"><a class="header-anchor" href="#_8-身份认证" aria-hidden="true">#</a> 8. 身份认证</h2><h3 id="_8-1-用户认证信息" tabindex="-1"><a class="header-anchor" href="#_8-1-用户认证信息" aria-hidden="true">#</a> 8.1 用户认证信息</h3><h4 id="_8-1-1-基本概念" tabindex="-1"><a class="header-anchor" href="#_8-1-1-基本概念" aria-hidden="true">#</a> 8.1.1 基本概念</h4><p>在 Spring Security 框架中，<code>SecurityContextHolder</code>、<code>SecurityContext</code>、<code>Authentication</code>、<code>Principal</code> 和 <code>Credential</code> 是一些与身份验证和授权相关的重要概念。</p><p>它们之间的关系如下：</p><ol><li><code>SecurityContextHolder</code>：Spring Security 存储已认证用户详细信息的地方</li><li><code>SecurityContext</code>：从 SecurityContextHolder 获取内容，包含当前已认证用户的 Authentication 信息</li><li><code>Authentication</code>：Authentication 表示用户的身份认证信息，它包含了用户的 <code>Principal</code>、<code>Credential</code> 和 <code>Authority</code> 信息</li><li><code>Principal</code>：表示用户的身份标识，它通常是一个表示用户的实体对象。可以通过 <code>Authentication</code> 对象的 <code>getPrincipal()</code> 方法获取</li><li><code>Credentials</code>：表示用户的凭证信息，例如密码、证书或其他认证凭据。可以通过 <code>Authentication</code> 对象的 <code>getCredentials()</code> 方法获取</li><li><code>GrantedAuthority</code>：表示用户被授予的权限</li></ol><p>总结起来：</p><ul><li><code>SecurityContextHolder</code> 用于管理当前线程的安全上下文，存储已认证用户的详细信息，其中包含了 <code>SecurityContext</code> 对象</li><li><code>SecurityContext</code> 对象包含了 <code>Authentication</code> 对象，<code>Authentication</code> 表示用户的身份验证信息</li><li><code>Authentication</code> 对象包括 <code>Principal</code>（用户的身份标识）、<code>Credential</code>（用户的凭证信息）和 <code>GrantedAuthority</code>（用户的权限信息）</li></ul><h4 id="_8-1-2-在-controller-中获取用户信息" tabindex="-1"><a class="header-anchor" href="#_8-1-2-在-controller-中获取用户信息" aria-hidden="true">#</a> 8.1.2 在 Controller 中获取用户信息</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 存储认证对象的上下文</span>
        <span class="token class-name">SecurityContext</span> securityContext <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 认证对象</span>
        <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> securityContext<span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 用户名</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 用户信息 org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[]]</span>
        <span class="token class-name">Object</span> principal <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 用户凭证（脱敏处理 null）</span>
        <span class="token class-name">Object</span> credentials <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 用户权限</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建结果对象</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> resultMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_8-2-会话并发处理" tabindex="-1"><a class="header-anchor" href="#_8-2-会话并发处理" aria-hidden="true">#</a> 8.2 会话并发处理</h3><p>在 Spring Security 框架中可以实现会话并发处理，后登录的账号会使先登录的账号失效。</p><p>1、创建 <code>CustomSessionInformationExpiredStrategy</code> 类并实现接口 <code>SessionInformationExpiredStrategy</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomSessionInformationExpiredStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">SessionInformationExpiredStrategy</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onExpiredSessionDetected</span><span class="token punctuation">(</span><span class="token class-name">SessionInformationExpiredEvent</span> event<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;该账号已从其他设备登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>resultMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 输出响应结果</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>2、在 Spring Security 的默认配置中配置<strong>会话并发的处理类</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> httpSecurity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> httpSecurity
                <span class="token comment">// 对所有请求开启请求保护</span>
                <span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span>authorize <span class="token operator">-&gt;</span> authorize<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 使用默认登录页</span>
<span class="token comment">//                .formLogin(withDefaults())</span>
                <span class="token comment">// 基本授权方式</span>
<span class="token comment">//                .httpBasic(withDefaults())</span>
                <span class="token comment">// 配置自定义登录页</span>
                <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>form <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    form<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                            // 配置自定义的表单用户名参数 默认：username</span>
<span class="token comment">//                            .usernameParameter(&quot;myusername&quot;)</span>
<span class="token comment">//                            // 配置自定义的表单密码参数 默认：password</span>
<span class="token comment">//                            .passwordParameter(&quot;pwd&quot;)</span>
                            <span class="token comment">// 配置认证成功自定义处理类</span>
                            <span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token comment">// 配置认证失败自定义处理类</span>
                            <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token comment">// 配置登录页无需授权即可访问</span>
                            <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 配置注销成功自定义处理类</span>
                <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>logout <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    logout<span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 配置请求未认证接口的处理类</span>
                <span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 跨域处理</span>
                <span class="token punctuation">.</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 会话并发处理</span>
                <span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span>session <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 设置用户的最大会话数为 1，即只允许一个用户（同个用户）在线，不允许同一个用户多端多设备同时在线</span>
                    session<span class="token punctuation">.</span><span class="token function">maximumSessions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">expiredSessionStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomSessionInformationExpiredStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 关闭跨站伪造攻击</span>
                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span>csrf <span class="token operator">-&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="_9-授权" tabindex="-1"><a class="header-anchor" href="#_9-授权" aria-hidden="true">#</a> 9. 授权</h2><p>授权管理的实现在SpringSecurity中非常灵活，可以帮助应用程序实现以下两种常见的授权需求：</p><ul><li><p>用户-权限-资源：例如张三的权限是添加用户、查看用户列表，李四的权限是查看用户列表</p></li><li><p>用户-角色-权限-资源：例如 张三是角色是管理员、李四的角色是普通用户，管理员能做所有操作，普通用户只能查看信息</p></li></ul><h3 id="_9-1-基于request的授权" tabindex="-1"><a class="header-anchor" href="#_9-1-基于request的授权" aria-hidden="true">#</a> 9.1 基于request的授权</h3><h4 id="_9-1-1-用户-权限-资源" tabindex="-1"><a class="header-anchor" href="#_9-1-1-用户-权限-资源" aria-hidden="true">#</a> 9.1.1 用户-权限-资源</h4><p><strong>需求：</strong></p><ul><li>具有USER_LIST权限的用户可以访问/user/list接口</li><li>具有USER_ADD权限的用户可以访问/user/add接口</li></ul><p>1、配置权限</p><p>SecurityFilterChain</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//开启授权保护</span>
http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>
        authorize <span class="token operator">-&gt;</span> authorize
    			<span class="token comment">//具有USER_LIST权限的用户可以访问/user/list</span>
                <span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;USER_LIST&quot;</span><span class="token punctuation">)</span>
    			<span class="token comment">//具有USER_ADD权限的用户可以访问/user/add</span>
    			<span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;USER_ADD&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//对所有请求开启授权保护</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//已认证的请求会被自动授权</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>2、授予权限</p><p>DBUserDetailsManager中的loadUserByUsername方法：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> authorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authorities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token string">&quot;USER_LIST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authorities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token string">&quot;USER_ADD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*authorities.add(new GrantedAuthority() {
    @Override
    public String getAuthority() {
        return &quot;USER_LIST&quot;;
    }
});
authorities.add(new GrantedAuthority() {
    @Override
    public String getAuthority() {
        return &quot;USER_ADD&quot;;
    }
});*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>3、请求未授权的接口</p><p>SecurityFilterChain</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//错误处理</span>
http<span class="token punctuation">.</span><span class="token function">exceptionHandling</span><span class="token punctuation">(</span>exception  <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    exception<span class="token punctuation">.</span><span class="token function">authenticationEntryPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//请求未认证的接口</span>
    exception<span class="token punctuation">.</span><span class="token function">accessDeniedHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span> <span class="token comment">//请求未授权的接口</span>

        <span class="token comment">//创建结果对象</span>
        <span class="token class-name">HashMap</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;没有权限&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//转换成json字符串</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//返回响应</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>更多的例子</strong>：https://docs.spring.io/spring-security/reference/servlet/authorization/authorize-http-requests.html</p><h4 id="_9-1-2-用户-角色-资源" tabindex="-1"><a class="header-anchor" href="#_9-1-2-用户-角色-资源" aria-hidden="true">#</a> 9.1.2 用户-角色-资源</h4><p><strong>需求</strong>：角色为 ADMIN 的用户才可以访问 <code>/user/**</code> 路径下的资源</p><p>1、配置角色</p><p>SecurityFilterChain</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//开启授权保护</span>
http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>
        authorize <span class="token operator">-&gt;</span> authorize
                <span class="token comment">//具有管理员角色的用户可以访问/user/**</span>
                <span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//对所有请求开启授权保护</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//已认证的请求会被自动授权</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>2、授予角色</p><p>DBUserDetailsManager中的loadUserByUsername方法：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span>
        <span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_9-1-3-用户-角色-权限-资源" tabindex="-1"><a class="header-anchor" href="#_9-1-3-用户-角色-权限-资源" aria-hidden="true">#</a> 9.1.3 用户-角色-权限-资源</h3><p>RBAC（Role-Based Access Control，基于角色的访问控制）是一种常用的数据库设计方案，它将用户的权限分配和管理与角色相关联。以下是一个基本的RBAC数据库设计方案的示例：</p><ol><li>用户表（User table）：包含用户的基本信息，例如用户名、密码和其他身份验证信息。</li></ol><table><thead><tr><th>列名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>user_id</td><td>int</td><td>用户ID</td></tr><tr><td>username</td><td>varchar</td><td>用户名</td></tr><tr><td>password</td><td>varchar</td><td>密码</td></tr><tr><td>email</td><td>varchar</td><td>电子邮件地址</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><ol start="2"><li>角色表（Role table）：存储所有可能的角色及其描述。</li></ol><table><thead><tr><th>列名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>role_id</td><td>int</td><td>角色ID</td></tr><tr><td>role_name</td><td>varchar</td><td>角色名称</td></tr><tr><td>description</td><td>varchar</td><td>角色描述</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><ol start="3"><li>权限表（Permission table）：定义系统中所有可能的权限。</li></ol><table><thead><tr><th>列名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>permission_id</td><td>int</td><td>权限ID</td></tr><tr><td>permission_name</td><td>varchar</td><td>权限名称</td></tr><tr><td>description</td><td>varchar</td><td>权限描述</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><ol start="4"><li>用户角色关联表（User-Role table）：将用户与角色关联起来。</li></ol><table><thead><tr><th>列名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>user_role_id</td><td>int</td><td>用户角色关联ID</td></tr><tr><td>user_id</td><td>int</td><td>用户ID</td></tr><tr><td>role_id</td><td>int</td><td>角色ID</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><ol start="5"><li>角色权限关联表（Role-Permission table）：将角色与权限关联起来。</li></ol><table><thead><tr><th>列名</th><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>role_permission_id</td><td>int</td><td>角色权限关联ID</td></tr><tr><td>role_id</td><td>int</td><td>角色ID</td></tr><tr><td>permission_id</td><td>int</td><td>权限ID</td></tr><tr><td>...</td><td>...</td><td>...</td></tr></tbody></table><p>在这个设计方案中，用户可以被分配一个或多个角色，而每个角色又可以具有一个或多个权限。通过对用户角色关联和角色权限关联表进行操作，可以实现灵活的权限管理和访问控制。</p><p>当用户尝试访问系统资源时，系统可以根据用户的角色和权限决定是否允许访问。这样的设计方案使得权限管理更加简单和可维护，因为只需调整角色和权限的分配即可，而不需要针对每个用户进行单独的设置。</p><h3 id="_9-2-基于方法的授权" tabindex="-1"><a class="header-anchor" href="#_9-2-基于方法的授权" aria-hidden="true">#</a> 9.2 基于方法的授权</h3><p>1、开启方法授权</p><p>在配置文件中添加如下注解</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableMethodSecurity</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2、给用户授予角色和权限</p><p>DBUserDetailsManager中的loadUserByUsername方法：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">return</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span>
        <span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">authorities</span><span class="token punctuation">(</span><span class="token string">&quot;USER_ADD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;USER_UPDATE&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>3、常用授权注解</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//用户必须有 ADMIN 角色 并且 用户名是 admin 才能访问此方法</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasRole(&#39;ADMIN&#39;) and authentication.name == &#39;admim&#39;&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//用户必须有 USER_ADD 权限 才能访问此方法</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;USER_ADD&#39;)&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    userService<span class="token punctuation">.</span><span class="token function">saveUserDetails</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>更多的例子</strong>：https://docs.spring.io/spring-security/reference/servlet/authorization/method-security.html</p><h2 id="_10-oauth2" tabindex="-1"><a class="header-anchor" href="#_10-oauth2" aria-hidden="true">#</a> 10. OAuth2</h2><h3 id="_10-1-oauth2-简介" tabindex="-1"><a class="header-anchor" href="#_10-1-oauth2-简介" aria-hidden="true">#</a> 10.1 OAuth2 简介</h3><h4 id="_10-1-1-oauth2-什么" tabindex="-1"><a class="header-anchor" href="#_10-1-1-oauth2-什么" aria-hidden="true">#</a> 10.1.1 OAuth2 什么</h4><p>“Auth” 表示 “授权” Authorization</p><p>“O” 是 Open 的简称，表示 “开放”</p><p>连在一起就表示 <strong>“开放授权”</strong>，OAuth2是一种开放授权协议。</p><p><strong>OAuth2最简向导</strong>：https://darutk.medium.com/the-simplest-guide-to-oauth-2-0-8c71bd9a15bb</p><h4 id="_10-1-2-oauth2-的角色" tabindex="-1"><a class="header-anchor" href="#_10-1-2-oauth2-的角色" aria-hidden="true">#</a> 10.1.2 OAuth2 的角色</h4><p>OAuth 2协议包含以下角色：</p><ol><li>资源所有者（Resource Owner）：即用户，资源的拥有人，想要通过客户应用访问资源服务器上的资源。</li><li>客户应用（Client）：通常是一个Web或者无线应用，它需要访问用户的受保护资源。</li><li>资源服务器（Resource Server）：存储受保护资源的服务器或定义了可以访问到资源的API，接收并验证客户端的访问令牌，以决定是否授权访问资源。</li><li>授权服务器（Authorization Server）：负责验证资源所有者的身份并向客户端颁发访问令牌。</li></ol><h4 id="_10-1-3-oauth2的使用场景" tabindex="-1"><a class="header-anchor" href="#_10-1-3-oauth2的使用场景" aria-hidden="true">#</a> 10.1.3 OAuth2的使用场景</h4><ul><li><p>开放系统间授权</p></li><li><p>社交登录</p></li></ul><p>在传统的身份验证中，用户需要提供用户名和密码，还有很多网站登录时，允许使用第三方网站的身份，这称为&quot;第三方登录&quot;。所谓第三方登录，实质就是 OAuth 授权。用户想要登录 A 网站，A 网站让用户提供第三方网站的数据，证明自己的身份。获取第三方网站的身份数据，就需要 OAuth 授权。</p><ul><li>开放API</li></ul><p>例如云冲印服务的实现</p><ul><li><p>现代微服务安全</p></li><li><p>单块应用安全</p></li></ul><ul><li>微服务安全</li></ul><ul><li><p>企业内部应用认证授权</p></li><li><p>SSO：Single Sign On 单点登录</p></li><li><p>IAM：Identity and Access Management 身份识别与访问管理</p></li></ul><h4 id="_10-1-4-oauth2-的四种授权模式" tabindex="-1"><a class="header-anchor" href="#_10-1-4-oauth2-的四种授权模式" aria-hidden="true">#</a> 10.1.4 OAuth2 的四种授权模式</h4><p>RFC6749：</p><p><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_blank" rel="noopener noreferrer">RFC 6749 - The OAuth 2.0 Authorization Framework (ietf.org)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>阮一峰：</p><p><a href="https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html" target="_blank" rel="noopener noreferrer">OAuth 2.0 的四种方式 - 阮一峰的网络日志 (ruanyifeng.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>四种模式：</p><ul><li>授权码（authorization-code）</li><li>隐藏式（implicit）</li><li>密码式（password）</li><li>客户端凭证（client credentials）</li></ul><h4 id="第一种方式-授权码" tabindex="-1"><a class="header-anchor" href="#第一种方式-授权码" aria-hidden="true">#</a> 第一种方式：授权码</h4><p><strong>授权码（authorization code），指的是第三方应用先申请一个授权码，然后再用该码获取令牌。</strong></p><p>这种方式是最常用，最复杂，也是最安全的，它适用于那些有后端的 Web 应用。授权码通过前端传送，令牌则是储存在后端，而且所有与资源服务器的通信都在后端完成。这样的前后端分离，可以避免令牌泄漏。</p><ul><li>注册客户应用：客户应用如果想要访问资源服务器需要有凭证，需要在授权服务器上注册客户应用。注册后会<strong>获取到一个ClientID和ClientSecrets</strong></li></ul><h4 id="第二种方式-隐藏式" tabindex="-1"><a class="header-anchor" href="#第二种方式-隐藏式" aria-hidden="true">#</a> 第二种方式：隐藏式</h4><p><strong>隐藏式（implicit），也叫简化模式，有些 Web 应用是纯前端应用，没有后端。这时就不能用上面的方式了，必须将令牌储存在前端。</strong></p><p>RFC 6749 规定了这种方式，允许直接向前端颁发令牌。这种方式没有授权码这个中间步骤，所以称为隐藏式。这种方式把令牌直接传给前端，是很不安全的。因此，只能用于一些安全要求不高的场景，并且令牌的有效期必须非常短，通常就是会话期间（session）有效，浏览器关掉，令牌就失效了。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://a.com/callback#token=ACCESS_TOKEN
将访问令牌包含在URL锚点中的好处：锚点在HTTP请求中不会发送到服务器，减少了泄漏令牌的风险。
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="第三种方式-密码式" tabindex="-1"><a class="header-anchor" href="#第三种方式-密码式" aria-hidden="true">#</a> 第三种方式：密码式</h4><p><strong>密码式（Resource Owner Password Credentials）：如果你高度信任某个应用，RFC 6749 也允许用户把用户名和密码，直接告诉该应用。该应用就使用你的密码，申请令牌。</strong></p><p>这种方式需要用户给出自己的用户名/密码，显然风险很大，因此只适用于其他授权方式都无法采用的情况，而且必须是用户高度信任的应用。</p><h4 id="第四种方式-凭证式" tabindex="-1"><a class="header-anchor" href="#第四种方式-凭证式" aria-hidden="true">#</a> 第四种方式：凭证式</h4><p><strong>凭证式（client credentials）：也叫客户端模式，适用于没有前端的命令行应用，即在命令行下请求令牌。</strong></p><p>这种方式给出的令牌，是针对第三方应用的，而不是针对用户的，即有可能多个用户共享同一个令牌。</p><h4 id="_10-1-5-授权类型的选择" tabindex="-1"><a class="header-anchor" href="#_10-1-5-授权类型的选择" aria-hidden="true">#</a> 10.1.5 授权类型的选择</h4><h3 id="_10-2-spring中的oauth2" tabindex="-1"><a class="header-anchor" href="#_10-2-spring中的oauth2" aria-hidden="true">#</a> 10.2 Spring中的OAuth2</h3><h4 id="_10-2-1-相关角色" tabindex="-1"><a class="header-anchor" href="#_10-2-1-相关角色" aria-hidden="true">#</a> 10.2.1 相关角色</h4><p>**回顾：**OAuth 2中的角色</p><ol><li>资源所有者（Resource Owner）</li><li>客户应用（Client）</li><li>资源服务器（Resource Server）</li><li>授权服务器（Authorization Server）</li></ol><h4 id="_10-2-2-spring中的实现" tabindex="-1"><a class="header-anchor" href="#_10-2-2-spring中的实现" aria-hidden="true">#</a> 10.2.2 Spring中的实现</h4><p><a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html" target="_blank" rel="noopener noreferrer">OAuth2 :: Spring Security<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>Spring Security</strong></p><ul><li>客户应用（OAuth2 Client）：OAuth2客户端功能中包含OAuth2 Login</li><li>资源服务器（OAuth2 Resource Server）</li></ul><p><strong>Spring</strong></p><ul><li>授权服务器（Spring Authorization Server）：它是在Spring Security之上的一个单独的项目。</li></ul><h4 id="_10-2-3-相关依赖" tabindex="-1"><a class="header-anchor" href="#_10-2-3-相关依赖" aria-hidden="true">#</a> 10.2.3 相关依赖</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 资源服务器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-resource-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 客户应用 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 授权服务器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-oauth2-authorization-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_10-2-4-授权登录的实现思路" tabindex="-1"><a class="header-anchor" href="#_10-2-4-授权登录的实现思路" aria-hidden="true">#</a> 10.2.4 授权登录的实现思路</h4><p>使用OAuth2 Login</p><h3 id="_10-3-giuhub-社交登录案例" tabindex="-1"><a class="header-anchor" href="#_10-3-giuhub-社交登录案例" aria-hidden="true">#</a> 10.3 GiuHub 社交登录案例</h3><h4 id="_10-3-1-创建应用" tabindex="-1"><a class="header-anchor" href="#_10-3-1-创建应用" aria-hidden="true">#</a> 10.3.1 创建应用</h4><p><strong>注册客户应用：</strong></p><p>登录GitHub，在开发者设置中找到OAuth Apps，创建一个application，为客户应用创建访问GitHub的凭据：</p><p>填写应用信息：<code>默认的重定向URI模板为{baseUrl}/login/oauth2/code/{registrationId}</code>。registrationId是ClientRegistration的唯一标识符。</p><p>获取应用程序id，生成应用程序密钥：</p><h4 id="_10-3-2-创建测试项目" tabindex="-1"><a class="header-anchor" href="#_10-3-2-创建测试项目" aria-hidden="true">#</a> 10.3.2 创建测试项目</h4><p>创建一个springboot项目oauth2-login-demo，创建时引入如下依赖</p><p>示例代码参考：<a href="https://github.com/spring-projects/spring-security-samples/tree/6.2.x/servlet/spring-boot/java/oauth2/login" target="_blank" rel="noopener noreferrer">spring-security-samples/servlet/spring-boot/java/oauth2/login at 6.2.x · spring-projects/spring-security-samples (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_10-3-3-配置-oauth-客户端属性" tabindex="-1"><a class="header-anchor" href="#_10-3-3-配置-oauth-客户端属性" aria-hidden="true">#</a> 10.3.3 配置 OAuth 客户端属性</h4><p>application.yml：</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">spring</span><span class="token punctuation">:</span>
<span class="token attr-name">  security</span><span class="token punctuation">:</span>
<span class="token attr-name">    oauth2</span><span class="token punctuation">:</span>
<span class="token attr-name">      client</span><span class="token punctuation">:</span>
<span class="token attr-name">        registration</span><span class="token punctuation">:</span>
<span class="token attr-name">          github</span><span class="token punctuation">:</span>
<span class="token attr-name">            client-id</span><span class="token punctuation">:</span> <span class="token attr-value">7807cc3bb1534abce9f2</span>
<span class="token attr-name">            client-secret</span><span class="token punctuation">:</span> <span class="token attr-value">008dc141879134433f4db7f62b693c4a5361771b</span>
<span class="token comment">#            redirectUri: http://localhost:8200/login/oauth2/code/github</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_10-3-4-创建controller" tabindex="-1"><a class="header-anchor" href="#_10-3-4-创建controller" aria-hidden="true">#</a> 10.3.4 创建Controller</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>oauthdemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span>
            <span class="token class-name">Model</span> model<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RegisteredOAuth2AuthorizedClient</span> <span class="token class-name">OAuth2AuthorizedClient</span> authorizedClient<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@AuthenticationPrincipal</span> <span class="token class-name">OAuth2User</span> oauth2User<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;userName&quot;</span><span class="token punctuation">,</span> oauth2User<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;clientName&quot;</span><span class="token punctuation">,</span> authorizedClient<span class="token punctuation">.</span><span class="token function">getClientRegistration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClientName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;userAttributes&quot;</span><span class="token punctuation">,</span> oauth2User<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_10-3-5-创建-html-页面" tabindex="-1"><a class="header-anchor" href="#_10-3-5-创建-html-页面" aria-hidden="true">#</a> 10.3.5 创建 html 页面</h4><p>resources/templates/index.html</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xhtml<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org/thymeleaf-extras-springsecurity5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Spring Security - OAuth 2.0 Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span> right</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logout<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isAuthenticated()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span>left</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>User: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span>none</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title=" ">&amp;nbsp;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span>right</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/logout}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Logout<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>OAuth 2.0 Login with Spring Security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    You are successfully logged in <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${userName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    via the OAuth 2.0 Client <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${clientName}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title=" ">&amp;nbsp;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>User Attributes:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userAttribute : ${userAttributes}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-weight</span><span class="token punctuation">:</span>bold</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${userAttribute.key}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${userAttribute.value}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="_10-3-6-启动应用程序" tabindex="-1"><a class="header-anchor" href="#_10-3-6-启动应用程序" aria-hidden="true">#</a> 10.3.6 启动应用程序</h4><ul><li>启动程序并访问localhost:8080。浏览器将被重定向到默认的自动生成的登录页面，该页面显示了一个用于GitHub登录的链接。</li><li>点击GitHub链接，浏览器将被重定向到GitHub进行身份验证。</li><li>使用GitHub账户凭据进行身份验证后，用户会看到授权页面，询问用户是否允许或拒绝客户应用访问GitHub上的用户数据。点击允许以授权OAuth客户端访问用户的基本个人资料信息。</li><li>此时，OAuth客户端访问GitHub的获取用户信息的接口获取基本个人资料信息，并建立一个已认证的会话。</li></ul><h3 id="_10-4-案例分析" tabindex="-1"><a class="header-anchor" href="#_10-4-案例分析" aria-hidden="true">#</a> 10.4 案例分析</h3><h4 id="_10-4-1-登录流程" tabindex="-1"><a class="header-anchor" href="#_10-4-1-登录流程" aria-hidden="true">#</a> 10.4.1 登录流程</h4><ol><li><strong>A 网站让用户跳转到 GitHub，并携带参数ClientID 以及 Redirection URI。</strong></li><li>GitHub 要求用户登录，然后询问用户&quot;A 网站要求获取用户信息的权限，你是否同意？&quot;</li><li>用户同意，GitHub 就会重定向回 A 网站，同时发回一个授权码。</li><li><strong>A 网站使用授权码，向 GitHub 请求令牌。</strong></li><li>GitHub 返回令牌.</li><li><strong>A 网站使用令牌，向 GitHub 请求用户数据。</strong></li><li>GitHub返回用户数据</li><li><strong>A 网站使用 GitHub用户数据登录</strong></li></ol><h4 id="_10-4-2-commonoauth2provider" tabindex="-1"><a class="header-anchor" href="#_10-4-2-commonoauth2provider" aria-hidden="true">#</a> 10.4.2 CommonOAuth2Provider</h4><p>CommonOAuth2Provider是一个预定义的通用OAuth2Provider，为一些知名资源服务API提供商（如Google、GitHub、Facebook）预定义了一组默认的属性。</p><p>例如，<strong>授权URI、令牌URI和用户信息URI</strong>通常不经常变化。因此，提供默认值以减少所需的配置。</p><p>因此，当我们配置GitHub客户端时，只需要提供client-id和client-secret属性。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>GITHUB <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">ClientRegistration<span class="token punctuation">.</span>Builder</span> <span class="token function">getBuilder</span><span class="token punctuation">(</span><span class="token class-name">String</span> registrationId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClientRegistration<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBuilder</span><span class="token punctuation">(</span>
        registrationId<span class="token punctuation">,</span> 
        <span class="token class-name">ClientAuthenticationMethod</span><span class="token punctuation">.</span>CLIENT_SECRET_BASIC<span class="token punctuation">,</span> 
        
        <span class="token comment">//授权回调地址(GitHub向客户应用发送回调请求，并携带授权码)   </span>
		<span class="token string">&quot;{baseUrl}/{action}/oauth2/code/{registrationId}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;read:user&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//授权页面</span>
        builder<span class="token punctuation">.</span><span class="token function">authorizationUri</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/login/oauth/authorize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//客户应用使用授权码，向 GitHub 请求令牌</span>
        builder<span class="token punctuation">.</span><span class="token function">tokenUri</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/login/oauth/access_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//客户应用使用令牌向GitHub请求用户数据</span>
        builder<span class="token punctuation">.</span><span class="token function">userInfoUri</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.github.com/user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//username属性显示GitHub中获取的哪个属性的信息</span>
        builder<span class="token punctuation">.</span><span class="token function">userNameAttributeName</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//登录页面超链接的文本</span>
        builder<span class="token punctuation">.</span><span class="token function">clientName</span><span class="token punctuation">(</span><span class="token string">&quot;GitHub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/chenyl8848/chenyl8848.github.io/edit/master/docs/rearend/spring/SpringSecurity+Oauth2.md" rel="noopener noreferrer" target="_blank" arialabel="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2024/11/21 14:14:10</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 1063415880@qq.com">chenyl8848</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/rearend/spring/Spring_Retry.html" class="nav-link prev" arialabel="Spring Retry 实现重试机制"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->Spring Retry 实现重试机制</div></a><!----></nav><div class="giscus-wrapper input-top" style="display:block;"><giscus-widget repo="chenyl8848/chenyl8848.github.io" repoId="R_kgDOHJ-qSQ" category="Announcements" categoryId="DIC_kwDOHJ-qSc4COg8Z" lang="zh-CN" theme="light" mapping="pathname" inputPosition="top" reactionsEnabled="1" emitMetadata="0"></giscus-widget></div><!----></main><!--]--><footer class="footer-wrapper"><div class="footer">没有最好，只有更好！</div><div class="copyright">Copyright © 2025 Java陈序员</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.06d697e7.js" defer></script>
  </body>
</html>
