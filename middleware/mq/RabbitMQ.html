<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://chenyl8848.github.io/middleware/mq/RabbitMQ.html"><meta property="og:site_name" content="Java陈序员"><meta property="og:title" content="RabbitMQ 万字入门教程"><meta property="og:type" content="article"><meta property="og:updated_time" content="2024-10-22T02:34:23.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="RabbitMQ"><meta property="article:published_time" content="2022-04-10T00:00:00.000Z"><meta property="article:modified_time" content="2024-10-22T02:34:23.000Z"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3316994_227lwxrw41z.css"><title>RabbitMQ 万字入门教程 | Java陈序员</title><meta name="description" content="Java陈序员的个人博客网站">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.7c8a6ce0.css">
    <link rel="modulepreload" href="/assets/app.06d697e7.js"><link rel="modulepreload" href="/assets/RabbitMQ.html.02a0d36c.js"><link rel="modulepreload" href="/assets/RabbitMQ.html.997196ca.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.webp" alt="Java陈序员"><!----><span class="site-name hide-in-pad">Java陈序员</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" arialabel="首页"><i class="icon iconfont icon-home"></i>首页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="后端"><span class="title"><i class="icon iconfont icon-rearend"></i>后端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/rearend/java/" class="nav-link" arialabel="Java"><i class="icon iconfont icon-java"></i>Java<!----></a></li><li class="dropdown-item"><a href="/rearend/spring/" class="nav-link" arialabel="Spring"><i class="icon iconfont icon-spring"></i>Spring<!----></a></li><li class="dropdown-item"><a href="/rearend/springBoot/" class="nav-link" arialabel="Spring Boot"><i class="icon iconfont icon-springboot"></i>Spring Boot<!----></a></li><li class="dropdown-item"><a href="/rearend/microServices/" class="nav-link" arialabel="微服务"><i class="icon iconfont icon-microServices"></i>微服务<!----></a></li><li class="dropdown-item"><a href="/rearend/dataStructure/" class="nav-link" arialabel="数据结构"><i class="icon iconfont icon-dataStructure"></i>数据结构<!----></a></li><li class="dropdown-item"><a href="/rearend/algorithm/" class="nav-link" arialabel="算法"><i class="icon iconfont icon-algorithm"></i>算法<!----></a></li><li class="dropdown-item"><a href="/rearend/designPattern/" class="nav-link" arialabel="设计模式"><i class="icon iconfont icon-designPattern"></i>设计模式<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="中间件"><span class="title"><i class="icon iconfont icon-middleware"></i>中间件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/middleware/database/" class="nav-link" arialabel="数据库"><i class="icon iconfont icon-database"></i>数据库<!----></a></li><li class="dropdown-item"><a href="/middleware/noSQL/" class="nav-link" arialabel="NoSQL"><i class="icon iconfont icon-noSQL"></i>NoSQL<!----></a></li><li class="dropdown-item"><a href="/middleware/mq/" class="nav-link active" arialabel="MQ"><i class="icon iconfont icon-MQ"></i>MQ<!----></a></li><li class="dropdown-item"><a href="/middleware/zookeeper/" class="nav-link" arialabel="ZooKeeper"><i class="icon iconfont icon-zookeeper"></i>ZooKeeper<!----></a></li><li class="dropdown-item"><a href="/middleware/elasticsearch/" class="nav-link" arialabel="ElasticSearch"><i class="icon iconfont icon-elasticsearch"></i>ElasticSearch<!----></a></li><li class="dropdown-item"><a href="/middleware/prometheus/" class="nav-link" arialabel="Prometheus"><i class="icon iconfont icon-prometheus"></i>Prometheus<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="服务器"><span class="title"><i class="icon iconfont icon-server"></i>服务器</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/server/linux/" class="nav-link" arialabel="Linux"><i class="icon iconfont icon-linux"></i>Linux<!----></a></li><li class="dropdown-item"><a href="/server/docker/" class="nav-link" arialabel="Docker"><i class="icon iconfont icon-docker"></i>Docker<!----></a></li><li class="dropdown-item"><a href="/server/kubernetes/" class="nav-link" arialabel="Kubernetes"><i class="icon iconfont icon-kubernetes"></i>Kubernetes<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="AI"><span class="title"><i class="icon iconfont icon-wuguan"></i>AI</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/ai/assistant/" class="nav-link" arialabel="AI 助手"><i class="icon iconfont icon-Cursor"></i>AI 助手<!----></a></li><li class="dropdown-item"><a href="/ai/framework/" class="nav-link" arialabel="AI 框架"><i class="icon iconfont icon-Aisucai"></i>AI 框架<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="前端"><span class="title"><i class="icon iconfont icon-wangye"></i>前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>框架</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/framework/js/" class="nav-link" arialabel="JavaScript"><i class="icon iconfont icon-java_script"></i>JavaScript<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/nodejs/" class="nav-link" arialabel="Node.js"><i class="icon iconfont icon-node-js"></i>Node.js<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/vue/" class="nav-link" arialabel="Vue.js"><i class="icon iconfont icon-vue"></i>Vue.js<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/react/" class="nav-link" arialabel="React"><i class="icon iconfont icon-react"></i>React<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/mp/" class="nav-link" arialabel="小程序"><i class="icon iconfont icon-xiaochengxu"></i>小程序<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/blog/" class="nav-link" arialabel="Blog"><i class="icon iconfont icon-folder-vuepress"></i>Blog<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="索引"><span class="title"><i class="icon iconfont icon-index"></i>索引</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article/" class="nav-link" arialabel="文章"><i class="icon iconfont icon-articles"></i>文章<!----></a></li><li class="dropdown-item"><a href="/category/java/" class="nav-link" arialabel="分类"><i class="icon iconfont icon-category"></i>分类<!----></a></li><li class="dropdown-item"><a href="/tag/" class="nav-link" arialabel="标签"><i class="icon iconfont icon-tag"></i>标签<!----></a></li><li class="dropdown-item"><a href="/timeline/" class="nav-link" arialabel="时间轴"><i class="icon iconfont icon-timeLine"></i>时间轴<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzkzOTM3NjAzOQ==&amp;action=getalbum&amp;album_id=2783119709868212224&amp;scene=126&amp;sessionid=-659761542&amp;uin=&amp;key=&amp;devicetype=Windows+11+x64&amp;version=6309092b&amp;lang=zh_CN&amp;ascene=0&amp;session_us=gh_b840974cfe99" rel="noopener noreferrer" target="_blank" arialabel="开源项目" class="nav-link"><i class="icon iconfont icon-note"></i>开源项目<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/chenyl8848/chenyl8848.github.io" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" arialabelledby="outlook"><title id="outlook" lang="en">outlook icon</title><g fill="currentColor"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></g></svg><div class="outlook-dropdown"><!----></div></button></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/middleware/mq/" class="nav-link sidebar-link sidebar-page" arialabel="MQ"><i class="icon iconfont icon-MQ"></i>MQ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">RabbitMQ</span><span class="arrow down"></span></button><!--[--><!--[--><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/middleware/mq/RabbitMQ.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" arialabel="RabbitMQ 万字入门教程"><!---->RabbitMQ 万字入门教程<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_1-mq-引言" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1. MQ 引言"><!---->1. MQ 引言<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_1-1-什么是-mq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.1 什么是 MQ"><!---->1.1 什么是 MQ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_1-2-mq-有哪些" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2 MQ 有哪些"><!---->1.2 MQ 有哪些<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_1-3-不同-mq-特点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3 不同 MQ 特点"><!---->1.3 不同 MQ 特点<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_2-rabbitmq-引言" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2. RabbitMQ 引言"><!---->2. RabbitMQ 引言<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_2-1-rabbitmq-介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.1 RabbitMQ 介绍"><!---->2.1 RabbitMQ 介绍<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_2-2-rabbitmq-安装" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2 RabbitMQ 安装"><!---->2.2 RabbitMQ 安装<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_3-rabiitmq-配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3. RabiitMQ 配置"><!---->3. RabiitMQ 配置<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_3-1-rabbitmq-管理命令行" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.1 RabbitMQ 管理命令行"><!---->3.1 RabbitMQ 管理命令行<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_3-2-web-管理界面介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3.2 Web 管理界面介绍"><!---->3.2 Web 管理界面介绍<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-rabbitmq-的第一个程序" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4. RabbitMQ 的第一个程序"><!---->4. RabbitMQ 的第一个程序<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-0-amqp-协议的回顾" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.0 AMQP 协议的回顾"><!---->4.0 AMQP 协议的回顾<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-1-rabbitmq-支持的消息模型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.1 RabbitMQ 支持的消息模型"><!---->4.1 RabbitMQ 支持的消息模型<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-2-引入依赖" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.2 引入依赖"><!---->4.2 引入依赖<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-3-第一种模型-直连" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.3 第一种模型（直连）"><!---->4.3 第一种模型（直连）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-4-第二种模型-work" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.4 第二种模型(Work)"><!---->4.4 第二种模型(Work)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-5-第三种模型-fanout" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.5 第三种模型(Fanout)"><!---->4.5 第三种模型(Fanout)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-6-第四种模型-routing" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.6 第四种模型(Routing)"><!---->4.6 第四种模型(Routing)<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-springboot-集成-rabbitmq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5. SpringBoot 集成 RabbitMQ"><!---->5. SpringBoot 集成 RabbitMQ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-0-环境搭建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.0 环境搭建"><!---->5.0 环境搭建<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-1-第一种-hello-world-模型使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.1 第一种 hello world 模型使用"><!---->5.1 第一种 hello world 模型使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-2-第二种-work-模型使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.2 第二种 Work 模型使用"><!---->5.2 第二种 Work 模型使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-3-fanout-广播模型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.3 Fanout 广播模型"><!---->5.3 Fanout 广播模型<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-4-route-路由模型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.4 Route 路由模型"><!---->5.4 Route 路由模型<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-5-topic-订阅模型-动态路由模型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.5 Topic 订阅模型（动态路由模型）"><!---->5.5 Topic 订阅模型（动态路由模型）<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_6-mq-的应用场景" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6. MQ 的应用场景"><!---->6. MQ 的应用场景<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_6-1-异步处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.1 异步处理"><!---->6.1 异步处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_6-2-应用解耦" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.2 应用解耦"><!---->6.2 应用解耦<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_6-3-流量削峰" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.3 流量削峰"><!---->6.3 流量削峰<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_7-rabbitmq-集群" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7. RabbitMQ 集群"><!---->7. RabbitMQ 集群<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_7-1-普通集群-副本集群" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1 普通集群（副本集群）"><!---->7.1 普通集群（副本集群）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_7-2-镜像集群" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2 镜像集群"><!---->7.2 镜像集群<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul><!--]--><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">RocketMQ</span><span class="arrow right"></span></button><!--[--><!--[--><!----><!--]--><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">kafka</span><span class="arrow right"></span></button><!--[--><!--[--><!----><!--]--><!----><!--]--></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->RabbitMQ 万字入门教程</h1><div class="article-info"><span class="author-info" arialabel="作者🖊" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://chenyl8848.github.io" target="_blank" rel="noopener noreferrer">Java陈序员</a></span><span property="author" content="Java陈序员"></span></span><!----><span class="date-info" arialabel="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2022年4月10日</span><meta property="datePublished" content="2022-04-10T00:00:00.000Z"></span><span class="category-info" arialabel="分类🌈" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category category5 clickable" role="navigation">中间件</li><li class="category category7 clickable" role="navigation">MQ</li><meta property="articleSection" content="中间件,MQ"></ul></span><span arialabel="标签🏷" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag tag0 clickable" role="navigation">RabbitMQ</li></ul><meta property="keywords" content="RabbitMQ"></span><span class="reading-time-info" arialabel="阅读时间⌛" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" arialabelledby="timer"><title id="timer" lang="en">timer icon</title><g fill="currentColor"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></g></svg><span>大约 23 分钟</span><meta property="timeRequired" content="PT23M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_1-mq-引言" class="router-link-active router-link-exact-active toc-link level2">1. MQ 引言</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_1-1-什么是-mq" class="router-link-active router-link-exact-active toc-link level3">1.1 什么是 MQ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_1-2-mq-有哪些" class="router-link-active router-link-exact-active toc-link level3">1.2 MQ 有哪些</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_1-3-不同-mq-特点" class="router-link-active router-link-exact-active toc-link level3">1.3 不同 MQ 特点</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_2-rabbitmq-引言" class="router-link-active router-link-exact-active toc-link level2">2. RabbitMQ 引言</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_2-1-rabbitmq-介绍" class="router-link-active router-link-exact-active toc-link level3">2.1 RabbitMQ 介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_2-2-rabbitmq-安装" class="router-link-active router-link-exact-active toc-link level3">2.2 RabbitMQ 安装</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_3-rabiitmq-配置" class="router-link-active router-link-exact-active toc-link level2">3. RabiitMQ 配置</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_3-1-rabbitmq-管理命令行" class="router-link-active router-link-exact-active toc-link level3">3.1 RabbitMQ 管理命令行</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_3-2-web-管理界面介绍" class="router-link-active router-link-exact-active toc-link level3">3.2 Web 管理界面介绍</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-rabbitmq-的第一个程序" class="router-link-active router-link-exact-active toc-link level2">4. RabbitMQ 的第一个程序</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-0-amqp-协议的回顾" class="router-link-active router-link-exact-active toc-link level3">4.0 AMQP 协议的回顾</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-1-rabbitmq-支持的消息模型" class="router-link-active router-link-exact-active toc-link level3">4.1 RabbitMQ 支持的消息模型</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-2-引入依赖" class="router-link-active router-link-exact-active toc-link level3">4.2 引入依赖</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-3-第一种模型-直连" class="router-link-active router-link-exact-active toc-link level3">4.3 第一种模型（直连）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-4-第二种模型-work" class="router-link-active router-link-exact-active toc-link level3">4.4 第二种模型(Work)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-5-第三种模型-fanout" class="router-link-active router-link-exact-active toc-link level3">4.5 第三种模型(Fanout)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_4-6-第四种模型-routing" class="router-link-active router-link-exact-active toc-link level3">4.6 第四种模型(Routing)</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-springboot-集成-rabbitmq" class="router-link-active router-link-exact-active toc-link level2">5. SpringBoot 集成 RabbitMQ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-0-环境搭建" class="router-link-active router-link-exact-active toc-link level3">5.0 环境搭建</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-1-第一种-hello-world-模型使用" class="router-link-active router-link-exact-active toc-link level3">5.1 第一种 hello world 模型使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-2-第二种-work-模型使用" class="router-link-active router-link-exact-active toc-link level3">5.2 第二种 Work 模型使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-3-fanout-广播模型" class="router-link-active router-link-exact-active toc-link level3">5.3 Fanout 广播模型</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-4-route-路由模型" class="router-link-active router-link-exact-active toc-link level3">5.4 Route 路由模型</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_5-5-topic-订阅模型-动态路由模型" class="router-link-active router-link-exact-active toc-link level3">5.5 Topic 订阅模型（动态路由模型）</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_6-mq-的应用场景" class="router-link-active router-link-exact-active toc-link level2">6. MQ 的应用场景</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_6-1-异步处理" class="router-link-active router-link-exact-active toc-link level3">6.1 异步处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_6-2-应用解耦" class="router-link-active router-link-exact-active toc-link level3">6.2 应用解耦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_6-3-流量削峰" class="router-link-active router-link-exact-active toc-link level3">6.3 流量削峰</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_7-rabbitmq-集群" class="router-link-active router-link-exact-active toc-link level2">7. RabbitMQ 集群</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_7-1-普通集群-副本集群" class="router-link-active router-link-exact-active toc-link level3">7.1 普通集群（副本集群）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/mq/RabbitMQ.html#_7-2-镜像集群" class="router-link-active router-link-exact-active toc-link level3">7.2 镜像集群</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h1 id="rabbitmq-万字入门教程" tabindex="-1"><a class="header-anchor" href="#rabbitmq-万字入门教程" aria-hidden="true">#</a> RabbitMQ 万字入门教程</h1><blockquote><p><a href="https://www.bilibili.com/video/BV1dE411K7MG?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">学习视频【编程不良人】<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.rabbitmq.com/" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.rabbitmq.com/#getstarted" target="_blank" rel="noopener noreferrer">官方教程<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/RabbitMQ_Mindmap.png" alt="" loading="lazy"></p><h2 id="_1-mq-引言" tabindex="-1"><a class="header-anchor" href="#_1-mq-引言" aria-hidden="true">#</a> 1. MQ 引言</h2><h3 id="_1-1-什么是-mq" tabindex="-1"><a class="header-anchor" href="#_1-1-什么是-mq" aria-hidden="true">#</a> 1.1 什么是 MQ</h3><p><code>MQ</code>(Message Quene) : 翻译为<strong>消息队列</strong>，别名为<strong>消息中间件</strong>，通过典型的<strong>生产者</strong>和<strong>消费者</strong>模型，生产者不断向消息队列中生产消息，消费者不断的从队列中获取消息。因为消息的生产和消费都是异步的，而且只关心消息的发送和接收，没有业务逻辑的侵入，轻松的实现系统间解耦。利用高效可靠的消息传递机制进行平台无关的数据交流，并基于数据通信来进行分布式系统的集成。</p><h3 id="_1-2-mq-有哪些" tabindex="-1"><a class="header-anchor" href="#_1-2-mq-有哪些" aria-hidden="true">#</a> 1.2 MQ 有哪些</h3><p>当今市面上有很多主流的消息中间件，如老牌的 <code>ActiveMQ</code>、<code>RabbitMQ</code>，炙手可热的 <code>Kafka</code>，阿里巴巴自主开发 <code>RocketMQ</code> 等。</p><h3 id="_1-3-不同-mq-特点" tabindex="-1"><a class="header-anchor" href="#_1-3-不同-mq-特点" aria-hidden="true">#</a> 1.3 不同 MQ 特点</h3><ul><li>ActiveMQ：Apache 出品，最流行的，能力强劲的开源消息总线。它是一个完全支持 JMS 规范的的消息中间件。丰富的API,多种集群架构模式让 ActiveMQ 在业界成为老牌的消息中间件，在中小型企业颇受欢迎。</li><li>Kafka：LinkedIn 开源的分布式发布-订阅消息系统，目前归属于 Apache 顶级项目。Kafka 主要特点是基于 Pull 的模式来处理消息消费，追求高吞吐量，一开始的目的就是用于日志收集和传输。0.8 版本开始支持复制，不支持事务，对消息的重复、丢失、错误没有严格要求，适合产生大量数据的互联网服务的数据收集业务。</li><li>RocketMQ：阿里开源的消息中间件，它是纯 <code>Java</code> 开发，具有高吞吐量、高可用性、适合大规模分布式系统应用的特点。RocketMQ 思路起源于 Kafka，但并不是 Kafka 的一个Copy，它对消息的可靠传输及事务性做了优化，目前在阿里集团被广泛应用于交易、充值、流计算、消息推送、日志流式处理、binglog 分发等场景。</li><li>RabbitMQ：使用 <code>Erlang</code> 语言开发的开源消息队列系统，基于 AMQP 协议来实现。AMQP 的主要特征是面向消息、队列、路由（包括点对点和发布/订阅）、可靠性、安全。 AMQP 协议更多用在企业系统内对数据一致性、稳定性和可靠性要求很高的场景，对性能和吞吐量的要求还在其次。</li></ul><blockquote><p>RabbitMQ 比 Kafka 可靠，Kafka 更适合 IO 高吞吐的处理，一般应用在大数据日志处理或对实时性（少量延迟），可靠性（少量丢数据）要求稍低的场景使用，比如 ELK 日志收集。</p></blockquote><hr><h2 id="_2-rabbitmq-引言" tabindex="-1"><a class="header-anchor" href="#_2-rabbitmq-引言" aria-hidden="true">#</a> 2. RabbitMQ 引言</h2><h3 id="_2-1-rabbitmq-介绍" tabindex="-1"><a class="header-anchor" href="#_2-1-rabbitmq-介绍" aria-hidden="true">#</a> 2.1 RabbitMQ 介绍</h3><p>基于 <code>AMQP</code> 协议，<code>Erlang</code> 语言开发，是部署最广泛、最受欢迎的<strong>开源消息中间件</strong>之一。</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20190925215603036-9419777.png" alt="" loading="lazy"></p><p><strong>AMQP 协议</strong></p><p>AMQP（advanced message queuing protocol）在 2003 年时被提出，最早用于解决金融领不同平台之间的消息传递交互问题。顾名思义，AMQP 是一种协议，更准确的说是一种binary wire-level protocol（链接协议）。这是其和 JMS 的本质差别，AMQP 不从 API 层进行限定，而是直接定义网络交换的数据格式。这使得实现了 AMQP 的 provider 天然性就是跨平台的。</p><p>以下是 AMQP 协议模型：</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200311182438041.png" alt="" loading="lazy"></p><h3 id="_2-2-rabbitmq-安装" tabindex="-1"><a class="header-anchor" href="#_2-2-rabbitmq-安装" aria-hidden="true">#</a> 2.2 RabbitMQ 安装</h3><h4 id="_2-2-1-下载" tabindex="-1"><a class="header-anchor" href="#_2-2-1-下载" aria-hidden="true">#</a> 2.2.1 下载</h4><p>官网下载地址：https://www.rabbitmq.com/download.html</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20190925220115235.png" alt="" loading="lazy"></p><h4 id="_2-2-2-下载安装包" tabindex="-1"><a class="header-anchor" href="#_2-2-2-下载安装包" aria-hidden="true">#</a> 2.2.2 下载安装包</h4><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20190925220343521.png" alt="" loading="lazy"></p><blockquote><p><strong>注意</strong>：这里的安装包是 CentOS7 安装的包。</p></blockquote><h4 id="_2-2-3-安装步骤" tabindex="-1"><a class="header-anchor" href="#_2-2-3-安装步骤" aria-hidden="true">#</a> 2.2.3 安装步骤</h4><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">1.</span> 将 RabbitMQ 安装包上传到 Linux 系统中
  erlang-22.0.7-1.el7.x86_64.rpm
	rabbitmq-server-3.7.18-1.el7.noarch.rpm

<span class="token list punctuation">2.</span> 安装 Erlang 依赖包
	rpm -ivh erlang-22.0.7-1.el7.x86_64.rpm

<span class="token list punctuation">3.</span> 安装 RabbitMQ 安装包（需要联网）
	yum install -y rabbitmq-server-3.7.18-1.el7.noarch.rpm
		
  注意：默认安装完成后配置文件模板在：/usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example 目录中，需要将配置文件复制到 /etc/rabbitmq/ 目录中，并修改名称为 rabbitmq.config

<span class="token list punctuation">4.</span> 复制配置文件
	cp /usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config

<span class="token list punctuation">5.</span> 查看配置文件位置
	ls /etc/rabbitmq/rabbitmq.config

<span class="token list punctuation">6.</span> 修改配置文件（参见下图）
	vim /etc/rabbitmq/rabbitmq.config 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20190925222230260-3836271.png" alt="" loading="lazy"></p><p>将上图中配置文件中红色部分去掉 <code>%%</code>,以及最后的 <code>,</code>,修改为下图：</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20190925222329200-3836312.png" alt="" loading="lazy"></p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">7.</span> 执行如下命令，启动 RabbitMQ 中的插件管理
	rabbitmq-plugins enable rabbitmq_management
	
<span class="token code keyword">	出现如下说明：
		Enabling plugins on node rabbit@localhost:
    rabbitmq_management
    The following plugins have been configured:
      rabbitmq_management
      rabbitmq_management_agent
      rabbitmq_web_dispatch
    Applying plugin configuration to rabbit@localhost...
    The following plugins have been enabled:
      rabbitmq_management
      rabbitmq_management_agent
      rabbitmq_web_dispatch</span>

<span class="token code keyword">    set 3 plugins.
    Offline change; changes will take effect at broker restart.</span>

<span class="token list punctuation">8.</span> 启动 RabbitMQ 的服务
	systemctl start rabbitmq-server
	systemctl restart rabbitmq-server
	systemctl stop rabbitmq-server
	

<span class="token list punctuation">9.</span> 查看服务状态（见下图）
	systemctl status rabbitmq-server
  ● rabbitmq-server.service - RabbitMQ broker
     Loaded: loaded (/usr/lib/systemd/system/rabbitmq-server.service; disabled; vendor preset: disabled)
     Active: active (running) since 三 2019-09-25 22:26:35 CST; 7s ago
   Main PID: 2904 (beam.smp)
     Status: &quot;Initialized&quot;
     CGroup: /system.slice/rabbitmq-server.service
             ├─2904 /usr/lib64/erlang/erts-10.4.4/bin/beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -
             MBlmbcs...
             ├─3220 erl_child_setup 32768
             ├─3243 inet_gethost 4
             └─3244 inet_gethost 4
      .........
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20190925222743776-3836511.png" alt="" loading="lazy"></p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">10.</span> 关闭防火墙服务
	systemctl disable firewalld
    Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.
    Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
	systemctl stop firewalld   

<span class="token list punctuation">11.</span> 访问 Web 管理界面
	http://10.15.0.8:15672/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20190926194738708-3836601.png" alt="" loading="lazy"></p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">12.</span> 登录管理界面
	username:  guest
	password:  guest
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20190926194954822-3836665.png" alt="" loading="lazy"></p><hr><h2 id="_3-rabiitmq-配置" tabindex="-1"><a class="header-anchor" href="#_3-rabiitmq-配置" aria-hidden="true">#</a> 3. RabiitMQ 配置</h2><h3 id="_3-1-rabbitmq-管理命令行" tabindex="-1"><a class="header-anchor" href="#_3-1-rabbitmq-管理命令行" aria-hidden="true">#</a> 3.1 RabbitMQ 管理命令行</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">1.</span> 服务启动相关
	systemctl start|restart|stop|status rabbitmq-server

<span class="token list punctuation">2.</span> 管理命令行 用来在不使用 Web 管理界面情况下命令操作 RabbitMQ
	rabbitmqctl  help  可以查看更多命令

<span class="token list punctuation">3.</span> 插件管理命令行
	rabbitmq-plugins enable|list|disable 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-2-web-管理界面介绍" tabindex="-1"><a class="header-anchor" href="#_3-2-web-管理界面介绍" aria-hidden="true">#</a> 3.2 Web 管理界面介绍</h3><h4 id="_3-2-1-overview-概览" tabindex="-1"><a class="header-anchor" href="#_3-2-1-overview-概览" aria-hidden="true">#</a> 3.2.1 Overview 概览</h4><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126162026720.png" alt="" loading="lazy"></p><ul><li><code>connections</code>：无论生产者还是消费者，都需要与 RabbitMQ 建立连接后才可以完成消息的生产和消费，在这里可以查看连接情况</li><li><code>channels</code>：通道，建立连接后，会形成通道，消息的投递获取依赖通道。</li><li><code>Exchanges</code>：交换机，用来实现消息的路由</li><li><code>Queues</code>：队列，即消息队列，消息存放在队列中，等待消费，消费后被移除队列。</li></ul><h4 id="_3-2-2-admin-用户和虚拟主机管理" tabindex="-1"><a class="header-anchor" href="#_3-2-2-admin-用户和虚拟主机管理" aria-hidden="true">#</a> 3.2.2 Admin 用户和虚拟主机管理</h4><ol><li>添加用户</li></ol><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126162617280.png" alt="" loading="lazy"></p><p>上面的 Tags 选项，其实是指定用户的角色，可选的有以下几个：</p><ul><li><code>超级管理员(administrator)</code>：可登陆管理控制台，可查看所有的信息，并且可以对用户，策略(policy)进行操作。</li><li><code>监控者(monitoring)</code>：可登陆管理控制台，同时可以查看 RabbitMQ 节点的相关信息(进程数，内存使用情况，磁盘使用情况等)</li><li><code>策略制定者(policymaker)</code>：可登陆管理控制台, 同时可以对 policy 进行管理，但无法查看节点的相关信息(上图红框标识的部分)。</li><li><code>普通管理者(management)</code>：仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。</li><li><code>其他</code>：无法登陆管理控制台，通常就是普通的生产者和消费者。</li></ul><ol start="2"><li>创建虚拟主机</li></ol><p>为了让各个用户可以互不干扰的工作，RabbitMQ 添加了虚拟主机（Virtual Hosts）的概念。其实就是一个独立的访问路径，不同用户使用不同路径，各自有自己的队列、交换机，互相不会影响。</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126163023153.png" alt="" loading="lazy"></p><ol start="3"><li>绑定虚拟主机和用户</li></ol><p>创建好虚拟主机，还要给用户添加访问权限。</p><p>点击添加好的虚拟主机：</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126163506795.png" alt="" loading="lazy"></p><p>进入虚拟机设置界面：</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126163631889.png" alt="" loading="lazy"></p><hr><h2 id="_4-rabbitmq-的第一个程序" tabindex="-1"><a class="header-anchor" href="#_4-rabbitmq-的第一个程序" aria-hidden="true">#</a> 4. RabbitMQ 的第一个程序</h2><h3 id="_4-0-amqp-协议的回顾" tabindex="-1"><a class="header-anchor" href="#_4-0-amqp-协议的回顾" aria-hidden="true">#</a> 4.0 AMQP 协议的回顾</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200312140114784.png" alt="" loading="lazy"></p><h3 id="_4-1-rabbitmq-支持的消息模型" tabindex="-1"><a class="header-anchor" href="#_4-1-rabbitmq-支持的消息模型" aria-hidden="true">#</a> 4.1 RabbitMQ 支持的消息模型</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126165434784.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126165459282.png" alt="" loading="lazy"></p><h3 id="_4-2-引入依赖" tabindex="-1"><a class="header-anchor" href="#_4-2-引入依赖" aria-hidden="true">#</a> 4.2 引入依赖</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.rabbitmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>amqp-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-3-第一种模型-直连" tabindex="-1"><a class="header-anchor" href="#_4-3-第一种模型-直连" aria-hidden="true">#</a> 4.3 第一种模型（直连）</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126165840602.png" alt="" loading="lazy"></p><p>在上图的模型中，有以下概念：</p><ul><li>P：生产者，也就是要发送消息的程序</li><li>C：消费者：消息的接受者，会一直等待消息到来。</li><li>queue：消息队列，图中红色部分。类似一个邮箱，可以缓存消息；生产者向其中投递消息，消费者从其中取出消息。</li></ul><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//创建连接工厂</span>
<span class="token class-name">ConnectionFactory</span> connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;10.15.0.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;ems&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/ems&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Connection</span> connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建通道</span>
<span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//参数1: 是否持久化  参数2:是否独占队列 参数3:是否自动删除  参数4:其他属性</span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;hello rabbitmq&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="2"><li>开发消费者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//创建连接工厂</span>
<span class="token class-name">ConnectionFactory</span> connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;10.15.0.9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;ems&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connectionFactory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">&quot;/ems&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Connection</span> connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="3"><li>参数说明</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 参数1：用来声明通道对应的队列</span>
<span class="token comment">// 参数2：用来指定是否持久化队列</span>
<span class="token comment">// 参数3：用来指定是否独占队列</span>
<span class="token comment">// 参数4：用来指定是否自动删除队列</span>
<span class="token comment">// 参数5：对队列的额外配置</span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-4-第二种模型-work" tabindex="-1"><a class="header-anchor" href="#_4-4-第二种模型-work" aria-hidden="true">#</a> 4.4 第二种模型(Work)</h3><p><code>Work queues</code>，也被称为任务模型（<code>Task queues</code>）。当消息处理比较耗时的时候，可能生产消息的速度会远远大于消息的消费速度。长此以往，消息就会堆积越来越多，无法及时处理。此时就可以使用 Work 模型：<strong>让多个消费者绑定到一个队列，共同消费队列中的消息</strong>。队列中的消息一旦消费，就会消失，因此任务是不会被重复执行的。</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200314221002008.png" alt="" loading="lazy"></p><p>角色：</p><ul><li>P：生产者：任务的发布者</li><li>C1：消费者-1，领取任务并且完成任务，假设完成速度较慢</li><li>C2：消费者-2：领取任务并完成任务，假设完成速度快</li></ul><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;====&gt;:我是消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>开发消费者-1</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者1: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>开发消费者-2</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//处理消息比较慢 一秒处理一个消息</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者2: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="4"><li>测试结果</li></ol><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200314223242058.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200314223302207.png" alt="" loading="lazy"></p><blockquote><p><strong>总结</strong>：默认情况下，RabbitMQ 将按顺序将每个消息发送给下一个使用者。平均而言，<strong>每个消费者都会收到相同数量的消息，这种分发消息的方式称为循环</strong>。</p></blockquote><ol start="5"><li>消息自动确认机制</li></ol><blockquote><p>Doing a task can take a few seconds. You may wonder what happens if one of the consumers starts a long task and dies with it only partly done. With our current code, once RabbitMQ delivers a message to the consumer it immediately marks it for deletion. In this case, if you kill a worker we will lose the message it was just processing. We&#39;ll also lose all the messages that were dispatched to this particular worker but were not yet handled.</p><p>But we don&#39;t want to lose any tasks. If a worker dies, we&#39;d like the task to be delivered to another worker.</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">basicQos</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//一次只接受一条未确认的消息</span>
<span class="token comment">//参数2:关闭自动确认消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者1: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>envelope<span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//手动确认消息</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>设置通道一次只能消费一个消息</li><li>关闭消息的自动确认，开启手动确认消息</li></ul><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200314230412178.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200314230423280.png" alt="" loading="lazy"></p><h3 id="_4-5-第三种模型-fanout" tabindex="-1"><a class="header-anchor" href="#_4-5-第三种模型-fanout" aria-hidden="true">#</a> 4.5 第三种模型(Fanout)</h3><p>Fanout 扇出也称为广播。</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126213115873.png" alt="" loading="lazy"></p><p>在广播模式下，消息发送流程是这样的：</p><ul><li>可以有多个消费者</li><li>每个<strong>消费者有自己的 queue</strong>（队列）</li><li>每个<strong>队列都要绑定到 Exchange</strong>（交换机）</li><li><strong>生产者发送的消息，只能发送到交换机</strong>，交换机来决定要发给哪个队列，生产者无法决定</li><li>交换机把消息发送给绑定过的所有队列</li><li>队列的消费者都能拿到消息，实现一条消息被多个消费者消费</li></ul><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//声明交换机</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//广播 一条消息多个消费者同时消费</span>
<span class="token comment">//发布消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>开发消费者-1</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//绑定交换机</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建临时队列</span>
<span class="token class-name">String</span> queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//将临时队列绑定exchange</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//处理消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者1: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="3"><li>开发消费者-2</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//绑定交换机</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建临时队列</span>
<span class="token class-name">String</span> queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//将临时队列绑定exchange</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//处理消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者2: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="4"><li>开发消费者-3</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//绑定交换机</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建临时队列</span>
<span class="token class-name">String</span> queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//将临时队列绑定exchange</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//处理消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者3: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="5"><li>测试结果</li></ol><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200315180653207.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200315180708489.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200315180728035.png" alt="" loading="lazy"></p><h3 id="_4-6-第四种模型-routing" tabindex="-1"><a class="header-anchor" href="#_4-6-第四种模型-routing" aria-hidden="true">#</a> 4.6 第四种模型(Routing)</h3><h4 id="_4-6-1-routing-之订阅模型-direct-直连" tabindex="-1"><a class="header-anchor" href="#_4-6-1-routing-之订阅模型-direct-直连" aria-hidden="true">#</a> 4.6.1 Routing 之订阅模型-Direct(直连)</h4><p>在 Fanout 模式中，一条消息，会被所有订阅的队列都消费。但是，在某些场景下，我们希望不同的消息被不同的队列消费，这时就要用到 Direct 类型的 Exchange.</p><p>在 Direct 模型下：</p><ul><li>队列与交换机的绑定，不能是任意绑定了，而是要指定一个 <code>RoutingKey</code> （路由 key）</li><li>消息的发送方在 向 Exchange发送消息时，也必须指定消息的 <code>RoutingKey</code>.</li><li>Exchange不再把消息交给每一个绑定的队列，而是根据消息的 <code>RoutingKey</code> 进行判断，只有队列的 <code>RoutingKey</code> 与消息的 <code>RoutingKey</code> 完全一致，才会接收到消息</li></ul><p>流程:</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191126220145375.png" alt="" loading="lazy"></p><p>图解：</p><ul><li>P：生产者，向 Exchange 发送消息，发送消息时，会指定一个 RoutingKey.</li><li>X：Exchange（交换机），接收生产者的消息，然后把消息递交给 与 RoutingKey 完全匹配的队列</li><li>C1：消费者，其所在队列指定了需要 RoutingKey 为 error 的消息</li><li>C2：消费者，其所在队列指定了需要 RoutingKey 为 info、error、warn 的消息</li></ul><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//声明交换机  参数1:交换机名称 参数2:交换机类型 基于指令的Routing key转发</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;logs_direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//发布消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;logs_direct&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;指定的route key&quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;的消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>开发消费者-1</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">//声明交换机</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;logs_direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建临时队列</span>
<span class="token class-name">String</span> queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//绑定队列和交换机</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token string">&quot;logs_direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token string">&quot;logs_direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token string">&quot;logs_direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;warn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//消费消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者1: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="3"><li>开发消费者-2</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//声明交换机</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;logs_direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建临时队列</span>
<span class="token class-name">String</span> queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//绑定队列和交换机</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token string">&quot;logs_direct&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//消费消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者2: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="4"><li>测试生产者发送 RoutingKey 为 error 的消息时</li></ol><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200316102613933.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200316102627912.png" alt="" loading="lazy"></p><ol start="5"><li>测试生产者发送 RoutingKey 为 info 的消息时</li></ol><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200316102925740.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200316102947326.png" alt="" loading="lazy"></p><h4 id="_4-6-2-routing-之订阅模型-topic" tabindex="-1"><a class="header-anchor" href="#_4-6-2-routing-之订阅模型-topic" aria-hidden="true">#</a> 4.6.2 Routing 之订阅模型-Topic</h4><p><code>Topic</code> 类型的 <code>Exchange</code> 与 <code>Direct</code> 相比，都是可以根据 <code>RoutingKey</code> 把消息路由到不同的队列。只不过 <code>Topic</code> 类型 <code>Exchange</code> 可以让队列在绑定 <code>RoutingKey</code> 的时候使用通配符！这种模型<code>RoutingKey</code> 一般都是由一个或多个单词组成，多个单词之间以”.”分割，例如： <code>item.insert</code></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20191127121900255.png" alt="" loading="lazy"></p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>通配符：
  <span class="token list punctuation">*</span> (star) can substitute for exactly one word.    匹配不多不少恰好1个词
  <span class="token title important"><span class="token punctuation">#</span> (hash) can substitute for zero or more words.  匹配一个或多个词</span>
如：
  audit.#    匹配audit.irs.corporate或者 audit.irs 等
  audit.*   只能匹配 audit.irs
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//生命交换机和交换机类型 topic 使用动态路由(通配符方式)</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;topics&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> routekey <span class="token operator">=</span> <span class="token string">&quot;user.save&quot;</span><span class="token punctuation">;</span><span class="token comment">//动态路由key</span>
<span class="token comment">//发布消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;topics&quot;</span><span class="token punctuation">,</span> routekey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;这是路由中的动态订阅模型,route key: [&quot;</span> <span class="token operator">+</span> routekey <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>开发消费者-1</li></ol><p>RoutingKey 中使用 * 通配符方式。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">//声明交换机</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;topics&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建临时队列</span>
<span class="token class-name">String</span> queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//绑定队列与交换机并设置获取交换机中动态路由</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token string">&quot;topics&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//消费消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者1: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li>开发消费者-2</li></ol><p>RoutingKey 中使用 # 通配符方式。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//声明交换机</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;topics&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建临时队列</span>
<span class="token class-name">String</span> queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//绑定队列与交换机并设置获取交换机中动态路由</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token string">&quot;topics&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//消费消息</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;消费者2: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="4"><li>测试结果</li></ol><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200316113935785.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200316114000459.png" alt="" loading="lazy"></p><h2 id="_5-springboot-集成-rabbitmq" tabindex="-1"><a class="header-anchor" href="#_5-springboot-集成-rabbitmq" aria-hidden="true">#</a> 5. SpringBoot 集成 RabbitMQ</h2><h3 id="_5-0-环境搭建" tabindex="-1"><a class="header-anchor" href="#_5-0-环境搭建" aria-hidden="true">#</a> 5.0 环境搭建</h3><ol><li>引入依赖</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>配置配置文件</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> springboot_rabbitmq
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 10.15.0.9
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> ems
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /ems
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>RabbitTemplate</code> 用来简化操作，使用时候直接在项目中注入即可使用。</p><h3 id="_5-1-第一种-hello-world-模型使用" tabindex="-1"><a class="header-anchor" href="#_5-1-第一种-hello-world-模型使用" aria-hidden="true">#</a> 5.1 第一种 hello world 模型使用</h3><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>开发消费者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloCustomer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;message = &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_5-2-第二种-work-模型使用" tabindex="-1"><a class="header-anchor" href="#_5-2-第二种-work-模型使用" aria-hidden="true">#</a> 5.2 第二种 Work 模型使用</h3><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;work&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello work!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>开发消费者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WorkCustomer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token string">&quot;work&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;work message1 = &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token string">&quot;work&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;work message2 = &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p><strong>说明</strong>：默认在 Spring AMQP 实现中 Work 这种方式就是<strong>公平调度</strong>，如果需要实现能者多劳需要额外配置。</p></blockquote><h3 id="_5-3-fanout-广播模型" tabindex="-1"><a class="header-anchor" href="#_5-3-fanout-广播模型" aria-hidden="true">#</a> 5.3 Fanout 广播模型</h3><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFanout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
  rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;这是日志广播&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>开发消费者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FanoutCustomer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
            value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span>
            exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;message1 = &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
            value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span> <span class="token comment">//创建临时队列</span>
            exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span>  <span class="token comment">//绑定交换机类型</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;message2 = &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_5-4-route-路由模型" tabindex="-1"><a class="header-anchor" href="#_5-4-route-路由模型" aria-hidden="true">#</a> 5.4 Route 路由模型</h3><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;directs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error 的日志信息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>开发消费者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DirectCustomer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
                    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;directs&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;message1 = &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
                    value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;directs&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;message2 = &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_5-5-topic-订阅模型-动态路由模型" tabindex="-1"><a class="header-anchor" href="#_5-5-topic-订阅模型-动态路由模型" aria-hidden="true">#</a> 5.5 Topic 订阅模型（动态路由模型）</h3><ol><li>开发生产者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token comment">//topic</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;topics&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.save.findAll&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.save.findAll 的消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>开发消费者</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TopCustomer</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
                  value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span>
                  key <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;user.*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;topics&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;message1 = &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
                  value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span>
                  key <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;user.#&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;topics&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;message2 = &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><hr><h2 id="_6-mq-的应用场景" tabindex="-1"><a class="header-anchor" href="#_6-mq-的应用场景" aria-hidden="true">#</a> 6. MQ 的应用场景</h2><h3 id="_6-1-异步处理" tabindex="-1"><a class="header-anchor" href="#_6-1-异步处理" aria-hidden="true">#</a> 6.1 异步处理</h3><p>场景说明：用户注册后，需要发注册邮件和注册短信，传统的做法有两种：串行的方式、并行的方式。</p><ul><li><strong>串行方式</strong>：将注册信息写入数据库后，发送注册邮件，再发送注册短信，以上三个任务全部完成后才返回给客户端。这有一个问题是邮件、短信并不是必须的，它只是一个通知，而这种做法让客户端等待没有必要等待的东西。</li></ul><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/SouthEast-4860248.png" alt="" loading="lazy"></p><ul><li><strong>并行方式</strong>：将注册信息写入数据库后，发送邮件的同时，发送短信，以上三个任务完成后，返回给客户端，并行的方式能提高处理的时间。</li></ul><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/SouthEast-20191127211112660.png" alt="" loading="lazy"></p><ul><li><strong>消息队列</strong>：假设三个业务节点分别使用 50ms，那么串行方式使用时间 150ms，并行使用时间 100ms。虽然并行已经提高的处理时间，但是，前面说过，邮件和短信对正常的使用网站没有任何影响，客户端没有必要等着其发送完成才显示注册成功，应该是写入数据库后就返回。引入消息队列后，把发送邮件，短信不是必须的业务逻辑异步处理。</li></ul><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/592892-20190520220249900-1679743651.jpg" alt="" loading="lazy"></p><p>由此可以看出，引入消息队列后，用户的响应时间就等于写入数据库的时间 + 写入消息队列的时间(可以忽略不计)，引入消息队列后处理后，响应时间是串行的 3 倍，是并行的 2 倍。</p><h3 id="_6-2-应用解耦" tabindex="-1"><a class="header-anchor" href="#_6-2-应用解耦" aria-hidden="true">#</a> 6.2 应用解耦</h3><p>场景：双11是购物狂节，用户下单后，订单系统需要通知库存系统，传统的做法就是订单系统调用库存系统的接口。</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/SouthEast-20191127211247287.png" alt="" loading="lazy"></p><p>这种做法有一个缺点：</p><p>当库存系统出现故障时，订单就会失败，订单系统和库存系统高耦合。</p><p>引入消息队列：</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/SouthEast-20191127211304085.png" alt="" loading="lazy"></p><ul><li><strong>订单系统</strong>：用户下单后，订单系统完成持久化处理，将消息写入消息队列，返回用户订单下单成功。</li><li><strong>库存系统</strong>：订阅下单的消息，获取下单消息，进行扣减库存操作。就算库存系统出现故障，消息队列也能保证消息的可靠投递，不会导致消息丢失。</li></ul><h3 id="_6-3-流量削峰" tabindex="-1"><a class="header-anchor" href="#_6-3-流量削峰" aria-hidden="true">#</a> 6.3 流量削峰</h3><p>场景：秒杀活动，一般会因为流量过大，导致应用挂掉，为了解决这个问题，一般在应用前端加入消息队列。</p><p>作用：</p><ol><li>可以控制活动人数，超过此一定阀值的订单直接丢弃（我为什么秒杀一次都没有成功过呢^^）</li></ol><p>​2. 可以缓解短时间的高流量压垮应用(应用程序按自己的最大处理能力获取订单)</p><p>流程：</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/SouthEast-20191127211341601.png" alt="" loading="lazy"></p><ol><li><p>用户的请求，服务器收到之后，首先写入消息队列，加入消息队列长度超过最大值，则直接抛弃用户请求或跳转到错误页面。</p></li><li><p>秒杀业务根据消息队列中的请求信息，再做后续处理。</p></li></ol><hr><h2 id="_7-rabbitmq-集群" tabindex="-1"><a class="header-anchor" href="#_7-rabbitmq-集群" aria-hidden="true">#</a> 7. RabbitMQ 集群</h2><h3 id="_7-1-普通集群-副本集群" tabindex="-1"><a class="header-anchor" href="#_7-1-普通集群-副本集群" aria-hidden="true">#</a> 7.1 普通集群（副本集群）</h3><blockquote><p>All data/state required for the operation of a RabbitMQ broker is replicated across all nodes. An exception to this are message queues, which by default reside on one node, though they are visible and reachable from all nodes. To replicate queues across nodes in a cluster --摘自官网</p></blockquote><p>默认情况下：RabbitMQ 代理操作所需的所有数据/状态都将跨所有节点复制。这方面的一个例外是消息队列，默认情况下，消息队列位于一个节点上，尽管它们可以从所有节点看到和访问。</p><ol><li>架构图</li></ol><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200320094147471.png" alt="" loading="lazy"></p><p>​核心解决问题：<strong>当集群中某一时刻 Master 节点宕机，可以对 Quene 中信息，进行备份</strong>。</p><ol start="2"><li>集群搭建</li></ol><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">0.</span> 集群规划
  node1: 10.15.0.3  mq1  master 主节点
  node2: 10.15.0.4  mq2  repl1  副本节点
  node3: 10.15.0.5  mq3  repl2  副本节点

<span class="token list punctuation">1.</span> 克隆三台机器主机名和 IP 映射
  vim /etc/hosts加入：
    10.15.0.3 mq1
    10.15.0.4 mq2
    10.15.0.5 mq3

<span class="token code keyword">    node1: vim /etc/hostname 加入：mq1
    node2: vim /etc/hostname 加入：mq2
    node3: vim /etc/hostname 加入：mq3</span>

<span class="token list punctuation">2.</span> 三个机器安装 RabbitMQ,并同步 cookie 文件，在 node1 上执行：
  scp /var/lib/rabbitmq/.erlang.cookie root@mq2:/var/lib/rabbitmq/
  scp /var/lib/rabbitmq/.erlang.cookie root@mq3:/var/lib/rabbitmq/

<span class="token list punctuation">3.</span> 查看 cookie 是否一致：
  node1: cat /var/lib/rabbitmq/.erlang.cookie 
  node2: cat /var/lib/rabbitmq/.erlang.cookie 
  node3: cat /var/lib/rabbitmq/.erlang.cookie 

<span class="token list punctuation">4.</span> 后台启动 RabbitMQ 所有节点执行如下命令，启动成功访问管理界面：
  rabbitmq-server -detached 

<span class="token list punctuation">5.</span> 在 node2 和 node3 执行加入集群命令：
  <span class="token list punctuation">1.</span> 关闭       rabbitmqctl stop_app
  <span class="token list punctuation">2.</span> 加入集群    rabbitmqctl join_cluster rabbit@mq1
  <span class="token list punctuation">3.</span> 启动服务    rabbitmqctl start_app

<span class="token list punctuation">6.</span> 查看集群状态，任意节点执行：
  rabbitmqctl cluster_status

<span class="token list punctuation">7.</span> 如果出现如下显示，集群搭建成功：
  Cluster status of node rabbit@mq3 ...
  [{nodes,[{disc,[rabbit@mq1,rabbit@mq2,rabbit@mq3]}]},
  {running_nodes,[rabbit@mq1,rabbit@mq2,rabbit@mq3]},
  {cluster_name,&lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>&quot;rabbit@mq1&quot;</span><span class="token punctuation">&gt;</span></span>&gt;},
  {partitions,[]},
  {alarms,[{rabbit@mq1,[]},{rabbit@mq2,[]},{rabbit@mq3,[]}]}]

<span class="token list punctuation">8.</span> 登录管理界面，展示如下状态：
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200320095613586.png" alt="" loading="lazy"></p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">9.</span> 测试集群在 node1 上，创建队列
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200320095743935.png" alt="" loading="lazy"></p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">10.</span> 查看 node2 和 node3 节点：
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200320095827688.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200320095843370.png" alt="" loading="lazy"></p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">11.</span> 关闭 node1 节点，执行如下命令，查看 node2 和 node3:
rabbitmqctl stop_app
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200320100000347.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200320100010968.png" alt="" loading="lazy"></p><hr><h3 id="_7-2-镜像集群" tabindex="-1"><a class="header-anchor" href="#_7-2-镜像集群" aria-hidden="true">#</a> 7.2 镜像集群</h3><blockquote><p>This guide covers mirroring (queue contents replication) of classic queues --摘自官网</p><p>By default, contents of a queue within a RabbitMQ cluster are located on a single node (the node on which the queue was declared). This is in contrast to exchanges and bindings, which can always be considered to be on all nodes. Queues can optionally be made <em>mirrored</em> across multiple nodes. --摘自官网</p></blockquote><p>镜像队列机制就是将队列在三个节点之间设置主从关系，消息会在三个节点之间进行自动同步，且如果其中一个节点不可用，并不会导致消息丢失或服务不可用的情况，提升 MQ 集群的整体高可用性。</p><ol><li>集群架构图</li></ol><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/middleware/MQ/01/image-20200320113423235.png" alt="" loading="lazy"></p><ol start="2"><li>配置集群架构</li></ol><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">0.</span> 策略说明
  rabbitmqctl set_policy <span class="token url">[<span class="token content">-p &lt;vhost&gt;</span>] [<span class="token variable">--priority &lt;priority&gt;</span>]</span> [--apply-to <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>apply-to</span><span class="token punctuation">&gt;</span></span>] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>definition</span><span class="token punctuation">&gt;</span></span>
  -p Vhost：  可选参数，针对指定 vhost 下的 queue 进行设置
  priority：可选参数，policy 的优先级
  name:       policy 的名称
  pattern:    queue 的匹配模式（正则表达式）
  definition: ha-mode、ha-params、ha-sync-mode
    ha-mode: 指明镜像队列的模式，有效值为 all/exactly/nodes
      all：表示在集群中所有的节点上进行镜像
      exactly：表示在指定个数的节点上进行镜像，节点的个数由 ha-params 指定
      nodes：表示在指定的节点上进行镜像，节点名称通过 ha-params 指定
    ha-params: ha-mode 模式需要用到的参数
    ha-sync-mode: 进行队列中消息的同步方式，有效值为 automatic 和 manual
                
<span class="token code keyword">                </span>
<span class="token list punctuation">1.</span> 查看当前策略
rabbitmqctl list_policies

<span class="token list punctuation">1.</span> 添加策略
rabbitmqctl set_policy ha-all &#39;^hello&#39; &#39;{&quot;ha-mode&quot;:&quot;all&quot;,&quot;ha-sync-mode&quot;:&quot;automatic&quot;}&#39; 

说明：策略正则表达式为 “^” 表示所有匹配所有队列名称  ^hello: 匹配 hello 开头队列

<span class="token list punctuation">3.</span> 删除策略
rabbitmqctl clear_policy ha-all

<span class="token list punctuation">4.</span> 测试集群
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><hr><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/chenyl8848/chenyl8848.github.io/edit/master/docs/middleware/mq/RabbitMQ.md" rel="noopener noreferrer" target="_blank" arialabel="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2024/10/22 02:34:23</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 1063415880@qq.com">chenyl8848</span>,<!--]--><!--[--><span class="contributor" title="email: 1063415880@qq.com">cyl</span><!--]--><!--]--></div></footer><!----><div class="giscus-wrapper input-top" style="display:block;"><giscus-widget repo="chenyl8848/chenyl8848.github.io" repoId="R_kgDOHJ-qSQ" category="Announcements" categoryId="DIC_kwDOHJ-qSc4COg8Z" lang="zh-CN" theme="light" mapping="pathname" inputPosition="top" reactionsEnabled="1" emitMetadata="0"></giscus-widget></div><!----></main><!--]--><footer class="footer-wrapper"><div class="footer">没有最好，只有更好！</div><div class="copyright">Copyright © 2025 Java陈序员</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.06d697e7.js" defer></script>
  </body>
</html>
