import{_ as e,r as c,c as o,a as n,b as p,F as l,d as s,f as t,o as u}from"./app.06d697e7.js";const i={},r=n("h1",{id:"\u7B2C1\u7AE0-netty\u4ECB\u7ECD\u548C\u5E94\u7528\u573A\u666F",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u7B2C1\u7AE0-netty\u4ECB\u7ECD\u548C\u5E94\u7528\u573A\u666F","aria-hidden":"true"},"#"),s(" \u7B2C1\u7AE0 Netty\u4ECB\u7ECD\u548C\u5E94\u7528\u573A\u666F")],-1),k=n("h2",{id:"_1-1-netty\u4ECB\u7ECD",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-1-netty\u4ECB\u7ECD","aria-hidden":"true"},"#"),s(" 1.1 Netty\u4ECB\u7ECD")],-1),b={href:"https://www.bilibili.com/video/BV1jD4y1Q7tU?spm_id_from=333.999.0.0",target:"_blank",rel:"noopener noreferrer"},m=s("\u5B66\u4E60\u89C6\u9891\u3010\u5C1A\u7845\u8C37\u3011"),d=t(`<ol><li>Netty \u662F\u7531JBOSS\u63D0\u4F9B\u7684\u4E00\u4E2A Java \u5F00\u6E90\u6846\u67B6\uFF0C\u73B0\u4E3A Github\u4E0A\u7684\u72EC\u7ACB\u9879\u76EE\uFF1B</li><li>Netty \u662F\u4E00\u4E2A\u5F02\u6B65\u7684\u3001\u57FA\u4E8E\u4E8B\u4EF6\u9A71\u52A8\u7684\u7F51\u7EDC\u5E94\u7528\u6846\u67B6\uFF0C\u7528\u4EE5\u5FEB\u901F\u5F00\u53D1\u9AD8\u6027\u80FD\u3001\u9AD8\u53EF\u9760\u6027\u7684\u7F51\u7EDC IO \u7A0B\u5E8F\uFF1B</li><li>Netty\u4E3B\u8981\u9488\u5BF9\u5728TCP\u534F\u8BAE\u4E0B\uFF0C\u9762\u5411Clients\u7AEF\u7684\u9AD8\u5E76\u53D1\u5E94\u7528\uFF0C\u6216\u8005Peer-to-Peer\u573A\u666F\u4E0B\u7684\u5927\u91CF\u6570\u636E\u6301\u7EED\u4F20\u8F93\u7684\u5E94\u7528\uFF1B</li><li>Netty\u672C\u8D28\u662F\u4E00\u4E2ANIO\u6846\u67B6\uFF0C\u9002\u7528\u4E8E\u670D\u52A1\u5668\u901A\u8BAF\u76F8\u5173\u7684\u591A\u79CD\u5E94\u7528\u573A\u666F\u3002</li></ol><h2 id="_1-2-netty\u7684\u5E94\u7528\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#_1-2-netty\u7684\u5E94\u7528\u573A\u666F" aria-hidden="true">#</a> 1.2 Netty\u7684\u5E94\u7528\u573A\u666F</h2><h3 id="_1-2-1-\u4E92\u8054\u7F51\u884C\u4E1A" tabindex="-1"><a class="header-anchor" href="#_1-2-1-\u4E92\u8054\u7F51\u884C\u4E1A" aria-hidden="true">#</a> 1.2.1 \u4E92\u8054\u7F51\u884C\u4E1A</h3><p>1\uFF09\u4E92\u8054\u7F51\u884C\u4E1A\uFF1A\u5728\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\uFF0C\u5404\u4E2A\u8282\u70B9\u4E4B\u95F4\u9700\u8981\u8FDC\u7A0B\u670D\u52A1\u8C03\u7528\uFF0C\u9AD8\u6027\u80FD\u7684 RPC \u6846\u67B6\u5FC5\u4E0D\u53EF\u5C11\uFF0CNetty \u4F5C\u4E3A\u5F02\u6B65\u9AD8\u6027\u80FD\u7684\u901A\u4FE1\u6846\u67B6\uFF0C\u5F80\u5F80\u4F5C\u4E3A\u57FA\u7840\u901A\u4FE1\u7EC4\u4EF6\u88AB\u8FD9\u4E9B RPC \u6846\u67B6\u4F7F\u7528\uFF1B 2\uFF09\u5178\u578B\u7684\u5E94\u7528\u6709\uFF1A\u963F\u91CC\u5206\u5E03\u5F0F\u670D\u52A1\u6846\u67B6 Dubbo \u7684 RPC \u6846\u67B6\u4F7F\u7528 Dubbo \u534F\u8BAE\u8FDB\u884C\u8282\u70B9\u95F4\u901A\u4FE1\uFF0CDubbo \u534F\u8BAE\u9ED8\u8BA4\u4F7F\u7528 Netty \u4F5C\u4E3A\u57FA\u7840\u901A\u4FE1\u7EC4\u4EF6\uFF0C\u7528\u4E8E\u5B9E\u73B0\u5404\u8FDB\u7A0B\u8282\u70B9\u4E4B\u95F4\u7684\u5185\u90E8\u901A\u4FE1\u3002</p><h3 id="_1-2-2-\u6E38\u620F\u884C\u4E1A" tabindex="-1"><a class="header-anchor" href="#_1-2-2-\u6E38\u620F\u884C\u4E1A" aria-hidden="true">#</a> 1.2.2 \u6E38\u620F\u884C\u4E1A</h3><p>1\uFF09\u65E0\u8BBA\u662F\u624B\u6E38\u670D\u52A1\u7AEF\u8FD8\u662F\u5927\u578B\u7684\u7F51\u7EDC\u6E38\u620F\uFF0CJava \u8BED\u8A00\u5F97\u5230\u4E86\u8D8A\u6765\u8D8A\u5E7F\u6CDB\u7684\u5E94\u7528\uFF1B 2\uFF09Netty \u4F5C\u4E3A\u9AD8\u6027\u80FD\u7684\u57FA\u7840\u901A\u4FE1\u7EC4\u4EF6\uFF0C\u63D0\u4F9B\u4E86 TCP/UDP \u548C HTTP \u534F\u8BAE\u6808\uFF0C\u65B9\u4FBF\u5B9A\u5236\u548C\u5F00\u53D1\u79C1\u6709\u534F\u8BAE\u6808\uFF0C\u8D26\u53F7\u767B\u5F55\u670D\u52A1\u5668\uFF1B 3\uFF09\u5730\u56FE\u670D\u52A1\u5668\u4E4B\u95F4\u53EF\u4EE5\u65B9\u4FBF\u7684\u901A\u8FC7 Netty \u8FDB\u884C\u9AD8\u6027\u80FD\u7684\u901A\u4FE1\u3002</p><h3 id="_1-2-3-\u5927\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_1-2-3-\u5927\u6570\u636E" aria-hidden="true">#</a> 1.2.3 \u5927\u6570\u636E</h3><p>1\uFF09\u7ECF\u5178\u7684 Hadoop \u7684\u9AD8\u6027\u80FD\u901A\u4FE1\u548C\u5E8F\u5217\u5316\u7EC4\u4EF6 Avro\u7684 RPC \u6846\u67B6\uFF0C\u9ED8\u8BA4\u91C7\u7528 Netty \u8FDB\u884C\u8DE8\u754C\u70B9\u901A\u4FE1\uFF1B 2\uFF09\u5B83\u7684 Netty Service \u57FA\u4E8E Netty \u6846\u67B6\u4E8C\u6B21\u5C01\u88C5\u5B9E\u73B0\u3002</p><h1 id="\u7B2C2\u7AE0-java-bio\u7F16\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u7B2C2\u7AE0-java-bio\u7F16\u7A0B" aria-hidden="true">#</a> \u7B2C2\u7AE0 Java BIO\u7F16\u7A0B</h1><h2 id="_2-1-i-o\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_2-1-i-o\u6A21\u578B" aria-hidden="true">#</a> 2.1 I/O\u6A21\u578B</h2><h3 id="_2-1-1-i-o\u6A21\u578B\u57FA\u672C\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_2-1-1-i-o\u6A21\u578B\u57FA\u672C\u8BF4\u660E" aria-hidden="true">#</a> 2.1.1 I/O\u6A21\u578B\u57FA\u672C\u8BF4\u660E</h3><p>1\uFF09I/O \u6A21\u578B\u7B80\u5355\u7684\u7406\u89E3\uFF1A\u5C31\u662F\u7528\u4EC0\u4E48\u6837\u7684\u901A\u9053\u8FDB\u884C\u6570\u636E\u7684\u53D1\u9001\u548C\u63A5\u6536\uFF0C\u5F88\u5927\u7A0B\u5EA6\u4E0A\u51B3\u5B9A\u4E86\u7A0B\u5E8F\u901A\u4FE1\u7684\u6027\u80FD\uFF1B 2\uFF09Java\u5171\u652F\u63013\u79CD\u7F51\u7EDC\u7F16\u7A0B\u6A21\u578B/IO\u6A21\u5F0F\uFF1ABIO\u3001NIO\u3001AIO\uFF1B 3\uFF09Java BIO \uFF1A \u540C\u6B65\u5E76\u963B\u585E(\u4F20\u7EDF\u963B\u585E\u578B)\uFF0C\u670D\u52A1\u5668\u5B9E\u73B0\u6A21\u5F0F\u4E3A\u4E00\u4E2A\u8FDE\u63A5\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u5373\u5BA2\u6237\u7AEF\u6709\u8FDE\u63A5\u8BF7\u6C42\u65F6\u670D\u52A1\u5668\u7AEF\u5C31\u9700\u8981\u542F\u52A8\u4E00\u4E2A\u7EBF\u7A0B\u8FDB\u884C\u5904\u7406\uFF0C\u5982\u679C\u8FD9\u4E2A\u8FDE\u63A5\u4E0D\u505A\u4EFB\u4F55\u4E8B\u60C5\u4F1A\u9020\u6210\u4E0D\u5FC5\u8981\u7684\u7EBF\u7A0B\u5F00\u9500 \uFF1B</p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821003614806.png" alt="image-20210821003614806" style="zoom:50%;"><p>4\uFF09Java NIO \uFF1A \u540C\u6B65\u975E\u963B\u585E\uFF0C\u670D\u52A1\u5668\u5B9E\u73B0\u6A21\u5F0F\u4E3A\u4E00\u4E2A\u7EBF\u7A0B\u5904\u7406\u591A\u4E2A\u8BF7\u6C42(\u8FDE\u63A5)\uFF0C\u5373\u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u8FDE\u63A5\u8BF7\u6C42\u90FD\u4F1A\u6CE8\u518C\u5230\u591A\u8DEF\u590D\u7528\u5668\u4E0A\uFF0C\u591A\u8DEF\u590D\u7528\u5668\u8F6E\u8BE2\u5230\u8FDE\u63A5\u6709I/O\u8BF7\u6C42\u5C31\u8FDB\u884C\u5904\u7406\uFF1B</p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821003812822.png" alt="image-20210821003812822" style="zoom:50%;"><p>5\uFF09Java AIO(NIO.2) \uFF1A \u5F02\u6B65\u975E\u963B\u585E\uFF0CAIO \u5F15\u5165\u5F02\u6B65\u901A\u9053\u7684\u6982\u5FF5\uFF0C\u91C7\u7528\u4E86Proactor \u6A21\u5F0F\uFF0C\u7B80\u5316\u4E86\u7A0B\u5E8F\u7F16\u5199\uFF0C\u6709\u6548\u7684\u8BF7\u6C42\u624D\u542F\u52A8\u7EBF\u7A0B\uFF0C\u5B83\u7684\u7279\u70B9\u662F\u5148\u7531\u64CD\u4F5C\u7CFB\u7EDF\u5B8C\u6210\u540E\u624D\u901A\u77E5\u670D\u52A1\u7AEF\u7A0B\u5E8F\u542F\u52A8\u7EBF\u7A0B\u53BB\u5904\u7406\uFF0C\u4E00\u822C\u9002\u7528\u4E8E\u8FDE\u63A5\u6570\u8F83\u591A\u4E14\u8FDE\u63A5\u65F6\u95F4\u8F83\u957F\u7684\u5E94\u7528\u3002</p><h2 id="_2-2-\u9002\u7528\u573A\u666F\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_2-2-\u9002\u7528\u573A\u666F\u5206\u6790" aria-hidden="true">#</a> 2.2 \u9002\u7528\u573A\u666F\u5206\u6790</h2><p>1\uFF09BIO\u65B9\u5F0F\u9002\u7528\u4E8E\u8FDE\u63A5\u6570\u76EE\u6BD4\u8F83\u5C0F\u4E14\u56FA\u5B9A\u7684\u67B6\u6784\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u5BF9\u670D\u52A1\u5668\u8D44\u6E90\u8981\u6C42\u6BD4\u8F83\u9AD8\uFF0C\u5E76\u53D1\u5C40\u9650\u4E8E\u5E94\u7528\u4E2D\uFF0CJDK1.4\u4EE5\u524D\u7684\u552F\u4E00\u9009\u62E9\uFF0C\u4F46\u7A0B\u5E8F\u7B80\u5355\u6613\u7406\u89E3\uFF1B 2\uFF09NIO\u65B9\u5F0F\u9002\u7528\u4E8E\u8FDE\u63A5\u6570\u76EE\u591A\u4E14\u8FDE\u63A5\u6BD4\u8F83\u77ED\uFF08\u8F7B\u64CD\u4F5C\uFF09\u7684\u67B6\u6784\uFF0C\u6BD4\u5982\u804A\u5929\u670D\u52A1\u5668\uFF0C\u5F39\u5E55\u7CFB\u7EDF\uFF0C\u670D\u52A1\u5668\u95F4\u901A\u8BAF\u7B49\u3002\u7F16\u7A0B\u6BD4\u8F83\u590D\u6742\uFF0CJDK1.4\u5F00\u59CB\u652F\u6301\uFF1B 3\uFF09AIO\u65B9\u5F0F\u4F7F\u7528\u4E8E\u8FDE\u63A5\u6570\u76EE\u591A\u4E14\u8FDE\u63A5\u6BD4\u8F83\u957F\uFF08\u91CD\u64CD\u4F5C\uFF09\u7684\u67B6\u6784\uFF0C\u6BD4\u5982\u76F8\u518C\u670D\u52A1\u5668\uFF0C\u5145\u5206\u8C03\u7528OS\u53C2\u4E0E\u5E76\u53D1\u64CD\u4F5C\uFF0C\u7F16\u7A0B\u6BD4\u8F83\u590D\u6742\uFF0CJDK7\u5F00\u59CB\u652F\u6301\u3002</p><table><thead><tr><th></th><th>\u7279\u70B9</th><th>\u51FA\u73B0\u7248\u672C</th><th>\u4F7F\u7528\u573A\u666F</th><th>\u4F7F\u7528\u793A\u4F8B</th></tr></thead><tbody><tr><td>BIO</td><td>\u540C\u6B65\u5E76\u963B\u585E(\u4F20\u7EDF\u963B\u585E\u578B)</td><td>JDK1.4\u4EE5\u524D\u7684\u552F\u4E00\u9009\u62E9</td><td>\u8FDE\u63A5\u6570\u76EE\u6BD4\u8F83\u5C0F</td><td></td></tr><tr><td>NIO</td><td>\u540C\u6B65\u975E\u963B\u585E</td><td>DK1.4\u5F00\u59CB\u652F\u6301</td><td>\u8FDE\u63A5\u6570\u76EE\u591A\u4E14\u8FDE\u63A5\u6BD4\u8F83\u77ED\uFF08\u8F7B\u64CD\u4F5C\uFF09</td><td>\u804A\u5929\u670D\u52A1\u5668\u3001\u5F39\u5E55\u7CFB\u7EDF\u3001\u670D\u52A1\u5668\u95F4\u901A\u8BAF</td></tr><tr><td>AIO</td><td>\u5F02\u6B65\u975E\u963B\u585E</td><td>JDK7\u5F00\u59CB\u652F\u6301\u3002</td><td>\u8FDE\u63A5\u6570\u76EE\u591A\u4E14\u8FDE\u63A5\u6BD4\u8F83\u957F\uFF08\u91CD\u64CD\u4F5C</td><td>\u76F8\u518C\u670D\u52A1\u5668</td></tr></tbody></table><h2 id="_2-3-java-bio\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_2-3-java-bio\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 2.3 Java BIO\u57FA\u672C\u4ECB\u7ECD</h2><p>1\uFF09Java BIO \u5C31\u662F\u4F20\u7EDF\u7684java io \u7F16\u7A0B\uFF0C\u5176\u76F8\u5173\u7684\u7C7B\u548C\u63A5\u53E3\u5728 java.io \uFF1B 2\uFF09BIO(blocking I/O) \uFF1A\u540C\u6B65\u963B\u585E\uFF0C\u670D\u52A1\u5668\u5B9E\u73B0\u6A21\u5F0F\u4E3A\u4E00\u4E2A\u8FDE\u63A5\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u5373\u5BA2\u6237\u7AEF\u6709\u8FDE\u63A5\u8BF7\u6C42\u65F6\u670D\u52A1\u5668\u7AEF\u5C31\u9700\u8981\u542F\u52A8\u4E00\u4E2A\u7EBF\u7A0B\u8FDB\u884C\u5904\u7406\uFF0C\u5982\u679C\u8FD9\u4E2A\u8FDE\u63A5\u4E0D\u505A\u4EFB\u4F55\u4E8B\u60C5\u4F1A\u9020\u6210\u4E0D\u5FC5\u8981\u7684\u7EBF\u7A0B\u5F00\u9500\uFF0C\u53EF\u4EE5\u901A\u8FC7\u7EBF\u7A0B\u6C60\u673A\u5236\u6539\u5584(\u5B9E\u73B0\u591A\u4E2A\u5BA2\u6237\u8FDE\u63A5\u670D\u52A1\u5668)\uFF1B 3\uFF09BIO\u65B9\u5F0F\u9002\u7528\u4E8E\u8FDE\u63A5\u6570\u76EE\u6BD4\u8F83\u5C0F\u4E14\u56FA\u5B9A\u7684\u67B6\u6784\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u5BF9\u670D\u52A1\u5668\u8D44\u6E90\u8981\u6C42\u6BD4\u8F83\u9AD8\uFF0C\u5E76\u53D1\u5C40\u9650\u4E8E\u5E94\u7528\u4E2D\uFF0CJDK1.4\u4EE5\u524D\u7684\u552F\u4E00\u9009\u62E9\uFF0C\u7A0B\u5E8F\u7B80\u5355\u6613\u7406\u89E3\u3002</p><h2 id="_2-4-java-bio\u5DE5\u4F5C\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_2-4-java-bio\u5DE5\u4F5C\u673A\u5236" aria-hidden="true">#</a> 2.4 Java BIO\u5DE5\u4F5C\u673A\u5236</h2><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821102025270.png" alt="image-20210821102025270" style="zoom:50%;"><p><strong>BIO\u7F16\u7A0B\u7B80\u5355\u6D41\u7A0B\uFF1A</strong> 1\uFF09\u670D\u52A1\u5668\u7AEF\u542F\u52A8\u4E00\u4E2AServerSocket\uFF1B 2\uFF09\u5BA2\u6237\u7AEF\u542F\u52A8Socket\u5BF9\u670D\u52A1\u5668\u8FDB\u884C\u901A\u4FE1\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u670D\u52A1\u5668\u7AEF\u9700\u8981\u5BF9\u6BCF\u4E2A\u5BA2\u6237\u5EFA\u7ACB\u4E00\u4E2A\u7EBF\u7A0B\u4E0E\u4E4B\u901A\u8BAF\uFF1B 3\uFF09\u5BA2\u6237\u7AEF\u53D1\u51FA\u8BF7\u6C42\u540E, \u5148\u54A8\u8BE2\u670D\u52A1\u5668\u662F\u5426\u6709\u7EBF\u7A0B\u54CD\u5E94\uFF0C\u5982\u679C\u6CA1\u6709\u5219\u4F1A\u7B49\u5F85\uFF0C\u6216\u8005\u88AB\u62D2\u7EDD\uFF1B 4\uFF09\u5982\u679C\u6709\u54CD\u5E94\uFF0C\u5BA2\u6237\u7AEF\u7EBF\u7A0B\u4F1A\u7B49\u5F85\u8BF7\u6C42\u7ED3\u675F\u540E\uFF0C\u5728\u7EE7\u7EED\u6267\u884C</p><h2 id="_2-5-java-bio\u5E94\u7528\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#_2-5-java-bio\u5E94\u7528\u5B9E\u4F8B" aria-hidden="true">#</a> 2.5 Java BIO\u5E94\u7528\u5B9E\u4F8B</h2><p><strong>\u5B9E\u4F8B\u8BF4\u660E\uFF1A</strong> 1\uFF09\u4F7F\u7528BIO\u6A21\u578B\u7F16\u5199\u4E00\u4E2A\u670D\u52A1\u5668\u7AEF\uFF0C\u76D1\u542C6666\u7AEF\u53E3\uFF0C\u5F53\u6709\u5BA2\u6237\u7AEF\u8FDE\u63A5\u65F6\uFF0C\u5C31\u542F\u52A8\u4E00\u4E2A\u7EBF\u7A0B\u4E0E\u4E4B\u901A\u8BAF\uFF1B 2\uFF09\u8981\u6C42\u4F7F\u7528\u7EBF\u7A0B\u6C60\u673A\u5236\u6539\u5584\uFF0C\u53EF\u4EE5\u8FDE\u63A5\u591A\u4E2A\u5BA2\u6237\u7AEF\uFF1B 3\uFF09\u670D\u52A1\u5668\u7AEF\u53EF\u4EE5\u63A5\u6536\u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u6570\u636E(telnet \u65B9\u5F0F\u5373\u53EF)\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bio</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/21/9:48
 * <span class="token keyword">@description</span>
 */</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 1)\u4F7F\u7528BIO\u6A21\u578B\u7F16\u5199\u4E00\u4E2A\u670D\u52A1\u5668\u7AEF\uFF0C\u76D1\u542C6666\u7AEF\u53E3\uFF0C\u5F53\u6709\u5BA2\u6237\u7AEF\u8FDE\u63A5\u65F6\uFF0C\u5C31\u542F\u52A8\u4E00\u4E2A\u7EBF\u7A0B\u4E0E\u4E4B\u901A\u8BAF
 * 2)\u8981\u6C42\u4F7F\u7528\u7EBF\u7A0B\u6C60\u673A\u5236\u6539\u5584\uFF0C\u53EF\u4EE5\u8FDE\u63A5\u591A\u4E2A\u5BA2\u6237\u7AEF
 * 3)\u670D\u52A1\u5668\u7AEF\u53EF\u4EE5\u63A5\u6536\u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u6570\u636E(telnet \u65B9\u5F0F\u5373\u53EF)
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BIOServerDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token doc-comment comment">/**
         * \u601D\u8DEF:
         *  1.\u521B\u5EFA\u4E00\u4E2A\u7EBF\u7A0B\u6C60
         *  2.\u5982\u679C\u6709\u5BA2\u6237\u7AEF\u8FDE\u63A5\uFF0C\u5C31\u521B\u5EFA\u4E00\u4E2A\u7EBF\u7A0B\u4E0E\u4E4B\u901A\u4FE1\uFF08\u5355\u72EC\u4E00\u4E2A\u65B9\u6CD5\uFF09
         */</span>
        <span class="token class-name">ExecutorService</span> newCachedThreadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u521B\u5EFAserverSocket \u6307\u5B9A\u7AEF\u53E3\u4E3A6666
         */</span>
        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">6666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u670D\u52A1\u5668\u542F\u52A8\u4E86...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7EBF\u7A0B\u4FE1\u606F:id=&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                    <span class="token string">&quot; \u540D\u79F0:&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token doc-comment comment">/**
             * \u76D1\u542C\uFF0C\u7B49\u5F85\u5BA2\u6237\u7AEF\u8FDB\u884C\u8FDE\u63A5
             */</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7B49\u5F85\u8FDE\u63A5...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FDE\u63A5\u5230\u4E00\u4E2A\u5BA2\u6237\u7AEF...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token doc-comment comment">/**
             * \u521B\u5EFA\u7EBF\u7A0B\uFF0C\u8FDB\u884C\u901A\u4FE1
             */</span>
            newCachedThreadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">handler</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> socket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token doc-comment comment">/**
             * \u901A\u8FC7socket\u83B7\u5F97\u8F93\u5165\u6D41
             */</span>
            <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token doc-comment comment">/**
             * \u8BFB\u53D6\u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u6570\u636E
             */</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7EBF\u7A0B\u4FE1\u606F:id=&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                        <span class="token string">&quot; \u540D\u79F0:&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;read...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> read <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>read<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br></div></div><p><strong>Telnet\u4F7F\u7528\u8BF4\u660E</strong></p><p>1\uFF09cmd\u547D\u4EE4\u884C\u8F93\u5165\u8FDB\u884C\u8FDE\u63A5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>telnet <span class="token number">127.0</span>.0.1 <span class="token number">6666</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u82E5\u63D0\u793A\u9519\u8BEF\uFF1A\u201Ctelnet\u201D\u4E0D\u662F\u5185\u90E8\u6216\u5916\u90E8\u547D\u4EE4\uFF0C\u4E5F\u4E0D\u662F\u53EF\u8FD0\u884C\u7684\u7A0B\u5E8F\u6216\u6279\u5904\u7406\u6587\u4EF6</p>`,31),h={href:"https://jingyan.baidu.com/article/375c8e19bff04625f3a22961.html",target:"_blank",rel:"noopener noreferrer"},y=s("\u5F00\u542FTelnet"),f=t(`<p>2\uFF09\u6309Ctrl+]\u8FDB\u884C\u6D88\u606F\u53D1\u9001</p><p>3\uFF09\u53D1\u9001\u6D88\u606F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>send helloworld
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="_2-5-java-bio\u95EE\u9898\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_2-5-java-bio\u95EE\u9898\u5206\u6790" aria-hidden="true">#</a> 2.5 Java BIO\u95EE\u9898\u5206\u6790</h2><p>1\uFF09\u6BCF\u4E2A\u8BF7\u6C42\u90FD\u9700\u8981\u521B\u5EFA\u72EC\u7ACB\u7684\u7EBF\u7A0B\uFF0C\u4E0E\u5BF9\u5E94\u7684\u5BA2\u6237\u7AEF\u8FDB\u884C\u6570\u636E Read\uFF0C\u4E1A\u52A1\u5904\u7406\uFF0C\u6570\u636E Write\uFF1B 2\uFF09\u5F53\u5E76\u53D1\u6570\u8F83\u5927\u65F6\uFF0C\u9700\u8981\u521B\u5EFA\u5927\u91CF\u7EBF\u7A0B\u6765\u5904\u7406\u8FDE\u63A5\uFF0C\u7CFB\u7EDF\u8D44\u6E90\u5360\u7528\u8F83\u5927\uFF1B 3\uFF09\u8FDE\u63A5\u5EFA\u7ACB\u540E\uFF0C\u5982\u679C\u5F53\u524D\u7EBF\u7A0B\u6682\u65F6\u6CA1\u6709\u6570\u636E\u53EF\u8BFB\uFF0C\u5219\u7EBF\u7A0B\u5C31\u963B\u585E\u5728 Read \u64CD\u4F5C\u4E0A\uFF0C\u9020\u6210\u7EBF\u7A0B\u8D44\u6E90\u6D6A\u8D39\u3002</p><h1 id="\u7B2C3\u7AE0-java-nio\u7F16\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u7B2C3\u7AE0-java-nio\u7F16\u7A0B" aria-hidden="true">#</a> \u7B2C3\u7AE0 Java NIO\u7F16\u7A0B</h1><h2 id="_3-1-java-nio\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_3-1-java-nio\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 3.1 Java NIO\u57FA\u672C\u4ECB\u7ECD</h2><p>1\uFF09Java NIO \u5168\u79F0java non-blocking IO\uFF0C\u662F\u6307 JDK \u63D0\u4F9B\u7684\u65B0 API\u3002\u4ECE JDK1.4 \u5F00\u59CB\uFF0CJava \u63D0\u4F9B\u4E86\u4E00\u7CFB\u5217\u6539\u8FDB\u7684\u8F93\u5165/\u8F93\u51FA\u7684\u65B0\u7279\u6027\uFF0C\u88AB\u7EDF\u79F0\u4E3A NIO(\u5373 New IO)\uFF0C\u662F\u540C\u6B65\u975E\u963B\u585E\u7684\uFF1B</p><p>2\uFF09NIO \u76F8\u5173\u7C7B\u90FD\u88AB\u653E\u5728 java.nio\u5305\u53CA\u5B50\u5305\u4E0B\uFF0C\u5E76\u4E14\u5BF9\u539F java.io \u5305\u4E2D\u7684\u5F88\u591A\u7C7B\u8FDB\u884C\u6539\u5199\u3002\u3010\u57FA\u672C\u6848\u4F8B\u3011</p><p>3\uFF09NIO \u6709\u4E09\u5927\u6838\u5FC3\u90E8\u5206\uFF1AChannel(\u901A\u9053)\uFF0CBuffer(\u7F13\u51B2\u533A), Selector(\u9009\u62E9\u5668)</p><p>4\uFF09NIO\u662F \u9762\u5411\u7F13\u51B2\u533A \uFF0C\u6216\u8005\u9762\u5411\u5757\u7F16\u7A0B\u7684\u3002\u6570\u636E\u8BFB\u53D6\u5230\u4E00\u4E2A\u5B83\u7A0D\u540E\u5904\u7406\u7684\u7F13\u51B2\u533A\uFF0C\u9700\u8981\u65F6\u53EF\u5728\u7F13\u51B2\u533A\u4E2D\u524D\u540E\u79FB\u52A8\uFF0C\u8FD9\u5C31\u589E\u52A0\u4E86\u5904\u7406\u8FC7\u7A0B\u4E2D\u7684\u7075\u6D3B\u6027\uFF0C\u4F7F\u7528\u5B83\u53EF\u4EE5\u63D0\u4F9B\u975E\u963B\u585E\u5F0F\u7684\u9AD8\u4F38\u7F29\u6027\u7F51\u7EDC</p><p>5\uFF09Java NIO\u7684\u975E\u963B\u585E\u6A21\u5F0F\uFF0C\u4F7F\u4E00\u4E2A\u7EBF\u7A0B\u4ECE\u67D0\u901A\u9053\u53D1\u9001\u8BF7\u6C42\u6216\u8005\u8BFB\u53D6\u6570\u636E\uFF0C\u4F46\u662F\u5B83\u4EC5\u80FD\u5F97\u5230\u76EE\u524D\u53EF\u7528\u7684\u6570\u636E\uFF0C\u5982\u679C\u76EE\u524D\u6CA1\u6709\u6570\u636E\u53EF\u7528\u65F6\uFF0C\u5C31\u4EC0\u4E48\u90FD\u4E0D\u4F1A\u83B7\u53D6\uFF0C\u800C\u4E0D\u662F\u4FDD\u6301\u7EBF\u7A0B\u963B\u585E\uFF0C\u6240\u4EE5\u76F4\u81F3\u6570\u636E\u53D8\u7684\u53EF\u4EE5\u8BFB\u53D6\u4E4B\u524D\uFF0C\u8BE5\u7EBF\u7A0B\u53EF\u4EE5\u7EE7\u7EED\u505A\u5176\u4ED6\u7684\u4E8B\u60C5\u3002 \u975E\u963B\u585E\u5199\u4E5F\u662F\u5982\u6B64\uFF0C\u4E00\u4E2A\u7EBF\u7A0B\u8BF7\u6C42\u5199\u5165\u4E00\u4E9B\u6570\u636E\u5230\u67D0\u901A\u9053\uFF0C\u4F46\u4E0D\u9700\u8981\u7B49\u5F85\u5B83\u5B8C\u5168\u5199\u5165\uFF0C\u8FD9\u4E2A\u7EBF\u7A0B\u540C\u65F6\u53EF\u4EE5\u53BB\u505A\u522B\u7684\u4E8B\u60C5\u3002\u3010\u540E\u9762\u6709\u6848\u4F8B\u8BF4\u660E\u3011 6\uFF09\u901A\u4FD7\u7406\u89E3\uFF1ANIO\u662F\u53EF\u4EE5\u505A\u5230\u7528\u4E00\u4E2A\u7EBF\u7A0B\u6765\u5904\u7406\u591A\u4E2A\u64CD\u4F5C\u7684\u3002\u5047\u8BBE\u670910000\u4E2A\u8BF7\u6C42\u8FC7\u6765,\u6839\u636E\u5B9E\u9645\u60C5\u51B5\uFF0C\u53EF\u4EE5\u5206\u914D50\u6216\u8005100\u4E2A\u7EBF\u7A0B\u6765\u5904\u7406\u3002\u4E0D\u50CF\u4E4B\u524D\u7684\u963B\u585EIO\u90A3\u6837\uFF0C\u975E\u5F97\u5206\u914D10000\u4E2A\u3002 7\uFF09HTTP2.0\u4F7F\u7528\u4E86\u591A\u8DEF\u590D\u7528\u7684\u6280\u672F\uFF0C\u505A\u5230\u540C\u4E00\u4E2A\u8FDE\u63A5\u5E76\u53D1\u5904\u7406\u591A\u4E2A\u8BF7\u6C42\uFF0C\u800C\u4E14\u5E76\u53D1\u8BF7\u6C42\u7684\u6570\u91CF\u6BD4HTTP1.1\u5927\u4E86\u597D\u51E0\u4E2A\u6570\u91CF\u7EA7\u3002</p><p>8\uFF09\u6848\u4F8B\u8BF4\u660EBIO\u7684Buffer</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">IntBuffer</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/21/10:40
 * <span class="token keyword">@description</span> java nio buffer\u7B80\u5355\u793A\u4F8B
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BasicBufferDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5F80buffer\u91CC\u9762\u5B58\u653E\u6570\u636E
         */</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/**
         * \u4ECEbuffer\u91CC\u9762\u8BFB\u53D6\u6570\u636E
         */</span>
        <span class="token doc-comment comment">/**
         * \u5148\u8FDB\u884C\u8BFB\u5199\u5207\u6362\uFF01\uFF01\uFF01
         */</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="_3-2-bio\u548Cnio\u7684\u6BD4\u8F83" tabindex="-1"><a class="header-anchor" href="#_3-2-bio\u548Cnio\u7684\u6BD4\u8F83" aria-hidden="true">#</a> 3.2 BIO\u548CNIO\u7684\u6BD4\u8F83</h2><p>1\uFF09BIO \u4EE5\u6D41\u7684\u65B9\u5F0F\u5904\u7406\u6570\u636E,\u800C NIO \u4EE5\u5757\u7684\u65B9\u5F0F\u5904\u7406\u6570\u636E,\u5757 I/O \u7684\u6548\u7387\u6BD4\u6D41 I/O \u9AD8\u5F88\u591A 2\uFF09BIO \u662F\u963B\u585E\u7684\uFF0CNIO \u5219\u662F\u975E\u963B\u585E\u7684 3\uFF09BIO\u57FA\u4E8E\u5B57\u8282\u6D41\u548C\u5B57\u7B26\u6D41\u8FDB\u884C\u64CD\u4F5C\uFF0C\u800C NIO \u57FA\u4E8E Channel(\u901A\u9053)\u548C Buffer(\u7F13\u51B2\u533A)\u8FDB\u884C\u64CD\u4F5C\uFF0C\u6570\u636E\u603B\u662F\u4ECE\u901A\u9053\u8BFB\u53D6\u5230\u7F13\u51B2\u533A\u4E2D\uFF0C\u6216\u8005\u4ECE\u7F13\u51B2\u533A\u5199\u5165\u5230\u901A\u9053\u4E2D\u3002Selector(\u9009\u62E9\u5668)\u7528\u4E8E\u76D1\u542C\u591A\u4E2A\u901A\u9053\u7684\u4E8B\u4EF6\uFF08\u6BD4\u5982\uFF1A\u8FDE\u63A5\u8BF7\u6C42\uFF0C\u6570\u636E\u5230\u8FBE\u7B49\uFF09\uFF0C\u56E0\u6B64\u4F7F\u7528\u5355\u4E2A\u7EBF\u7A0B\u5C31\u53EF\u4EE5\u76D1\u542C\u591A\u4E2A\u5BA2\u6237\u7AEF\u901A\u9053\u3002</p><h2 id="_3-3-nio-\u4E09\u5927\u6838\u5FC3\u539F\u7406\u793A\u610F\u56FE" tabindex="-1"><a class="header-anchor" href="#_3-3-nio-\u4E09\u5927\u6838\u5FC3\u539F\u7406\u793A\u610F\u56FE" aria-hidden="true">#</a> 3.3 NIO \u4E09\u5927\u6838\u5FC3\u539F\u7406\u793A\u610F\u56FE</h2><p>Selector \u3001 Channel \u548C Buffer \u7684\u5173\u7CFB\u56FE(\u7B80\u5355\u7248)</p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821221245062.png" alt="image-20210821221245062" style="zoom:80%;"><p>\u5173\u7CFB\u56FE\u7684\u8BF4\u660E: 1\uFF09\u6BCF\u4E2Achannel \u90FD\u4F1A\u5BF9\u5E94\u4E00\u4E2ABuffer\uFF1B 2\uFF09Selector \u5BF9\u5E94\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u5E94\u591A\u4E2Achannel(\u8FDE\u63A5)\uFF1B 3\uFF09\u8BE5\u56FE\u53CD\u5E94\u4E86\u6709\u4E09\u4E2Achannel \u6CE8\u518C\u5230 \u8BE5selector\uFF1B 4\uFF09\u7A0B\u5E8F\u5207\u6362\u5230\u54EA\u4E2Achannel \u662F\u6709\u4E8B\u4EF6\u51B3\u5B9A\u7684, Event \u5C31\u662F\u4E00\u4E2A\u91CD\u8981\u7684\u6982\u5FF5\uFF1B 5\uFF09Selector \u4F1A\u6839\u636E\u4E0D\u540C\u7684\u4E8B\u4EF6\uFF0C\u5728\u5404\u4E2A\u901A\u9053\u4E0A\u5207\u6362\uFF1B 6\uFF09Buffer \u5C31\u662F\u4E00\u4E2A\u5185\u5B58\u5757\uFF0C \u5E95\u5C42\u662F\u6709\u4E00\u4E2A\u6570\u7EC4\uFF1B 7\uFF09\u6570\u636E\u7684\u8BFB\u53D6\u5199\u5165\u662F\u901A\u8FC7Buffer, \u8FD9\u4E2A\u548CBIO , BIO \u4E2D\u8981\u4E48\u662F\u8F93\u5165\u6D41\uFF0C\u6216\u8005\u662F\u8F93\u51FA\u6D41, \u4E0D\u80FD\u53CC\u5411\uFF0C\u4F46\u662FNIO\u7684Buffer \u662F\u53EF\u4EE5\u8BFB\u4E5F\u53EF\u4EE5\u5199, \u9700\u8981 flip \u65B9\u6CD5\u5207\u6362\uFF1B 8\uFF09channel \u662F\u53CC\u5411\u7684, \u53EF\u4EE5\u8FD4\u56DE\u5E95\u5C42\u64CD\u4F5C\u7CFB\u7EDF\u7684\u60C5\u51B5, \u6BD4\u5982Linux \uFF0C \u5E95\u5C42\u7684\u64CD\u4F5C\u7CFB\u7EDF\v\u901A\u9053\u5C31\u662F\u53CC\u5411\u7684\u3002</p><h2 id="_3-4-\u7F13\u51B2\u533A-buffer" tabindex="-1"><a class="header-anchor" href="#_3-4-\u7F13\u51B2\u533A-buffer" aria-hidden="true">#</a> 3.4 \u7F13\u51B2\u533A\uFF08Buffer\uFF09</h2><h3 id="_3-4-1-\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_3-4-1-\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 3.4.1 \u57FA\u672C\u4ECB\u7ECD</h3><p>\u7F13\u51B2\u533A\uFF08Buffer\uFF09\uFF1A\u7F13\u51B2\u533A\u672C\u8D28\u4E0A\u662F\u4E00\u4E2A\u53EF\u4EE5\u8BFB\u5199\u6570\u636E\u7684\u5185\u5B58\u5757\uFF0C\u53EF\u4EE5\u7406\u89E3\u6210\u662F\u4E00\u4E2A\u5BB9\u5668\u5BF9\u8C61(\u542B\u6570\u7EC4)\uFF0C\u8BE5\u5BF9\u8C61\u63D0\u4F9B\u4E86\u4E00\u7EC4\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u66F4\u8F7B\u677E\u5730\u4F7F\u7528\u5185\u5B58\u5757\uFF0C\u7F13\u51B2\u533A\u5BF9\u8C61\u5185\u7F6E\u4E86\u4E00\u4E9B\u673A\u5236\uFF0C\u80FD\u591F\u8DDF\u8E2A\u548C\u8BB0\u5F55\u7F13\u51B2\u533A\u7684\u72B6\u6001\u53D8\u5316\u60C5\u51B5\u3002Channel \u63D0\u4F9B\u4ECE\u6587\u4EF6\u3001\u7F51\u7EDC\u8BFB\u53D6\u6570\u636E\u7684\u6E20\u9053\uFF0C\u4F46\u662F\u8BFB\u53D6\u6216\u5199\u5165\u7684\u6570\u636E\u90FD\u5FC5\u987B\u7ECF\u7531 Buffer\uFF0C\u5982\u56FE:</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821221638468.png" alt="image-20210821221638468" loading="lazy"></p><h3 id="_3-4-2-buffer\u7C7B\u53CA\u5176\u5B50\u7C7B" tabindex="-1"><a class="header-anchor" href="#_3-4-2-buffer\u7C7B\u53CA\u5176\u5B50\u7C7B" aria-hidden="true">#</a> 3.4.2 Buffer\u7C7B\u53CA\u5176\u5B50\u7C7B</h3><p>1\uFF09\u5728 NIO \u4E2D\uFF0CBuffer \u662F\u4E00\u4E2A\u9876\u5C42\u7236\u7C7B\uFF0C\u5B83\u662F\u4E00\u4E2A\u62BD\u8C61\u7C7B, \u7C7B\u7684\u5C42\u7EA7\u5173\u7CFB\u56FE:</p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821222041871.png" alt="image-20210821222041871" style="zoom:67%;"><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821221843327.png" alt="image-20210821221843327" style="zoom:50%;"><p>2\uFF09Buffer\u7C7B\u5B9A\u4E49\u4E86\u6240\u6709\u7684\u7F13\u51B2\u533A\u90FD\u5177\u6709\u7684\u56DB\u4E2A\u5C5E\u6027\u6765\u63D0\u4F9B\u5173\u4E8E\u5176\u6240\u5305\u542B\u7684\u6570\u636E\u5143\u7D20\u7684\u4FE1\u606F:</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821222141080.png" alt="image-20210821222141080" loading="lazy"></p><table><thead><tr><th><strong>\u5C5E\u6027</strong></th><th><strong>\u63CF\u8FF0</strong></th></tr></thead><tbody><tr><td>Capacity</td><td>\u5BB9\u91CF\uFF0C\u5373\u53EF\u4EE5\u5BB9\u7EB3\u7684\u6700\u5927\u6570\u636E\u91CF\uFF1B\u5728\u7F13\u51B2\u533A\u521B\u5EFA\u65F6\u88AB\u8BBE\u5B9A\u5E76\u4E14\u4E0D\u80FD\u6539\u53D8</td></tr><tr><td>Limit</td><td>\u8868\u793A\u7F13\u51B2\u533A\u7684\u5F53\u524D\u7EC8\u70B9\uFF0C\u4E0D\u80FD\u5BF9\u7F13\u51B2\u533A\u8D85\u8FC7\u6781\u9650\u7684\u4F4D\u7F6E\u8FDB\u884C\u8BFB\u5199\u64CD\u4F5C\u3002\u4E14\u6781\u9650\u662F\u53EF\u4EE5\u4FEE\u6539\u7684</td></tr><tr><td>Position</td><td>\u4F4D\u7F6E\uFF0C\u4E0B\u4E00\u4E2A\u8981\u88AB\u8BFB\u6216\u5199\u7684\u5143\u7D20\u7684\u7D22\u5F15\uFF0C\u6BCF\u6B21\u8BFB\u5199\u7F13\u51B2\u533A\u6570\u636E\u65F6\u90FD\u4F1A\u6539\u53D8\u6539\u503C\uFF0C\u4E3A\u4E0B\u6B21\u8BFB\u5199\u4F5C\u51C6\u5907</td></tr><tr><td>Mark</td><td>\u6807\u8BB0</td></tr></tbody></table><p>3\uFF09Buffer\u7C7B\u76F8\u5173\u65B9\u6CD5\u4E00\u89C8</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Buffer</span> <span class="token punctuation">{</span>
    <span class="token comment">//JDK1.4\u65F6\uFF0C\u5F15\u5165\u7684api</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">capacity</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u8FD4\u56DE\u6B64\u7F13\u51B2\u533A\u7684\u5BB9\u91CF</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">position</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u8FD4\u56DE\u6B64\u7F13\u51B2\u533A\u7684\u4F4D\u7F6E</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Buffer</span> position <span class="token punctuation">(</span><span class="token keyword">int</span> newPositio<span class="token punctuation">)</span><span class="token comment">//\u8BBE\u7F6E\u6B64\u7F13\u51B2\u533A\u7684\u4F4D\u7F6E</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">limit</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u8FD4\u56DE\u6B64\u7F13\u51B2\u533A\u7684\u9650\u5236</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Buffer</span> limit <span class="token punctuation">(</span><span class="token keyword">int</span> newLimit<span class="token punctuation">)</span><span class="token comment">//\u8BBE\u7F6E\u6B64\u7F13\u51B2\u533A\u7684\u9650\u5236</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Buffer</span> <span class="token function">mark</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u5728\u6B64\u7F13\u51B2\u533A\u7684\u4F4D\u7F6E\u8BBE\u7F6E\u6807\u8BB0</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Buffer</span> <span class="token function">reset</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u5C06\u6B64\u7F13\u51B2\u533A\u7684\u4F4D\u7F6E\u91CD\u7F6E\u4E3A\u4EE5\u524D\u6807\u8BB0\u7684\u4F4D\u7F6E</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Buffer</span> <span class="token function">clear</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u6E05\u9664\u6B64\u7F13\u51B2\u533A, \u5373\u5C06\u5404\u4E2A\u6807\u8BB0\u6062\u590D\u5230\u521D\u59CB\u72B6\u6001\uFF0C\u4F46\u662F\u6570\u636E\u5E76\u6CA1\u6709\u771F\u6B63\u64E6\u9664, \u540E\u9762\u64CD\u4F5C\u4F1A\u8986\u76D6</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Buffer</span> <span class="token function">flip</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u53CD\u8F6C\u6B64\u7F13\u51B2\u533A</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Buffer</span> <span class="token function">rewind</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u91CD\u7ED5\u6B64\u7F13\u51B2\u533A</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">remaining</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u8FD4\u56DE\u5F53\u524D\u4F4D\u7F6E\u4E0E\u9650\u5236\u4E4B\u95F4\u7684\u5143\u7D20\u6570</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">hasRemaining</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token comment">//\u544A\u77E5\u5728\u5F53\u524D\u4F4D\u7F6E\u548C\u9650\u5236\u4E4B\u95F4\u662F\u5426\u6709\u5143\u7D20</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">isReadOnly</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u544A\u77E5\u6B64\u7F13\u51B2\u533A\u662F\u5426\u4E3A\u53EA\u8BFB\u7F13\u51B2\u533A</span>
 
    <span class="token comment">//JDK1.6\u65F6\u5F15\u5165\u7684api</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">hasArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u544A\u77E5\u6B64\u7F13\u51B2\u533A\u662F\u5426\u5177\u6709\u53EF\u8BBF\u95EE\u7684\u5E95\u5C42\u5B9E\u73B0\u6570\u7EC4</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Object</span> <span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8FD4\u56DE\u6B64\u7F13\u51B2\u533A\u7684\u5E95\u5C42\u5B9E\u73B0\u6570\u7EC4</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">arrayOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8FD4\u56DE\u6B64\u7F13\u51B2\u533A\u7684\u5E95\u5C42\u5B9E\u73B0\u6570\u7EC4\u4E2D\u7B2C\u4E00\u4E2A\u7F13\u51B2\u533A\u5143\u7D20\u7684\u504F\u79FB\u91CF</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">isDirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u544A\u77E5\u6B64\u7F13\u51B2\u533A\u662F\u5426\u4E3A\u76F4\u63A5\u7F13\u51B2\u533A</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_3-4-3-bytebuffer" tabindex="-1"><a class="header-anchor" href="#_3-4-3-bytebuffer" aria-hidden="true">#</a> 3.4.3 ByteBuffer</h3><p>\u4ECE\u524D\u9762\u53EF\u4EE5\u770B\u51FA\u5BF9\u4E8E Java \u4E2D\u7684\u57FA\u672C\u6570\u636E\u7C7B\u578B(boolean\u9664\u5916)\uFF0C\u90FD\u6709\u4E00\u4E2A Buffer \u7C7B\u578B\u4E0E\u4E4B\u76F8\u5BF9\u5E94\uFF0C\u6700\u5E38\u7528\u7684\u81EA\u7136\u662FByteBuffer \u7C7B\uFF08\u4E8C\u8FDB\u5236\u6570\u636E\uFF09\uFF0C\u8BE5\u7C7B\u7684\u4E3B\u8981\u65B9\u6CD5\u5982\u4E0B:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ByteBuffer</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u7F13\u51B2\u533A\u521B\u5EFA\u76F8\u5173api</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuffer</span> <span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span><span class="token comment">//\u521B\u5EFA\u76F4\u63A5\u7F13\u51B2\u533A</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuffer</span> <span class="token function">allocate</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span><span class="token comment">//\u8BBE\u7F6E\u7F13\u51B2\u533A\u7684\u521D\u59CB\u5BB9\u91CF</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuffer</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span><span class="token comment">//\u628A\u4E00\u4E2A\u6570\u7EC4\u653E\u5230\u7F13\u51B2\u533A\u4E2D\u4F7F\u7528</span>
    <span class="token comment">//\u6784\u9020\u521D\u59CB\u5316\u4F4D\u7F6Eoffset\u548C\u4E0A\u754Clength\u7684\u7F13\u51B2\u533A</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuffer</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span><span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span>
     <span class="token comment">//\u7F13\u5B58\u533A\u5B58\u53D6\u76F8\u5173API</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">byte</span> <span class="token function">get</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4ECE\u5F53\u524D\u4F4D\u7F6Eposition\u4E0Aget\uFF0Cget\u4E4B\u540E\uFF0Cposition\u4F1A\u81EA\u52A8+1</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">byte</span> get <span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4ECE\u7EDD\u5BF9\u4F4D\u7F6Eget</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">ByteBuffer</span> put <span class="token punctuation">(</span><span class="token keyword">byte</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4ECE\u5F53\u524D\u4F4D\u7F6E\u4E0A\u6DFB\u52A0\uFF0Cput\u4E4B\u540E\uFF0Cposition\u4F1A\u81EA\u52A8+1</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">ByteBuffer</span> put <span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">byte</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4ECE\u7EDD\u5BF9\u4F4D\u7F6E\u4E0Aput</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_3-5-\u901A\u9053-channel" tabindex="-1"><a class="header-anchor" href="#_3-5-\u901A\u9053-channel" aria-hidden="true">#</a> 3.5 \u901A\u9053\uFF08Channel\uFF09</h2><h3 id="_3-5-1-\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_3-5-1-\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 3.5.1 \u57FA\u672C\u4ECB\u7ECD</h3><p>1\uFF09NIO\u7684\u901A\u9053\u7C7B\u4F3C\u4E8E\u6D41\uFF0C\u4F46\u6709\u4E9B\u533A\u522B\u5982\u4E0B\uFF1A \u901A\u9053\u53EF\u4EE5\u540C\u65F6\u8FDB\u884C\u8BFB\u5199\uFF0C\u800C\u6D41\u53EA\u80FD\u8BFB\u6216\u8005\u53EA\u80FD\u5199\uFF1B \u901A\u9053\u53EF\u4EE5\u5B9E\u73B0\u5F02\u6B65\u8BFB\u5199\u6570\u636E\uFF1B \u901A\u9053\u53EF\u4EE5\u4ECE\u7F13\u51B2\u8BFB\u6570\u636E\uFF0C\u4E5F\u53EF\u4EE5\u5199\u6570\u636E\u5230\u7F13\u51B2\uFF1B</p><p>2\uFF09BIO \u4E2D\u7684 stream \u662F\u5355\u5411\u7684\uFF0C\u4F8B\u5982 FileInputStream \u5BF9\u8C61\u53EA\u80FD\u8FDB\u884C\u8BFB\u53D6\u6570\u636E\u7684\u64CD\u4F5C\uFF0C\u800C NIO \u4E2D\u7684\u901A\u9053(Channel)\u662F\u53CC\u5411\u7684\uFF0C\u53EF\u4EE5\u8BFB\u64CD\u4F5C\uFF0C\u4E5F\u53EF\u4EE5\u5199\u64CD\u4F5C\uFF1B 3\uFF09Channel\u5728NIO\u4E2D\u662F\u4E00\u4E2A\u63A5\u53E3\uFF1B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Channel</span> <span class="token keyword">extends</span> <span class="token class-name">Closeable</span><span class="token punctuation">{</span><span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>4\uFF09\u5E38\u7528\u7684 Channel \u7C7B\u6709\uFF1AFileChannel\u3001DatagramChannel\u3001ServerSocketChannel \u548C SocketChannel\u3002\u3010ServerSocketChanne \u7C7B\u4F3C ServerSocket , SocketChannel \u7C7B\u4F3C Socket\u3011\uFF1B</p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821222904980.png" alt="image-20210821222904980" style="zoom:67%;"><p>5\uFF09FileChannel \u7528\u4E8E\u6587\u4EF6\u7684\u6570\u636E\u8BFB\u5199\uFF0CDatagramChannel \u7528\u4E8E UDP \u7684\u6570\u636E\u8BFB\u5199\uFF0CServerSocketChannel \u548C SocketChannel \u7528\u4E8E TCP \u7684\u6570\u636E\u8BFB\u5199\u3002</p><h3 id="_3-5-2-filechannel-\u7C7B" tabindex="-1"><a class="header-anchor" href="#_3-5-2-filechannel-\u7C7B" aria-hidden="true">#</a> 3.5.2 FileChannel \u7C7B</h3><p>FileChannel\u4E3B\u8981\u7528\u6765\u5BF9\u672C\u5730\u6587\u4EF6\u8FDB\u884C IO \u64CD\u4F5C\uFF0C\u5E38\u89C1\u7684\u65B9\u6CD5\u6709\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> dst<span class="token punctuation">)</span> \uFF0C\u4ECE\u901A\u9053\u8BFB\u53D6\u6570\u636E\u5E76\u653E\u5230\u7F13\u51B2\u533A\u4E2D
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> src<span class="token punctuation">)</span> \uFF0C\u628A\u7F13\u51B2\u533A\u7684\u6570\u636E\u5199\u5230\u901A\u9053\u4E2D
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span><span class="token class-name">ReadableByteChannel</span> src<span class="token punctuation">,</span> <span class="token keyword">long</span> position<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">)</span>\uFF0C\u4ECE\u76EE\u6807\u901A\u9053\u4E2D\u590D\u5236\u6570\u636E\u5230\u5F53\u524D\u901A\u9053
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">long</span> position<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">,</span> <span class="token class-name">WritableByteChannel</span> target<span class="token punctuation">)</span>\uFF0C\u628A\u6570\u636E\u4ECE\u5F53\u524D\u901A\u9053\u590D\u5236\u7ED9\u76EE\u6807\u901A\u9053
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-5-2-1\u5E94\u7528\u5B9E\u4F8B1-\u672C\u5730\u6587\u4EF6\u5199\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3-5-2-1\u5E94\u7528\u5B9E\u4F8B1-\u672C\u5730\u6587\u4EF6\u5199\u6570\u636E" aria-hidden="true">#</a> 3.5.2.1\u5E94\u7528\u5B9E\u4F8B1-\u672C\u5730\u6587\u4EF6\u5199\u6570\u636E</h4><p>\u5B9E\u4F8B\u8981\u6C42: 1\uFF09\u4F7F\u7528\u524D\u9762\u5B66\u4E60\u540E\u7684ByteBuffer(\u7F13\u51B2) \u548C FileChannel(\u901A\u9053)\uFF0C \u5C06\u5B57\u7B26\u4E32\u5199\u5165\u5230file01.txt\u4E2D\uFF1B 2\uFF09\u6587\u4EF6\u4E0D\u5B58\u5728\u5C31\u521B\u5EFA\uFF1B 3\uFF09\u4EE3\u7801\u6F14\u793A\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/21/16:11
 * <span class="token keyword">@description</span> \u672C\u5730\u6587\u4EF6\u5199\u6570\u636E
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOFileChannelDemo1</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;hello,cyl&quot;</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * \u5B9A\u4E49\u4E00\u4E2A\u8F93\u51FA\u6D41
         */</span>
        <span class="token class-name">FileOutputStream</span> fileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;e://file01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u4ECE\u8F93\u51FA\u6D41\u83B7\u53D6\u901A\u9053
         */</span>
        <span class="token class-name">FileChannel</span> fileChannel <span class="token operator">=</span> fileOutputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5B9A\u4E49\u4E00\u4E2A\u7F13\u51B2\u533A
         */</span>
        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5C06\u8981\u8F93\u51FA\u7684\u5B57\u7B26\u4E32\u653E\u5165\u7F13\u51B2\u533A
         */</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5BF9\u7F13\u51B2\u533A\u8FDB\u884C\u53CD\u8F6C position=0
         */</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5C06\u7F13\u51B2\u533A\u7684\u6570\u636E\u5199\u5165\u5230channel
         */</span>
        fileChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5173\u95ED\u8F93\u51FA\u6D41
         */</span>
        fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h4 id="_3-5-2-2-\u5E94\u7528\u5B9E\u4F8B2-\u672C\u5730\u6587\u4EF6\u8BFB\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3-5-2-2-\u5E94\u7528\u5B9E\u4F8B2-\u672C\u5730\u6587\u4EF6\u8BFB\u6570\u636E" aria-hidden="true">#</a> 3.5.2.2 \u5E94\u7528\u5B9E\u4F8B2-\u672C\u5730\u6587\u4EF6\u8BFB\u6570\u636E</h4><p>\u5B9E\u4F8B\u8981\u6C42: 1\uFF09\u4F7F\u7528\u524D\u9762\u5B66\u4E60\u540E\u7684ByteBuffer(\u7F13\u51B2) \u548C FileChannel(\u901A\u9053)\uFF0C \u5C06 file01.txt\u4E2D\u7684\u6570\u636E\u8BFB\u5165\u5230\u7A0B\u5E8F\uFF0C\u5E76\u663E\u793A\u5728\u63A7\u5236\u53F0\u5C4F\u5E55\uFF1B 2\uFF09\u5047\u5B9A\u6587\u4EF6\u5DF2\u7ECF\u5B58\u5728\uFF1B 3\uFF09\u4EE3\u7801\u6F14\u793A\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/21/16:20
 * <span class="token keyword">@description</span> \u4ECE\u672C\u5730\u6587\u4EF6\u8BFB\u6570\u636E
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOFileChannelDemo2</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token doc-comment comment">/**
         * \u521B\u5EFA\u4E00\u4E2A\u8F93\u5165\u6D41
         */</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;e://file01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u4ECE\u6D41\u4E2D\u83B7\u53D6\u901A\u9053
         */</span>
        <span class="token class-name">FileChannel</span> fileInputStreamChannel <span class="token operator">=</span> fileInputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u521B\u5EFA\u4E00\u4E2A\u7F13\u51B2\u533A
         */</span>
        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5C06\u901A\u9053\u7684\u6570\u636E\u8BFB\u5165\u5230\u7F13\u51B2\u533A
         */</span>
        fileInputStreamChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5C06\u7F13\u51B2\u533A\u7684\u5B57\u8282\u6570\u636E\u8F6C\u6210String\u5E76\u8F93\u51FA
         */</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5173\u95ED\u8F93\u5165\u6D41
         */</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h4 id="_3-5-2-3-\u5E94\u7528\u5B9E\u4F8B3-\u4F7F\u7528\u4E00\u4E2Abuffer\u5B8C\u6210\u6587\u4EF6\u8BFB\u53D6" tabindex="-1"><a class="header-anchor" href="#_3-5-2-3-\u5E94\u7528\u5B9E\u4F8B3-\u4F7F\u7528\u4E00\u4E2Abuffer\u5B8C\u6210\u6587\u4EF6\u8BFB\u53D6" aria-hidden="true">#</a> 3.5.2.3 \u5E94\u7528\u5B9E\u4F8B3-\u4F7F\u7528\u4E00\u4E2ABuffer\u5B8C\u6210\u6587\u4EF6\u8BFB\u53D6</h4><p>\u5B9E\u4F8B\u8981\u6C42:</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210821223814767.png" alt="image-20210821223814767" loading="lazy">1\uFF09\u4F7F\u7528 FileChannel(\u901A\u9053) \u548C\u65B9\u6CD5 read,write,\u5B8C\u6210\u6587\u4EF6\u7684\u62F7\u8D1D\uFF1B 2\uFF09\u62F7\u8D1D\u4E00\u4E2A\u6587\u672C\u6587\u4EF6 1.txt , \u653E\u5728\u9879\u76EE\u4E0B\u5373\u53EF\uFF1B 3)\u4EE3\u7801\u6F14\u793A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/21/16:36
 * <span class="token keyword">@description</span> \u4F7F\u7528\u4E00\u4E2ABuffer\u5B8C\u6210\u6587\u4EF6\u8BFB\u53D6:\u4F7F\u7528 FileChannel(\u901A\u9053) \u548C \u65B9\u6CD5  read , write\uFF0C\u5B8C\u6210\u6587\u4EF6\u7684\u62F7\u8D1D
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOFileChannelDemo3</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;E://Java//java-study//java-netty//1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> channel01 <span class="token operator">=</span> fileInputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">FileOutputStream</span> fileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;E://Java//java-study//java-netty//2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> channel02 <span class="token operator">=</span> fileOutputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token doc-comment comment">/**
             * \u6700\u91CD\u8981\u7684\u4E00\u6B65!!!
             *   public final Buffer clear() <span class="token punctuation">{</span>
             *         position = 0;
             *         limit = capacity;
             *         mark = -1;
             *         return this;
             *     <span class="token punctuation">}</span>
             */</span>
            byteBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">int</span> read <span class="token operator">=</span> channel01<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;read=&quot;</span> <span class="token operator">+</span> read<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>read  <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * \u7F13\u51B2\u533Aposition\u53CD\u8F6C
             */</span>
            byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channel02<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h4 id="_3-5-2-4-\u5E94\u7528\u5B9E\u4F8B4-\u62F7\u8D1D\u6587\u4EF6transferfrom-\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_3-5-2-4-\u5E94\u7528\u5B9E\u4F8B4-\u62F7\u8D1D\u6587\u4EF6transferfrom-\u65B9\u6CD5" aria-hidden="true">#</a> 3.5.2.4 \u5E94\u7528\u5B9E\u4F8B4-\u62F7\u8D1D\u6587\u4EF6transferFrom \u65B9\u6CD5</h4><p>\u5B9E\u4F8B\u8981\u6C42: 1\uFF09\u4F7F\u7528 FileChannel(\u901A\u9053) \u548C \u65B9\u6CD5 transferFrom \uFF0C\u5B8C\u6210\u6587\u4EF6\u7684\u62F7\u8D1D\uFF1B 2\uFF09\u62F7\u8D1D\u4E00\u5F20\u56FE\u7247\uFF1B 3\uFF09\u4EE3\u7801\u6F14\u793A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/21/16:49
 * <span class="token keyword">@description</span> \u62F7\u8D1D\u6587\u4EF6transferFrom\u65B9\u6CD5:\u4F7F\u7528 FileChannel(\u901A\u9053) \u548C \u65B9\u6CD5  transferFrom \uFF0C\u5B8C\u6210\u6587\u4EF6\u7684\u62F7\u8D1D
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOFileChannelDemo4</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;E://Java//java-study//java-netty//a.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> sourceChannel <span class="token operator">=</span> fileInputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">FileOutputStream</span> fileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;E://Java//java-study//java-netty//b.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> targetChannel <span class="token operator">=</span> fileOutputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        sourceChannel.transferTo(0,sourceChannel.size(),targetChannel);</span>
        sourceChannel<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>sourceChannel<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>sourceChannel<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="_3-5-3-\u5173\u4E8Ebuffer-\u548C-channel\u7684\u6CE8\u610F\u4E8B\u9879\u548C\u7EC6\u8282" tabindex="-1"><a class="header-anchor" href="#_3-5-3-\u5173\u4E8Ebuffer-\u548C-channel\u7684\u6CE8\u610F\u4E8B\u9879\u548C\u7EC6\u8282" aria-hidden="true">#</a> 3.5.3 \u5173\u4E8EBuffer \u548C Channel\u7684\u6CE8\u610F\u4E8B\u9879\u548C\u7EC6\u8282</h4><p>1\uFF09ByteBuffer \u652F\u6301\u7C7B\u578B\u5316\u7684put \u548C get, put \u653E\u5165\u7684\u662F\u4EC0\u4E48\u6570\u636E\u7C7B\u578B\uFF0Cget\u5C31\u5E94\u8BE5\u4F7F\u7528\u76F8\u5E94\u7684\u6570\u636E\u7C7B\u578B\u6765\u53D6\u51FA\uFF0C\u5426\u5219\u53EF\u80FD\u6709 BufferUnderflowException \u5F02\u5E38\uFF1B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/21/18:00
 * <span class="token keyword">@description</span> ByteBuffer \u652F\u6301\u7C7B\u578B\u5316\u7684put\u548Cget, put\u653E\u5165\u7684\u662F\u4EC0\u4E48\u6570\u636E\u7C7B\u578B\uFF0Cget\u5C31\u5E94\u8BE5\u4F7F\u7528\u76F8\u5E94\u7684\u6570\u636E\u7C7B\u578B\u6765\u53D6\u51FA\uFF0C
 *  \u5426\u5219\u53EF\u80FD\u6709BufferUnderflowException\u5F02\u5E38
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ByteBufferPutAndGetDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        byteBuffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">putLong</span><span class="token punctuation">(</span><span class="token number">7L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">putChar</span><span class="token punctuation">(</span><span class="token char">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">putDouble</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u53CD\u8F6C
         */</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">getShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">getChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        System.out.println(byteBuffer.getDouble());</span>
<span class="token comment">//        System.out.println(byteBuffer.getLong());</span>
<span class="token comment">//        System.out.println(byteBuffer.getInt());</span>
<span class="token comment">//        System.out.println(byteBuffer.getShort());</span>
<span class="token comment">//        System.out.println(byteBuffer.getChar());</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>2\uFF09\u53EF\u4EE5\u5C06\u4E00\u4E2A\u666E\u901ABuffer \u8F6C\u6210\u53EA\u8BFBBuffer\uFF1B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/21/18:14
 * <span class="token keyword">@description</span> \u53EA\u8BFBBuffer
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReadOnlyBufferDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            byteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/**
         * \u53CD\u8F6C
         */</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5F97\u5230\u4E00\u4E2A\u53EA\u8BFBbuffer
         */</span>
        <span class="token class-name">ByteBuffer</span> readOnlyBuffer <span class="token operator">=</span> byteBuffer<span class="token punctuation">.</span><span class="token function">asReadOnlyBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>readOnlyBuffer<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>readOnlyBuffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>readOnlyBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/**
         * Exception in thread &quot;main&quot; java.nio.ReadOnlyBufferException
         */</span>
        readOnlyBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>3\uFF09NIO \u8FD8\u63D0\u4F9B\u4E86 MappedByteBuffer\uFF0C \u53EF\u4EE5\u8BA9\u6587\u4EF6\u76F4\u63A5\u5728\u5185\u5B58\uFF08\u5806\u5916\u7684\u5185\u5B58\uFF09\u4E2D\u8FDB\u884C\u4FEE\u6539\uFF0C \u800C\u5982\u4F55\u540C\u6B65\u5230\u6587\u4EF6\u7531NIO \u6765\u5B8C\u6210\uFF1B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">RandomAccessFile</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">MappedByteBuffer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/21/18:20
 * <span class="token keyword">@description</span> MappedByteBuffer \u53EF\u4EE5\u8BA9\u6587\u4EF6\u76F4\u63A5\u5728\u5185\u5B58\uFF08\u5806\u5916\u7684\u5185\u5B58\uFF09\u4E2D\u8FDB\u884C\u4FEE\u6539\uFF0C\u800C\u5982\u4F55\u540C\u6B65\u5230\u6587\u4EF6\u7531NIO\u6765\u5B8C\u6210\uFF0C\u64CD\u4F5C\u7CFB\u7EDF\u4E0D\u9700\u8981\u62F7\u8D1D\u4E00\u6B21
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MappedByteBufferDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token class-name">RandomAccessFile</span> randomAccessFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">&quot;E://Java//java-study//java-netty//1.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u521B\u5EFAchannel
         */</span>
        <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> randomAccessFile<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u521B\u5EFAmappedByteBuffer
         */</span>
        <span class="token doc-comment comment">/**
         * \u53C2\u6570\u8BF4\u660E\uFF1A
         *  \u53C2\u65701\uFF1AFileChannel.MapMode.READ_WRITE \u4F7F\u7528\u7684\u8BFB\u5199\u6A21\u5F0F
         *  \u53C2\u65702\uFF1A\u53EF\u4EE5\u76F4\u63A5\u4FEE\u6539\u7684\u8D77\u59CB\u4F4D\u7F6E
         *  \u53C2\u65703\uFF1A\u662F\u6620\u5C04\u5230\u5185\u5B58\u7684\u5927\u5C0F\uFF08\u4E0D\u662F\u7D22\u5F15\u4F4D\u7F6E\uFF09\uFF0C\u5373\u5C061.txt\u7684\u591A\u5C11\u4E2A\u5B57\u8282\u6620\u5C04\u5230\u5185\u5B58\uFF0C\u533A\u95F4\u957F\u5EA6
         *  \u53EF\u4EE5\u4FEE\u6539\u7684\u8303\u56F4\u662F[0,5)
         *  \u5B9E\u9645\u7C7B\u578B\u662FDirectByteBuffer
         */</span>
        <span class="token class-name">MappedByteBuffer</span> mappedByteBuffer <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">FileChannel<span class="token punctuation">.</span>MapMode</span><span class="token punctuation">.</span>READ_WRITE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u8FDB\u884C\u4FEE\u6539\u64CD\u4F5C
         */</span>
        mappedByteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token char">&#39;H&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappedByteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token char">&#39;9&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        mappedByteBuffer.put(5,(byte) &#39;t&#39;); //Exception in thread &quot;main&quot; java.lang.IndexOutOfBoundsException</span>

        randomAccessFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4FEE\u6539\u6210\u529F!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>4\uFF09NIO \u8FD8\u652F\u6301\u901A\u8FC7\u591A\u4E2ABuffer (\u5373Buffer\u6570\u7EC4) \u5B8C\u6210\u8BFB\u5199\u64CD\u4F5C\uFF0C\u5373Scattering\u548CGathering</p><div class="language-Java ext-Java line-numbers-mode"><pre class="language-Java"><code>package com.cccyl.netty.nio;

import java.net.InetSocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.ServerSocketChannel;
import java.nio.channels.SocketChannel;
import java.util.Arrays;

/**
 * @author cyl
 * @date 2021/08/21/18:34
 * @description
 *  Scattering\uFF1A\u5C06\u6570\u636E\u5199\u5165\u5230buffer\u65F6\uFF0C\u53EF\u4EE5\u91C7\u7528buffer\u6570\u7EC4\uFF0C\u4F9D\u6B21\u5199\u5165 \u5206\u6563
 *  Gathering\uFF1A\u4ECEbuffer\u8BFB\u53D6\u6570\u636E\u65F6\uFF0C\u53EF\u4EE5\u91C7\u7528buffer\u6570\u7EC4\uFF0C\u4F9D\u6B21\u8BFB\u5165
 */
public class ScatteringAndGatheringDemo {

    public static void main(String[] args) throws Exception{

        /**
         * \u4F7F\u7528serverSocketChannel
         */
        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();

        InetSocketAddress address = new InetSocketAddress(7000);

        /**
         * \u7ED1\u5B9A7000\u7AEF\u53E3
         */
        serverSocketChannel.socket().bind(address);

        /**
         * \u521B\u5EFAbuffer\u6570\u7EC4
         */
        ByteBuffer[] byteBuffers = new ByteBuffer[2];
        byteBuffers[0] = ByteBuffer.allocate(5);
        byteBuffers[1] = ByteBuffer.allocate(3);

        /**
         * \u7B49\u5F85\u5BA2\u6237\u7AEF\u8FDE\u63A5
         */
        SocketChannel socketChannel = serverSocketChannel.accept();

        /**
         * \u5047\u8BBE\u4ECE\u5BA2\u6237\u7AEF\u63A5\u65368\u4E2A\u5B57\u8282
         */
        int messageLength = 8;

        while (true) {

            int byteRead = 0;

            while (byteRead &lt; messageLength) {
                long read = socketChannel.read(byteBuffers);

                byteRead += read;

                System.out.println(&quot;byteRead=&quot; + byteRead);

                Arrays.asList(byteBuffers).stream().map(byteBuffer -&gt;
                    &quot;position=&quot; + byteBuffer.position() + &quot; limit=&quot; + byteBuffer.limit()
                ).forEach(System.out::println);

                /**
                 * \u5C06\u6240\u6709\u7684buffer\u8FDB\u884C\u53CD\u8F6C
                 */
                Arrays.asList(byteBuffers).forEach(byteBuffer -&gt; byteBuffer.flip());
            }

            /**
             * \u5C06\u6570\u636E\u8BFB\u51FA\u5230\u5BA2\u6237\u7AEF
             */
            int byteWrite = 0;
            while (byteWrite &lt; messageLength) {
                long l = socketChannel.write(byteBuffers);
                byteWrite += l;

            }

            /**
             * \u5C06\u6240\u6709\u7684buffer clear
             */
            Arrays.asList(byteBuffers).stream().forEach(byteBuffer -&gt; byteBuffer.clear());

        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><h2 id="_3-6-\u9009\u62E9\u5668-selector" tabindex="-1"><a class="header-anchor" href="#_3-6-\u9009\u62E9\u5668-selector" aria-hidden="true">#</a> 3.6 \u9009\u62E9\u5668(Selector)</h2><h3 id="_3-6-1-\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_3-6-1-\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 3.6.1 \u57FA\u672C\u4ECB\u7ECD</h3><p>1\uFF09Java \u7684 NIO\uFF0C\u7528\u975E\u963B\u585E\u7684 IO \u65B9\u5F0F\uFF0C\u53EF\u4EE5\u7528\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u5904\u7406\u591A\u4E2A\u7684\u5BA2\u6237\u7AEF\u8FDE\u63A5\uFF0C\u5C31\u4F1A\u4F7F\u7528\u5230Selector(\u9009\u62E9\u5668)\uFF1B 2\uFF09Selector \u80FD\u591F\u68C0\u6D4B\u591A\u4E2A\u6CE8\u518C\u7684\u901A\u9053\u4E0A\u662F\u5426\u6709\u4E8B\u4EF6\u53D1\u751F(\u6CE8\u610F:\u591A\u4E2AChannel\u4EE5\u4E8B\u4EF6\u7684\u65B9\u5F0F\u53EF\u4EE5\u6CE8\u518C\u5230\u540C\u4E00\u4E2ASelector)\uFF0C\u5982\u679C\u6709\u4E8B\u4EF6\u53D1\u751F\uFF0C\u4FBF\u83B7\u53D6\u4E8B\u4EF6\u7136\u540E\u9488\u5BF9\u6BCF\u4E2A\u4E8B\u4EF6\u8FDB\u884C\u76F8\u5E94\u7684\u5904\u7406\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u53EA\u7528\u4E00\u4E2A\u5355\u7EBF\u7A0B\u53BB\u7BA1\u7406\u591A\u4E2A\u901A\u9053\uFF0C\u4E5F\u5C31\u662F\u7BA1\u7406\u591A\u4E2A\u8FDE\u63A5\u548C\u8BF7\u6C42\uFF1B 3\uFF09\u53EA\u6709\u5728\u8FDE\u63A5/\u901A\u9053 \u771F\u6B63\u6709\u8BFB\u5199\u4E8B\u4EF6\u53D1\u751F\u65F6\uFF0C\u624D\u4F1A\u8FDB\u884C\u8BFB\u5199\uFF0C\u5C31\u5927\u5927\u5730\u51CF\u5C11\u4E86\u7CFB\u7EDF\u5F00\u9500\uFF0C\u5E76\u4E14\u4E0D\u5FC5\u4E3A\u6BCF\u4E2A\u8FDE\u63A5\u90FD\u521B\u5EFA\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u4E0D\u7528\u53BB\u7EF4\u62A4\u591A\u4E2A\u7EBF\u7A0B\uFF1B 4\uFF09\u907F\u514D\u4E86\u591A\u7EBF\u7A0B\u4E4B\u95F4\u7684\u4E0A\u4E0B\u6587\u5207\u6362\u5BFC\u81F4\u7684\u5F00\u9500\u3002</p><h3 id="_3-6-2-selector\u793A\u610F\u56FE\u548C\u7279\u70B9\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_3-6-2-selector\u793A\u610F\u56FE\u548C\u7279\u70B9\u8BF4\u660E" aria-hidden="true">#</a> 3.6.2 Selector\u793A\u610F\u56FE\u548C\u7279\u70B9\u8BF4\u660E</h3><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210823221331628.png" alt="image-20210823221331628" style="zoom:80%;"><p>\u7279\u70B9\u8BF4\u660E: 1\uFF09Netty \u7684 IO \u7EBF\u7A0B NioEventLoop \u805A\u5408\u4E86 Selector(\u9009\u62E9\u5668\uFF0C\u4E5F\u53EB\u591A\u8DEF\u590D\u7528\u5668)\uFF0C\u53EF\u4EE5\u540C\u65F6\u5E76\u53D1\u5904\u7406\u6210\u767E\u4E0A\u5343\u4E2A\u5BA2\u6237\u7AEF\u8FDE\u63A5\uFF1B 2\uFF09\u5F53\u7EBF\u7A0B\u4ECE\u67D0\u5BA2\u6237\u7AEF Socket \u901A\u9053\u8FDB\u884C\u8BFB\u5199\u6570\u636E\u65F6\uFF0C\u82E5\u6CA1\u6709\u6570\u636E\u53EF\u7528\u65F6\uFF0C\u8BE5\u7EBF\u7A0B\u53EF\u4EE5\u8FDB\u884C\u5176\u4ED6\u4EFB\u52A1\uFF1B 3\uFF09\u7EBF\u7A0B\u901A\u5E38\u5C06\u975E\u963B\u585E IO \u7684\u7A7A\u95F2\u65F6\u95F4\u7528\u4E8E\u5728\u5176\u4ED6\u901A\u9053\u4E0A\u6267\u884C IO \u64CD\u4F5C\uFF0C\u6240\u4EE5\u5355\u72EC\u7684\u7EBF\u7A0B\u53EF\u4EE5\u7BA1\u7406\u591A\u4E2A\u8F93\u5165\u548C\u8F93\u51FA\u901A\u9053\uFF1B 4\uFF09\u7531\u4E8E\u8BFB\u5199\u64CD\u4F5C\u90FD\u662F\u975E\u963B\u585E\u7684\uFF0C\u8FD9\u5C31\u53EF\u4EE5\u5145\u5206\u63D0\u5347 IO \u7EBF\u7A0B\u7684\u8FD0\u884C\u6548\u7387\uFF0C\u907F\u514D\u7531\u4E8E\u9891\u7E41 I/O \u963B\u585E\u5BFC\u81F4\u7684\u7EBF\u7A0B\u6302\u8D77\uFF1B 5\uFF09\u4E00\u4E2A I/O \u7EBF\u7A0B\u53EF\u4EE5\u5E76\u53D1\u5904\u7406 N \u4E2A\u5BA2\u6237\u7AEF\u8FDE\u63A5\u548C\u8BFB\u5199\u64CD\u4F5C\uFF0C\u8FD9\u4ECE\u6839\u672C\u4E0A\u89E3\u51B3\u4E86\u4F20\u7EDF\u540C\u6B65\u963B\u585E I/O \u4E00\u8FDE\u63A5\u4E00\u7EBF\u7A0B\u6A21\u578B\uFF0C\u67B6\u6784\u7684\u6027\u80FD\u3001\u5F39\u6027\u4F38\u7F29\u80FD\u529B\u548C\u53EF\u9760\u6027\u90FD\u5F97\u5230\u4E86\u6781\u5927\u7684\u63D0\u5347\u3002</p><h3 id="_3-6-3-selector\u7C7B\u76F8\u5173\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_3-6-3-selector\u7C7B\u76F8\u5173\u65B9\u6CD5" aria-hidden="true">#</a> 3.6.3 Selector\u7C7B\u76F8\u5173\u65B9\u6CD5</h3><p>Selector \u7C7B\u662F\u4E00\u4E2A\u62BD\u8C61\u7C7B, \u5E38\u7528\u65B9\u6CD5\u548C\u8BF4\u660E\u5982\u4E0B:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Selector</span> <span class="token keyword">implements</span> <span class="token class-name">Closeable</span> <span class="token punctuation">{</span> 
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Selector</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5F97\u5230\u4E00\u4E2A\u9009\u62E9\u5668\u5BF9\u8C61</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u76D1\u63A7\u6240\u6709\u6CE8\u518C\u7684\u901A\u9053\uFF0C\u5F53\u5176\u4E2D\u6709 IO \u64CD\u4F5C\u53EF\u4EE5\u8FDB\u884C\u65F6\uFF0C\u5C06</span>
\u5BF9\u5E94\u7684 <span class="token class-name">SelectionKey</span> \u52A0\u5165\u5230\u5185\u90E8\u96C6\u5408\u4E2D\u5E76\u8FD4\u56DE\uFF0C\u53C2\u6570\u7528\u6765\u8BBE\u7F6E\u8D85\u65F6\u65F6\u95F4
<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4ECE\u5185\u90E8\u96C6\u5408\u4E2D\u5F97\u5230\u6240\u6709\u7684 SelectionKey	</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210823221640046.png" alt="image-20210823221640046" style="zoom:80%;"><p>\u6CE8\u610F\u4E8B\u9879 1)NIO\u4E2D\u7684 ServerSocketChannel\u529F\u80FD\u7C7B\u4F3CServerSocket\uFF0CSocketChannel\u529F\u80FD\u7C7B\u4F3CSocket 2)selector \u76F8\u5173\u65B9\u6CD5\u8BF4\u660E</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u963B\u585E</span>
selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u963B\u585E1000\u6BEB\u79D2\uFF0C\u57281000\u6BEB\u79D2\u540E\u8FD4\u56DE</span>
selector<span class="token punctuation">.</span><span class="token function">wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5524\u9192selector</span>
selector<span class="token punctuation">.</span><span class="token function">selectNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4E0D\u963B\u585E\uFF0C\u7ACB\u9A6C\u8FD4\u8FD8</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_3-7-nio\u975E\u963B\u585E\u7F51\u7EDC\u7F16\u7A0B" tabindex="-1"><a class="header-anchor" href="#_3-7-nio\u975E\u963B\u585E\u7F51\u7EDC\u7F16\u7A0B" aria-hidden="true">#</a> 3.7 NIO\u975E\u963B\u585E\u7F51\u7EDC\u7F16\u7A0B</h2><h3 id="_3-7-1-\u539F\u7406\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_3-7-1-\u539F\u7406\u5206\u6790" aria-hidden="true">#</a> 3.7.1 \u539F\u7406\u5206\u6790</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210823221834900.png" alt="image-20210823221834900" loading="lazy"></p><p>\u8BF4\u660E: 1)\u5F53\u5BA2\u6237\u7AEF\u8FDE\u63A5\u65F6\uFF0C\u4F1A\u901A\u8FC7ServerSocketChannel \u5F97\u5230 SocketChannel\uFF1B 2)Selector \u8FDB\u884C\u76D1\u542C select \u65B9\u6CD5, \u8FD4\u56DE\u6709\u4E8B\u4EF6\u53D1\u751F\u7684\u901A\u9053\u7684\u4E2A\u6570\uFF1B 3)\u5C06socketChannel\u6CE8\u518C\u5230Selector\u4E0A, register(Selector sel, int ops), \u4E00\u4E2Aselector\u4E0A\u53EF\u4EE5\u6CE8\u518C\u591A\u4E2ASocketChannel\uFF1B 4)\u6CE8\u518C\u540E\u8FD4\u56DE\u4E00\u4E2A SelectionKey, \u4F1A\u548C\u8BE5Selector \u5173\u8054(\u96C6\u5408)\uFF1B 5)\u8FDB\u4E00\u6B65\u5F97\u5230\u5404\u4E2A SelectionKey (\u6709\u4E8B\u4EF6\u53D1\u751F)\uFF1B 6)\u5728\u901A\u8FC7 SelectionKey \u53CD\u5411\u83B7\u53D6 SocketChannel , \u65B9\u6CD5 channel()\uFF1B 7)\u53EF\u4EE5\u901A\u8FC7 \u5F97\u5230\u7684 channel , \u5B8C\u6210\u4E1A\u52A1\u5904\u7406\u3002</p><h3 id="_3-7-2-\u5FEB\u901F\u5165\u95E8" tabindex="-1"><a class="header-anchor" href="#_3-7-2-\u5FEB\u901F\u5165\u95E8" aria-hidden="true">#</a> 3.7.2 \u5FEB\u901F\u5165\u95E8</h3><p><strong>\u6848\u4F8B\u8981\u6C42:</strong><br> 1\uFF09\u7F16\u5199\u4E00\u4E2A NIO \u5165\u95E8\u6848\u4F8B\uFF0C\u5B9E\u73B0\u670D\u52A1\u5668\u7AEF\u548C\u5BA2\u6237\u7AEF\u4E4B\u95F4\u7684\u6570\u636E\u7B80\u5355\u901A\u8BAF\uFF08\u975E\u963B\u585E\uFF09 2\uFF09\u76EE\u7684\uFF1A\u7406\u89E3NIO\u975E\u963B\u585E\u7F51\u7EDC\u7F16\u7A0B\u673A\u5236</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SelectionKey</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">Selector</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/22/9:48
 * <span class="token keyword">@description</span> NIO\u7F51\u7EDC\u7F16\u7A0B\u670D\u52A1\u7AEF
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOServerDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token comment">//\u521B\u5EFAserverSocketChannel --&gt;serverSocket</span>
        <span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u521B\u5EFAselector\u5BF9\u8C61</span>
        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u7ED1\u5B9A\u7AEF\u53E3</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u8BBE\u5B9A\u4E3A\u975E\u963B\u585E</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u5C06channel\u6CE8\u518C\u5230selector,OP_ACCEPT</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u5FAA\u73AF\u7B49\u5F85\u5BA2\u6237\u7AEF\u8FDE\u63A5</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">//\u7B49\u5F851\u79D2\uFF0C\u5982\u679C\u6CA1\u6709\u4E8B\u4EF6\u53D1\u751F\uFF0C\u5C31\u8FD4\u56DE</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u670D\u52A1\u8D77\u7B49\u5F85\u4E861\u79D2\uFF0C\u6CA1\u6709\u8FDE\u63A5....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//\u5982\u679C\u8FD4\u56DE\u7684&gt;0\uFF0C\u5C31\u83B7\u53D6\u5230\u76F8\u5E94\u7684selectionKey</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectionKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//\u901A\u8FC7selectionKey\u53CD\u5411\u83B7\u53D6channel</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iterator <span class="token operator">=</span> selectionKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//\u4F7F\u7528\u8FED\u4EE3\u5668\u904D\u5386</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token class-name">SelectionKey</span> selectionKey <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//\u6839\u636Ekey\u5BF9\u5E94\u7684\u901A\u9053\u53D1\u751F\u7684\u4E8B\u4EF6\u8FDB\u884C\u5904\u7406</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>selectionKey<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u5982\u679C\u662FOP_ACCEPT\uFF0C\u8868\u793A\u6709\u65B0\u7684\u5BA2\u6237\u7AEF\u8FDE\u63A5</span>
                    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5BA2\u6237\u7AEF\u8FDE\u63A5\u6210\u529F\uFF0C\u751F\u6210socketChannel:&quot;</span> <span class="token operator">+</span> socketChannel<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">//\u8BBE\u7F6E\u4E3A\u975E\u963B\u585E</span>
                    socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">//\u5C06channel\u6CE8\u518C\u5230selector,\u5173\u6CE8\u4E8B\u4EF6\u4E3AOP_READ\uFF0C\u540C\u65F6\u5173\u8054\u4E0A\u4E00\u4E2AByteBuffer</span>
                    socketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>selectionKey<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u5173\u6CE8OP_READ\u4E8B\u4EF6</span>
                    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> selectionKey<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">//\u83B7\u53D6\u5230\u8BE5channel\u5173\u8054\u7684buffer</span>
                    <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> selectionKey<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    socketChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;form \u5BA2\u6237\u7AEF:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">//\u624B\u52A8\u79FB\u9664selectionKey,\u9632\u6B62\u91CD\u590D\u64CD\u4F5C</span>
                iterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/22/10:13
 * <span class="token keyword">@description</span> NIO\u7F51\u7EDC\u7F16\u7A0B\u5BA2\u6237\u7AEF
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOClientDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token comment">//\u521B\u5EFAsocketChannel</span>
        <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u8BBE\u7F6E\u4E3A\u975E\u963B\u585E</span>
        socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u7ED1\u5B9A\u670D\u52A1\u5668\u5730\u5740</span>
        <span class="token class-name">InetSocketAddress</span> socketAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u8FDE\u63A5\u670D\u52A1\u5668</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>socketChannel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>socketAddress<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u8FDE\u63A5\u4E0D\u6210\u529F\uFF0C\u4E0D\u7528\u963B\u585E\uFF0C\u53EF\u4EE5\u505A\u5176\u4ED6\u4E8B</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>socketChannel<span class="token punctuation">.</span><span class="token function">finishConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u56E0\u4E3A\u8FDE\u63A5\u9700\u8981\u65F6\u95F4\uFF0C\u5BA2\u6237\u7AEF\u4E0D\u4F1A\u963B\u585E\uFF0C\u53EF\u4EE5\u505A\u5176\u4ED6\u4E8B....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//\u5982\u679C\u8FDE\u63A5\u6210\u529F\uFF0C\u5C31\u53D1\u9001\u6570\u636E</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;hello world \u6211\u7231\u4F60&quot;</span><span class="token punctuation">;</span>

        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u5C06byteBuffer\u5199\u5165\u5230\u901A\u9053</span>
        socketChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="_3-7-3-selectionkey" tabindex="-1"><a class="header-anchor" href="#_3-7-3-selectionkey" aria-hidden="true">#</a> 3.7.3 SelectionKey</h3><p>1\uFF09SelectionKey\uFF0C\u8868\u793A Selector \u548C\u7F51\u7EDC\u901A\u9053\u7684\u6CE8\u518C\u5173\u7CFB, \u5171\u56DB\u79CD: int OP_ACCEPT\uFF1A\u6709\u65B0\u7684\u7F51\u7EDC\u8FDE\u63A5\u53EF\u4EE5 accept\uFF0C\u503C\u4E3A 16 int OP_CONNECT\uFF1A\u4EE3\u8868\u8FDE\u63A5\u5DF2\u7ECF\u5EFA\u7ACB\uFF0C\u503C\u4E3A 8 int OP_READ\uFF1A\u4EE3\u8868\u8BFB\u64CD\u4F5C\uFF0C\u503C\u4E3A 1 int OP_WRITE\uFF1A\u4EE3\u8868\u5199\u64CD\u4F5C\uFF0C\u503C\u4E3A 4 \u6E90\u7801\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_READ <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_WRITE <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_CONNECT <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_ACCEPT <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2\uFF09SelectionKey\u76F8\u5173\u65B9\u6CD5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SelectionKey</span> <span class="token punctuation">{</span>
     <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Selector</span> <span class="token function">selector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5F97\u5230\u4E0E\u4E4B\u5173\u8054\u7684 Selector \u5BF9\u8C61</span>
     <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">SelectableChannel</span> <span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5F97\u5230\u4E0E\u4E4B\u5173\u8054\u7684\u901A\u9053</span>
     <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> <span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5F97\u5230\u4E0E\u4E4B\u5173\u8054\u7684\u5171\u4EAB\u6570\u636E</span>
     <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">SelectionKey</span> <span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token keyword">int</span> ops<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8BBE\u7F6E\u6216\u6539\u53D8\u76D1\u542C\u4E8B\u4EF6</span>
     <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u662F\u5426\u53EF\u4EE5 accept</span>
     <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u662F\u5426\u53EF\u4EE5\u8BFB</span>
     <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u662F\u5426\u53EF\u4EE5\u5199</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210823222330092.png" alt="image-20210823222330092" style="zoom:80%;"><h3 id="_3-7-4-serversocketchannel" tabindex="-1"><a class="header-anchor" href="#_3-7-4-serversocketchannel" aria-hidden="true">#</a> 3.7.4 ServerSocketChannel</h3><p>1\uFF09ServerSocketChannel \u5728\u670D\u52A1\u5668\u7AEF\u76D1\u542C\u65B0\u7684\u5BA2\u6237\u7AEF Socket \u8FDE\u63A5\uFF1B 2\uFF09\u76F8\u5173\u65B9\u6CD5\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ServerSocketChannel</span>\v    <span class="token keyword">extends</span> <span class="token class-name">AbstractSelectableChannel</span>\v    <span class="token keyword">implements</span> <span class="token class-name">NetworkChannel</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ServerSocketChannel</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\uFF0C\u5F97\u5230\u4E00\u4E2A <span class="token class-name">ServerSocketChannel</span> \u901A\u9053
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ServerSocketChannel</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> local<span class="token punctuation">)</span>\uFF0C\u8BBE\u7F6E\u670D\u52A1\u5668\u7AEF\u7AEF\u53E3\u53F7
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">SelectableChannel</span> <span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> block<span class="token punctuation">)</span>\uFF0C\u8BBE\u7F6E\u963B\u585E\u6216\u975E\u963B\u585E\u6A21\u5F0F\uFF0C\u53D6\u503C <span class="token boolean">false</span> \u8868\u793A\u91C7\u7528\u975E\u963B\u585E\u6A21\u5F0F
    <span class="token keyword">public</span> <span class="token class-name">SocketChannel</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\uFF0C\u63A5\u53D7\u4E00\u4E2A\u8FDE\u63A5\uFF0C\u8FD4\u56DE\u4EE3\u8868\u8FD9\u4E2A\u8FDE\u63A5\u7684\u901A\u9053\u5BF9\u8C61
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">SelectionKey</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> sel<span class="token punctuation">,</span> <span class="token keyword">int</span> ops<span class="token punctuation">)</span>\uFF0C\u6CE8\u518C\u4E00\u4E2A\u9009\u62E9\u5668\u5E76\u8BBE\u7F6E\u76D1\u542C\u4E8B\u4EF6
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210823222440346.png" alt="image-20210823222440346"><h3 id="_3-7-5-socketchannel" tabindex="-1"><a class="header-anchor" href="#_3-7-5-socketchannel" aria-hidden="true">#</a> 3.7.5 SocketChannel</h3><p>1\uFF09SocketChannel\uFF0C\u7F51\u7EDC IO \u901A\u9053\uFF0C\u5177\u4F53\u8D1F\u8D23\u8FDB\u884C\u8BFB\u5199\u64CD\u4F5C\uFF0CNIO \u628A\u7F13\u51B2\u533A\u7684\u6570\u636E\u5199\u5165\u901A\u9053\uFF0C\u6216\u8005\u628A\u901A\u9053\u91CC\u7684\u6570\u636E\u8BFB\u5230\u7F13\u51B2\u533A\uFF1B 2\uFF09\u76F8\u5173\u65B9\u6CD5\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SocketChannel</span>\v    <span class="token keyword">extends</span> <span class="token class-name">AbstractSelectableChannel</span>\v    <span class="token keyword">implements</span> <span class="token class-name">ByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">ScatteringByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">GatheringByteChannel</span><span class="token punctuation">,</span> <span class="token class-name">NetworkChannel</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SocketChannel</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5F97\u5230\u4E00\u4E2A SocketChannel \u901A\u9053</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">SelectableChannel</span> <span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> block<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8BBE\u7F6E\u963B\u585E\u6216\u975E\u963B\u585E\u6A21\u5F0F\uFF0C\u53D6\u503C false \u8868\u793A\u91C7\u7528\u975E\u963B\u585E\u6A21\u5F0F</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">SocketAddress</span> remote<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8FDE\u63A5\u670D\u52A1\u5668</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">finishConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5982\u679C\u4E0A\u9762\u7684\u65B9\u6CD5\u8FDE\u63A5\u5931\u8D25\uFF0C\u63A5\u4E0B\u6765\u5C31\u8981\u901A\u8FC7\u8BE5\u65B9\u6CD5\u5B8C\u6210\u8FDE\u63A5\u64CD\u4F5C</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5F80\u901A\u9053\u91CC\u5199\u6570\u636E</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4ECE\u901A\u9053\u91CC\u8BFB\u6570\u636E</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">SelectionKey</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> sel<span class="token punctuation">,</span> <span class="token keyword">int</span> ops<span class="token punctuation">,</span> <span class="token class-name">Object</span> att<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u6CE8\u518C\u4E00\u4E2A\u9009\u62E9\u5668\u5E76\u8BBE\u7F6E\u76D1\u542C\u4E8B\u4EF6\uFF0C\u6700\u540E\u4E00\u4E2A\u53C2\u6570\u53EF\u4EE5\u8BBE\u7F6E\u5171\u4EAB\u6570\u636E</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5173\u95ED\u901A\u9053</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210823222554668.png" alt="image-20210823222554668" loading="lazy"></p><h3 id="_3-7-6-nio-\u7F51\u7EDC\u7F16\u7A0B\u5E94\u7528\u5B9E\u4F8B-\u7FA4\u804A\u7CFB\u7EDF" tabindex="-1"><a class="header-anchor" href="#_3-7-6-nio-\u7F51\u7EDC\u7F16\u7A0B\u5E94\u7528\u5B9E\u4F8B-\u7FA4\u804A\u7CFB\u7EDF" aria-hidden="true">#</a> 3.7.6 NIO \u7F51\u7EDC\u7F16\u7A0B\u5E94\u7528\u5B9E\u4F8B-\u7FA4\u804A\u7CFB\u7EDF</h3><p>\u5B9E\u4F8B\u8981\u6C42: 1\uFF09\u7F16\u5199\u4E00\u4E2A NIO \u7FA4\u804A\u7CFB\u7EDF\uFF0C\u5B9E\u73B0\u670D\u52A1\u5668\u7AEF\u548C\u5BA2\u6237\u7AEF\u4E4B\u95F4\u7684\u6570\u636E\u7B80\u5355\u901A\u8BAF\uFF08\u975E\u963B\u585E\uFF09\uFF1B 2\uFF09\u5B9E\u73B0\u591A\u4EBA\u7FA4\u804A\uFF1B 3\uFF09\u670D\u52A1\u5668\u7AEF\uFF1A\u53EF\u4EE5\u76D1\u6D4B\u7528\u6237\u4E0A\u7EBF\uFF0C\u79BB\u7EBF\uFF0C\u5E76\u5B9E\u73B0\u6D88\u606F\u8F6C\u53D1\u529F\u80FD\uFF1B 4\uFF09\u5BA2\u6237\u7AEF\uFF1A\u901A\u8FC7channel \u53EF\u4EE5\u65E0\u963B\u585E\u53D1\u9001\u6D88\u606F\u7ED9\u5176\u5B83\u6240\u6709\u7528\u6237\uFF0C\u540C\u65F6\u53EF\u4EE5\u63A5\u53D7\u5176\u5B83\u7528\u6237\u53D1\u9001\u7684\u6D88\u606F(\u6709\u670D\u52A1\u5668\u8F6C\u53D1\u5F97\u5230)\uFF1B 5\uFF09\u76EE\u7684\uFF1A\u8FDB\u4E00\u6B65\u7406\u89E3NIO\u975E\u963B\u585E\u7F51\u7EDC\u7F16\u7A0B\u673A\u5236\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SelectionKey</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">Selector</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/23/20:27
 * <span class="token keyword">@description</span> \u7FA4\u804A\u7CFB\u7EDF\u670D\u52A1\u7AEF
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupChatServerDemo</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u5B9A\u4E49\u5C5E\u6027
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Selector</span> selector<span class="token punctuation">;</span><span class="token comment">//\u591A\u8DEF\u590D\u7528\u9009\u62E9\u5668</span>

    <span class="token keyword">private</span> <span class="token class-name">ServerSocketChannel</span> serverSocketChannel<span class="token punctuation">;</span><span class="token comment">//serverSocketChannel</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SERVER_ADDRESS <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span><span class="token comment">//ip</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SERVER_PORT <span class="token operator">=</span> <span class="token number">7000</span><span class="token punctuation">;</span> <span class="token comment">//\u7AEF\u53E3</span>

    <span class="token comment">//\u521D\u59CB\u5316</span>
    <span class="token keyword">public</span> <span class="token class-name">GroupChatServerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//selector</span>
            selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//serverSocketChannel</span>
            serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//\u7ED1\u5B9Aip \u7AEF\u53E3\u53F7</span>
            serverSocketChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>SERVER_ADDRESS<span class="token punctuation">,</span>SERVER_PORT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//\u5F00\u542F\u975E\u963B\u585E\u6A21\u5F0F</span>
            serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//\u5C06channel\u6CE8\u518C\u5230selector</span>
            serverSocketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u5904\u7406\u76D1\u542C\u4E8B\u4EF6
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u6709\u4EF6\u4E8B\u5904\u7406</span>
                    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectionKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iterator <span class="token operator">=</span> selectionKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">SelectionKey</span> selectionKey <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>selectionKey<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">//\u63D0\u793A</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token string">&quot;]--&gt;[&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]--&gt;\u4E0A\u7EBF\u4E86...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>selectionKey<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">//\u8BFB\u53D6\u5BA2\u6237\u7AEF\u6D88\u606F</span>
                            <span class="token function">readClientMessage</span><span class="token punctuation">(</span>selectionKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        iterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\u670D\u52A1\u5668\u7B49\u5F85\u4E2D...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>


            <span class="token punctuation">}</span>


        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u8BFB\u53D6\u5BA2\u6237\u7AEF\u6D88\u606F</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readClientMessage</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span> selectionKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//\u53D6\u5230\u5173\u8054\u7684channel</span>
        <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            socketChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> selectionKey<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            socketChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span><span class="token operator">+</span> socketChannel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]--&gt;[&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]--&gt;msg:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//\u670D\u52A1\u5668\u5C06\u6D88\u606F\u5986\u53D1\u7ED9\u5176\u4ED6\u5BA2\u6237\u7AEF\uFF0C\u6CE8\u610F\u6392\u9664\u81EA\u5DF1</span>
            <span class="token function">sendMsgToOtherClients</span><span class="token punctuation">(</span>socketChannel<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u51FA\u73B0\u5F02\u5E38\uFF0C\u8BF4\u660E\u8BE5\u5BA2\u6237\u7AEF\u4E0B\u7EBF\u4E86</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span><span class="token operator">+</span> socketChannel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]--&gt;[&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]--&gt;\u4E0B\u7EBF\u4E86...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//\u53D6\u6D88\u6CE8\u518C</span>
                selectionKey<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//\u5173\u95ED\u901A\u9053</span>
                socketChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ioException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ioException<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u670D\u52A1\u5668\u8F6C\u53D1\u6D88\u606F\u7ED9\u5176\u4ED6\u5BA2\u6237\u7AEF</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsgToOtherClients</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> self<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\u670D\u52A1\u5668\u8F6C\u53D1\u6D88\u606F\u4E2D...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token comment">//\u83B7\u53D6\u6240\u6709\u6CE8\u518C\u5230selector\u4E0A\u7684socketChannel\u5E76\u6392\u9664\u81EA\u5DF1</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SelectionKey</span> key<span class="token operator">:</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Channel</span> channel <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>channel <span class="token keyword">instanceof</span> <span class="token class-name">SocketChannel</span> <span class="token operator">&amp;&amp;</span> channel <span class="token operator">!=</span> self<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> channel<span class="token punctuation">;</span>

                    <span class="token comment">//\u5C06msg\u5B58\u50A8\u5230ByteBuffer\u4E2D</span>
                    <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    socketChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GroupChatServerDemo</span> groupChatServerDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GroupChatServerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        groupChatServerDemo<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SelectionKey</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">Selector</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/08/23/21:47
 * <span class="token keyword">@description</span> \u7FA4\u804A\u7CFB\u7EDF\u5BA2\u6237\u7AEF
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupChatClientDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SERVER_IP <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SERVER_PORT <span class="token operator">=</span> <span class="token number">7000</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Selector</span> selector<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">SocketChannel</span> socketChannel<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">GroupChatClientDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            socketChannel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>SERVER_IP<span class="token punctuation">,</span> SERVER_PORT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            socketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>

            userName <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">getLocalAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userName <span class="token operator">+</span> <span class="token string">&quot;--&gt;\u6210\u529F\u4E0A\u7EBF...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//\u5BA2\u6237\u7AEF\u53D1\u9001\u6D88\u606F\u7ED9\u670D\u52A1\u7AEF</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsgToServer</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        msg <span class="token operator">=</span> userName <span class="token operator">+</span> <span class="token string">&quot;--&gt;\u8BF4:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            socketChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u5BA2\u6237\u7AEF\u63A5\u6536\u670D\u52A1\u7AEF\u53D1\u56DE\u7684\u6D88\u606F</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveMsgFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> read <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6709\u53EF\u4EE5\u7528\u7684\u901A\u9053</span>
                <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectionKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iterator <span class="token operator">=</span> selectionKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    iterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GroupChatClientDemo</span> groupChatClientDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GroupChatClientDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                groupChatClientDemo<span class="token punctuation">.</span><span class="token function">receiveMsgFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u5411server\u53D1\u9001\u6D88\u606F</span>
        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">hasNextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> next <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            groupChatClientDemo<span class="token punctuation">.</span><span class="token function">sendMsgToServer</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br></div></div><h2 id="_3-8-nio\u4E0E\u96F6\u62F7\u8D1D" tabindex="-1"><a class="header-anchor" href="#_3-8-nio\u4E0E\u96F6\u62F7\u8D1D" aria-hidden="true">#</a> 3.8 NIO\u4E0E\u96F6\u62F7\u8D1D</h2><h3 id="_3-8-1-\u96F6\u62F7\u8D1D\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_3-8-1-\u96F6\u62F7\u8D1D\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 3.8.1 \u96F6\u62F7\u8D1D\u57FA\u672C\u4ECB\u7ECD</h3><p>1)\u96F6\u62F7\u8D1D\u662F\u7F51\u7EDC\u7F16\u7A0B\u7684\u5173\u952E\uFF0C\u5F88\u591A\u6027\u80FD\u4F18\u5316\u90FD\u79BB\u4E0D\u5F00; 2)\u5728 Java \u7A0B\u5E8F\u4E2D\uFF0C\u5E38\u7528\u7684\u96F6\u62F7\u8D1D\u6709mmap(\u5185\u5B58\u6620\u5C04) \u548C sendFile\u3002\u90A3\u4E48\uFF0C\u4ED6\u4EEC\u5728 OS \u91CC\uFF0C\u5230\u5E95\u662F\u600E\u4E48\u6837\u7684\u4E00\u4E2A\u7684\u8BBE\u8BA1\uFF1F\u6211\u4EEC\u5206\u6790 mmap \u548C sendFile \u8FD9\u4E24\u4E2A\u96F6\u62F7\u8D1D; 3)\u6211\u4EEC\u8BF4\u96F6\u62F7\u8D1D\uFF0C\u662F\u4ECE\u64CD\u4F5C\u7CFB\u7EDF\u7684\u89D2\u5EA6\u6765\u8BF4\u7684\uFF0C\u56E0\u4E3A\u5185\u6838\u7F13\u51B2\u533A\u4E4B\u95F4\uFF0C\u6CA1\u6709\u6570\u636E\u662F\u91CD\u590D\u7684\uFF08\u53EA\u6709 kernel buffer \u6709\u4E00\u4EFD\u6570\u636E\uFF09; 4)\u96F6\u62F7\u8D1D\u4E0D\u4EC5\u4EC5\u5E26\u6765\u66F4\u5C11\u7684\u6570\u636E\u590D\u5236\uFF0C\u8FD8\u80FD\u5E26\u6765\u5176\u4ED6\u7684\u6027\u80FD\u4F18\u52BF\uFF0C\u4F8B\u5982\u66F4\u5C11\u7684\u4E0A\u4E0B\u6587\u5207\u6362\uFF0C\u66F4\u5C11\u7684 CPU \u7F13\u5B58\u4F2A\u5171\u4EAB\u4EE5\u53CA\u65E0 CPU \u6821\u9A8C\u548C\u8BA1\u7B97\u3002</p><h3 id="_3-8-2-\u4F20\u7EDFio\u6570\u636E\u8BFB\u5199" tabindex="-1"><a class="header-anchor" href="#_3-8-2-\u4F20\u7EDFio\u6570\u636E\u8BFB\u5199" aria-hidden="true">#</a> 3.8.2 \u4F20\u7EDFIO\u6570\u636E\u8BFB\u5199</h3><p>Java \u4F20\u7EDF IO \u548C \u7F51\u7EDC\u7F16\u7A0B:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RandomAccessFile</span> raf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
raf<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-8-3-\u4F20\u7EDFio" tabindex="-1"><a class="header-anchor" href="#_3-8-3-\u4F20\u7EDFio" aria-hidden="true">#</a> 3.8.3 \u4F20\u7EDFIO</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902182644172.png" alt="image-20210902182644172" loading="lazy"></p><p>DMA: direct memory access\u76F4\u63A5\u5185\u5B58\u62F7\u8D1D(\u4E0D\u4F7F\u7528CPU)</p><h3 id="_3-8-4-mmap-\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#_3-8-4-mmap-\u4F18\u5316" aria-hidden="true">#</a> 3.8.4 mmap \u4F18\u5316</h3><p>mmap \u901A\u8FC7\u5185\u5B58\u6620\u5C04\uFF0C\u5C06\u6587\u4EF6\u6620\u5C04\u5230\u5185\u6838\u7F13\u51B2\u533A\uFF0C\u540C\u65F6\uFF0C\u7528\u6237\u7A7A\u95F4\u53EF\u4EE5\u5171\u4EAB\u5185\u6838\u7A7A\u95F4\u7684\u6570\u636E\u3002\u8FD9\u6837\uFF0C\u5728\u8FDB\u884C\u7F51\u7EDC\u4F20\u8F93\u65F6\uFF0C\u5C31\u53EF\u4EE5\u51CF\u5C11\u5185\u6838\u7A7A\u95F4\u5230\u7528\u6237\u63A7\u4EF6\u7684\u62F7\u8D1D\u6B21\u6570\u3002</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902182844448.png" alt="image-20210902182844448" loading="lazy"></p><h3 id="_3-8-5-sendfile-\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#_3-8-5-sendfile-\u4F18\u5316" aria-hidden="true">#</a> 3.8.5 sendFile \u4F18\u5316</h3><p>1)Linux 2.1 \u7248\u672C \u63D0\u4F9B\u4E86 sendFile \u51FD\u6570\uFF0C\u5176\u57FA\u672C\u539F\u7406\u5982\u4E0B\uFF1A\u6570\u636E\u6839\u672C\u4E0D\u7ECF\u8FC7\u7528\u6237\u6001\uFF0C\u76F4\u63A5\u4ECE\u5185\u6838\u7F13\u51B2\u533A\u8FDB\u5165\u5230 Socket Buffer\uFF0C\u540C\u65F6\uFF0C\u7531\u4E8E\u548C\u7528\u6237\u6001\u5B8C\u5168\u65E0\u5173\uFF0C\u5C31\u51CF\u5C11\u4E86\u4E00\u6B21\u4E0A\u4E0B\u6587\u5207\u6362\uFF1B</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902182938161.png" alt="image-20210902182938161" loading="lazy"></p><p>2)Linux \u5728 2.4 \u7248\u672C\u4E2D\uFF0C\u505A\u4E86\u4E00\u4E9B\u4FEE\u6539\uFF0C\u907F\u514D\u4E86\u4ECE\u5185\u6838\u7F13\u51B2\u533A\u62F7\u8D1D\u5230 Socket buffer \u7684\u64CD\u4F5C\uFF0C\u76F4\u63A5\u62F7\u8D1D\u5230\u534F\u8BAE\u6808\uFF0C\u4ECE\u800C\u518D\u4E00\u6B21\u51CF\u5C11\u4E86\u6570\u636E\u62F7\u8D1D\u3002\u8FD9\u91CC\u5176\u5B9E\u6709 \u4E00\u6B21cpu \u62F7\u8D1Dkernel buffer -&gt; socket buffer\u4F46\u662F\uFF0C\u62F7\u8D1D\u7684\u4FE1\u606F\u5F88\u5C11\uFF0C\u6BD4\u5982lenght , offset , \u6D88\u8017\u4F4E\uFF0C\u53EF\u4EE5\u5FFD\u7565\u3002</p><h3 id="_3-8-6-mmap-\u548C-sendfile-\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#_3-8-6-mmap-\u548C-sendfile-\u7684\u533A\u522B" aria-hidden="true">#</a> 3.8.6 mmap \u548C sendFile \u7684\u533A\u522B</h3><p>1)mmap \u9002\u5408\u5C0F\u6570\u636E\u91CF\u8BFB\u5199\uFF0CsendFile \u9002\u5408\u5927\u6587\u4EF6\u4F20\u8F93; 2)mmap \u9700\u8981 4 \u6B21\u4E0A\u4E0B\u6587\u5207\u6362\uFF0C3 \u6B21\u6570\u636E\u62F7\u8D1D\uFF1BsendFile \u9700\u8981 3 \u6B21\u4E0A\u4E0B\u6587\u5207\u6362\uFF0C\u6700\u5C11 2 \u6B21\u6570\u636E\u62F7\u8D1D; 3)sendFile \u53EF\u4EE5\u5229\u7528 DMA \u65B9\u5F0F\uFF0C\u51CF\u5C11 CPU \u62F7\u8D1D\uFF0Cmmap \u5219\u4E0D\u80FD\uFF08\u5FC5\u987B\u4ECE\u5185\u6838\u62F7\u8D1D\u5230 Socket \u7F13\u51B2\u533A\uFF09\u3002</p><h1 id="\u7B2C4\u7AE0-java-aio\u7F16\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u7B2C4\u7AE0-java-aio\u7F16\u7A0B" aria-hidden="true">#</a> \u7B2C4\u7AE0 Java AIO\u7F16\u7A0B</h1><h2 id="_4-1-ava-aio-\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_4-1-ava-aio-\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 4.1 ava AIO \u57FA\u672C\u4ECB\u7ECD</h2><p>1)JDK 7 \u5F15\u5165\u4E86 Asynchronous I/O\uFF0C\u5373 AIO\u3002\u5728\u8FDB\u884C I/O \u7F16\u7A0B\u4E2D\uFF0C\u5E38\u7528\u5230\u4E24\u79CD\u6A21\u5F0F\uFF1AReactor\u548C Proactor\u3002Java \u7684 NIO \u5C31\u662F Reactor\uFF0C\u5F53\u6709\u4E8B\u4EF6\u89E6\u53D1\u65F6\uFF0C\u670D\u52A1\u5668\u7AEF\u5F97\u5230\u901A\u77E5\uFF0C\u8FDB\u884C\u76F8\u5E94\u7684\u5904\u7406; 2)AIO \u5373 NIO2.0\uFF0C\u53EB\u505A\u5F02\u6B65\u4E0D\u963B\u585E\u7684 IO\u3002AIO \u5F15\u5165\u5F02\u6B65\u901A\u9053\u7684\u6982\u5FF5\uFF0C\u91C7\u7528\u4E86 Proactor \u6A21\u5F0F\uFF0C\u7B80\u5316\u4E86\u7A0B\u5E8F\u7F16\u5199\uFF0C\u6709\u6548\u7684\u8BF7\u6C42\u624D\u542F\u52A8\u7EBF\u7A0B\uFF0C\u5B83\u7684\u7279\u70B9\u662F\u5148\u7531\u64CD\u4F5C\u7CFB\u7EDF\u5B8C\u6210\u540E\u624D\u901A\u77E5\u670D\u52A1\u7AEF\u7A0B\u5E8F\u542F\u52A8\u7EBF\u7A0B\u53BB\u5904\u7406\uFF0C\u4E00\u822C\u9002\u7528\u4E8E\u8FDE\u63A5\u6570\u8F83\u591A\u4E14\u8FDE\u63A5\u65F6\u95F4\u8F83\u957F\u7684\u5E94\u7528</p><p>3)\u76EE\u524D AIO \u8FD8\u6CA1\u6709\u5E7F\u6CDB\u5E94\u7528\uFF0CNetty \u4E5F\u662F\u57FA\u4E8ENIO, \u800C\u4E0D\u662FAIO\uFF0C \u56E0\u6B64\u6211\u4EEC\u5C31\u4E0D\u8BE6\u89E3AIO\u4E86\uFF0C\u6709\u5174\u8DA3\u7684\u540C\u5B66\u53EF\u4EE5\u53C2\u8003 &lt;&lt;Java\u65B0\u4E00\u4EE3\u7F51\u7EDC\u7F16\u7A0B\u6A21\u578BAIO\u539F\u7406\u53CALinux\u7CFB\u7EDFAIO\u4ECB\u7ECD&gt;&gt; http://www.52im.net/thread-306-1-1.html</p><h2 id="_4-2-bio\u3001nio\u3001aio\u5BF9\u6BD4\u8868" tabindex="-1"><a class="header-anchor" href="#_4-2-bio\u3001nio\u3001aio\u5BF9\u6BD4\u8868" aria-hidden="true">#</a> 4.2 BIO\u3001NIO\u3001AIO\u5BF9\u6BD4\u8868</h2><table><thead><tr><th></th><th><strong>BIO</strong></th><th><strong>NIO</strong></th><th><strong>AIO</strong></th></tr></thead><tbody><tr><td>IO \u6A21\u578B</td><td>\u540C\u6B65\u963B\u585E</td><td>\u540C\u6B65\u975E\u963B\u585E\uFF08\u591A\u8DEF\u590D\u7528\uFF09</td><td>\u5F02\u6B65\u975E\u963B\u585E</td></tr><tr><td>\u7F16\u7A0B\u96BE\u5EA6</td><td>\u7B80\u5355</td><td>\u590D\u6742</td><td>\u590D\u6742</td></tr><tr><td>\u53EF\u9760\u6027</td><td>\u5DEE</td><td>\u597D</td><td>\u597D</td></tr><tr><td>\u541E\u5410\u91CF</td><td>\u4F4E</td><td>\u9AD8</td><td>\u9AD8</td></tr></tbody></table><p><strong>\u4E3E\u4F8B\u8BF4\u660E</strong> 1)\u540C\u6B65\u963B\u585E\uFF1A\u5230\u7406\u53D1\u5E97\u7406\u53D1\uFF0C\u5C31\u4E00\u76F4\u7B49\u7406\u53D1\u5E08\uFF0C\u76F4\u5230\u8F6E\u5230\u81EA\u5DF1\u7406\u53D1; 2)\u540C\u6B65\u975E\u963B\u585E\uFF1A\u5230\u7406\u53D1\u5E97\u7406\u53D1\uFF0C\u53D1\u73B0\u524D\u9762\u6709\u5176\u5B83\u4EBA\u7406\u53D1\uFF0C\u7ED9\u7406\u53D1\u5E08\u8BF4\u4E0B\uFF0C\u5148\u5E72\u5176\u4ED6\u4E8B\u60C5\uFF0C\u4E00\u4F1A\u8FC7\u6765\u770B\u662F\u5426\u8F6E\u5230\u81EA\u5DF1; 3)\u5F02\u6B65\u975E\u963B\u585E\uFF1A\u7ED9\u7406\u53D1\u5E08\u6253\u7535\u8BDD\uFF0C\u8BA9\u7406\u53D1\u5E08\u4E0A\u95E8\u670D\u52A1\uFF0C\u81EA\u5DF1\u5E72\u5176\u5B83\u4E8B\u60C5\uFF0C\u7406\u53D1\u5E08\u81EA\u5DF1\u6765\u5BB6\u7ED9\u4F60\u7406\u53D1.</p><h1 id="\u7B2C5\u7AE0-netty-\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u7B2C5\u7AE0-netty-\u6982\u8FF0" aria-hidden="true">#</a> \u7B2C5\u7AE0 Netty \u6982\u8FF0</h1><h2 id="_5-1-\u539F\u751Fnio\u5B58\u5728\u7684\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_5-1-\u539F\u751Fnio\u5B58\u5728\u7684\u95EE\u9898" aria-hidden="true">#</a> 5.1 \u539F\u751FNIO\u5B58\u5728\u7684\u95EE\u9898</h2><p>1)NIO \u7684\u7C7B\u5E93\u548C API \u7E41\u6742\uFF0C\u4F7F\u7528\u9EBB\u70E6\uFF1A\u9700\u8981\u719F\u7EC3\u638C\u63E1 Selector\u3001ServerSocketChannel\u3001SocketChannel\u3001ByteBuffer \u7B49; 2)\u9700\u8981\u5177\u5907\u5176\u4ED6\u7684\u989D\u5916\u6280\u80FD\uFF1A\u8981\u719F\u6089 Java \u591A\u7EBF\u7A0B\u7F16\u7A0B\uFF0C\u56E0\u4E3A NIO \u7F16\u7A0B\u6D89\u53CA\u5230 Reactor \u6A21\u5F0F\uFF0C\u4F60\u5FC5\u987B\u5BF9\u591A\u7EBF\u7A0B\u548C\u7F51\u7EDC\u7F16\u7A0B\u975E\u5E38\u719F\u6089\uFF0C\u624D\u80FD\u7F16\u5199\u51FA\u9AD8\u8D28\u91CF\u7684 NIO \u7A0B\u5E8F; 3)\u5F00\u53D1\u5DE5\u4F5C\u91CF\u548C\u96BE\u5EA6\u90FD\u975E\u5E38\u5927\uFF1A\u4F8B\u5982\u5BA2\u6237\u7AEF\u9762\u4E34\u65AD\u8FDE\u91CD\u8FDE\u3001\u7F51\u7EDC\u95EA\u65AD\u3001\u534A\u5305\u8BFB\u5199\u3001\u5931\u8D25\u7F13\u5B58\u3001\u7F51\u7EDC\u62E5\u585E\u548C\u5F02\u5E38\u6D41\u7684\u5904\u7406\u7B49\u7B49; 4)JDK NIO \u7684 Bug\uFF1A\u4F8B\u5982\u81ED\u540D\u662D\u8457\u7684 Epoll Bug\uFF0C\u5B83\u4F1A\u5BFC\u81F4 Selector \u7A7A\u8F6E\u8BE2\uFF0C\u6700\u7EC8\u5BFC\u81F4 CPU 100%\u3002\u76F4\u5230 JDK 1.7 \u7248\u672C\u8BE5\u95EE\u9898\u4ECD\u65E7\u5B58\u5728\uFF0C\u6CA1\u6709\u88AB\u6839\u672C\u89E3\u51B3\u3002</p><h2 id="_5-2-netty\u5B98\u7F51\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_5-2-netty\u5B98\u7F51\u8BF4\u660E" aria-hidden="true">#</a> 5.2 Netty\u5B98\u7F51\u8BF4\u660E</h2><p>1)Netty \u662F\u7531 JBOSS \u63D0\u4F9B\u7684\u4E00\u4E2A Java \u5F00\u6E90\u6846\u67B6\u3002Netty \u63D0\u4F9B\u5F02\u6B65\u7684\u3001\u57FA\u4E8E\u4E8B\u4EF6\u9A71\u52A8\u7684\u7F51\u7EDC\u5E94\u7528\u7A0B\u5E8F\u6846\u67B6\uFF0C\u7528\u4EE5\u5FEB\u901F\u5F00\u53D1\u9AD8\u6027\u80FD\u3001\u9AD8\u53EF\u9760\u6027\u7684\u7F51\u7EDC IO \u7A0B\u5E8F; 2)Netty \u53EF\u4EE5\u5E2E\u52A9\u4F60\u5FEB\u901F\u3001\u7B80\u5355\u7684\u5F00\u53D1\u51FA\u4E00\u4E2A\u7F51\u7EDC\u5E94\u7528\uFF0C\u76F8\u5F53\u4E8E\u7B80\u5316\u548C\u6D41\u7A0B\u5316\u4E86 NIO \u7684\u5F00\u53D1\u8FC7\u7A0B; 3)Netty \u662F\u76EE\u524D\u6700\u6D41\u884C\u7684 NIO \u6846\u67B6\uFF0CNetty \u5728\u4E92\u8054\u7F51\u9886\u57DF\u3001\u5927\u6570\u636E\u5206\u5E03\u5F0F\u8BA1\u7B97\u9886\u57DF\u3001\u6E38\u620F\u884C\u4E1A\u3001\u901A\u4FE1\u884C\u4E1A\u7B49\u83B7\u5F97\u4E86\u5E7F\u6CDB\u7684\u5E94\u7528\uFF0C\u77E5\u540D\u7684 Elasticsearch \u3001Dubbo \u6846\u67B6\u5185\u90E8\u90FD\u91C7\u7528\u4E86 Netty\u3002</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902184211723.png" alt="image-20210902184211723" loading="lazy"></p><h2 id="_5-3-netty\u7684\u4F18\u70B9" tabindex="-1"><a class="header-anchor" href="#_5-3-netty\u7684\u4F18\u70B9" aria-hidden="true">#</a> 5.3 Netty\u7684\u4F18\u70B9</h2><p>Netty \u5BF9 JDK \u81EA\u5E26\u7684 NIO \u7684 API \u8FDB\u884C\u4E86\u5C01\u88C5\uFF0C\u89E3\u51B3\u4E86\u4E0A\u8FF0\u95EE\u9898\u3002 1)\u8BBE\u8BA1\u4F18\u96C5\uFF1A\u9002\u7528\u4E8E\u5404\u79CD\u4F20\u8F93\u7C7B\u578B\u7684\u7EDF\u4E00 API \u963B\u585E\u548C\u975E\u963B\u585E Socket\uFF1B\u57FA\u4E8E\u7075\u6D3B\u4E14\u53EF\u6269\u5C55\u7684\u4E8B\u4EF6\u6A21\u578B\uFF0C\u53EF\u4EE5\u6E05\u6670\u5730\u5206\u79BB\u5173\u6CE8\u70B9\uFF1B\u9AD8\u5EA6\u53EF\u5B9A\u5236\u7684\u7EBF\u7A0B\u6A21\u578B - \u5355\u7EBF\u7A0B\uFF0C\u4E00\u4E2A\u6216\u591A\u4E2A\u7EBF\u7A0B\u6C60; 2)\u4F7F\u7528\u65B9\u4FBF\uFF1A\u8BE6\u7EC6\u8BB0\u5F55\u7684 Javadoc\uFF0C\u7528\u6237\u6307\u5357\u548C\u793A\u4F8B\uFF1B\u6CA1\u6709\u5176\u4ED6\u4F9D\u8D56\u9879\uFF0CJDK 5\uFF08Netty 3.x\uFF09\u6216 6\uFF08Netty 4.x\uFF09\u5C31\u8DB3\u591F\u4E86\u3002 \u9AD8\u6027\u80FD\u3001\u541E\u5410\u91CF\u66F4\u9AD8\uFF1A\u5EF6\u8FDF\u66F4\u4F4E\uFF1B\u51CF\u5C11\u8D44\u6E90\u6D88\u8017\uFF1B\u6700\u5C0F\u5316\u4E0D\u5FC5\u8981\u7684\u5185\u5B58\u590D\u5236; 3)\u5B89\u5168\uFF1A\u5B8C\u6574\u7684 SSL/TLS \u548C StartTLS \u652F\u6301; 4)\u793E\u533A\u6D3B\u8DC3\u3001\u4E0D\u65AD\u66F4\u65B0\uFF1A\u793E\u533A\u6D3B\u8DC3\uFF0C\u7248\u672C\u8FED\u4EE3\u5468\u671F\u77ED\uFF0C\u53D1\u73B0\u7684 Bug \u53EF\u4EE5\u88AB\u53CA\u65F6\u4FEE\u590D\uFF0C\u540C\u65F6\uFF0C\u66F4\u591A\u7684\u65B0\u529F\u80FD\u4F1A\u88AB\u52A0\u5165\u3002</p><h1 id="\u7B2C6\u7AE0-netty-\u9AD8\u6027\u80FD\u67B6\u6784\u8BBE\u8BA1" tabindex="-1"><a class="header-anchor" href="#\u7B2C6\u7AE0-netty-\u9AD8\u6027\u80FD\u67B6\u6784\u8BBE\u8BA1" aria-hidden="true">#</a> \u7B2C6\u7AE0 Netty \u9AD8\u6027\u80FD\u67B6\u6784\u8BBE\u8BA1</h1><h2 id="_6-1-\u7EBF\u7A0B\u6A21\u578B\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_6-1-\u7EBF\u7A0B\u6A21\u578B\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 6.1 \u7EBF\u7A0B\u6A21\u578B\u57FA\u672C\u4ECB\u7ECD</h2><p>1)\u4E0D\u540C\u7684\u7EBF\u7A0B\u6A21\u5F0F\uFF0C\u5BF9\u7A0B\u5E8F\u7684\u6027\u80FD\u6709\u5F88\u5927\u5F71\u54CD\uFF0C\u4E3A\u4E86\u641E\u6E05Netty \u7EBF\u7A0B\u6A21\u5F0F\uFF0C\u6211\u4EEC\u6765\u7CFB\u7EDF\u7684\u8BB2\u89E3\u4E0B \u5404\u4E2A\u7EBF\u7A0B\u6A21\u5F0F\uFF0C \u6700\u540E\u770B\u770BNetty \u7EBF\u7A0B\u6A21\u578B\u6709\u4EC0\u4E48\u4F18\u8D8A\u6027; 2)\u76EE\u524D\u5B58\u5728\u7684\u7EBF\u7A0B\u6A21\u578B\u6709\uFF1A\u4F20\u7EDF\u963B\u585E I/O \u670D\u52A1\u6A21\u578B Reactor \u6A21\u5F0F; 3)\u6839\u636E Reactor \u7684\u6570\u91CF\u548C\u5904\u7406\u8D44\u6E90\u6C60\u7EBF\u7A0B\u7684\u6570\u91CF\u4E0D\u540C\uFF0C\u6709 3 \u79CD\u5178\u578B\u7684\u5B9E\u73B0 \u5355 Reactor \u5355\u7EBF\u7A0B \u5355 Reactor \u591A\u7EBF\u7A0B \u4E3B\u4ECE Reactor \u591A\u7EBF\u7A0B 4)Netty \u7EBF\u7A0B\u6A21\u5F0F(Netty \u4E3B\u8981\u57FA\u4E8E\u4E3B\u4ECE Reactor \u591A\u7EBF\u7A0B\u6A21\u578B\u505A\u4E86\u4E00\u5B9A\u7684\u6539\u8FDB\uFF0C\u5176\u4E2D\u4E3B\u4ECE Reactor \u591A\u7EBF\u7A0B\u6A21\u578B\u6709\u591A\u4E2A Reactor)</p><h2 id="_6-2-\u4F20\u7EDF\u963B\u585E-i-o-\u670D\u52A1\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_6-2-\u4F20\u7EDF\u963B\u585E-i-o-\u670D\u52A1\u6A21\u578B" aria-hidden="true">#</a> 6.2 \u4F20\u7EDF\u963B\u585E I/O \u670D\u52A1\u6A21\u578B</h2><h3 id="_6-2-1\u5DE5\u4F5C\u539F\u7406\u56FE" tabindex="-1"><a class="header-anchor" href="#_6-2-1\u5DE5\u4F5C\u539F\u7406\u56FE" aria-hidden="true">#</a> 6.2.1\u5DE5\u4F5C\u539F\u7406\u56FE</h3><p>\u9EC4\u8272\u7684\u6846\u8868\u793A\u5BF9\u8C61\uFF0C \u84DD\u8272\u7684\u6846\u8868\u793A\u7EBF\u7A0B\uFF0C\u767D\u8272\u7684\u6846\u8868\u793A\u65B9\u6CD5(API)</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902184659396.png" alt="image-20210902184659396" loading="lazy"></p><h3 id="_6-2-2-\u6A21\u578B\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#_6-2-2-\u6A21\u578B\u7279\u70B9" aria-hidden="true">#</a> 6.2.2 \u6A21\u578B\u7279\u70B9</h3><p>1)\u91C7\u7528\u963B\u585EIO\u6A21\u5F0F\u83B7\u53D6\u8F93\u5165\u7684\u6570\u636E; 2_\u6BCF\u4E2A\u8FDE\u63A5\u90FD\u9700\u8981\u72EC\u7ACB\u7684\u7EBF\u7A0B\u5B8C\u6210\u6570\u636E\u7684\u8F93\u5165\uFF0C\u4E1A\u52A1\u5904\u7406,\u6570\u636E\u8FD4\u56DE\u3002</p><h3 id="_6-2-3-\u95EE\u9898\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_6-2-3-\u95EE\u9898\u5206\u6790" aria-hidden="true">#</a> 6.2.3 \u95EE\u9898\u5206\u6790</h3><p>1)\u5F53\u5E76\u53D1\u6570\u5F88\u5927\uFF0C\u5C31\u4F1A\u521B\u5EFA\u5927\u91CF\u7684\u7EBF\u7A0B\uFF0C\u5360\u7528\u5F88\u5927\u7CFB\u7EDF\u8D44\u6E90; 2)\u8FDE\u63A5\u521B\u5EFA\u540E\uFF0C\u5982\u679C\u5F53\u524D\u7EBF\u7A0B\u6682\u65F6\u6CA1\u6709\u6570\u636E\u53EF\u8BFB\uFF0C\u8BE5\u7EBF\u7A0B\u4F1A\u963B\u585E\u5728read \u64CD\u4F5C\uFF0C\u9020\u6210\u7EBF\u7A0B\u8D44\u6E90\u6D6A\u8D39\u3002</p><h2 id="_6-3-reactor-\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_6-3-reactor-\u6A21\u5F0F" aria-hidden="true">#</a> 6.3 Reactor \u6A21\u5F0F</h2><h3 id="_6-3-1-\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_6-3-1-\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 6.3.1 \u89E3\u51B3\u65B9\u6848</h3><p>1)\u57FA\u4E8E I/O \u590D\u7528\u6A21\u578B\uFF1A\u591A\u4E2A\u8FDE\u63A5\u5171\u7528\u4E00\u4E2A\u963B\u585E\u5BF9\u8C61\uFF0C\u5E94\u7528\u7A0B\u5E8F\u53EA\u9700\u8981\u5728\u4E00\u4E2A\u963B\u585E\u5BF9\u8C61\u7B49\u5F85\uFF0C\u65E0\u9700\u963B\u585E\u7B49\u5F85\u6240\u6709\u8FDE\u63A5\u3002\u5F53\u67D0\u4E2A\u8FDE\u63A5\u6709\u65B0\u7684\u6570\u636E\u53EF\u4EE5\u5904\u7406\u65F6\uFF0C\u64CD\u4F5C\u7CFB\u7EDF\u901A\u77E5\u5E94\u7528\u7A0B\u5E8F\uFF0C\u7EBF\u7A0B\u4ECE\u963B\u585E\u72B6\u6001\u8FD4\u56DE\uFF0C\u5F00\u59CB\u8FDB\u884C\u4E1A\u52A1\u5904\u7406\vReactor \u5BF9\u5E94\u7684\u53EB\u6CD5: 1. \u53CD\u5E94\u5668\u6A21\u5F0F 2. \u5206\u53D1\u8005\u6A21\u5F0F(Dispatcher) 3. \u901A\u77E5\u8005\u6A21\u5F0F(notifier)\uFF1B 2)\u57FA\u4E8E\u7EBF\u7A0B\u6C60\u590D\u7528\u7EBF\u7A0B\u8D44\u6E90\uFF1A\u4E0D\u5FC5\u518D\u4E3A\u6BCF\u4E2A\u8FDE\u63A5\u521B\u5EFA\u7EBF\u7A0B\uFF0C\u5C06\u8FDE\u63A5\u5B8C\u6210\u540E\u7684\u4E1A\u52A1\u5904\u7406\u4EFB\u52A1\u5206\u914D\u7ED9\u7EBF\u7A0B\u8FDB\u884C\u5904\u7406\uFF0C\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u5904\u7406\u591A\u4E2A\u8FDE\u63A5\u7684\u4E1A\u52A1\u3002</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902185122844.png" alt="image-20210902185122844" loading="lazy"></p><h3 id="_6-3-2-\u6A21\u5F0F\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_6-3-2-\u6A21\u5F0F\u8BF4\u660E" aria-hidden="true">#</a> 6.3.2 \u6A21\u5F0F\u8BF4\u660E</h3><p>I/O \u590D\u7528\u7ED3\u5408\u7EBF\u7A0B\u6C60\uFF0C\u5C31\u662F Reactor \u6A21\u5F0F\u57FA\u672C\u8BBE\u8BA1\u601D\u60F3\u3002</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902185222587.png" alt="image-20210902185222587" loading="lazy"></p><p>\u8BF4\u660E: 1)Reactor \u6A21\u5F0F\uFF0C\u901A\u8FC7\u4E00\u4E2A\u6216\u591A\u4E2A\u8F93\u5165\u540C\u65F6\u4F20\u9012\u7ED9\u670D\u52A1\u5904\u7406\u5668\u7684\u6A21\u5F0F(\u57FA\u4E8E\u4E8B\u4EF6\u9A71\u52A8); 3)\u670D\u52A1\u5668\u7AEF\u7A0B\u5E8F\u5904\u7406\u4F20\u5165\u7684\u591A\u4E2A\u8BF7\u6C42,\u5E76\u5C06\u5B83\u4EEC\u540C\u6B65\u5206\u6D3E\u5230\u76F8\u5E94\u7684\u5904\u7406\u7EBF\u7A0B\uFF0C \u56E0\u6B64Reactor\u6A21\u5F0F\u4E5F\u53EB Dispatcher\u6A21\u5F0F; 3)Reactor \u6A21\u5F0F\u4F7F\u7528IO\u590D\u7528\u76D1\u542C\u4E8B\u4EF6, \u6536\u5230\u4E8B\u4EF6\u540E\uFF0C\u5206\u53D1\u7ED9\u67D0\u4E2A\u7EBF\u7A0B(\u8FDB\u7A0B), \u8FD9\u70B9\u5C31\u662F\u7F51\u7EDC\u670D\u52A1\u5668\u9AD8\u5E76\u53D1\u5904\u7406\u5173\u952E\u3002</p><h3 id="_6-3-3-\u6838\u5FC3\u7EC4\u6210" tabindex="-1"><a class="header-anchor" href="#_6-3-3-\u6838\u5FC3\u7EC4\u6210" aria-hidden="true">#</a> 6.3.3 \u6838\u5FC3\u7EC4\u6210</h3><p>1)Reactor\uFF1AReactor \u5728\u4E00\u4E2A\u5355\u72EC\u7684\u7EBF\u7A0B\u4E2D\u8FD0\u884C\uFF0C\u8D1F\u8D23\u76D1\u542C\u548C\u5206\u53D1\u4E8B\u4EF6\uFF0C\u5206\u53D1\u7ED9\u9002\u5F53\u7684\u5904\u7406\u7A0B\u5E8F\u6765\u5BF9 IO \u4E8B\u4EF6\u505A\u51FA\u53CD\u5E94\u3002 \u5B83\u5C31\u50CF\u516C\u53F8\u7684\u7535\u8BDD\u63A5\u7EBF\u5458\uFF0C\u5B83\u63A5\u542C\u6765\u81EA\u5BA2\u6237\u7684\u7535\u8BDD\u5E76\u5C06\u7EBF\u8DEF\u8F6C\u79FB\u5230\u9002\u5F53\u7684\u8054\u7CFB\u4EBA\uFF1B 2)Handlers\uFF1A\u5904\u7406\u7A0B\u5E8F\u6267\u884C I/O \u4E8B\u4EF6\u8981\u5B8C\u6210\u7684\u5B9E\u9645\u4E8B\u4EF6\uFF0C\u7C7B\u4F3C\u4E8E\u5BA2\u6237\u60F3\u8981\u4E0E\u4E4B\u4EA4\u8C08\u7684\u516C\u53F8\u4E2D\u7684\u5B9E\u9645\u5B98\u5458\u3002Reactor \u901A\u8FC7\u8C03\u5EA6\u9002\u5F53\u7684\u5904\u7406\u7A0B\u5E8F\u6765\u54CD\u5E94 I/O \u4E8B\u4EF6\uFF0C\u5904\u7406\u7A0B\u5E8F\u6267\u884C\u975E\u963B\u585E\u64CD\u4F5C\u3002</p><h3 id="_6-3-4-\u6A21\u5F0F\u5206\u7C7B" tabindex="-1"><a class="header-anchor" href="#_6-3-4-\u6A21\u5F0F\u5206\u7C7B" aria-hidden="true">#</a> 6.3.4 \u6A21\u5F0F\u5206\u7C7B</h3><p>1)\u5355 Reactor \u5355\u7EBF\u7A0B; 2)\u5355 Reactor \u591A\u7EBF\u7A0B; 3)\u4E3B\u4ECE Reactor \u591A\u7EBF\u7A0B\u3002</p><h3 id="_6-3-5-\u5355-reactor-\u5355\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_6-3-5-\u5355-reactor-\u5355\u7EBF\u7A0B" aria-hidden="true">#</a> 6.3.5 \u5355 Reactor \u5355\u7EBF\u7A0B</h3><h4 id="_6-3-5-1-\u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE" tabindex="-1"><a class="header-anchor" href="#_6-3-5-1-\u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE" aria-hidden="true">#</a> 6.3.5.1 \u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE</h4><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902185609854.png" alt="image-20210902185609854" loading="lazy"></p><h4 id="_6-3-5-2-\u65B9\u6848\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_6-3-5-2-\u65B9\u6848\u8BF4\u660E" aria-hidden="true">#</a> 6.3.5.2 \u65B9\u6848\u8BF4\u660E</h4><p>1)Select \u662F\u524D\u9762 I/O \u590D\u7528\u6A21\u578B\u4ECB\u7ECD\u7684\u6807\u51C6\u7F51\u7EDC\u7F16\u7A0B API\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u5E94\u7528\u7A0B\u5E8F\u901A\u8FC7\u4E00\u4E2A\u963B\u585E\u5BF9\u8C61\u76D1\u542C\u591A\u8DEF\u8FDE\u63A5\u8BF7\u6C42; 2)Reactor \u5BF9\u8C61\u901A\u8FC7 Select \u76D1\u63A7\u5BA2\u6237\u7AEF\u8BF7\u6C42\u4E8B\u4EF6\uFF0C\u6536\u5230\u4E8B\u4EF6\u540E\u901A\u8FC7 Dispatch \u8FDB\u884C\u5206\u53D1; 3)\u5982\u679C\u662F\u5EFA\u7ACB\u8FDE\u63A5\u8BF7\u6C42\u4E8B\u4EF6\uFF0C\u5219\u7531 Acceptor \u901A\u8FC7 Accept \u5904\u7406\u8FDE\u63A5\u8BF7\u6C42\uFF0C\u7136\u540E\u521B\u5EFA\u4E00\u4E2A Handler \u5BF9\u8C61\u5904\u7406\u8FDE\u63A5\u5B8C\u6210\u540E\u7684\u540E\u7EED\u4E1A\u52A1\u5904\u7406; 4)\u5982\u679C\u4E0D\u662F\u5EFA\u7ACB\u8FDE\u63A5\u4E8B\u4EF6\uFF0C\u5219 Reactor \u4F1A\u5206\u53D1\u8C03\u7528\u8FDE\u63A5\u5BF9\u5E94\u7684 Handler \u6765\u54CD\u5E94; 5)Handler \u4F1A\u5B8C\u6210 Read\u2192\u4E1A\u52A1\u5904\u7406\u2192Send \u7684\u5B8C\u6574\u4E1A\u52A1\u6D41\u7A0B\u3002 **\u7ED3\u5408\u5B9E\u4F8B\uFF1A**\u670D\u52A1\u5668\u7AEF\u7528\u4E00\u4E2A\u7EBF\u7A0B\u901A\u8FC7\u591A\u8DEF\u590D\u7528\u641E\u5B9A\u6240\u6709\u7684 IO \u64CD\u4F5C\uFF08\u5305\u62EC\u8FDE\u63A5\uFF0C\u8BFB\u3001\u5199\u7B49\uFF09\uFF0C\u7F16\u7801\u7B80\u5355\uFF0C\u6E05\u6670\u660E\u4E86\uFF0C\u4F46\u662F\u5982\u679C\u5BA2\u6237\u7AEF\u8FDE\u63A5\u6570\u91CF\u8F83\u591A\uFF0C\u5C06\u65E0\u6CD5\u652F\u6491\uFF0C\u524D\u9762\u7684 NIO \u6848\u4F8B\u5C31\u5C5E\u4E8E\u8FD9\u79CD\u6A21\u578B\u3002</p><h4 id="_6-3-5-3-\u65B9\u6848\u4F18\u7F3A\u70B9\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_6-3-5-3-\u65B9\u6848\u4F18\u7F3A\u70B9\u5206\u6790" aria-hidden="true">#</a> 6.3.5.3 \u65B9\u6848\u4F18\u7F3A\u70B9\u5206\u6790</h4><p>1)**\u4F18\u70B9\uFF1A**\u6A21\u578B\u7B80\u5355\uFF0C\u6CA1\u6709\u591A\u7EBF\u7A0B\u3001\u8FDB\u7A0B\u901A\u4FE1\u3001\u7ADE\u4E89\u7684\u95EE\u9898\uFF0C\u5168\u90E8\u90FD\u5728\u4E00\u4E2A\u7EBF\u7A0B\u4E2D\u5B8C\u6210 2)**\u7F3A\u70B9\uFF1A**\u6027\u80FD\u95EE\u9898\uFF0C\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u65E0\u6CD5\u5B8C\u5168\u53D1\u6325\u591A\u6838 CPU \u7684\u6027\u80FD\u3002Handler \u5728\u5904\u7406\u67D0\u4E2A\u8FDE\u63A5\u4E0A\u7684\u4E1A\u52A1\u65F6\uFF0C\u6574\u4E2A\u8FDB\u7A0B\u65E0\u6CD5\u5904\u7406\u5176\u4ED6\u8FDE\u63A5\u4E8B\u4EF6\uFF0C\u5F88\u5BB9\u6613\u5BFC\u81F4\u6027\u80FD\u74F6\u9888 3)**\u7F3A\u70B9\uFF1A**\u53EF\u9760\u6027\u95EE\u9898\uFF0C\u7EBF\u7A0B\u610F\u5916\u7EC8\u6B62\uFF0C\u6216\u8005\u8FDB\u5165\u6B7B\u5FAA\u73AF\uFF0C\u4F1A\u5BFC\u81F4\u6574\u4E2A\u7CFB\u7EDF\u901A\u4FE1\u6A21\u5757\u4E0D\u53EF\u7528\uFF0C\u4E0D\u80FD\u63A5\u6536\u548C\u5904\u7406\u5916\u90E8\u6D88\u606F\uFF0C\u9020\u6210\u8282\u70B9\u6545\u969C 4)<strong>\u4F7F\u7528\u573A\u666F</strong>\uFF1A\u5BA2\u6237\u7AEF\u7684\u6570\u91CF\u6709\u9650\uFF0C\u4E1A\u52A1\u5904\u7406\u975E\u5E38\u5FEB\u901F\uFF0C\u6BD4\u5982 Redis\u5728\u4E1A\u52A1\u5904\u7406\u7684\u65F6\u95F4\u590D\u6742\u5EA6 O(1) \u7684\u60C5\u51B5</p><h3 id="_6-3-6-\u5355reactor\u591A\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_6-3-6-\u5355reactor\u591A\u7EBF\u7A0B" aria-hidden="true">#</a> 6.3.6 \u5355Reactor\u591A\u7EBF\u7A0B</h3><h4 id="_6-3-6-1-\u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE" tabindex="-1"><a class="header-anchor" href="#_6-3-6-1-\u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE" aria-hidden="true">#</a> 6.3.6.1 \u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE</h4><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902185853080.png" alt="image-20210902185853080" loading="lazy"></p><h4 id="_6-3-6-2-\u65B9\u6848\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_6-3-6-2-\u65B9\u6848\u8BF4\u660E" aria-hidden="true">#</a> 6.3.6.2 \u65B9\u6848\u8BF4\u660E</h4><p>1)Reactor \u5BF9\u8C61\u901A\u8FC7select \u76D1\u63A7\u5BA2\u6237\u7AEF\u8BF7\u6C42\v\u4E8B\u4EF6, \u6536\u5230\u4E8B\u4EF6\u540E\uFF0C\u901A\u8FC7dispatch\u8FDB\u884C\u5206\u53D1; 2)\u5982\u679C\u5EFA\u7ACB\u8FDE\u63A5\u8BF7\u6C42, \u5219\u53F3Acceptor \u901A\u8FC7\vaccept \u5904\u7406\u8FDE\u63A5\u8BF7\u6C42, \u7136\u540E\u521B\u5EFA\u4E00\u4E2AHandler\u5BF9\u8C61\u5904\u7406\u5B8C\u6210\u8FDE\u63A5\u540E\u7684\u5404\u79CD\u4E8B\u4EF6; 3)\u5982\u679C\u4E0D\u662F\u8FDE\u63A5\u8BF7\u6C42\uFF0C\u5219\u7531reactor\u5206\u53D1\u8C03\u7528\u8FDE\u63A5\u5BF9\u5E94\u7684handler \u6765\u5904\u7406; 4)handler \u53EA\u8D1F\u8D23\u54CD\u5E94\u4E8B\u4EF6\uFF0C\u4E0D\u505A\u5177\u4F53\u7684\u4E1A\u52A1\u5904\u7406, \u901A\u8FC7read \u8BFB\u53D6\u6570\u636E\u540E\uFF0C\u4F1A\u5206\u53D1\u7ED9\u540E\u9762\u7684worker\u7EBF\u7A0B\u6C60\u7684\u67D0\u4E2A\u7EBF\u7A0B\u5904\u7406\u4E1A\u52A1; 4)worker \u7EBF\u7A0B\u6C60\u4F1A\u5206\u914D\u72EC\u7ACB\u7EBF\u7A0B\u5B8C\u6210\u771F\u6B63\u7684\u4E1A\u52A1\uFF0C\u5E76\u5C06\u7ED3\u679C\u8FD4\u56DE\u7ED9handler; 6)handler\u6536\u5230\u54CD\u5E94\u540E\uFF0C\u901A\u8FC7send \u5C06\u7ED3\u679C\u8FD4\u56DE\u7ED9client\u3002</p><h4 id="_6-3-6-3-\u65B9\u6848\u4F18\u7F3A\u70B9\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_6-3-6-3-\u65B9\u6848\u4F18\u7F3A\u70B9\u5206\u6790" aria-hidden="true">#</a> 6.3.6.3 \u65B9\u6848\u4F18\u7F3A\u70B9\u5206\u6790</h4><p>1)**\u4F18\u70B9\uFF1A**\u53EF\u4EE5\u5145\u5206\u7684\u5229\u7528\u591A\u6838cpu \u7684\u5904\u7406\u80FD\u529B; 2)**\u7F3A\u70B9\uFF1A**\u591A\u7EBF\u7A0B\u6570\u636E\u5171\u4EAB\u548C\u8BBF\u95EE\u6BD4\u8F83\u590D\u6742\uFF0C reactor \u5904\u7406\u6240\u6709\u7684\u4E8B\u4EF6\u7684\u76D1\u542C\u548C\u54CD\u5E94\uFF0C\u5728\u5355\u7EBF\u7A0B\u8FD0\u884C\uFF0C \u5728\u9AD8\u5E76\u53D1\u573A\u666F\u5BB9\u6613\u51FA\u73B0\u6027\u80FD\u74F6\u9888\u3002</p><h3 id="_6-3-7-\u4E3B\u4ECE-reactor-\u591A\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_6-3-7-\u4E3B\u4ECE-reactor-\u591A\u7EBF\u7A0B" aria-hidden="true">#</a> 6.3.7 \u4E3B\u4ECE Reactor \u591A\u7EBF\u7A0B</h3><h4 id="_6-3-7-1-\u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE" tabindex="-1"><a class="header-anchor" href="#_6-3-7-1-\u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE" aria-hidden="true">#</a> 6.3.7.1 \u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE</h4><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902190110862.png" alt="image-20210902190110862" loading="lazy"></p><h4 id="_6-3-7-2-\u65B9\u6848\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_6-3-7-2-\u65B9\u6848\u8BF4\u660E" aria-hidden="true">#</a> 6.3.7.2 \u65B9\u6848\u8BF4\u660E</h4><p>1)Reactor\u4E3B\u7EBF\u7A0B MainReactor \u5BF9\u8C61\u901A\u8FC7select \u76D1\u542C\u8FDE\u63A5\u4E8B\u4EF6, \u6536\u5230\u4E8B\u4EF6\u540E\uFF0C\u901A\u8FC7Acceptor \u5904\u7406\u8FDE\u63A5\u4E8B\u4EF6; 2)\u5F53 Acceptor \u5904\u7406\u8FDE\u63A5\u4E8B\u4EF6\u540E\uFF0CMainReactor \u5C06\u8FDE\u63A5\u5206\u914D\u7ED9SubReactor ; 3)subreactor \u5C06\u8FDE\u63A5\u52A0\u5165\u5230\u8FDE\u63A5\u961F\u5217\u8FDB\u884C\u76D1\u542C,\u5E76\u521B\u5EFAhandler\u8FDB\u884C\u5404\u79CD\u4E8B\u4EF6\u5904\u7406; 4)\u5F53\u6709\u65B0\u4E8B\u4EF6\u53D1\u751F\u65F6\uFF0C subreactor \u5C31\u4F1A\u8C03\u7528\u5BF9\u5E94\u7684handler\u5904\u7406; 5)handler \u901A\u8FC7read \u8BFB\u53D6\u6570\u636E\uFF0C\u5206\u53D1\u7ED9\u540E\u9762\u7684worker \u7EBF\u7A0B\u5904\u7406; 6)worker \u7EBF\u7A0B\u6C60\u5206\u914D\u72EC\u7ACB\u7684worker \u7EBF\u7A0B\u8FDB\u884C\u4E1A\u52A1\u5904\u7406\uFF0C\u5E76\u8FD4\u56DE\u7ED3\u679C; 7)handler \u6536\u5230\u54CD\u5E94\u7684\u7ED3\u679C\u540E\uFF0C\u518D\u901A\u8FC7send \u5C06\u7ED3\u679C\u8FD4\u56DE\u7ED9client; 8)Reactor \u4E3B\u7EBF\u7A0B\u53EF\u4EE5\u5BF9\u5E94\u591A\u4E2AReactor \u5B50\u7EBF\u7A0B, \u5373MainRecator \u53EF\u4EE5\u5173\u8054\u591A\u4E2ASubReactor\u3002</p><p><strong>Scalable IO in Java \u5BF9 Multiple Reactors \u7684\u539F\u7406\u56FE\u89E3\uFF1A</strong></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902190242798.png" alt="image-20210902190242798" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210902190247890.png" alt="image-20210902190247890" loading="lazy"></p><h4 id="_6-3-7-3-\u65B9\u6848\u4F18\u7F3A\u70B9\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_6-3-7-3-\u65B9\u6848\u4F18\u7F3A\u70B9\u8BF4\u660E" aria-hidden="true">#</a> 6.3.7.3 \u65B9\u6848\u4F18\u7F3A\u70B9\u8BF4\u660E</h4><p>1)<strong>\u4F18\u70B9</strong>\uFF1A\u7236\u7EBF\u7A0B\u4E0E\u5B50\u7EBF\u7A0B\u7684\u6570\u636E\u4EA4\u4E92\u7B80\u5355\u804C\u8D23\u660E\u786E\uFF0C\u7236\u7EBF\u7A0B\u53EA\u9700\u8981\u63A5\u6536\u65B0\u8FDE\u63A5\uFF0C\u5B50\u7EBF\u7A0B\u5B8C\u6210\u540E\u7EED\u7684\u4E1A\u52A1\u5904\u7406; 2)**\u4F18\u70B9\uFF1A**\u7236\u7EBF\u7A0B\u4E0E\u5B50\u7EBF\u7A0B\u7684\u6570\u636E\u4EA4\u4E92\u7B80\u5355\uFF0CReactor \u4E3B\u7EBF\u7A0B\u53EA\u9700\u8981\u628A\u65B0\u8FDE\u63A5\u4F20\u7ED9\u5B50\u7EBF\u7A0B\uFF0C\u5B50\u7EBF\u7A0B\u65E0\u9700\u8FD4\u56DE\u6570\u636E; 3)**\u7F3A\u70B9\uFF1A**\u7F16\u7A0B\u590D\u6742\u5EA6\u8F83\u9AD8; 4)**\u7ED3\u5408\u5B9E\u4F8B\uFF1A**\u8FD9\u79CD\u6A21\u578B\u5728\u8BB8\u591A\u9879\u76EE\u4E2D\u5E7F\u6CDB\u4F7F\u7528\uFF0C\u5305\u62EC Nginx \u4E3B\u4ECE Reactor \u591A\u8FDB\u7A0B\u6A21\u578B\uFF0CMemcached \u4E3B\u4ECE\u591A\u7EBF\u7A0B\uFF0CNetty \u4E3B\u4ECE\u591A\u7EBF\u7A0B\u6A21\u578B\u7684\u652F\u6301\u3002</p><h3 id="_6-3-7-reactor-\u6A21\u5F0F\u5C0F\u7ED3" tabindex="-1"><a class="header-anchor" href="#_6-3-7-reactor-\u6A21\u5F0F\u5C0F\u7ED3" aria-hidden="true">#</a> 6.3.7 Reactor \u6A21\u5F0F\u5C0F\u7ED3</h3><p><strong>3 \u79CD\u6A21\u5F0F\u7528\u751F\u6D3B\u6848\u4F8B\u6765\u7406\u89E3</strong> 1)\u5355 Reactor \u5355\u7EBF\u7A0B\uFF0C\u524D\u53F0\u63A5\u5F85\u5458\u548C\u670D\u52A1\u5458\u662F\u540C\u4E00\u4E2A\u4EBA\uFF0C\u5168\u7A0B\u4E3A\u987E\u5BA2\u670D; 2)\u5355 Reactor \u591A\u7EBF\u7A0B\uFF0C1 \u4E2A\u524D\u53F0\u63A5\u5F85\u5458\uFF0C\u591A\u4E2A\u670D\u52A1\u5458\uFF0C\u63A5\u5F85\u5458\u53EA\u8D1F\u8D23\u63A5\u5F85; 3)\u4E3B\u4ECE Reactor \u591A\u7EBF\u7A0B\uFF0C\u591A\u4E2A\u524D\u53F0\u63A5\u5F85\u5458\uFF0C\u591A\u4E2A\u670D\u52A1\u751F\u3002</p><p><strong>Reactor \u6A21\u5F0F\u5177\u6709\u5982\u4E0B\u7684\u4F18\u70B9\uFF1A</strong> 1)\u54CD\u5E94\u5FEB\uFF0C\u4E0D\u5FC5\u4E3A\u5355\u4E2A\u540C\u6B65\u65F6\u95F4\u6240\u963B\u585E\uFF0C\u867D\u7136 Reactor \u672C\u8EAB\u4F9D\u7136\u662F\u540C\u6B65\u7684; 2)\u53EF\u4EE5\u6700\u5927\u7A0B\u5EA6\u7684\u907F\u514D\u590D\u6742\u7684\u591A\u7EBF\u7A0B\u53CA\u540C\u6B65\u95EE\u9898\uFF0C\u5E76\u4E14\u907F\u514D\u4E86\u591A\u7EBF\u7A0B/\u8FDB\u7A0B\u7684\u5207\u6362\u5F00\u9500; 3)\u6269\u5C55\u6027\u597D\uFF0C\u53EF\u4EE5\u65B9\u4FBF\u7684\u901A\u8FC7\u589E\u52A0 Reactor \u5B9E\u4F8B\u4E2A\u6570\u6765\u5145\u5206\u5229\u7528 CPU \u8D44\u6E90; 4)\u590D\u7528\u6027\u597D\uFF0CReactor \u6A21\u578B\u672C\u8EAB\u4E0E\u5177\u4F53\u4E8B\u4EF6\u5904\u7406\u903B\u8F91\u65E0\u5173\uFF0C\u5177\u6709\u5F88\u9AD8\u7684\u590D\u7528\u6027\u3002</p><h2 id="_6-4-netty\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_6-4-netty\u6A21\u578B" aria-hidden="true">#</a> 6.4 Netty\u6A21\u578B</h2><h3 id="_6-4-1-\u7B80\u5355\u7248" tabindex="-1"><a class="header-anchor" href="#_6-4-1-\u7B80\u5355\u7248" aria-hidden="true">#</a> 6.4.1 \u7B80\u5355\u7248</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210903083616976.png" alt="image-20210903083616976" loading="lazy"></p><p>1)BossGroup \u7EBF\u7A0B\u7EF4\u62A4Selector , \u53EA\u5173\u6CE8Accecpt; 2)\u5F53\u63A5\u6536\u5230Accept\u4E8B\u4EF6\uFF0C\u83B7\u53D6\u5230\u5BF9\u5E94\u7684SocketChannel, \u5C01\u88C5\u6210 NIOScoketChannel\u5E76\u6CE8\u518C\u5230Worker \u7EBF\u7A0B(\u4E8B\u4EF6\u5FAA\u73AF), \u5E76\u8FDB\u884C\u7EF4\u62A4; 3)\u5F53Worker\u7EBF\u7A0B\u76D1\u542C\u5230selector \u4E2D\u901A\u9053\u53D1\u751F\u81EA\u5DF1\u611F\u5174\u8DA3\u7684\u4E8B\u4EF6\u540E\uFF0C\u5C31\u8FDB\u884C\u5904\u7406(\u5C31\u7531handler)\uFF0C \u6CE8\u610Fhandler \u5DF2\u7ECF\u52A0\u5165\u5230\u901A\u9053\u3002</p><h3 id="_6-4-2-\u8FDB\u9636\u7248" tabindex="-1"><a class="header-anchor" href="#_6-4-2-\u8FDB\u9636\u7248" aria-hidden="true">#</a> 6.4.2 \u8FDB\u9636\u7248</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210903083731222.png" alt="image-20210903083731222" loading="lazy"></p><h3 id="_6-4-3-\u8BE6\u7EC6\u7248" tabindex="-1"><a class="header-anchor" href="#_6-4-3-\u8BE6\u7EC6\u7248" aria-hidden="true">#</a> 6.4.3 \u8BE6\u7EC6\u7248</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210903083750466.png" alt="image-20210903083750466" loading="lazy"></p><p>1)Netty\u62BD\u8C61\u51FA\u4E24\u7EC4\u7EBF\u7A0B\u6C60 BossGroup \u4E13\u95E8\u8D1F\u8D23\u63A5\u6536\u5BA2\u6237\u7AEF\u7684\u8FDE\u63A5, WorkerGroup \u4E13\u95E8\u8D1F\u8D23\u7F51\u7EDC\u7684\u8BFB\u5199; 2)BossGroup \u548C WorkerGroup \u7C7B\u578B\u90FD\u662F NioEventLoopGroup; 3)NioEventLoopGroup \u76F8\u5F53\u4E8E\u4E00\u4E2A\u4E8B\u4EF6\u5FAA\u73AF\u7EC4, \u8FD9\u4E2A\u7EC4\u4E2D\u542B\u6709\u591A\u4E2A\u4E8B\u4EF6\u5FAA\u73AF \uFF0C\u6BCF\u4E00\u4E2A\u4E8B\u4EF6\u5FAA\u73AF\u662F NioEventLoop; 4)NioEventLoop \u8868\u793A\u4E00\u4E2A\u4E0D\u65AD\u5FAA\u73AF\u7684\u6267\u884C\u5904\u7406\u4EFB\u52A1\u7684\u7EBF\u7A0B\uFF0C \u6BCF\u4E2ANioEventLoop \u90FD\u6709\u4E00\u4E2Aselector , \u7528\u4E8E\u76D1\u542C\u7ED1\u5B9A\u5728\u5176\u4E0A\u7684socket\u7684\u7F51\u7EDC\u901A\u8BAF; 5)NioEventLoopGroup \u53EF\u4EE5\u6709\u591A\u4E2A\u7EBF\u7A0B, \u5373\u53EF\u4EE5\u542B\u6709\u591A\u4E2ANioEventLoop; 6)\u6BCF\u4E2ABoss NioEventLoop \u5FAA\u73AF\u6267\u884C\u7684\u6B65\u9AA4\u67093\u6B65; 1.\u8F6E\u8BE2accept \u4E8B\u4EF6 2.\u5904\u7406accept \u4E8B\u4EF6 , \u4E0Eclient\u5EFA\u7ACB\u8FDE\u63A5 , \u751F\u6210NioScocketChannel , \u5E76\u5C06\u5176\u6CE8\u518C\u5230\u67D0\u4E2Aworker NIOEventLoop \u4E0A\u7684 selector 3.\u5904\u7406\u4EFB\u52A1\u961F\u5217\u7684\u4EFB\u52A1 \uFF0C \u5373 runAllTasks</p><p>7)\u6BCF\u4E2A Worker NIOEventLoop \u5FAA\u73AF\u6267\u884C\u7684\u6B65\u9AA4; 1.\u8F6E\u8BE2read, write \u4E8B\u4EF6 2.\u5904\u7406i/o\u4E8B\u4EF6\uFF0C \u5373read , write \u4E8B\u4EF6\uFF0C\u5728\u5BF9\u5E94NioScocketChannel \u5904\u7406 3.\u5904\u7406\u4EFB\u52A1\u961F\u5217\u7684\u4EFB\u52A1 \uFF0C \u5373 runAllTasks</p><p>8)\u6BCF\u4E2AWorker NIOEventLoop \u5904\u7406\u4E1A\u52A1\u65F6\uFF0C\u4F1A\u4F7F\u7528pipeline(\u7BA1\u9053), pipeline \u4E2D\u5305\u542B\u4E86 channel , \u5373\u901A\u8FC7pipeline \u53EF\u4EE5\u83B7\u53D6\u5230\u5BF9\u5E94\u901A\u9053, \u7BA1\u9053\u4E2D\u7EF4\u62A4\u4E86\u5F88\u591A\u7684 \u5904\u7406\u5668\u3002</p><h3 id="_6-4-4-netty\u5FEB\u901F\u5165\u95E8\u5B9E\u4F8B-tcp\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_6-4-4-netty\u5FEB\u901F\u5165\u95E8\u5B9E\u4F8B-tcp\u670D\u52A1" aria-hidden="true">#</a> 6.4.4 Netty\u5FEB\u901F\u5165\u95E8\u5B9E\u4F8B-TCP\u670D\u52A1</h3><p>\u5B9E\u4F8B\u8981\u6C42\uFF1A</p><p>1)\u4F7F\u7528IDEA \u521B\u5EFANetty\u9879\u76EE; 2)Netty \u670D\u52A1\u5668\u5728 6668 \u7AEF\u53E3\u76D1\u542C\uFF0C\u5BA2\u6237\u7AEF\u80FD\u53D1\u9001\u6D88\u606F\u7ED9\u670D\u52A1\u5668 &quot;hello, \u670D\u52A1\u5668~&quot;; 3)\u670D\u52A1\u5668\u53EF\u4EE5\u56DE\u590D\u6D88\u606F\u7ED9\u5BA2\u6237\u7AEF &quot;hello, \u5BA2\u6237\u7AEF~&quot;;</p><h3 id="_6-4-5-\u4EFB\u52A1\u961F\u5217" tabindex="-1"><a class="header-anchor" href="#_6-4-5-\u4EFB\u52A1\u961F\u5217" aria-hidden="true">#</a> 6.4.5 \u4EFB\u52A1\u961F\u5217</h3><p>1)\u7528\u6237\u7A0B\u5E8F\u81EA\u5B9A\u4E49\u7684\u666E\u901A\u4EFB\u52A1 [\u4E3E\u4F8B\u8BF4\u660E] 2)\u7528\u6237\u81EA\u5B9A\u4E49\u5B9A\u65F6\u4EFB\u52A1; 3)\u975E\u5F53\u524D Reactor \u7EBF\u7A0B\u8C03\u7528 Channel \u7684\u5404\u79CD\u65B9\u6CD5</p><p>4)\u4F8B\u5982\u5728\u63A8\u9001\u7CFB\u7EDF\u7684\u4E1A\u52A1\u7EBF\u7A0B\u91CC\u9762\uFF0C\u6839\u636E\u7528\u6237\u7684\u6807\u8BC6\uFF0C\u627E\u5230\u5BF9\u5E94\u7684 Channel \u5F15\u7528\uFF0C\u7136\u540E\u8C03\u7528 Write \u7C7B\u65B9\u6CD5\u5411\u8BE5\u7528\u6237\u63A8\u9001\u6D88\u606F\uFF0C\u5C31\u4F1A\u8FDB\u5165\u5230\u8FD9\u79CD\u573A\u666F\u3002\u6700\u7EC8\u7684 Write \u4F1A\u63D0\u4EA4\u5230\u4EFB\u52A1\u961F\u5217\u4E2D\u540E\u88AB\u5F02\u6B65\u6D88\u8D39</p><h3 id="_6-4-6-\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_6-4-6-\u603B\u7ED3" aria-hidden="true">#</a> 6.4.6 \u603B\u7ED3</h3><p><strong>\u65B9\u6848\u518D\u8BF4\u660E</strong> 1)Netty \u62BD\u8C61\u51FA\u4E24\u7EC4\u7EBF\u7A0B\u6C60\uFF0CBossGroup \u4E13\u95E8\u8D1F\u8D23\u63A5\u6536\u5BA2\u6237\u7AEF\u8FDE\u63A5\uFF0CWorkerGroup \u4E13\u95E8\u8D1F\u8D23\u7F51\u7EDC\u8BFB\u5199\u64CD\u4F5C; 2)NioEventLoop \u8868\u793A\u4E00\u4E2A\u4E0D\u65AD\u5FAA\u73AF\u6267\u884C\u5904\u7406\u4EFB\u52A1\u7684\u7EBF\u7A0B\uFF0C\u6BCF\u4E2A NioEventLoop \u90FD\u6709\u4E00\u4E2A selector\uFF0C\u7528\u4E8E\u76D1\u542C\u7ED1\u5B9A\u5728\u5176\u4E0A\u7684 socket \u7F51\u7EDC\u901A\u9053; 3)NioEventLoop \u5185\u90E8\u91C7\u7528\u4E32\u884C\u5316\u8BBE\u8BA1\uFF0C\u4ECE\u6D88\u606F\u7684\u8BFB\u53D6-&gt;\u89E3\u7801-&gt;\u5904\u7406-&gt;\u7F16\u7801-&gt;\u53D1\u9001\uFF0C\u59CB\u7EC8\u7531 IO \u7EBF\u7A0B NioEventLoop \u8D1F\u8D23\u3002 NioEventLoopGroup \u4E0B\u5305\u542B\u591A\u4E2A NioEventLoop \u6BCF\u4E2A NioEventLoop \u4E2D\u5305\u542B\u6709\u4E00\u4E2A Selector\uFF0C\u4E00\u4E2A taskQueue \u6BCF\u4E2A NioEventLoop \u7684 Selector \u4E0A\u53EF\u4EE5\u6CE8\u518C\u76D1\u542C\u591A\u4E2A NioChannel \u6BCF\u4E2A NioChannel \u53EA\u4F1A\u7ED1\u5B9A\u5728\u552F\u4E00\u7684 NioEventLoop \u4E0A \u6BCF\u4E2A NioChannel \u90FD\u7ED1\u5B9A\u6709\u4E00\u4E2A\u81EA\u5DF1\u7684 ChannelPipeline</p><h2 id="_6-5-\u5F02\u6B65\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_6-5-\u5F02\u6B65\u6A21\u578B" aria-hidden="true">#</a> 6.5 \u5F02\u6B65\u6A21\u578B</h2><h3 id="_6-5-1-\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_6-5-1-\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 6.5.1 \u57FA\u672C\u4ECB\u7ECD</h3><p>1)\u5F02\u6B65\u7684\u6982\u5FF5\u548C\u540C\u6B65\u76F8\u5BF9\u3002\u5F53\u4E00\u4E2A\u5F02\u6B65\u8FC7\u7A0B\u8C03\u7528\u53D1\u51FA\u540E\uFF0C\u8C03\u7528\u8005\u4E0D\u80FD\u7ACB\u523B\u5F97\u5230\u7ED3\u679C\u3002\u5B9E\u9645\u5904\u7406\u8FD9\u4E2A\u8C03\u7528\u7684\u7EC4\u4EF6\u5728\u5B8C\u6210\u540E\uFF0C\u901A\u8FC7\u72B6\u6001\u3001\u901A\u77E5\u548C\u56DE\u8C03\u6765\u901A\u77E5\u8C03\u7528\u8005; 2)Netty \u4E2D\u7684 I/O \u64CD\u4F5C\u662F\u5F02\u6B65\u7684\uFF0C\u5305\u62EC Bind\u3001Write\u3001Connect \u7B49\u64CD\u4F5C\u4F1A\u7B80\u5355\u7684\u8FD4\u56DE\u4E00\u4E2A ChannelFuture; 3)\u8C03\u7528\u8005\u5E76\u4E0D\u80FD\u7ACB\u523B\u83B7\u5F97\u7ED3\u679C\uFF0C\u800C\u662F\u901A\u8FC7 Future-Listener \u673A\u5236\uFF0C\u7528\u6237\u53EF\u4EE5\u65B9\u4FBF\u7684\u4E3B\u52A8\u83B7\u53D6\u6216\u8005\u901A\u8FC7\u901A\u77E5\u673A\u5236\u83B7\u5F97 IO \u64CD\u4F5C\u7ED3\u679C; 4)Netty \u7684\u5F02\u6B65\u6A21\u578B\u662F\u5EFA\u7ACB\u5728 future \u548C callback \u7684\u4E4B\u4E0A\u7684\u3002callback \u5C31\u662F\u56DE\u8C03\u3002\u91CD\u70B9\u8BF4 Future\uFF0C\u5B83\u7684\u6838\u5FC3\u601D\u60F3\u662F\uFF1A\u5047\u8BBE\u4E00\u4E2A\u65B9\u6CD5 fun\uFF0C\u8BA1\u7B97\u8FC7\u7A0B\u53EF\u80FD\u975E\u5E38\u8017\u65F6\uFF0C\u7B49\u5F85 fun\u8FD4\u56DE\u663E\u7136\u4E0D\u5408\u9002\u3002\u90A3\u4E48\u53EF\u4EE5\u5728\u8C03\u7528 fun \u7684\u65F6\u5019\uFF0C\u7ACB\u9A6C\u8FD4\u56DE\u4E00\u4E2A Future\uFF0C\u540E\u7EED\u53EF\u4EE5\u901A\u8FC7 Future\u53BB\u76D1\u63A7\u65B9\u6CD5 fun \u7684\u5904\u7406\u8FC7\u7A0B(\u5373 \uFF1A Future-Listener \u673A\u5236)\u3002</p><p><strong>Future \u8BF4\u660E</strong> 1)\u8868\u793A\u5F02\u6B65\u7684\u6267\u884C\u7ED3\u679C, \u53EF\u4EE5\u901A\u8FC7\u5B83\u63D0\u4F9B\u7684\u65B9\u6CD5\u6765\u68C0\u6D4B\u6267\u884C\u662F\u5426\u5B8C\u6210\uFF0C\u6BD4\u5982\u68C0\u7D22\u8BA1\u7B97\u7B49\u7B49; 2)ChannelFuture \u662F\u4E00\u4E2A\u63A5\u53E3 \uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ChannelFuture</span> <span class="token keyword">extends</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u6211\u4EEC\u53EF\u4EE5\u6DFB\u52A0\u76D1\u542C\u5668\uFF0C\u5F53\u76D1\u542C\u7684\u4E8B\u4EF6\u53D1\u751F\u65F6\uFF0C\u5C31\u4F1A\u901A\u77E5\u5230\u76D1\u542C\u5668\u3002\u6848\u4F8B\u8BF4\u660E</p><h3 id="_6-5-2-\u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE" tabindex="-1"><a class="header-anchor" href="#_6-5-2-\u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE" aria-hidden="true">#</a> 6.5.2 \u5DE5\u4F5C\u539F\u7406\u793A\u610F\u56FE</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210906182945241.png" alt="image-20210906182945241" loading="lazy"></p><p><strong>\u8BF4\u660E:</strong> 1)\u5728\u4F7F\u7528 Netty \u8FDB\u884C\u7F16\u7A0B\u65F6\uFF0C\u62E6\u622A\u64CD\u4F5C\u548C\u8F6C\u6362\u51FA\u5165\u7AD9\u6570\u636E\u53EA\u9700\u8981\u60A8\u63D0\u4F9B callback \u6216\u5229\u7528future \u5373\u53EF\u3002\u8FD9\u4F7F\u5F97\u94FE\u5F0F\u64CD\u4F5C\u7B80\u5355\u3001\u9AD8\u6548, \u5E76\u6709\u5229\u4E8E\u7F16\u5199\u53EF\u91CD\u7528\u7684\u3001\u901A\u7528\u7684\u4EE3\u7801; 2)Netty \u6846\u67B6\u7684\u76EE\u6807\u5C31\u662F\u8BA9\u4F60\u7684\u4E1A\u52A1\u903B\u8F91\u4ECE\u7F51\u7EDC\u57FA\u7840\u5E94\u7528\u7F16\u7801\u4E2D\u5206\u79BB\u51FA\u6765\u3001\u89E3\u8131\u51FA\u6765\u3002</p><h3 id="_6-5-3-future-listener-\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_6-5-3-future-listener-\u673A\u5236" aria-hidden="true">#</a> 6.5.3 Future-Listener \u673A\u5236</h3><p>\u4E3E\u4F8B\u8BF4\u660E \u6F14\u793A\uFF1A\u7ED1\u5B9A\u7AEF\u53E3\u662F\u5F02\u6B65\u64CD\u4F5C\uFF0C\u5F53\u7ED1\u5B9A\u64CD\u4F5C\u5904\u7406\u5B8C\uFF0C\u5C06\u4F1A\u8C03\u7528\u76F8\u5E94\u7684\u76D1\u542C\u5668\u5904\u7406\u903B\u8F91</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>future <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">newDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: \u7AEF\u53E3[&quot;</span><span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">&quot;]\u7ED1\u5B9A\u6210\u529F!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7AEF\u53E3[&quot;</span><span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">&quot;]\u7ED1\u5B9A\u5931\u8D25!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>**\u5C0F\u7ED3\uFF1A**\u76F8\u6BD4\u4F20\u7EDF\u963B\u585E I/O\uFF0C\u6267\u884C I/O \u64CD\u4F5C\u540E\u7EBF\u7A0B\u4F1A\u88AB\u963B\u585E\u4F4F, \u76F4\u5230\u64CD\u4F5C\u5B8C\u6210\uFF1B\u5F02\u6B65\u5904\u7406\u7684\u597D\u5904\u662F\u4E0D\u4F1A\u9020\u6210\u7EBF\u7A0B\u963B\u585E\uFF0C\u7EBF\u7A0B\u5728 I/O \u64CD\u4F5C\u671F\u95F4\u53EF\u4EE5\u6267\u884C\u522B\u7684\u7A0B\u5E8F\uFF0C\u5728\u9AD8\u5E76\u53D1\u60C5\u5F62\u4E0B\u4F1A\u66F4\u7A33\u5B9A\u548C\u66F4\u9AD8\u7684\u541E\u5410\u91CF</p><h3 id="_6-5-4-http\u670D\u52A1\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-5-4-http\u670D\u52A1\u5B9E\u4F8B" aria-hidden="true">#</a> 6.5.4 HTTP\u670D\u52A1\u5B9E\u4F8B</h3><p>\u5B9E\u4F8B\u8981\u6C42\uFF1A 1)Netty \u670D\u52A1\u5668\u5728 6668 \u7AEF\u53E3\u76D1\u542C\uFF0C\u6D4F\u89C8\u5668\u53D1\u51FA\u8BF7\u6C42 &quot;http://localhost:7000/ &quot; 2)\u670D\u52A1\u5668\u53EF\u4EE5\u56DE\u590D\u6D88\u606F\u7ED9\u5BA2\u6237\u7AEF &quot;Hello! \u6211\u662F\u670D\u52A1\u5668 5 &quot; , \u5E76\u5BF9\u7279\u5B9A\u8BF7\u6C42\u8D44\u6E90\u8FDB\u884C\u8FC7\u6EE4\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>http</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/06/8:54
 * <span class="token keyword">@description</span> netty http\u670D\u52A1\u7AEF
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyHttpServerDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">NioEventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NioEventLoopGroup</span> workGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span>workGroup<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyChannelInitializerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>http</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServerCodec</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/06/10:09
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyChannelInitializerDemo</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> socketChannel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//HttpServerCodec:netty\u63D0\u4F9B\u7684\u4E00\u4E2Ahttp\u7F16\u89E3\u7801\u5668</span>
        socketChannel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpServerCodec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        socketChannel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyHttpHandlerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>http</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">DefaultFullHttpResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">DefaultHttpResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaderNames</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaders</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpObject</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpResponseStatus</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpVersion</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/06/10:14
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyHttpHandlerDemo</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpObject</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u8BFB\u53D6\u5BA2\u6237\u7AEF\u6570\u636E
     * <span class="token keyword">@param</span> <span class="token parameter">channelHandlerContext</span>
     * <span class="token keyword">@param</span> <span class="token parameter">httpObject</span> \u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u6570\u636E
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">HttpObject</span> httpObject<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>httpObject <span class="token keyword">instanceof</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">String</span> uri <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HttpRequest</span><span class="token punctuation">)</span> httpObject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;uri:&quot;</span> <span class="token operator">+</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>uri<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;/favicon.ico&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u8FC7\u6EE4/favicon.ico\u8BF7\u6C42</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5BA2\u6237\u7AEF\u5730\u5740:&quot;</span> <span class="token operator">+</span> channelHandlerContext<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//\u56DE\u590D\u6D88\u606F\u7ED9\u5BA2\u6237\u7AEF,http\u534F\u8BAE</span>
            <span class="token class-name">ByteBuf</span> content <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello,\u5BA2\u6237\u7AEF...&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_16<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">DefaultFullHttpResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultFullHttpResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpVersion</span><span class="token punctuation">.</span>HTTP_1_1<span class="token punctuation">,</span>
                    <span class="token class-name">HttpResponseStatus</span><span class="token punctuation">.</span>OK<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

            response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaderNames</span><span class="token punctuation">.</span>CONTENT_TYPE<span class="token punctuation">,</span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaderNames</span><span class="token punctuation">.</span>CONTENT_LENGTH<span class="token punctuation">,</span> content<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channelHandlerContext<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h1 id="\u7B2C7\u7AE0-netty-\u6838\u5FC3\u6A21\u5757\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u7B2C7\u7AE0-netty-\u6838\u5FC3\u6A21\u5757\u7EC4\u4EF6" aria-hidden="true">#</a> \u7B2C7\u7AE0 Netty \u6838\u5FC3\u6A21\u5757\u7EC4\u4EF6</h1><h2 id="_7-1-bootstrap\u3001serverbootstrap" tabindex="-1"><a class="header-anchor" href="#_7-1-bootstrap\u3001serverbootstrap" aria-hidden="true">#</a> 7.1 Bootstrap\u3001ServerBootstrap</h2><p>1)Bootstrap \u610F\u601D\u662F\u5F15\u5BFC\uFF0C\u4E00\u4E2A Netty \u5E94\u7528\u901A\u5E38\u7531\u4E00\u4E2A Bootstrap \u5F00\u59CB\uFF0C\u4E3B\u8981\u4F5C\u7528\u662F\u914D\u7F6E\u6574\u4E2A Netty \u7A0B\u5E8F\uFF0C\u4E32\u8054\u5404\u4E2A\u7EC4\u4EF6\uFF0CNetty \u4E2D Bootstrap \u7C7B\u662F\u5BA2\u6237\u7AEF\u7A0B\u5E8F\u7684\u542F\u52A8\u5F15\u5BFC\u7C7B\uFF0CServerBootstrap \u662F\u670D\u52A1\u7AEF\u542F\u52A8\u5F15\u5BFC\u7C7B 2)\u5E38\u89C1\u7684\u65B9\u6CD5\u6709</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ServerBootstrap</span> <span class="token function">group</span><span class="token punctuation">(</span><span class="token class-name">EventLoopGroup</span> parentGroup<span class="token punctuation">,</span> <span class="token class-name">EventLoopGroup</span> childGroup<span class="token punctuation">)</span>\uFF0C\u8BE5\u65B9\u6CD5\u7528\u4E8E\u670D\u52A1\u5668\u7AEF\uFF0C\u7528\u6765\u8BBE\u7F6E\u4E24\u4E2A <span class="token class-name">EventLoop</span>
<span class="token keyword">public</span> <span class="token class-name">B</span> <span class="token function">group</span><span class="token punctuation">(</span><span class="token class-name">EventLoopGroup</span> group<span class="token punctuation">)</span> \uFF0C\u8BE5\u65B9\u6CD5\u7528\u4E8E\u5BA2\u6237\u7AEF\uFF0C\u7528\u6765\u8BBE\u7F6E\u4E00\u4E2A <span class="token class-name">EventLoop</span>
<span class="token keyword">public</span> <span class="token class-name">B</span> <span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">C</span><span class="token punctuation">&gt;</span></span> channelClass<span class="token punctuation">)</span>\uFF0C\u8BE5\u65B9\u6CD5\u7528\u6765\u8BBE\u7F6E\u4E00\u4E2A\u670D\u52A1\u5668\u7AEF\u7684\u901A\u9053\u5B9E\u73B0
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">B</span> <span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> option<span class="token punctuation">,</span> <span class="token class-name">T</span> value<span class="token punctuation">)</span>\uFF0C\u7528\u6765\u7ED9 <span class="token class-name">ServerChannel</span> \u6DFB\u52A0\u914D\u7F6E
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ServerBootstrap</span> <span class="token function">childOption</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> childOption<span class="token punctuation">,</span> <span class="token class-name">T</span> value<span class="token punctuation">)</span>\uFF0C\u7528\u6765\u7ED9\u63A5\u6536\u5230\u7684\u901A\u9053\u6DFB\u52A0\u914D\u7F6E
<span class="token keyword">public</span> <span class="token class-name">ServerBootstrap</span> <span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandler</span> childHandler<span class="token punctuation">)</span>\uFF0C\u8BE5\u65B9\u6CD5\u7528\u6765\u8BBE\u7F6E\u4E1A\u52A1\u5904\u7406\u7C7B\uFF08\u81EA\u5B9A\u4E49\u7684 handler\uFF09
<span class="token keyword">public</span> <span class="token class-name">ChannelFuture</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">int</span> inetPort<span class="token punctuation">)</span> \uFF0C\u8BE5\u65B9\u6CD5\u7528\u4E8E\u670D\u52A1\u5668\u7AEF\uFF0C\u7528\u6765\u8BBE\u7F6E\u5360\u7528\u7684\u7AEF\u53E3\u53F7
<span class="token keyword">public</span> <span class="token class-name">ChannelFuture</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">String</span> inetHost<span class="token punctuation">,</span> <span class="token keyword">int</span> inetPort<span class="token punctuation">)</span> \uFF0C\u8BE5\u65B9\u6CD5\u7528\u4E8E\u5BA2\u6237\u7AEF\uFF0C\u7528\u6765\u8FDE\u63A5\u670D\u52A1\u5668\u7AEF
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_7-2-channel\u548Cselector" tabindex="-1"><a class="header-anchor" href="#_7-2-channel\u548Cselector" aria-hidden="true">#</a> 7.2 Channel\u548CSelector</h2><h3 id="_7-2-1-channel" tabindex="-1"><a class="header-anchor" href="#_7-2-1-channel" aria-hidden="true">#</a> 7.2.1 Channel</h3><p>1)Netty \u7F51\u7EDC\u901A\u4FE1\u7684\u7EC4\u4EF6\uFF0C\u80FD\u591F\u7528\u4E8E\u6267\u884C\u7F51\u7EDC I/O \u64CD\u4F5C\u3002 2)\u901A\u8FC7Channel \u53EF\u83B7\u5F97\u5F53\u524D\u7F51\u7EDC\u8FDE\u63A5\u7684\u901A\u9053\u7684\u72B6\u6001 3)\u901A\u8FC7Channel \u53EF\u83B7\u5F97 \u7F51\u7EDC\u8FDE\u63A5\u7684\u914D\u7F6E\u53C2\u6570 \uFF08\u4F8B\u5982\u63A5\u6536\u7F13\u51B2\u533A\u5927\u5C0F\uFF09 4)Channel \u63D0\u4F9B\u5F02\u6B65\u7684\u7F51\u7EDC I/O \u64CD\u4F5C(\u5982\u5EFA\u7ACB\u8FDE\u63A5\uFF0C\u8BFB\u5199\uFF0C\u7ED1\u5B9A\u7AEF\u53E3)\uFF0C\u5F02\u6B65\u8C03\u7528\u610F\u5473\u7740\u4EFB\u4F55 I/O \u8C03\u7528\u90FD\u5C06\u7ACB\u5373\u8FD4\u56DE\uFF0C\u5E76\u4E14\u4E0D\u4FDD\u8BC1\u5728\u8C03\u7528\u7ED3\u675F\u65F6\u6240\u8BF7\u6C42\u7684 I/O \u64CD\u4F5C\u5DF2\u5B8C\u6210 5)\u8C03\u7528\u7ACB\u5373\u8FD4\u56DE\u4E00\u4E2A ChannelFuture \u5B9E\u4F8B\uFF0C\u901A\u8FC7\u6CE8\u518C\u76D1\u542C\u5668\u5230 ChannelFuture \u4E0A\uFF0C\u53EF\u4EE5 I/O \u64CD\u4F5C\u6210\u529F\u3001\u5931\u8D25\u6216\u53D6\u6D88\u65F6\u56DE\u8C03\u901A\u77E5\u8C03\u7528\u65B9</p><p>6)\u652F\u6301\u5173\u8054 I/O \u64CD\u4F5C\u4E0E\u5BF9\u5E94\u7684\u5904\u7406\u7A0B\u5E8F 7\u4E0D\u540C\u534F\u8BAE\u3001\u4E0D\u540C\u7684\u963B\u585E\u7C7B\u578B\u7684\u8FDE\u63A5\u90FD\u6709\u4E0D\u540C\u7684 Channel \u7C7B\u578B\u4E0E\u4E4B\u5BF9\u5E94\uFF0C\u5E38\u7528\u7684 Channel \u7C7B\u578B:</p><ul><li>NioSocketChannel\uFF0C\u5F02\u6B65\u7684\u5BA2\u6237\u7AEF TCP Socket \u8FDE\u63A5\u3002</li><li>NioServerSocketChannel\uFF0C\u5F02\u6B65\u7684\u670D\u52A1\u5668\u7AEF TCP Socket \u8FDE\u63A5\u3002</li><li>NioDatagramChannel\uFF0C\u5F02\u6B65\u7684 UDP \u8FDE\u63A5\u3002</li><li>NioSctpChannel\uFF0C\u5F02\u6B65\u7684\u5BA2\u6237\u7AEF Sctp \u8FDE\u63A5\u3002</li><li>NioSctpServerChannel\uFF0C\u5F02\u6B65\u7684 Sctp \u670D\u52A1\u5668\u7AEF\u8FDE\u63A5\uFF0C\u8FD9\u4E9B\u901A\u9053\u6DB5\u76D6\u4E86 UDP \u548C TCP \u7F51\u7EDC IO \u4EE5\u53CA\u6587\u4EF6 IO\u3002</li></ul><h3 id="_7-2-2-selector" tabindex="-1"><a class="header-anchor" href="#_7-2-2-selector" aria-hidden="true">#</a> 7.2.2 Selector</h3><p>1)Netty \u57FA\u4E8E Selector \u5BF9\u8C61\u5B9E\u73B0 I/O \u591A\u8DEF\u590D\u7528\uFF0C\u901A\u8FC7 Selector \u4E00\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u76D1\u542C\u591A\u4E2A\u8FDE\u63A5\u7684 Channel \u4E8B\u4EF6\u3002 2)\u5F53\u5411\u4E00\u4E2A Selector \u4E2D\u6CE8\u518C Channel \u540E\uFF0CSelector \u5185\u90E8\u7684\u673A\u5236\u5C31\u53EF\u4EE5\u81EA\u52A8\u4E0D\u65AD\u5730\u67E5\u8BE2(Select) \u8FD9\u4E9B\u6CE8\u518C\u7684 Channel \u662F\u5426\u6709\u5DF2\u5C31\u7EEA\u7684 I/O \u4E8B\u4EF6\uFF08\u4F8B\u5982\u53EF\u8BFB\uFF0C\u53EF\u5199\uFF0C\u7F51\u7EDC\u8FDE\u63A5\u5B8C\u6210\u7B49\uFF09\uFF0C\u8FD9\u6837\u7A0B\u5E8F\u5C31\u53EF\u4EE5\u5F88\u7B80\u5355\u5730\u4F7F\u7528\u4E00\u4E2A\u7EBF\u7A0B\u9AD8\u6548\u5730\u7BA1\u7406\u591A\u4E2A Channel</p><h2 id="_7-3-channelhandler" tabindex="-1"><a class="header-anchor" href="#_7-3-channelhandler" aria-hidden="true">#</a> 7.3 ChannelHandler</h2><p>1)ChannelHandler \u662F\u4E00\u4E2A\u63A5\u53E3\uFF0C\u5904\u7406 I/O \u4E8B\u4EF6\u6216\u62E6\u622A I/O \u64CD\u4F5C\uFF0C\u5E76\u5C06\u5176\u8F6C\u53D1\u5230\u5176 ChannelPipeline(\u4E1A\u52A1\u5904\u7406\u94FE)\u4E2D\u7684\u4E0B\u4E00\u4E2A\u5904\u7406\u7A0B\u5E8F\u3002 2)ChannelHandler \u672C\u8EAB\u5E76\u6CA1\u6709\u63D0\u4F9B\u5F88\u591A\u65B9\u6CD5\uFF0C\u56E0\u4E3A\u8FD9\u4E2A\u63A5\u53E3\u6709\u8BB8\u591A\u7684\u65B9\u6CD5\u9700\u8981\u5B9E\u73B0\uFF0C\u65B9\u4FBF\u4F7F\u7528\u671F\u95F4\uFF0C\u53EF\u4EE5\u7EE7\u627F\u5B83\u7684\u5B50\u7C7B 3)ChannelHandler \u53CA\u5176\u5B9E\u73B0\u7C7B\u4E00\u89C8\u56FE(\u540E)</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210907182134693.png" alt="image-20210907182134693" loading="lazy"></p><ul><li><p>ChannelInboundHandler \u7528\u4E8E\u5904\u7406\u5165\u7AD9 I/O \u4E8B\u4EF6\u3002</p></li><li><p>ChannelOutboundHandler \u7528\u4E8E\u5904\u7406\u51FA\u7AD9 I/O \u64CD\u4F5C\u3002</p></li><li><p>//\u9002\u914D\u5668</p></li><li><p>ChannelInboundHandlerAdapter \u7528\u4E8E\u5904\u7406\u5165\u7AD9 I/O \u4E8B\u4EF6\u3002</p></li><li><p>ChannelOutboundHandlerAdapter \u7528\u4E8E\u5904\u7406\u51FA\u7AD9 I/O \u64CD\u4F5C\u3002</p></li><li><p>ChannelDuplexHandler \u7528\u4E8E\u5904\u7406\u5165\u7AD9\u548C\u51FA\u7AD9\u4E8B\u4EF6\u3002</p></li></ul><p>4)\u6211\u4EEC\u7ECF\u5E38\u9700\u8981\u81EA\u5B9A\u4E49\u4E00\u4E2A Handler \u7C7B\u53BB\u7EE7\u627F ChannelInboundHandlerAdapter\uFF0C\u7136\u540E\u901A\u8FC7\u91CD\u5199\u76F8\u5E94\u65B9\u6CD5\u5B9E\u73B0\u4E1A\u52A1\u903B\u8F91\uFF0C\u6211\u4EEC\u63A5\u4E0B\u6765\u770B\u770B\u4E00\u822C\u90FD\u9700\u8981\u91CD\u5199\u54EA\u4E9B\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelHandlerAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">ChannelInboundHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRegistered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireChannelRegistered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelUnregistered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireChannelUnregistered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u901A\u9053\u5C31\u7EEA\u4E8B\u4EF6</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireChannelActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelInactive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireChannelInactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u901A\u9053\u8BFB\u53D6\u6570\u636E\u4E8B\u4EF6</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6570\u636E\u8BFB\u53D6\u5B8C\u6BD5\u4E8B\u4EF6</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireChannelReadComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> evt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireUserEventTriggered</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelWritabilityChanged</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireChannelWritabilityChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u901A\u9053\u53D1\u751F\u5F02\u5E38\u4E8B\u4EF6</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">fireExceptionCaught</span><span class="token punctuation">(</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="_7-4-pipeline-\u548C-channelpipeline" tabindex="-1"><a class="header-anchor" href="#_7-4-pipeline-\u548C-channelpipeline" aria-hidden="true">#</a> 7.4 Pipeline \u548C ChannelPipeline</h2><p><strong>ChannelPipeline \u662F\u4E00\u4E2A\u91CD\u70B9\uFF1A</strong> 1)ChannelPipeline \u662F\u4E00\u4E2A Handler \u7684\u96C6\u5408\uFF0C\u5B83\u8D1F\u8D23\u5904\u7406\u548C\u62E6\u622A inbound \u6216\u8005 outbound \u7684\u4E8B\u4EF6\u548C\u64CD\u4F5C\uFF0C\u76F8\u5F53\u4E8E\u4E00\u4E2A\u8D2F\u7A7F Netty \u7684\u94FE\u3002(\u4E5F\u53EF\u4EE5\u8FD9\u6837\u7406\u89E3\uFF1AChannelPipeline \u662F \u4FDD\u5B58 ChannelHandler \u7684 List\uFF0C\u7528\u4E8E\u5904\u7406\u6216\u62E6\u622A Channel \u7684\u5165\u7AD9\u4E8B\u4EF6\u548C\u51FA\u7AD9\u64CD\u4F5C) 2)ChannelPipeline \u5B9E\u73B0\u4E86\u4E00\u79CD\u9AD8\u7EA7\u5F62\u5F0F\u7684\u62E6\u622A\u8FC7\u6EE4\u5668\u6A21\u5F0F\uFF0C\u4F7F\u7528\u6237\u53EF\u4EE5\u5B8C\u5168\u63A7\u5236\u4E8B\u4EF6\u7684\u5904\u7406\u65B9\u5F0F\uFF0C\u4EE5\u53CA Channel \u4E2D\u5404\u4E2A\u7684 ChannelHandler \u5982\u4F55\u76F8\u4E92\u4EA4\u4E92</p><p>3)\u5728 Netty \u4E2D\u6BCF\u4E2A Channel \u90FD\u6709\u4E14\u4EC5\u6709\u4E00\u4E2A ChannelPipeline \u4E0E\u4E4B\u5BF9\u5E94\uFF0C\u5B83\u4EEC\u7684\u7EC4\u6210\u5173\u7CFB\u5982\u4E0B</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210907182752804.png" alt="image-20210907182752804" loading="lazy"></p><ul><li>\u4E00\u4E2A Channel \u5305\u542B\u4E86\u4E00\u4E2A ChannelPipeline\uFF0C\u800C ChannelPipeline \u4E2D\u53C8\u7EF4\u62A4\u4E86\u4E00\u4E2A\u7531 ChannelHandlerContext \u7EC4\u6210\u7684\u53CC\u5411\u94FE\u8868\uFF0C\u5E76\u4E14\u6BCF\u4E2A ChannelHandlerContext \u4E2D\u53C8\u5173\u8054\u7740\u4E00\u4E2A ChannelHandler</li><li>\u5165\u7AD9\u4E8B\u4EF6\u548C\u51FA\u7AD9\u4E8B\u4EF6\u5728\u4E00\u4E2A\u53CC\u5411\u94FE\u8868\u4E2D\uFF0C\u5165\u7AD9\u4E8B\u4EF6\u4F1A\u4ECE\u94FE\u8868 head \u5F80\u540E\u4F20\u9012\u5230\u6700\u540E\u4E00\u4E2A\u5165\u7AD9\u7684 handler\uFF0C\u51FA\u7AD9\u4E8B\u4EF6\u4F1A\u4ECE\u94FE\u8868 tail \u5F80\u524D\u4F20\u9012\u5230\u6700\u524D\u4E00\u4E2A\u51FA\u7AD9\u7684 handler\uFF0C\u4E24\u79CD\u7C7B\u578B\u7684 handler \u4E92\u4E0D\u5E72\u6270</li></ul><p>4)\u5E38\u7528\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ChannelPipeline</span> <span class="token function">addFirst</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandler</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> handlers<span class="token punctuation">)</span><span class="token comment">//\u628A\u4E00\u4E2A\u4E1A\u52A1\u5904\u7406\u7C7B\uFF08handler\uFF09\u6DFB\u52A0\u5230\u94FE\u4E2D\u7684\u7B2C\u4E00\u4E2A\u4F4D\u7F6E</span>
<span class="token class-name">ChannelPipeline</span> <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandler</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> handlers<span class="token punctuation">)</span><span class="token comment">//\u628A\u4E00\u4E2A\u4E1A\u52A1\u5904\u7406\u7C7B\uFF08handler\uFF09\u6DFB\u52A0\u5230\u94FE\u4E2D\u7684\u6700\u540E\u4E00\u4E2A\u4F4D\u7F6E</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_7-5-channelhandlercontext" tabindex="-1"><a class="header-anchor" href="#_7-5-channelhandlercontext" aria-hidden="true">#</a> 7.5 ChannelHandlerContext</h2><p>1)\u4FDD\u5B58 Channel \u76F8\u5173\u7684\u6240\u6709\u4E0A\u4E0B\u6587\u4FE1\u606F\uFF0C\u540C\u65F6\u5173\u8054\u4E00\u4E2A ChannelHandler \u5BF9\u8C61 2)\u5373ChannelHandlerContext \u4E2D \u5305 \u542B \u4E00 \u4E2A \u5177 \u4F53 \u7684 \u4E8B \u4EF6 \u5904 \u7406 \u5668 ChannelHandler \uFF0C \u540C \u65F6ChannelHandlerContext \u4E2D\u4E5F\u7ED1\u5B9A\u4E86\u5BF9\u5E94\u7684 pipeline \u548C Channel \u7684\u4FE1\u606F\uFF0C\u65B9\u4FBF\u5BF9 ChannelHandler\u8FDB\u884C\u8C03\u7528. 3)\u5E38\u7528\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ChannelFuture</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u5173\u95ED\u901A\u9053</span>
<span class="token class-name">ChannelOutboundInvoker</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u5237\u65B0</span>
<span class="token class-name">ChannelFuture</span> <span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span><span class="token comment">//\u5C06\u6570\u636E\u5199\u5230ChannelPipeline\u4E2D\u5F53\u524DChannelHandler \u7684\u4E0B\u4E00\u4E2A ChannelHandler \u5F00\u59CB\u5904\u7406\uFF08\u51FA\u7AD9\uFF09</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_7-6-channeloption" tabindex="-1"><a class="header-anchor" href="#_7-6-channeloption" aria-hidden="true">#</a> 7.6 ChannelOption</h2><p>1)Netty \u5728\u521B\u5EFA Channel \u5B9E\u4F8B\u540E,\u4E00\u822C\u90FD\u9700\u8981\u8BBE\u7F6E ChannelOption \u53C2\u6570\u3002 2)ChannelOption \u53C2\u6570\u5982\u4E0B:</p><p>ChannelOption.SO_BACKLOG:\u5BF9\u5E94 TCP/IP \u534F\u8BAE listen \u51FD\u6570\u4E2D\u7684 backlog \u53C2\u6570\uFF0C\u7528\u6765\u521D\u59CB\u5316\u670D\u52A1\u5668\u53EF\u8FDE\u63A5\u961F\u5217\u5927\u5C0F\u3002\u670D\u52A1\u7AEF\u5904\u7406\u5BA2\u6237\u7AEF\u8FDE\u63A5\u8BF7\u6C42\u662F\u987A\u5E8F\u5904\u7406\u7684\uFF0C\u6240\u4EE5\u540C\u4E00\u65F6\u95F4\u53EA\u80FD\u5904\u7406\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8FDE\u63A5\u3002\u591A\u4E2A\u5BA2\u6237\u7AEF\u6765\u7684\u65F6\u5019\uFF0C\u670D\u52A1\u7AEF\u5C06\u4E0D\u80FD\u5904\u7406\u7684\u5BA2\u6237\u7AEF\u8FDE\u63A5\u8BF7\u6C42\u653E\u5728\u961F\u5217\u4E2D\u7B49\u5F85\u5904\u7406\uFF0Cbacklog \u53C2\u6570\u6307\u5B9A\u4E86\u961F\u5217\u7684\u5927\u5C0F\u3002 ChannelOption.SO_KEEPALIVE:\u4E00\u76F4\u4FDD\u6301\u8FDE\u63A5\u6D3B\u52A8\u72B6\u6001</p><h2 id="_7-7-eventloopgroup" tabindex="-1"><a class="header-anchor" href="#_7-7-eventloopgroup" aria-hidden="true">#</a> 7.7 EventLoopGroup</h2><p>1)EventLoopGroup \u662F\u4E00\u7EC4 EventLoop \u7684\u62BD\u8C61\uFF0CNetty \u4E3A\u4E86\u66F4\u597D\u7684\u5229\u7528\u591A\u6838 CPU \u8D44\u6E90\uFF0C\u4E00\u822C\u4F1A\u6709\u591A\u4E2A EventLoop \u540C\u65F6\u5DE5\u4F5C\uFF0C\u6BCF\u4E2A EventLoop \u7EF4\u62A4\u7740\u4E00\u4E2A Selector \u5B9E\u4F8B\u3002 2)EventLoopGroup \u63D0\u4F9B next \u63A5\u53E3\uFF0C\u53EF\u4EE5\u4ECE\u7EC4\u91CC\u9762\u6309\u7167\u4E00\u5B9A\u89C4\u5219\u83B7\u53D6\u5176\u4E2D\u4E00\u4E2A EventLoop\u6765\u5904\u7406\u4EFB\u52A1\u3002\u5728 Netty \u670D\u52A1\u5668\u7AEF\u7F16\u7A0B\u4E2D\uFF0C\u6211\u4EEC\u4E00\u822C\u90FD\u9700\u8981\u63D0\u4F9B\u4E24\u4E2A EventLoopGroup\uFF0C\u4F8B\u5982\uFF1ABossEventLoopGroup \u548C WorkerEventLoopGroup\u3002</p><p>3)\u901A\u5E38\u4E00\u4E2A\u670D\u52A1\u7AEF\u53E3\u5373\u4E00\u4E2A ServerSocketChannel\u5BF9\u5E94\u4E00\u4E2ASelector \u548C\u4E00\u4E2AEventLoop\u7EBF\u7A0B\u3002BossEventLoop \u8D1F\u8D23\u63A5\u6536\u5BA2\u6237\u7AEF\u7684\u8FDE\u63A5\u5E76\u5C06 SocketChannel \u4EA4\u7ED9 WorkerEventLoopGroup \u6765\u8FDB\u884C IO \u5904\u7406\uFF0C\u5982\u4E0B\u56FE\u6240\u793A</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210907183322483.png" alt="image-20210907183322483" loading="lazy"></p><ul><li>BossEventLoopGroup \u901A\u5E38\u662F\u4E00\u4E2A\u5355\u7EBF\u7A0B\u7684 EventLoop\uFF0CEventLoop \u7EF4\u62A4\u7740\u4E00\u4E2A\u6CE8\u518C\u4E86ServerSocketChannel \u7684 Selector \u5B9E\u4F8BBossEventLoop \u4E0D\u65AD\u8F6E\u8BE2 Selector \u5C06\u8FDE\u63A5\u4E8B\u4EF6\u5206\u79BB\u51FA\u6765</li><li>\u901A\u5E38\u662F OP_ACCEPT \u4E8B\u4EF6\uFF0C\u7136\u540E\u5C06\u63A5\u6536\u5230\u7684 SocketChannel \u4EA4\u7ED9 WorkerEventLoopGroup</li><li>WorkerEventLoopGroup \u4F1A\u7531 next \u9009\u62E9\u5176\u4E2D\u4E00\u4E2A EventLoop\u6765\u5C06\u8FD9\u4E2A SocketChannel \u6CE8\u518C\u5230\u5176\u7EF4\u62A4\u7684 Selector \u5E76\u5BF9\u5176\u540E\u7EED\u7684 IO \u4E8B\u4EF6\u8FDB\u884C\u5904\u7406</li></ul><p>4)\u5E38\u7528\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u6784\u9020\u65B9\u6CD5</span>
<span class="token keyword">public</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u65AD\u5F00\u8FDE\u63A5\uFF0C\u5173\u95ED\u7EBF\u7A0B</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_7-8-unpooled-\u7C7B" tabindex="-1"><a class="header-anchor" href="#_7-8-unpooled-\u7C7B" aria-hidden="true">#</a> 7.8 Unpooled \u7C7B</h2><p>1)Netty \u63D0\u4F9B\u4E00\u4E2A\u4E13\u95E8\u7528\u6765\u64CD\u4F5C\u7F13\u51B2\u533A(\u5373Netty\u7684\u6570\u636E\u5BB9\u5668)\u7684\u5DE5\u5177\u7C7B 2)\u5E38\u7528\u65B9\u6CD5\u5982\u4E0B\u6240\u793A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u901A\u8FC7\u7ED9\u5B9A\u7684\u6570\u636E\u548C\u5B57\u7B26\u7F16\u7801\u8FD4\u56DE\u4E00\u4E2A ByteBuf \u5BF9\u8C61\uFF08\u7C7B\u4F3C\u4E8E NIO \u4E2D\u7684 ByteBuffer \u4F46\u6709\u533A\u522B\uFF09</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuf</span> <span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> string<span class="token punctuation">,</span> <span class="token class-name">Charset</span> charset<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>3)\u4E3E\u4F8B\u8BF4\u660EUnpooled \u83B7\u53D6 Netty\u7684\u6570\u636E\u5BB9\u5668ByteBuf \u7684\u57FA\u672C\u4F7F\u7528</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210907183616450.png" alt="image-20210907183616450" loading="lazy"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buf</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/07/11:22
 * <span class="token keyword">@description</span> netty ByteBuf demo
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyBufDemo1</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token doc-comment comment">/**
         * \u8BF4\u660E:
         *  1.netty\u4E2D\u7684byteBuf\u65E0\u9700\u50CFnio\u4E2D\u7684byteBuffer\u8981\u8FDB\u884Cflip()
         *  2.\u5E95\u5C42\u5305\u542B\u4E00\u4E2A\u6570\u7EC4\uFF0Cbyte[]
         *  3.\u5E95\u5C42\u4E09\u4E2A\u53C2\u6570:readerIndex,writeIndex,capacity\u5C06buffer\u5206\u6210\u4E09\u4E2A\u533A\u57DF
         *      0--readerIndex:\u5DF2\u8BFB\u533A\u57DF
         *      readerIndex--writeIndex:\u53EF\u8BFB\u533A\u57DF
         *      writerIndex--capacity:\u53EF\u5199\u533A\u57DF
         */</span>
        <span class="token class-name">ByteBuf</span> byteBuf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            byteBuf<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;byteBuf capacity=&quot;</span> <span class="token operator">+</span> byteBuf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> byteBuf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buf</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">Unpooled</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/07/11:31
 * <span class="token keyword">@description</span> netty byteBuf demo
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyBufDemo2</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ByteBuf</span> byteBuf <span class="token operator">=</span> <span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;hello,world&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>byteBuf<span class="token punctuation">.</span><span class="token function">hasArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content <span class="token operator">=</span> byteBuf<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;arrayOffset=&quot;</span> <span class="token operator">+</span> byteBuf<span class="token punctuation">.</span><span class="token function">arrayOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;readerIndex=&quot;</span> <span class="token operator">+</span> byteBuf<span class="token punctuation">.</span><span class="token function">readerIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;writerIndex=&quot;</span> <span class="token operator">+</span> byteBuf<span class="token punctuation">.</span><span class="token function">writerIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;capacity=&quot;</span> <span class="token operator">+</span> byteBuf<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u53EF\u8BFB\u5B57\u8282:&quot;</span> <span class="token operator">+</span> byteBuf<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6309\u7167\u8303\u56F4\u8BFB\u53D6:&quot;</span> <span class="token operator">+</span> byteBuf<span class="token punctuation">.</span><span class="token function">getCharSequence</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="_7-9-netty\u5E94\u7528\u5B9E\u4F8B-\u7FA4\u804A\u7CFB\u7EDF" tabindex="-1"><a class="header-anchor" href="#_7-9-netty\u5E94\u7528\u5B9E\u4F8B-\u7FA4\u804A\u7CFB\u7EDF" aria-hidden="true">#</a> 7.9 Netty\u5E94\u7528\u5B9E\u4F8B-\u7FA4\u804A\u7CFB\u7EDF</h2><p>\u5B9E\u4F8B\u8981\u6C42:<br> 1)\u7F16\u5199\u4E00\u4E2A Netty \u7FA4\u804A\u7CFB\u7EDF\uFF0C\u5B9E\u73B0\u670D\u52A1\u5668\u7AEF\u548C\u5BA2\u6237\u7AEF\u4E4B\u95F4\u7684\u6570\u636E\u7B80\u5355\u901A\u8BAF\uFF08\u975E\u963B\u585E\uFF09 2)\u5B9E\u73B0\u591A\u4EBA\u7FA4\u804A 3)\u670D\u52A1\u5668\u7AEF\uFF1A\u53EF\u4EE5\u76D1\u6D4B\u7528\u6237\u4E0A\u7EBF\uFF0C\u79BB\u7EBF\uFF0C\u5E76\u5B9E\u73B0\u6D88\u606F\u8F6C\u53D1\u529F\u80FD 4)\u5BA2\u6237\u7AEF\uFF1A\u901A\u8FC7channel \u53EF\u4EE5\u65E0\u963B\u585E\u53D1\u9001\u6D88\u606F\u7ED9\u5176\u5B83\u6240\u6709\u7528\u6237\uFF0C\u540C\u65F6\u53EF\u4EE5\u63A5\u53D7\u5176\u5B83\u7528\u6237\u53D1\u9001\u7684\u6D88\u606F(\u6709\u670D\u52A1\u5668\u8F6C\u53D1\u5F97\u5230) 5)\u76EE\u7684\uFF1A\u8FDB\u4E00\u6B65\u7406\u89E3Netty\u975E\u963B\u585E\u7F51\u7EDC\u7F16\u7A0B\u673A\u5236</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelOption</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/07/9:55
 * <span class="token keyword">@description</span> netty \u7FA4\u804A\u7CFB\u7EDF\u670D\u52A1\u7AEF
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyGroupChatServerDemo</span> <span class="token punctuation">{</span>

    <span class="token comment">//\u7AEF\u53E3\u53F7</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">NettyGroupChatServerDemo</span><span class="token punctuation">(</span><span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u670D\u52A1\u5668\u542F\u52A8</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">NioEventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NioEventLoopGroup</span> workGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span>workGroup<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_BACKLOG<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childOption</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>SO_KEEPALIVE<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> socketChannel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">//\u52A0\u5165\u89E3\u7801\u5668</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">//\u52A0\u5165\u7F16\u7801\u5668</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">//\u52A0\u5165\u81EA\u5B9A\u4E49handler</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyGroupChatServerHandlerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7FA4\u804A\u7CFB\u7EDF\u670D\u52A1\u5668\u542F\u52A8\u6210\u529F...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">NettyGroupChatServerDemo</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>group<span class="token punctuation">.</span></span><span class="token class-name">ChannelGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>group<span class="token punctuation">.</span></span><span class="token class-name">DefaultChannelGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">GlobalEventExecutor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/07/10:11
 * <span class="token keyword">@description</span> netty \u7FA4\u804A\u7CFB\u7EDF\u670D\u52A1\u7AEFhandler
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyGroupChatServerHandlerDemo</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u5B9A\u4E49\u4E00\u4E2AchannelGroup\u7BA1\u7406\u6240\u6709\u7684channel
     * GlobalEventExecutor.INSTANCE:\u5168\u5C40\u4E8B\u4EF6\u5904\u7406\u5668\uFF0C\u5355\u4F8B
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ChannelGroup</span> channelGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultChannelGroup</span><span class="token punctuation">(</span><span class="token class-name">GlobalEventExecutor</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SimpleDateFormat</span> simpleDateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u8868\u793A\u8FDE\u63A5\u5EFA\u7ACB\uFF0C\u4E00\u65E6\u8FDE\u63A5\uFF0C\u7B2C\u4E00\u4E2A\u6267\u884C
     * <span class="token keyword">@param</span> <span class="token parameter">ctx</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerAdded</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u5C06\u8BE5\u5BA2\u6237\u7AEF\u52A0\u5165\u804A\u5929\u7684\u6D88\u606F\u7FA4\u53D1\u5230\u5404\u4E2Achannel
         */</span>
        channelGroup<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;[\u5BA2\u6237\u7AEF]--&gt;&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; \u52A0\u5165\u804A\u5929--&gt;&quot;</span> <span class="token operator">+</span>
                simpleDateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        channelGroup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u65AD\u5F00\u8FDE\u63A5\uFF0CchannelGroup\u81EA\u52A8\u79FB\u9664\u76F8\u5E94\u7684channel
     * <span class="token keyword">@param</span> <span class="token parameter">ctx</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerRemoved</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        channelGroup<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;[\u5BA2\u6237\u7AEF]--&gt;&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; \u79BB\u5F00\u804A\u5929--&gt;&quot;</span> <span class="token operator">+</span>
                simpleDateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u76D1\u542Cchannel\u4E0D\u5904\u4E8E\u6D3B\u52A8\u72B6\u6001
     * <span class="token keyword">@param</span> <span class="token parameter">ctx</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelInactive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[\u5BA2\u6237\u7AEF]--&gt;&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; \u79BB\u7EBF\u4E86--&gt;&quot;</span>  <span class="token operator">+</span>
                simpleDateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u76D1\u542Cchannel\u5904\u4E8E\u6D3B\u52A8\u72B6\u6001
     * <span class="token keyword">@param</span> <span class="token parameter">ctx</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[\u5BA2\u6237\u7AEF]--&gt;&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; \u4E0A\u7EBF\u4E86--&gt;&quot;</span>  <span class="token operator">+</span>
                simpleDateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u8BFB\u53D6\u6570\u636E
     * <span class="token keyword">@param</span> <span class="token parameter">channelHandlerContext</span>
     * <span class="token keyword">@param</span> <span class="token parameter">s</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> channelHandlerContext<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        channelGroup<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>ch <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u4E0D\u662F\u81EA\u5DF1\uFF0C\u7FA4\u53D1\u6D88\u606F</span>
                ch<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;[\u5BA2\u6237\u7AEF]--&gt;&quot;</span> <span class="token operator">+</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;--&gt;&quot;</span>  <span class="token operator">+</span>
                        simpleDateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u8BF4:&quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u662F\u81EA\u5DF1\uFF0C\u56DE\u663E\u6D88\u606F</span>
                ch<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;[\u81EA\u5DF1]--&gt;&quot;</span> <span class="token operator">+</span> simpleDateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u8BF4:&quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u76D1\u542C\u5F02\u5E38
     * <span class="token keyword">@param</span> <span class="token parameter">ctx</span>
     * <span class="token keyword">@param</span> <span class="token parameter">cause</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>bcel<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>generic<span class="token punctuation">.</span></span>NEW<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/07/10:34
 * <span class="token keyword">@description</span> netty \u7FA4\u804A\u7CFB\u7EDF\u5BA2\u6237\u7AEF
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyGroupChatClientDemo</span> <span class="token punctuation">{</span>

    <span class="token comment">//\u670D\u52A1\u5668\u4E3B\u673A\u5730\u5740</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>

    <span class="token comment">//\u670D\u52A1\u5668\u7AEF\u53E3</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">NettyGroupChatClientDemo</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">,</span> <span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">NioEventLoopGroup</span> eventLoopGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>eventLoopGroup<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> socketChannel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">//\u52A0\u5165\u7F16\u7801\u5668</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//\u52A0\u5165\u89E3\u7801\u5668</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyGroupChatClientHandlerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7FA4\u804A\u7CFB\u7EDF\u5BA2\u6237\u7AEF\u542F\u52A8\u6210\u529F...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//            channelFuture.channel().closeFuture().sync();</span>

            <span class="token class-name">Channel</span> channel <span class="token operator">=</span> channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">hasNextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> s <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            eventLoopGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">NettyGroupChatClientDemo</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>groupchat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/07/10:46
 * <span class="token keyword">@description</span> netty \u7FA4\u804A\u7CFB\u7EDF\u5BA2\u6237\u7AEFhandler
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyGroupChatClientHandlerDemo</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="_7-10-netty\u5FC3\u8DF3\u68C0\u6D4B\u673A\u5236\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#_7-10-netty\u5FC3\u8DF3\u68C0\u6D4B\u673A\u5236\u6848\u4F8B" aria-hidden="true">#</a> 7.10 Netty\u5FC3\u8DF3\u68C0\u6D4B\u673A\u5236\u6848\u4F8B</h2><p>\u5B9E\u4F8B\u8981\u6C42:<br> 1)\u7F16\u5199\u4E00\u4E2A Netty\u5FC3\u8DF3\u68C0\u6D4B\u673A\u5236\u6848\u4F8B, \u5F53\u670D\u52A1\u5668\u8D85\u8FC73\u79D2\u6CA1\u6709\u8BFB\u65F6\uFF0C\u5C31\u63D0\u793A\u8BFB\u7A7A\u95F2 2)\u5F53\u670D\u52A1\u5668\u8D85\u8FC75\u79D2\u6CA1\u6709\u5199\u64CD\u4F5C\u65F6\uFF0C\u5C31\u63D0\u793A\u5199\u7A7A\u95F2 3)\u5B9E\u73B0\u5F53\u670D\u52A1\u5668\u8D85\u8FC77\u79D2\u6CA1\u6709\u8BFB\u6216\u8005\u5199\u64CD\u4F5C\u65F6\uFF0C\u5C31\u63D0\u793A\u8BFB\u5199\u7A7A\u95F2</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>heartbeat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LogLevel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LoggingHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span></span><span class="token class-name">IdleStateHandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/07/10:57
 * <span class="token keyword">@description</span> netty \u5FC3\u8DF3\u68C0\u6D4B\u673A\u5236
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyHeartBeatDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">NioEventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NioEventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span>INFO<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> socketChannel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token doc-comment comment">/**
                             * \u8BF4\u660E:
                             *  1.IdleStateHandler\u662Fnetty\u63D0\u4F9B\u7684\u5904\u7406\u7A7A\u95F2\u72B6\u6001\u7684\u5904\u7406\u5668
                             *  2.readerIdleTime:\u8868\u793A\u591A\u957F\u65F6\u95F4\u6CA1\u6709\u8BFB\u64CD\u4F5C\uFF0C\u5C31\u4F1A\u53D1\u9001\u4E00\u4E2A\u5FC3\u8DF3\u68C0\u6D4B\u5305\u68C0\u6D4B\u662F\u5426\u8FDE\u63A5
                             *  3.writerIdleTime:\u8868\u793A\u591A\u957F\u65F6\u95F4\u6CA1\u6709\u5199\u64CD\u4F5C\uFF0C\u5C31\u4F1A\u53D1\u9001\u4E00\u4E2A\u5FC3\u8DF3\u68C0\u6D4B\u5305\u68C0\u6D4B\u662F\u5426\u8FDE\u63A5
                             *  4.allIdleTime:\u8868\u793A\u591A\u957F\u65F6\u95F4\u6CA1\u6709\u8BFB\u5199\u64CD\u4F5C\uFF0C\u5C31\u4F1A\u53D1\u9001\u4E00\u4E2A\u5FC3\u8DF3\u68C0\u6D4B\u5305\u68C0\u6D4B\u662F\u5426\u8FDE\u63A5
                             *  5.\u5F53IdleStateHandler\u5904\u7406\u5668\u89E6\u53D1\u540E\uFF0C\u5C31\u4F1A\u4F20\u9012\u7ED9\u7BA1\u9053\u7684\u4E0B\u4E00\u4E2Ahandler\u5904\u7406\uFF0C
                             *      \u8C03\u7528\uFF08\u89E6\u53D1\uFF09\u4E0B\u4E00\u4E2Ahandler\u7684userEventTriggered
                             */</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IdleStateHandler</span><span class="token punctuation">(</span>
                                    <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyHeartBeatHandlerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>heartbeat</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span></span><span class="token class-name">IdleStateEvent</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/07/11:07
 * <span class="token keyword">@description</span> netty \u5FC3\u8DF3\u68C0\u6D4B\u673A\u5236handler
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyHeartBeatHandlerDemo</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userEventTriggered</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> evt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>evt <span class="token keyword">instanceof</span> <span class="token class-name">IdleStateEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">IdleStateEvent</span> event <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IdleStateEvent</span><span class="token punctuation">)</span> evt<span class="token punctuation">;</span>

            <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> READER_IDLE<span class="token operator">:</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BFB\u7A7A\u95F2...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> WRITER_IDLE<span class="token operator">:</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5199\u7A7A\u95F2...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> ALL_IDLE<span class="token operator">:</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BFB\u5199\u7A7A\u95F2...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="_7-11-netty-\u901A\u8FC7websocket\u7F16\u7A0B\u5B9E\u73B0\u670D\u52A1\u5668\u548C\u5BA2\u6237\u7AEF\u957F\u8FDE\u63A5" tabindex="-1"><a class="header-anchor" href="#_7-11-netty-\u901A\u8FC7websocket\u7F16\u7A0B\u5B9E\u73B0\u670D\u52A1\u5668\u548C\u5BA2\u6237\u7AEF\u957F\u8FDE\u63A5" aria-hidden="true">#</a> 7.11 Netty \u901A\u8FC7WebSocket\u7F16\u7A0B\u5B9E\u73B0\u670D\u52A1\u5668\u548C\u5BA2\u6237\u7AEF\u957F\u8FDE\u63A5</h2><p>\u5B9E\u4F8B\u8981\u6C42:<br> 1)Http\u534F\u8BAE\u662F\u65E0\u72B6\u6001\u7684, \u6D4F\u89C8\u5668\u548C\u670D\u52A1\u5668\u95F4\u7684\u8BF7\u6C42\u54CD\u5E94\u4E00\u6B21\uFF0C\u4E0B\u4E00\u6B21\u4F1A\u91CD\u65B0\u521B\u5EFA\u8FDE\u63A5. 2)\u8981\u6C42\uFF1A\u5B9E\u73B0\u57FA\u4E8EwebSocket\u7684\u957F\u8FDE\u63A5\u7684\u5168\u53CC\u5DE5\u7684\u4EA4\u4E92 3)\u6539\u53D8Http\u534F\u8BAE\u591A\u6B21\u8BF7\u6C42\u7684\u7EA6\u675F\uFF0C\u5B9E\u73B0\u957F\u8FDE\u63A5\u4E86\uFF0C \u670D\u52A1\u5668\u53EF\u4EE5\u53D1\u9001\u6D88\u606F\u7ED9\u6D4F\u89C8\u5668 4)\u5BA2\u6237\u7AEF\u6D4F\u89C8\u5668\u548C\u670D\u52A1\u5668\u7AEF\u4F1A\u76F8\u4E92\u611F\u77E5\uFF0C\u6BD4\u5982\u670D\u52A1\u5668\u5173\u95ED\u4E86\uFF0C\u6D4F\u89C8\u5668\u4F1A\u611F\u77E5\uFF0C\u540C\u6837\u6D4F\u89C8\u5668\u5173\u95ED\u4E86\uFF0C\u670D\u52A1\u5668\u4F1A\u611F\u77E5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>websocket</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpObjectAggregator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServerCodec</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span>websocketx<span class="token punctuation">.</span></span><span class="token class-name">WebSocketServerProtocolHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LogLevel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>logging<span class="token punctuation">.</span></span><span class="token class-name">LoggingHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">ChunkedWriteHandler</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/08/11:16
 * <span class="token keyword">@description</span> netty websocket\u670D\u52A1\u7AEF
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyWebsockerServerDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">NioEventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NioEventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServerBootstrap</span> serverBootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            serverBootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span>workerGroup<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span>INFO<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> socketChannel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//\u52A0\u5165httpserver\u7F16\u89E3\u7801\u5668</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpServerCodec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//\u4EE5\u5757\u7684\u65B9\u5F0F\u5199</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChunkedWriteHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token doc-comment comment">/**
                             * \u8BF4\u660E:
                             *  1.http\u6570\u636E\u5728\u4F20\u8F93\u8FC7\u7A0B\u4E2D\u662F\u5206\u6BB5\uFF0CHttpObjectAggregator\u53EF\u4EE5\u5C06\u591A\u4E2A\u6BB5\u805A\u5408
                             *  2.\u8FD9\u5C31\u662F\u4E3A\u4EC0\u4E48\u5F53\u6D4F\u89C8\u5668\u53D1\u9001\u5927\u91CF\u6570\u636E\u65F6\uFF0C\u4F1A\u53D1\u51FA\u591A\u6B21http\u8BF7\u6C42
                             */</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpObjectAggregator</span><span class="token punctuation">(</span><span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token doc-comment comment">/**
                             * \u8BF4\u660E:
                             *  1.\u5BF9\u5E94websocket,\u5B83\u7684\u6570\u636E\u662F\u4EE5\u5E27(frame)\u7684\u5F62\u5F0F\u4F20\u9012
                             *  2.WebSocketServerProtocolHandler\u7684\u6838\u5FC3\u529F\u80FD\u662F\u5C06http\u534F\u8BAE\u5347\u7EA7\u4E3Aws\u534F\u8BAE\uFF0C\u4FDD\u6301\u957F\u8FDE\u63A5
                             */</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebSocketServerProtocolHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyTextWebsocketFrameHandlerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> serverBootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>websocket</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">SimpleChannelInboundHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>http<span class="token punctuation">.</span>websocketx<span class="token punctuation">.</span></span><span class="token class-name">TextWebSocketFrame</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDateTime</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/08/11:32
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyTextWebsocketFrameHandlerDemo</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TextWebSocketFrame</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">,</span> <span class="token class-name">TextWebSocketFrame</span> textWebSocketFrame<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u670D\u52A1\u5668\u6536\u5230\u6D88\u606F:&quot;</span> <span class="token operator">+</span> textWebSocketFrame<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u56DE\u590D\u6D88\u606F</span>
        channelHandlerContext<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">TextWebSocketFrame</span><span class="token punctuation">(</span><span class="token string">&quot;\u670D\u52A1\u5668\u65F6\u95F4:&quot;</span> <span class="token operator">+</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> textWebSocketFrame<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cause<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">var</span> socket<span class="token punctuation">;</span>
        <span class="token comment">//\u5224\u65AD\u5F53\u524D\u6D4F\u89C8\u5668\u662F\u5426\u652F\u6301websocket</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>WebSocket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:7000/hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> rt <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;responseTx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                rt<span class="token punctuation">.</span>value <span class="token operator">=</span> rt<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span> <span class="token operator">+</span> ev<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> rt <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;responseTx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                rt<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;\u8FDE\u63A5\u5F00\u542F\u4E86...&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> rt <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;responseTx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                rt<span class="token punctuation">.</span>value <span class="token operator">=</span> rt<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\u8FDE\u63A5\u5173\u95ED\u4E86...&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301websocket!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//\u53D1\u9001\u6D88\u606F\u5230\u670D\u52A1\u5668</span>
        <span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>socket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>readyStateWebSocket<span class="token punctuation">.</span><span class="token constant">OPEN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FDE\u63A5\u672A\u5F00\u542F...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token special-attr"><span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token keyword">return</span> <span class="token boolean">false</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span>300px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span>300px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\u53D1\u9001\u6D88\u606F<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>message<span class="token punctuation">.</span>value<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>responseTx<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span>300px<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>300px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\u6E05\u7A7A\u5185\u5BB9<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;responseTx&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token operator">=</span><span class="token string">&#39;&#39;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h1 id="\u7B2C8\u7AE0-google-protobuf" tabindex="-1"><a class="header-anchor" href="#\u7B2C8\u7AE0-google-protobuf" aria-hidden="true">#</a> \u7B2C8\u7AE0 Google Protobuf</h1><h2 id="_8-1-\u7F16\u7801\u548C\u89E3\u7801\u7684\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_8-1-\u7F16\u7801\u548C\u89E3\u7801\u7684\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 8.1 \u7F16\u7801\u548C\u89E3\u7801\u7684\u57FA\u672C\u4ECB\u7ECD</h2><p>1)\u7F16\u5199\u7F51\u7EDC\u5E94\u7528\u7A0B\u5E8F\u65F6\uFF0C\u56E0\u4E3A\u6570\u636E\u5728\u7F51\u7EDC\u4E2D\u4F20\u8F93\u7684\u90FD\u662F\u4E8C\u8FDB\u5236\u5B57\u8282\u7801\u6570\u636E\uFF0C\u5728\u53D1\u9001\u6570\u636E\u65F6\u5C31\u9700\u8981\u7F16\u7801\uFF0C\u63A5\u6536\u6570\u636E\u65F6\u5C31\u9700\u8981\u89E3\u7801 [\u793A\u610F\u56FE] <img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210908164441701.png" alt="image-20210908164441701" loading="lazy"> 2)codec(\u7F16\u89E3\u7801\u5668) \u7684\u7EC4\u6210\u90E8\u5206\u6709\u4E24\u4E2A\uFF1Adecoder(\u89E3\u7801\u5668)\u548C encoder(\u7F16\u7801\u5668)\u3002encoder \u8D1F\u8D23\u628A\u4E1A\u52A1\u6570\u636E\u8F6C\u6362\u6210\u5B57\u8282\u7801\u6570\u636E\uFF0Cdecoder \u8D1F\u8D23\u628A\u5B57\u8282\u7801\u6570\u636E\u8F6C\u6362\u6210\u4E1A\u52A1\u6570\u636E</p><h2 id="_8-2-netty\u4E2D\u7684\u7F16\u89E3\u7801\u5668" tabindex="-1"><a class="header-anchor" href="#_8-2-netty\u4E2D\u7684\u7F16\u89E3\u7801\u5668" aria-hidden="true">#</a> 8.2 Netty\u4E2D\u7684\u7F16\u89E3\u7801\u5668</h2><p>1)Netty \u81EA\u8EAB\u63D0\u4F9B\u4E86\u4E00\u4E9B codec(\u7F16\u89E3\u7801\u5668) 2)Netty \u63D0\u4F9B\u7684\u7F16\u7801\u5668 StringEncoder\uFF0C\u5BF9\u5B57\u7B26\u4E32\u6570\u636E\u8FDB\u884C\u7F16\u7801 ObjectEncoder\uFF0C\u5BF9 Java \u5BF9\u8C61\u8FDB\u884C\u7F16\u7801 3)Netty \u63D0\u4F9B\u7684\u89E3\u7801\u5668 StringDecoder, \u5BF9\u5B57\u7B26\u4E32\u6570\u636E\u8FDB\u884C\u89E3\u7801 ObjectDecoder\uFF0C\u5BF9 Java \u5BF9\u8C61\u8FDB\u884C\u89E3\u7801 4)Netty \u672C\u8EAB\u81EA\u5E26\u7684 ObjectDecoder \u548C ObjectEncoder \u53EF\u4EE5\u7528\u6765\u5B9E\u73B0 POJO \u5BF9\u8C61\u6216\u5404\u79CD\u4E1A\u52A1\u5BF9\u8C61\u7684\u7F16\u7801\u548C\u89E3\u7801\uFF0C\u5E95\u5C42\u4F7F\u7528\u7684\u4ECD\u662F Java \u5E8F\u5217\u5316\u6280\u672F , \u800CJava \u5E8F\u5217\u5316\u6280\u672F\u672C\u8EAB\u6548\u7387\u5C31\u4E0D\u9AD8\uFF0C\u5B58\u5728\u5982\u4E0B\u95EE\u9898: \u65E0\u6CD5\u8DE8\u8BED\u8A00 \u5E8F\u5217\u5316\u540E\u7684\u4F53\u79EF\u592A\u5927\uFF0C\u662F\u4E8C\u8FDB\u5236\u7F16\u7801\u7684 5 \u500D\u591A\u3002 \u5E8F\u5217\u5316\u6027\u80FD\u592A\u4F4E</p><h2 id="_8-3-protobuf\u57FA\u672C\u4ECB\u7ECD\u548C\u4F7F\u7528\u793A\u610F\u56FE" tabindex="-1"><a class="header-anchor" href="#_8-3-protobuf\u57FA\u672C\u4ECB\u7ECD\u548C\u4F7F\u7528\u793A\u610F\u56FE" aria-hidden="true">#</a> 8.3 Protobuf\u57FA\u672C\u4ECB\u7ECD\u548C\u4F7F\u7528\u793A\u610F\u56FE</h2><p>1)Protobuf \u662F Google \u53D1\u5E03\u7684\u5F00\u6E90\u9879\u76EE\uFF0C\u5168\u79F0 Google Protocol Buffers\uFF0C\u662F\u4E00\u79CD\u8F7B\u4FBF\u9AD8\u6548\u7684\u7ED3\u6784\u5316\u6570\u636E\u5B58\u50A8\u683C\u5F0F\uFF0C\u53EF\u4EE5\u7528\u4E8E\u7ED3\u6784\u5316\u6570\u636E\u4E32\u884C\u5316\uFF0C\u6216\u8005\u8BF4\u5E8F\u5217\u5316\u3002\u5B83\u5F88\u9002\u5408\u505A\u6570\u636E\u5B58\u50A8\u6216 RPC[\u8FDC\u7A0B\u8FC7\u7A0B\u8C03\u7528 remote procedure call ] \u6570\u636E\u4EA4\u6362\u683C\u5F0F \u3002\u76EE\u524D\u5F88\u591A\u516C\u53F8 http+json/tcp+protobuf 2)\u53C2\u8003\u6587\u6863 : https://developers.google.com/protocol-buffers/docs/proto \u8BED\u8A00\u6307\u5357 3)Protobuf \u662F\u4EE5 message \u7684\u65B9\u5F0F\u6765\u7BA1\u7406\u6570\u636E\u7684. 4)\u652F\u6301\u8DE8\u5E73\u53F0\u3001\u8DE8\u8BED\u8A00\uFF0C\u5373[\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u5668\u7AEF\u53EF\u4EE5\u662F\u4E0D\u540C\u7684\u8BED\u8A00\u7F16\u5199\u7684] \uFF08\u652F\u6301\u76EE\u524D\u7EDD\u5927\u591A\u6570\u8BED\u8A00\uFF0C\u4F8B\u5982 C++\u3001C#\u3001Java\u3001python \u7B49\uFF09</p><p>5)\u9AD8\u6027\u80FD\uFF0C\u9AD8\u53EF\u9760\u6027 6)\u4F7F\u7528 protobuf \u7F16\u8BD1\u5668\u80FD\u81EA\u52A8\u751F\u6210\u4EE3\u7801\uFF0CProtobuf \u662F\u5C06\u7C7B\u7684\u5B9A\u4E49\u4F7F\u7528.proto \u6587\u4EF6\u8FDB\u884C\u63CF\u8FF0\u3002\u8BF4\u660E\uFF0C\u5728idea \u4E2D\u7F16\u5199 .proto \u6587\u4EF6\u65F6\uFF0C\u4F1A\u81EA\u52A8\u63D0\u793A\u662F\u5426\u4E0B\u8F7D .ptotot \u7F16\u5199\u63D2\u4EF6. \u53EF\u4EE5\u8BA9\u8BED\u6CD5\u9AD8\u4EAE\u3002\u7136\u540E\u901A\u8FC7 protoc.exe \u7F16\u8BD1\u5668\u6839\u636E.proto \u81EA\u52A8\u751F\u6210.java \u6587\u4EF6 7)protobuf \u4F7F\u7528\u793A\u610F\u56FE</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210908165649038.png" alt="image-20210908165649038" loading="lazy"></p><h2 id="_8-4-protobuf\u5FEB\u901F\u5165\u95E8\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#_8-4-protobuf\u5FEB\u901F\u5165\u95E8\u5B9E\u4F8B" aria-hidden="true">#</a> 8.4 Protobuf\u5FEB\u901F\u5165\u95E8\u5B9E\u4F8B</h2><h3 id="_8-4-1-\u5165\u95E8\u5B9E\u4F8B\u4E00" tabindex="-1"><a class="header-anchor" href="#_8-4-1-\u5165\u95E8\u5B9E\u4F8B\u4E00" aria-hidden="true">#</a> 8.4.1 \u5165\u95E8\u5B9E\u4F8B\u4E00</h3><p>\u7F16\u5199\u7A0B\u5E8F\uFF0C\u4F7F\u7528Protobuf\u5B8C\u6210\u5982\u4E0B\u529F\u80FD 1)\u5BA2\u6237\u7AEF\u53EF\u4EE5\u53D1\u9001\u4E00\u4E2AStudent PoJo \u5BF9\u8C61\u5230\u670D\u52A1\u5668 (\u901A\u8FC7 Protobuf \u7F16\u7801) 2)\u670D\u52A1\u7AEF\u80FD\u63A5\u6536Student PoJo \u5BF9\u8C61\uFF0C\u5E76\u663E\u793A\u4FE1\u606F(\u901A\u8FC7 Protobuf \u89E3\u7801)</p><h3 id="_8-4-2-\u5165\u95E8\u5B9E\u4F8B\u4E8C" tabindex="-1"><a class="header-anchor" href="#_8-4-2-\u5165\u95E8\u5B9E\u4F8B\u4E8C" aria-hidden="true">#</a> 8.4.2 \u5165\u95E8\u5B9E\u4F8B\u4E8C</h3><p>\u7F16\u5199\u7A0B\u5E8F\uFF0C\u4F7F\u7528Protobuf\u5B8C\u6210\u5982\u4E0B\u529F\u80FD 1)\u5BA2\u6237\u7AEF\u53EF\u4EE5\u968F\u673A\u53D1\u9001Student PoJo/ Worker PoJo \u5BF9\u8C61\u5230\u670D\u52A1\u5668 (\u901A\u8FC7 Protobuf \u7F16\u7801) 2)\u670D\u52A1\u7AEF\u80FD\u63A5\u6536Student PoJo/ Worker PoJo \u5BF9\u8C61(\u9700\u8981\u5224\u65AD\u662F\u54EA\u79CD\u7C7B\u578B)\uFF0C\u5E76\u663E\u793A\u4FE1\u606F(\u901A\u8FC7 Protobuf \u89E3\u7801)</p><h1 id="\u7B2C9\u7AE0-netty\u7F16\u89E3\u7801\u5668\u548Chandler\u7684\u8C03\u7528\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#\u7B2C9\u7AE0-netty\u7F16\u89E3\u7801\u5668\u548Chandler\u7684\u8C03\u7528\u673A\u5236" aria-hidden="true">#</a> \u7B2C9\u7AE0 Netty\u7F16\u89E3\u7801\u5668\u548Chandler\u7684\u8C03\u7528\u673A\u5236</h1><h2 id="_9-1-\u57FA\u672C\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_9-1-\u57FA\u672C\u8BF4\u660E" aria-hidden="true">#</a> 9.1 \u57FA\u672C\u8BF4\u660E</h2><p>1)netty\u7684\u7EC4\u4EF6\u8BBE\u8BA1\uFF1ANetty\u7684\u4E3B\u8981\u7EC4\u4EF6\u6709Channel\u3001EventLoop\u3001ChannelFuture\u3001ChannelHandler\u3001ChannelPipe\u7B49 2)ChannelHandler\u5145\u5F53\u4E86\u5904\u7406\u5165\u7AD9\u548C\u51FA\u7AD9\u6570\u636E\u7684\u5E94\u7528\u7A0B\u5E8F\u903B\u8F91\u7684\u5BB9\u5668\u3002\u4F8B\u5982\uFF0C\u5B9E\u73B0ChannelInboundHandler\u63A5\u53E3\uFF08ChannelInboundHandlerAdapter\uFF09\uFF0C\u4F60\u5C31\u53EF\u4EE5\u63A5\u6536\u5165\u7AD9\u4E8B\u4EF6\u548C\u6570\u636E\uFF0C\u8FD9\u4E9B\u6570\u636E\u4F1A\u88AB\u4E1A\u52A1\u903B\u8F91\u5904\u7406\u3002\u5F53\u8981\u7ED9\u5BA2\u6237\u7AEF\u53D1\u9001\u54CD\u5E94\u65F6\uFF0C\u4E5F\u53EF\u4EE5\u4ECEChannelInboundHandler\u51B2\u5237\u6570\u636E\u3002\u4E1A\u52A1\u903B\u8F91\u901A\u5E38\u5199\u5728\u4E00\u4E2A\u6216\u8005\u591A\u4E2AChannelInboundHandler\u4E2D\u3002ChannelOutboundHandler\u539F\u7406\u4E00\u6837\uFF0C\u53EA\u4E0D\u8FC7\u5B83\u662F\u7528\u6765\u5904\u7406\u51FA\u7AD9\u6570\u636E\u7684</p><p>3)ChannelPipeline\u63D0\u4F9B\u4E86ChannelHandler\u94FE\u7684\u5BB9\u5668\u3002\u4EE5\u5BA2\u6237\u7AEF\u5E94\u7528\u7A0B\u5E8F\u4E3A\u4F8B\uFF0C\u5982\u679C\u4E8B\u4EF6\u7684\u8FD0\u52A8\u65B9\u5411\u662F\u4ECE\u5BA2\u6237\u7AEF\u5230\u670D\u52A1\u7AEF\u7684\uFF0C\u90A3\u4E48\u6211\u4EEC\u79F0\u8FD9\u4E9B\u4E8B\u4EF6\u4E3A\u51FA\u7AD9\u7684\uFF0C\u5373\u5BA2\u6237\u7AEF\u53D1\u9001\u7ED9\u670D\u52A1\u7AEF\u7684\u6570\u636E\u4F1A\u901A\u8FC7pipeline\u4E2D\u7684\u4E00\u7CFB\u5217ChannelOutboundHandler\uFF0C\u5E76\u88AB\u8FD9\u4E9BHandler\u5904\u7406\uFF0C\u53CD\u4E4B\u5219\u79F0\u4E3A\u5165\u7AD9\u7684</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210908170347040.png" alt="image-20210908170347040" loading="lazy"></p><h2 id="_9-2-\u7F16\u7801\u89E3\u7801\u5668" tabindex="-1"><a class="header-anchor" href="#_9-2-\u7F16\u7801\u89E3\u7801\u5668" aria-hidden="true">#</a> 9.2 \u7F16\u7801\u89E3\u7801\u5668</h2><p>1)\u5F53Netty\u53D1\u9001\u6216\u8005\u63A5\u53D7\u4E00\u4E2A\u6D88\u606F\u7684\u65F6\u5019\uFF0C\u5C31\u5C06\u4F1A\u53D1\u751F\u4E00\u6B21\u6570\u636E\u8F6C\u6362\u3002\u5165\u7AD9\u6D88\u606F\u4F1A\u88AB\u89E3\u7801\uFF1A\u4ECE\u5B57\u8282\u8F6C\u6362\u4E3A\u53E6\u4E00\u79CD\u683C\u5F0F\uFF08\u6BD4\u5982java\u5BF9\u8C61\uFF09\uFF1B\u5982\u679C\u662F\u51FA\u7AD9\u6D88\u606F\uFF0C\u5B83\u4F1A\u88AB\u7F16\u7801\u6210\u5B57\u8282\u3002 2)Netty\u63D0\u4F9B\u4E00\u7CFB\u5217\u5B9E\u7528\u7684\u7F16\u89E3\u7801\u5668\uFF0C\u4ED6\u4EEC\u90FD\u5B9E\u73B0\u4E86ChannelInboundHadnler\u6216\u8005ChannelOutboundHandler\u63A5\u53E3\u3002\u5728\u8FD9\u4E9B\u7C7B\u4E2D\uFF0CchannelRead\u65B9\u6CD5\u5DF2\u7ECF\u88AB\u91CD\u5199\u4E86\u3002\u4EE5\u5165\u7AD9\u4E3A\u4F8B\uFF0C\u5BF9\u4E8E\u6BCF\u4E2A\u4ECE\u5165\u7AD9Channel\u8BFB\u53D6\u7684\u6D88\u606F\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u4F1A\u88AB\u8C03\u7528\u3002\u968F\u540E\uFF0C\u5B83\u5C06\u8C03\u7528\u7531\u89E3\u7801\u5668\u6240\u63D0\u4F9B\u7684decode()\u65B9\u6CD5\u8FDB\u884C\u89E3\u7801\uFF0C\u5E76\u5C06\u5DF2\u7ECF\u89E3\u7801\u7684\u5B57\u8282\u8F6C\u53D1\u7ED9ChannelPipeline\u4E2D\u7684\u4E0B\u4E00\u4E2AChannelInboundHandler\u3002</p><h2 id="_9-3-\u89E3\u7801\u5668-bytetomessagedecoder" tabindex="-1"><a class="header-anchor" href="#_9-3-\u89E3\u7801\u5668-bytetomessagedecoder" aria-hidden="true">#</a> 9.3 \u89E3\u7801\u5668-ByteToMessageDecoder</h2><p>1)\u5173\u7CFB\u7EE7\u627F\u56FE <img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210908170506506.png" alt="image-20210908170506506" loading="lazy"> 2)\u7531\u4E8E\u4E0D\u53EF\u80FD\u77E5\u9053\u8FDC\u7A0B\u8282\u70B9\u662F\u5426\u4F1A\u4E00\u6B21\u6027\u53D1\u9001\u4E00\u4E2A\u5B8C\u6574\u7684\u4FE1\u606F\uFF0Ctcp\u6709\u53EF\u80FD\u51FA\u73B0\u7C98\u5305\u62C6\u5305\u7684\u95EE\u9898\uFF0C\u8FD9\u4E2A\u7C7B\u4F1A\u5BF9\u5165\u7AD9\u6570\u636E\u8FDB\u884C\u7F13\u51B2\uFF0C\u76F4\u5230\u5B83\u51C6\u5907\u597D\u88AB\u5904\u7406.</p><p>3)\u4E00\u4E2A\u5173\u4E8EByteToMessageDecoder\u5B9E\u4F8B\u5206\u6790</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ToIntegerDecoder</span> <span class="token keyword">extends</span> <span class="token class-name">ByteToMessageDecoder</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ByteBuf</span> in<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">readableBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            out<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>\u8BF4\u660E\uFF1A</strong> \u8FD9\u4E2A\u4F8B\u5B50\uFF0C\u6BCF\u6B21\u5165\u7AD9\u4ECEByteBuf\u4E2D\u8BFB\u53D64\u5B57\u8282\uFF0C\u5C06\u5176\u89E3\u7801\u4E3A\u4E00\u4E2Aint\uFF0C\u7136\u540E\u5C06\u5B83\u6DFB\u52A0\u5230\u4E0B\u4E00\u4E2AList\u4E2D\u3002\u5F53\u6CA1\u6709\u66F4\u591A\u5143\u7D20\u53EF\u4EE5\u88AB\u6DFB\u52A0\u5230\u8BE5List\u4E2D\u65F6\uFF0C\u5B83\u7684\u5185\u5BB9\u5C06\u4F1A\u88AB\u53D1\u9001\u7ED9\u4E0B\u4E00\u4E2AChannelInboundHandler\u3002int\u5728\u88AB\u6DFB\u52A0\u5230List\u4E2D\u65F6\uFF0C\u4F1A\u88AB\u81EA\u52A8\u88C5\u7BB1\u4E3AInteger\u3002\u5728\u8C03\u7528readInt()\u65B9\u6CD5\u524D\u5FC5\u987B\u9A8C\u8BC1\u6240\u8F93\u5165\u7684ByteBuf\u662F\u5426\u5177\u6709\u8DB3\u591F\u7684\u6570\u636E\u3002</p><h2 id="_9-4-netty\u7684handler\u94FE\u7684\u8C03\u7528\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_9-4-netty\u7684handler\u94FE\u7684\u8C03\u7528\u673A\u5236" aria-hidden="true">#</a> 9.4 Netty\u7684handler\u94FE\u7684\u8C03\u7528\u673A\u5236</h2><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210908170730425.png" alt="image-20210908170730425" loading="lazy"></p><p><strong>\u603B\u7ED3\uFF1A</strong></p><ul><li><p>\u4E0D\u8BBA\u89E3\u7801\u5668handler \u8FD8\u662F \u7F16\u7801\u5668handler \u5373\u63A5\u6536\u7684\u6D88\u606F\u7C7B\u578B\u5FC5\u987B\u4E0E\u5F85\u5904\u7406\u7684\u6D88\u606F\u7C7B\u578B\u4E00\u81F4\uFF0C\u5426\u5219\u8BE5handler\u4E0D\u4F1A\u88AB\u6267\u884C</p></li><li><p>\u5728\u89E3\u7801\u5668 \u8FDB\u884C\u6570\u636E\u89E3\u7801\u65F6\uFF0C\u9700\u8981\u5224\u65AD \u7F13\u5B58\u533A(ByteBuf)\u7684\u6570\u636E\u662F\u5426\u8DB3\u591F \uFF0C\u5426\u5219\u63A5\u6536\u5230\u7684\u7ED3\u679C\u4F1A\u671F\u671B\u7ED3\u679C\u53EF\u80FD\u4E0D\u4E00\u81F4</p></li></ul><h2 id="_9-5-\u89E3\u7801\u5668-replayingdecoder" tabindex="-1"><a class="header-anchor" href="#_9-5-\u89E3\u7801\u5668-replayingdecoder" aria-hidden="true">#</a> 9.5 \u89E3\u7801\u5668-ReplayingDecoder</h2><ol><li></li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ReplayingDecoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">ByteToMessageDecoder</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2)ReplayingDecoder\u6269\u5C55\u4E86ByteToMessageDecoder\u7C7B\uFF0C\u4F7F\u7528\u8FD9\u4E2A\u7C7B\uFF0C\u6211\u4EEC\u4E0D\u5FC5\u8C03\u7528readableBytes()\u65B9\u6CD5\u3002\u53C2\u6570S\u6307\u5B9A\u4E86\u7528\u6237\u72B6\u6001\u7BA1\u7406\u7684\u7C7B\u578B\uFF0C\u5176\u4E2DVoid\u4EE3\u8868\u4E0D\u9700\u8981\u72B6\u6001\u7BA1\u7406 3)ReplayingDecoder\u4F7F\u7528\u65B9\u4FBF\uFF0C\u4F46\u5B83\u4E5F\u6709\u4E00\u4E9B\u5C40\u9650\u6027\uFF1A \u5E76\u4E0D\u662F\u6240\u6709\u7684 ByteBuf \u64CD\u4F5C\u90FD\u88AB\u652F\u6301\uFF0C\u5982\u679C\u8C03\u7528\u4E86\u4E00\u4E2A\u4E0D\u88AB\u652F\u6301\u7684\u65B9\u6CD5\uFF0C\u5C06\u4F1A\u629B\u51FA\u4E00\u4E2A UnsupportedOperationException\u3002 ReplayingDecoder \u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\u53EF\u80FD\u7A0D\u6162\u4E8E ByteToMessageDecoder\uFF0C\u4F8B\u5982\u7F51\u7EDC\u7F13\u6162\u5E76\u4E14\u6D88\u606F\u683C\u5F0F\u590D\u6742\u65F6\uFF0C\u6D88\u606F\u4F1A\u88AB\u62C6\u6210\u4E86\u591A\u4E2A\u788E\u7247\uFF0C\u901F\u5EA6\u53D8\u6162</p><h2 id="_9-6-\u5176\u5B83\u7F16\u89E3\u7801\u5668" tabindex="-1"><a class="header-anchor" href="#_9-6-\u5176\u5B83\u7F16\u89E3\u7801\u5668" aria-hidden="true">#</a> 9.6 \u5176\u5B83\u7F16\u89E3\u7801\u5668</h2><p>1)LineBasedFrameDecoder\uFF1A\u8FD9\u4E2A\u7C7B\u5728Netty\u5185\u90E8\u4E5F\u6709\u4F7F\u7528\uFF0C\u5B83\u4F7F\u7528\u884C\u5C3E\u63A7\u5236\u5B57\u7B26\uFF08\\n\u6216\u8005\\r\\n\uFF09\u4F5C\u4E3A\u5206\u9694\u7B26\u6765\u89E3\u6790\u6570\u636E\u3002 2)DelimiterBasedFrameDecoder\uFF1A\u4F7F\u7528\u81EA\u5B9A\u4E49\u7684\u7279\u6B8A\u5B57\u7B26\u4F5C\u4E3A\u6D88\u606F\u7684\u5206\u9694\u7B26\u3002 3)HttpObjectDecoder\uFF1A\u4E00\u4E2AHTTP\u6570\u636E\u7684\u89E3\u7801\u5668 4)LengthFieldBasedFrameDecoder\uFF1A\u901A\u8FC7\u6307\u5B9A\u957F\u5EA6\u6765\u6807\u8BC6\u6574\u5305\u6D88\u606F\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u81EA\u52A8\u7684\u5904\u7406\u9ECF\u5305\u548C\u534A\u5305\u6D88\u606F\u3002</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210908170942565.png" alt="image-20210908170942565" loading="lazy"></p><h2 id="_9-7-log4j-\u6574\u5408\u5230netty" tabindex="-1"><a class="header-anchor" href="#_9-7-log4j-\u6574\u5408\u5230netty" aria-hidden="true">#</a> 9.7 Log4j \u6574\u5408\u5230Netty</h2><p>1)\u5728Maven \u4E2D\u6DFB\u52A0\u5BF9Log4j\u7684\u4F9D\u8D56 \u5728 pom.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code> 		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-simple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>2)\u914D\u7F6E Log4j , \u5728 resources/log4j.properties</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">log4j.rootLogger</span> <span class="token punctuation">=</span> <span class="token attr-value">debug,stdout</span>
<span class="token attr-name">log4j.appender.stdout</span> <span class="token punctuation">=</span> <span class="token attr-value">org.apache.log4j.ConsoleAppender</span>
<span class="token attr-name">log4j.appender.stdout.layout</span> <span class="token punctuation">=</span> <span class="token attr-value">org.apache.log4j.PatternLayout</span>
<span class="token attr-name">log4j.appender.console.layout.ConversionPattern</span> <span class="token punctuation">=</span>  <span class="token attr-value">%d{ABSOLUTE} %5p %c{ 1 }:%L - %m%n</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h1 id="\u7B2C10\u7AE0-tcp-\u7C98\u5305\u548C\u62C6\u5305" tabindex="-1"><a class="header-anchor" href="#\u7B2C10\u7AE0-tcp-\u7C98\u5305\u548C\u62C6\u5305" aria-hidden="true">#</a> \u7B2C10\u7AE0 TCP \u7C98\u5305\u548C\u62C6\u5305</h1><h2 id="_10-1-\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_10-1-\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 10.1 \u57FA\u672C\u4ECB\u7ECD</h2><p>1)TCP\u662F\u9762\u5411\u8FDE\u63A5\u7684\u3001\u9762\u5411\u6D41\u7684\uFF0C\u63D0\u4F9B\u9AD8\u53EF\u9760\u6027\u670D\u52A1\u3002\u6536\u53D1\u4E24\u7AEF\uFF08\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u5668\u7AEF\uFF09\u90FD\u8981\u6709\u4E00\u4E00\u6210\u5BF9\u7684socket\uFF0C\u56E0\u6B64\uFF0C\u53D1\u9001\u7AEF\u4E3A\u4E86\u5C06\u591A</p><p>\u4E2A\u53D1\u7ED9\u63A5\u6536\u7AEF\u7684\u5305\uFF0C\u66F4\u6709\u6548\u7684\u53D1\u7ED9\u5BF9\u65B9\uFF0C\u4F7F\u7528\u4E86\u4F18\u5316\u65B9\u6CD5\uFF08Nagle\u7B97\u6CD5\uFF09\uFF0C\u5C06\u591A\u6B21\u95F4\u9694\u8F83\u5C0F\u4E14\u6570\u636E\u91CF\u5C0F\u7684\u6570\u636E\uFF0C\u5408\u5E76\u6210\u4E00\u4E2A\u5927\u7684\u6570\u636E\u5757\uFF0C</p><p>\u7136\u540E\u8FDB\u884C\u5C01\u5305\u3002\u8FD9\u6837\u505A\u867D\u7136\u63D0\u9AD8\u4E86\u6548\u7387\uFF0C\u4F46\u662F\u63A5\u6536\u7AEF\u5C31\u96BE\u4E8E\u5206\u8FA8\u51FA\u5B8C\u6574\u7684\u6570\u636E\u5305\u4E86\uFF0C\u56E0\u4E3A\u9762\u5411\u6D41\u7684\u901A\u4FE1\u662F\u65E0\u6D88\u606F\u4FDD\u62A4\u8FB9\u754C\u7684;</p><p>2)\u7531\u4E8ETCP\u65E0\u6D88\u606F\u4FDD\u62A4\u8FB9\u754C, \u9700\u8981\u5728\u63A5\u6536\u7AEF\u5904\u7406\u6D88\u606F\u8FB9\u754C\u95EE\u9898\uFF0C\u4E5F\u5C31\u662F\u6211\u4EEC\u6240\u8BF4\u7684\u7C98\u5305\u3001\u62C6\u5305\u95EE\u9898;</p><p>3)TCP\u7C98\u5305\u3001\u62C6\u5305\u56FE\u89E3:</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210911234818545.png" alt="image-20210911234818545" loading="lazy"></p><p><strong>\u8BF4\u660E\uFF1A</strong></p><p>\u5047\u8BBE\u5BA2\u6237\u7AEF\u5206\u522B\u53D1\u9001\u4E86\u4E24\u4E2A\u6570\u636E\u5305D1\u548CD2\u7ED9\u670D\u52A1\u7AEF\uFF0C\u7531\u4E8E\u670D\u52A1\u7AEF\u4E00\u6B21\u8BFB\u53D6\u5230\u5B57\u8282\u6570\u662F\u4E0D\u786E\u5B9A\u7684\uFF0C\u6545\u53EF\u80FD\u5B58\u5728\u4EE5\u4E0B\u56DB\u79CD\u60C5\u51B5\uFF1A a.\u670D\u52A1\u7AEF\u5206\u4E24\u6B21\u8BFB\u53D6\u5230\u4E86\u4E24\u4E2A\u72EC\u7ACB\u7684\u6570\u636E\u5305\uFF0C\u5206\u522B\u662FD1\u548CD2\uFF0C\u6CA1\u6709\u7C98\u5305\u548C\u62C6\u5305 b.\u670D\u52A1\u7AEF\u4E00\u6B21\u63A5\u53D7\u5230\u4E86\u4E24\u4E2A\u6570\u636E\u5305\uFF0CD1\u548CD2\u7C98\u5408\u5728\u4E00\u8D77\uFF0C\u79F0\u4E4B\u4E3ATCP\u7C98\u5305 c.\u670D\u52A1\u7AEF\u5206\u4E24\u6B21\u8BFB\u53D6\u5230\u4E86\u6570\u636E\u5305\uFF0C\u7B2C\u4E00\u6B21\u8BFB\u53D6\u5230\u4E86\u5B8C\u6574\u7684D1\u5305\u548CD2\u5305\u7684\u90E8\u5206\u5185\u5BB9\uFF0C\u7B2C\u4E8C\u6B21\u8BFB\u53D6\u5230\u4E86D2\u5305\u7684\u5269\u4F59\u5185\u5BB9\uFF0C\u8FD9\u79F0\u4E4B\u4E3ATCP\u62C6\u5305 d.\u670D\u52A1\u7AEF\u5206\u4E24\u6B21\u8BFB\u53D6\u5230\u4E86\u6570\u636E\u5305\uFF0C\u7B2C\u4E00\u6B21\u8BFB\u53D6\u5230\u4E86D1\u5305\u7684\u90E8\u5206\u5185\u5BB9D1_1\uFF0C\u7B2C\u4E8C\u6B21\u8BFB\u53D6\u5230\u4E86D1\u5305\u7684\u5269\u4F59\u90E8\u5206\u5185\u5BB9D1_2\u548C\u5B8C\u6574\u7684D2\u5305\u3002</p><h2 id="_10-2-\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_10-2-\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 10.2 \u89E3\u51B3\u65B9\u6848</h2><p>1)\u4F7F\u7528\u81EA\u5B9A\u4E49\u534F\u8BAE + \u7F16\u89E3\u7801\u5668\u6765\u89E3\u51B3;</p><p>2)\u5173\u952E\u5C31\u662F\u8981\u89E3\u51B3\u670D\u52A1\u5668\u7AEF\u6BCF\u6B21\u8BFB\u53D6\u6570\u636E\u957F\u5EA6\u7684\u95EE\u9898\uFF0C\u8FD9\u4E2A\u95EE\u9898\u89E3\u51B3\uFF0C\u5C31\u4E0D\u4F1A\u51FA\u73B0\u670D\u52A1\u5668\u591A\u8BFB\u6216\u5C11\u8BFB\u6570\u636E\u7684\u95EE\u9898\uFF0C\u4ECE\u800C\u907F\u514D\u7684TCP \u7C98\u5305\u3001\u62C6\u5305 \u3002</p><p>3\uFF09\u770B\u4E00\u4E2A\u5177\u4F53\u7684\u5B9E\u4F8B: \u8981\u6C42\u5BA2\u6237\u7AEF\u53D1\u9001 5 \u4E2A Message \u5BF9\u8C61, \u5BA2\u6237\u7AEF\u6BCF\u6B21\u53D1\u9001\u4E00\u4E2A Message \u5BF9\u8C61; \u670D\u52A1\u5668\u7AEF\u6BCF\u6B21\u63A5\u6536\u4E00\u4E2AMessage, \u52065\u6B21\u8FDB\u884C\u89E3\u7801\uFF0C \u6BCF\u8BFB\u53D6\u5230 \u4E00\u4E2AMessage , \u4F1A\u56DE\u590D\u4E00\u4E2AMessage \u5BF9\u8C61 \u7ED9\u5BA2\u6237\u7AEF\u3002</p><h1 id="\u7B2C11\u7AE0-netty-\u6838\u5FC3\u6E90\u7801\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#\u7B2C11\u7AE0-netty-\u6838\u5FC3\u6E90\u7801\u5256\u6790" aria-hidden="true">#</a> \u7B2C11\u7AE0 Netty \u6838\u5FC3\u6E90\u7801\u5256\u6790</h1><h2 id="_11-1-\u57FA\u672C\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_11-1-\u57FA\u672C\u8BF4\u660E" aria-hidden="true">#</a> 11.1 \u57FA\u672C\u8BF4\u660E</h2><p>1)\u53EA\u6709\u770B\u8FC7Netty\u6E90\u7801\uFF0C\u624D\u80FD\u8BF4\u662F\u771F\u7684\u638C\u63E1\u4E86Netty\u6846\u67B6;</p><p>2)\u5728 io.netty.example \u5305\u4E0B\uFF0C\u6709\u5F88\u591ANetty\u6E90\u7801\u6848\u4F8B\uFF0C\u53EF\u4EE5\u7528\u6765\u5206\u6790</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210911235405341.png" alt="image-20210911235405341" loading="lazy"></p><h2 id="_11-2-netty-\u542F\u52A8\u8FC7\u7A0B\u6E90\u7801\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#_11-2-netty-\u542F\u52A8\u8FC7\u7A0B\u6E90\u7801\u5256\u6790" aria-hidden="true">#</a> 11.2 Netty \u542F\u52A8\u8FC7\u7A0B\u6E90\u7801\u5256\u6790</h2><h2 id="_11-3-netty-\u63A5\u53D7\u8BF7\u6C42\u8FC7\u7A0B\u6E90\u7801\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#_11-3-netty-\u63A5\u53D7\u8BF7\u6C42\u8FC7\u7A0B\u6E90\u7801\u5256\u6790" aria-hidden="true">#</a> 11.3 Netty \u63A5\u53D7\u8BF7\u6C42\u8FC7\u7A0B\u6E90\u7801\u5256\u6790</h2><h2 id="_11-4-pipeline-handler-handlercontext\u521B\u5EFA\u6E90\u7801\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#_11-4-pipeline-handler-handlercontext\u521B\u5EFA\u6E90\u7801\u5256\u6790" aria-hidden="true">#</a> 11.4 Pipeline Handler HandlerContext\u521B\u5EFA\u6E90\u7801\u5256\u6790</h2><h2 id="_11-5-channelpipeline-\u8C03\u5EA6-handler-\u7684\u6E90\u7801\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#_11-5-channelpipeline-\u8C03\u5EA6-handler-\u7684\u6E90\u7801\u5256\u6790" aria-hidden="true">#</a> 11.5 ChannelPipeline \u8C03\u5EA6 handler \u7684\u6E90\u7801\u5256\u6790</h2><h2 id="_11-6-netty-\u5FC3\u8DF3-heartbeat-\u670D\u52A1\u6E90\u7801\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#_11-6-netty-\u5FC3\u8DF3-heartbeat-\u670D\u52A1\u6E90\u7801\u5256\u6790" aria-hidden="true">#</a> 11.6 Netty \u5FC3\u8DF3(heartbeat)\u670D\u52A1\u6E90\u7801\u5256\u6790</h2><h2 id="_11-7-netty-\u6838\u5FC3\u7EC4\u4EF6-eventloop-\u6E90\u7801\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#_11-7-netty-\u6838\u5FC3\u7EC4\u4EF6-eventloop-\u6E90\u7801\u5256\u6790" aria-hidden="true">#</a> 11.7 Netty \u6838\u5FC3\u7EC4\u4EF6 EventLoop \u6E90\u7801\u5256\u6790</h2><h2 id="_11-8-handler-\u4E2D\u52A0\u5165\u7EBF\u7A0B\u6C60\u548Ccontext-\u4E2D\u6DFB\u52A0\u7EBF\u7A0B\u6C60\u7684\u6E90\u7801\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#_11-8-handler-\u4E2D\u52A0\u5165\u7EBF\u7A0B\u6C60\u548Ccontext-\u4E2D\u6DFB\u52A0\u7EBF\u7A0B\u6C60\u7684\u6E90\u7801\u5256\u6790" aria-hidden="true">#</a> 11.8 handler \u4E2D\u52A0\u5165\u7EBF\u7A0B\u6C60\u548CContext \u4E2D\u6DFB\u52A0\u7EBF\u7A0B\u6C60\u7684\u6E90\u7801\u5256\u6790</h2><h1 id="\u7B2C12\u7AE0-\u7528netty\u5B9E\u73B0dubbo-rpc" tabindex="-1"><a class="header-anchor" href="#\u7B2C12\u7AE0-\u7528netty\u5B9E\u73B0dubbo-rpc" aria-hidden="true">#</a> \u7B2C12\u7AE0 \u7528Netty\u5B9E\u73B0Dubbo RPC</h1><h2 id="_12-1-rpc\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_12-1-rpc\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> 12.1 RPC\u57FA\u672C\u4ECB\u7ECD</h2><p>1)RPC\uFF08Remote Procedure Call\uFF09\u2014 \u8FDC\u7A0B\u8FC7\u7A0B\u8C03\u7528\uFF0C\u662F\u4E00\u4E2A\u8BA1\u7B97\u673A\u901A\u4FE1\u534F\u8BAE\u3002\u8BE5\u534F\u8BAE\u5141\u8BB8\u8FD0\u884C\u4E8E\u4E00\u53F0\u8BA1\u7B97\u673A\u7684\u7A0B\u5E8F\u8C03\u7528\u53E6\u4E00\u53F0\u8BA1\u7B97\u673A\u7684\u5B50\u7A0B\u5E8F\uFF0C\u800C\u7A0B\u5E8F\u5458\u65E0\u9700\u989D\u5916\u5730\u4E3A\u8FD9\u4E2A\u4EA4\u4E92\u4F5C\u7528\u7F16\u7A0B;</p><p>2)\u4E24\u4E2A\u6216\u591A\u4E2A\u5E94\u7528\u7A0B\u5E8F\u90FD\u5206\u5E03\u5728\u4E0D\u540C\u7684\u670D\u52A1\u5668\u4E0A\uFF0C\u5B83\u4EEC\u4E4B\u95F4\u7684\u8C03\u7528\u90FD\u50CF\u662F\u672C\u5730\u65B9\u6CD5\u8C03\u7528\u4E00\u6837(\u5982\u56FE);</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210911235807804.png" alt="image-20210911235807804" loading="lazy"></p><p>3)\u5E38\u89C1\u7684 RPC \u6846\u67B6\u6709: \u6BD4\u8F83\u77E5\u540D\u7684\u5982\u963F\u91CC\u7684Dubbo\u3001google\u7684gRPC\u3001Go\u8BED\u8A00\u7684rpcx\u3001Apache\u7684thrift\uFF0C Spring \u65D7\u4E0B\u7684 Spring Cloud\u3002</p><h2 id="_12-2-rpc\u8C03\u7528\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_12-2-rpc\u8C03\u7528\u6D41\u7A0B" aria-hidden="true">#</a> 12.2 RPC\u8C03\u7528\u6D41\u7A0B</h2><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/rearend/Java/20.Netty/image-20210912000010003.png" alt="image-20210912000010003" loading="lazy"></p><p><strong>\u672F\u8BED\u8BF4\u660E</strong>\uFF1A\u5728RPC \u4E2D\uFF0C Client \u53EB\u670D\u52A1\u6D88\u8D39\u8005\uFF0CServer \u53EB\u670D\u52A1\u63D0\u4F9B\u8005</p><p><strong>PRC\u8C03\u7528\u6D41\u7A0B\u8BF4\u660E:</strong> \u2460\u670D\u52A1\u6D88\u8D39\u65B9(client)\u4EE5\u672C\u5730\u8C03\u7528\u65B9\u5F0F\u8C03\u7528\u670D\u52A1 \u2461client stub \u63A5\u6536\u5230\u8C03\u7528\u540E\u8D1F\u8D23\u5C06\u65B9\u6CD5\u3001\u53C2\u6570\u7B49\u5C01\u88C5\u6210\u80FD\u591F\u8FDB\u884C\u7F51\u7EDC\u4F20\u8F93\u7684\u6D88\u606F\u4F53 \u2462client stub \u5C06\u6D88\u606F\u8FDB\u884C\u7F16\u7801\u5E76\u53D1\u9001\u5230\u670D\u52A1\u7AEF \u2463server stub \u6536\u5230\u6D88\u606F\u540E\u8FDB\u884C\u89E3\u7801 \u2464server stub \u6839\u636E\u89E3\u7801\u7ED3\u679C\u8C03\u7528\u672C\u5730\u7684\u670D\u52A1 \u2465\u672C\u5730\u670D\u52A1\u6267\u884C\u5E76\u5C06\u7ED3\u679C\u8FD4\u56DE\u7ED9 server stub \u2466server stub \u5C06\u8FD4\u56DE\u5BFC\u5165\u7ED3\u679C\u8FDB\u884C\u7F16\u7801\u5E76\u53D1\u9001\u81F3\u6D88\u8D39\u65B9 \u2467client stub \u63A5\u6536\u5230\u6D88\u606F\u5E76\u8FDB\u884C\u89E3\u7801 \u2468\u670D\u52A1\u6D88\u8D39\u65B9(client)\u5F97\u5230\u7ED3\u679C \u5C0F\u7ED3\uFF1ARPC \u7684\u76EE\u6807\u5C31\u662F\u5C06 2-8 \u8FD9\u4E9B\u6B65\u9AA4\u90FD\u5C01\u88C5\u8D77\u6765\uFF0C\u7528\u6237\u65E0\u9700\u5173\u5FC3\u8FD9\u4E9B\u7EC6\u8282\uFF0C\u53EF\u4EE5\u50CF\u8C03\u7528\u672C\u5730\u65B9\u6CD5\u4E00\u6837\u5373\u53EF\u5B8C\u6210\u8FDC\u7A0B\u670D\u52A1\u8C03\u7528\u3002</p><h2 id="_12-3-\u5B9E\u73B0-dubbo-rpc-\u57FA\u4E8Enetty" tabindex="-1"><a class="header-anchor" href="#_12-3-\u5B9E\u73B0-dubbo-rpc-\u57FA\u4E8Enetty" aria-hidden="true">#</a> 12.3 \u5B9E\u73B0 dubbo RPC(\u57FA\u4E8ENetty)</h2><p><strong>\u9700\u6C42\u8BF4\u660E:</strong> dubbo \u5E95\u5C42\u4F7F\u7528\u4E86 Netty \u4F5C\u4E3A\u7F51\u7EDC\u901A\u8BAF\u6846\u67B6\uFF0C\u8981\u6C42\u7528 Netty \u5B9E\u73B0\u4E00\u4E2A\u7B80\u5355\u7684 RPC \u6846\u67B6 \u6A21\u4EFF dubbo\uFF0C\u6D88\u8D39\u8005\u548C\u63D0\u4F9B\u8005\u7EA6\u5B9A\u63A5\u53E3\u548C\u534F\u8BAE\uFF0C\u6D88\u8D39\u8005\u8FDC\u7A0B\u8C03\u7528\u63D0\u4F9B\u8005\u7684\u670D\u52A1\uFF0C\u63D0\u4F9B\u8005\u8FD4\u56DE\u4E00\u4E2A\u5B57\u7B26\u4E32\uFF0C\u6D88\u8D39\u8005\u6253\u5370\u63D0\u4F9B\u8005\u8FD4\u56DE\u7684\u6570\u636E\u3002\u5E95\u5C42\u7F51\u7EDC\u901A\u4FE1\u4F7F\u7528 Netty 4.1.20 <strong>\u8BBE\u8BA1\u8BF4\u660E:</strong> \u521B\u5EFA\u4E00\u4E2A\u63A5\u53E3\uFF0C\u5B9A\u4E49\u62BD\u8C61\u65B9\u6CD5\u3002\u7528\u4E8E\u6D88\u8D39\u8005\u548C\u63D0\u4F9B\u8005\u4E4B\u95F4\u7684\u7EA6\u5B9A\u3002 \u521B\u5EFA\u4E00\u4E2A\u63D0\u4F9B\u8005\uFF0C\u8BE5\u7C7B\u9700\u8981\u76D1\u542C\u6D88\u8D39\u8005\u7684\u8BF7\u6C42\uFF0C\u5E76\u6309\u7167\u7EA6\u5B9A\u8FD4\u56DE\u6570\u636E\u3002 \u521B\u5EFA\u4E00\u4E2A\u6D88\u8D39\u8005\uFF0C\u8BE5\u7C7B\u9700\u8981\u900F\u660E\u7684\u8C03\u7528\u81EA\u5DF1\u4E0D\u5B58\u5728\u7684\u65B9\u6CD5\uFF0C\u5185\u90E8\u9700\u8981\u4F7F\u7528 Netty \u8BF7\u6C42\u63D0\u4F9B\u8005\u8FD4\u56DE\u6570\u636E\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/11/10:28
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HelloService</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>provider</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span><span class="token class-name">HelloService</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/11/10:30
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">HelloService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6536\u5230\u5BA2\u6237\u7AEF\u6D88\u606F:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;\u4F60\u597D\uFF0C\u5BA2\u6237\u7AEF\uFF0C\u6211\u5DF2\u7ECF\u6536\u5230\u4F60\u7684\u6D88\u606F[&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;\u4F60\u597D\uFF0C\u5BA2\u6237\u7AEF\uFF0C\u6211\u5DF2\u7ECF\u6536\u5230\u4F60\u7684\u6D88\u606F&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>netty</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/11/10:34
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startServer</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">,</span><span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token function">start</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">,</span><span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">NioEventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NioEventLoopGroup</span> workGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServerBootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span>workGroup<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> socketChannel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


                            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> bootstrap<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>netty</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>provider<span class="token punctuation">.</span></span><span class="token class-name">HelloServiceImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/11/10:39
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u83B7\u5F97\u5BA2\u6237\u7AEF\u53D1\u9001\u7684\u6D88\u606F\uFF0C\u5E76\u8C03\u7528\u670D\u52A1</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;msg=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u5BA2\u6237\u7AEF\u5728\u8C03\u7528\u670D\u52A1\u7684\u65F6\u5019\uFF0C\u9700\u8981\u5B9A\u4E49\u4E00\u4E2A\u534F\u8BAE</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;HelloService#hello#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> index <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            ctx<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>netty</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Callable</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/11/10:50
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClientHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ChannelHandlerContext</span> channelHandlerContext<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> reuslt<span class="token punctuation">;</span> <span class="token comment">//\u8FD4\u56DE\u7684\u7ED3\u679C</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> param<span class="token punctuation">;</span> <span class="token comment">//\u5BA2\u6237\u7AEF\u8C03\u7528\u65B9\u6CD5\u65F6\uFF0C\u4F20\u5165\u7684\u53C2\u6570</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelActive</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        channelHandlerContext <span class="token operator">=</span> ctx<span class="token punctuation">;</span> <span class="token comment">//\u5728\u5176\u4ED6\u65B9\u6CD5\u4F1A\u4F7F\u7528\u5230ctx</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        reuslt<span class="token operator">=</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u5524\u9192\u7B49\u5F85\u7684\u7EBF\u7A0B</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u88AB\u4EE3\u7406\u5BF9\u8C61\u8C03\u7528\uFF0C\u53D1\u9001\u6570\u636E\u7ED9\u670D\u52A1\u5668\uFF0C--&gt;wait--&gt;\u7B49\u5F85\u88AB\u5524\u9192(channelRead)--&gt;\u8FD4\u56DE\u7ED3\u679C
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">Object</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        channelHandlerContext<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u8FDB\u884Cwait\uFF0C\u7B49\u5F85channelRead\u65B9\u6CD5\u83B7\u53D6\u5230\u670D\u52A1\u5668\u7684\u7ED3\u679C\u540E\uFF0C\u5524\u9192
         */</span>
        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> reuslt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParam</span><span class="token punctuation">(</span><span class="token class-name">String</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>param <span class="token operator">=</span> param<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>netty</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelOption</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelPipeline</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/11/12:20
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NettyClient</span> <span class="token punctuation">{</span>

    <span class="token comment">//\u521B\u5EFA\u7EBF\u7A0B\u6C60</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">NettyClientHandler</span> nettyClientHandler<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u7F16\u5199\u65B9\u6CD5\u4F7F\u7528\u4EE3\u7406\u6A21\u5F0F\uFF0C\u83B7\u53D6\u4E00\u4E2A\u4EE3\u7406\u5BF9\u8C61
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> serviceClass<span class="token punctuation">,</span><span class="token keyword">final</span> <span class="token class-name">String</span> providerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>serviceClass<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>nettyClientHandler  <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">//\u8BBE\u7F6E\u8981\u53D1\u7ED9\u670D\u52A1\u5668\u7684\u4FE1\u606F</span>
                    nettyClientHandler<span class="token punctuation">.</span><span class="token function">setParam</span><span class="token punctuation">(</span>providerName <span class="token operator">+</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">return</span> executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>nettyClientHandler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u521D\u59CB\u5316\u5BA2\u6237\u7AEF</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        nettyClientHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Bootstrap</span> bootstrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        bootstrap<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>TCP_NODELAY<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> socketChannel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>nettyClientHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            bootstrap<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>provider</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>netty<span class="token punctuation">.</span></span><span class="token class-name">NettyServer</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/11/10:32
 * <span class="token keyword">@description</span> rpc\u670D\u52A1\u63D0\u4F9B\u8005
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProviderServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">NettyServer</span><span class="token punctuation">.</span><span class="token function">startServer</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>consumer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span></span><span class="token class-name">HelloService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>cccyl<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>netty<span class="token punctuation">.</span></span><span class="token class-name">NettyClient</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> cyl
 * <span class="token keyword">@date</span> 2021/09/11/12:36
 * <span class="token keyword">@description</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerServer</span> <span class="token punctuation">{</span>

    <span class="token comment">//\u5B9A\u4E49\u534F\u8BAE\u5934</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> providerName <span class="token operator">=</span> <span class="token string">&quot;HelloService#hello#&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u521B\u5EFA\u4E00\u4E2A\u6D88\u8D39\u8005</span>
        <span class="token class-name">NettyClient</span> nettyClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NettyClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u521B\u5EFA\u4EE3\u7406\u5BF9\u8C61</span>
        <span class="token class-name">HelloService</span> helloService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HelloService</span><span class="token punctuation">)</span> nettyClient<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">HelloService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> providerName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u901A\u8FC7\u4EE3\u7406\u5BF9\u8C61\u8C03\u7528\u670D\u52A1\u63D0\u4F9B\u8005\u7684\u65B9\u6CD5</span>
        <span class="token class-name">String</span> hello_world <span class="token operator">=</span> helloService<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">&quot;hello world333&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hello_world<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div>`,374);function g(w,v){const a=c("ExternalLinkIcon");return u(),o(l,null,[r,k,n("blockquote",null,[n("p",null,[n("a",b,[m,p(a)])])]),d,n("blockquote",null,[n("p",null,[n("a",h,[y,p(a)])])]),f],64)}var S=e(i,[["render",g],["__file","Netty.html.vue"]]);export{S as default};
