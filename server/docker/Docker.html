<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://chenyl8848.github.io/server/docker/Docker.html"><meta property="og:site_name" content="Java陈序员"><meta property="og:title" content="Docker 万字入门教程"><meta property="og:type" content="article"><meta property="og:updated_time" content="2024-10-10T03:26:59.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Docker"><meta property="article:published_time" content="2022-04-10T00:00:00.000Z"><meta property="article:modified_time" content="2024-10-10T03:26:59.000Z"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3316994_227lwxrw41z.css"><title>Docker 万字入门教程 | Java陈序员</title><meta name="description" content="Java陈序员的个人博客网站">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.7c8a6ce0.css">
    <link rel="modulepreload" href="/assets/app.06d697e7.js"><link rel="modulepreload" href="/assets/Docker.html.4e09560a.js"><link rel="modulepreload" href="/assets/Docker.html.9c1b51e3.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.webp" alt="Java陈序员"><!----><span class="site-name hide-in-pad">Java陈序员</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" arialabel="首页"><i class="icon iconfont icon-home"></i>首页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="后端"><span class="title"><i class="icon iconfont icon-rearend"></i>后端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/rearend/java/" class="nav-link" arialabel="Java"><i class="icon iconfont icon-java"></i>Java<!----></a></li><li class="dropdown-item"><a href="/rearend/spring/" class="nav-link" arialabel="Spring"><i class="icon iconfont icon-spring"></i>Spring<!----></a></li><li class="dropdown-item"><a href="/rearend/springBoot/" class="nav-link" arialabel="Spring Boot"><i class="icon iconfont icon-springboot"></i>Spring Boot<!----></a></li><li class="dropdown-item"><a href="/rearend/microServices/" class="nav-link" arialabel="微服务"><i class="icon iconfont icon-microServices"></i>微服务<!----></a></li><li class="dropdown-item"><a href="/rearend/dataStructure/" class="nav-link" arialabel="数据结构"><i class="icon iconfont icon-dataStructure"></i>数据结构<!----></a></li><li class="dropdown-item"><a href="/rearend/algorithm/" class="nav-link" arialabel="算法"><i class="icon iconfont icon-algorithm"></i>算法<!----></a></li><li class="dropdown-item"><a href="/rearend/designPattern/" class="nav-link" arialabel="设计模式"><i class="icon iconfont icon-designPattern"></i>设计模式<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="中间件"><span class="title"><i class="icon iconfont icon-middleware"></i>中间件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/middleware/database/" class="nav-link" arialabel="数据库"><i class="icon iconfont icon-database"></i>数据库<!----></a></li><li class="dropdown-item"><a href="/middleware/noSQL/" class="nav-link" arialabel="NoSQL"><i class="icon iconfont icon-noSQL"></i>NoSQL<!----></a></li><li class="dropdown-item"><a href="/middleware/mq/" class="nav-link" arialabel="MQ"><i class="icon iconfont icon-MQ"></i>MQ<!----></a></li><li class="dropdown-item"><a href="/middleware/zookeeper/" class="nav-link" arialabel="ZooKeeper"><i class="icon iconfont icon-zookeeper"></i>ZooKeeper<!----></a></li><li class="dropdown-item"><a href="/middleware/elasticsearch/" class="nav-link" arialabel="ElasticSearch"><i class="icon iconfont icon-elasticsearch"></i>ElasticSearch<!----></a></li><li class="dropdown-item"><a href="/middleware/prometheus/" class="nav-link" arialabel="Prometheus"><i class="icon iconfont icon-prometheus"></i>Prometheus<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="服务器"><span class="title"><i class="icon iconfont icon-server"></i>服务器</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/server/linux/" class="nav-link" arialabel="Linux"><i class="icon iconfont icon-linux"></i>Linux<!----></a></li><li class="dropdown-item"><a href="/server/docker/" class="nav-link active" arialabel="Docker"><i class="icon iconfont icon-docker"></i>Docker<!----></a></li><li class="dropdown-item"><a href="/server/kubernetes/" class="nav-link" arialabel="Kubernetes"><i class="icon iconfont icon-kubernetes"></i>Kubernetes<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="AI"><span class="title"><i class="icon iconfont icon-wuguan"></i>AI</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/ai/assistant/" class="nav-link" arialabel="AI 助手"><i class="icon iconfont icon-Cursor"></i>AI 助手<!----></a></li><li class="dropdown-item"><a href="/ai/framework/" class="nav-link" arialabel="AI 框架"><i class="icon iconfont icon-Aisucai"></i>AI 框架<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="前端"><span class="title"><i class="icon iconfont icon-wangye"></i>前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>框架</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/framework/js/" class="nav-link" arialabel="JavaScript"><i class="icon iconfont icon-java_script"></i>JavaScript<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/nodejs/" class="nav-link" arialabel="Node.js"><i class="icon iconfont icon-node-js"></i>Node.js<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/vue/" class="nav-link" arialabel="Vue.js"><i class="icon iconfont icon-vue"></i>Vue.js<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/react/" class="nav-link" arialabel="React"><i class="icon iconfont icon-react"></i>React<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/mp/" class="nav-link" arialabel="小程序"><i class="icon iconfont icon-xiaochengxu"></i>小程序<!----></a></li><li class="dropdown-subitem"><a href="/web/framework/blog/" class="nav-link" arialabel="Blog"><i class="icon iconfont icon-folder-vuepress"></i>Blog<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="索引"><span class="title"><i class="icon iconfont icon-index"></i>索引</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article/" class="nav-link" arialabel="文章"><i class="icon iconfont icon-articles"></i>文章<!----></a></li><li class="dropdown-item"><a href="/category/java/" class="nav-link" arialabel="分类"><i class="icon iconfont icon-category"></i>分类<!----></a></li><li class="dropdown-item"><a href="/tag/" class="nav-link" arialabel="标签"><i class="icon iconfont icon-tag"></i>标签<!----></a></li><li class="dropdown-item"><a href="/timeline/" class="nav-link" arialabel="时间轴"><i class="icon iconfont icon-timeLine"></i>时间轴<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzkzOTM3NjAzOQ==&amp;action=getalbum&amp;album_id=2783119709868212224&amp;scene=126&amp;sessionid=-659761542&amp;uin=&amp;key=&amp;devicetype=Windows+11+x64&amp;version=6309092b&amp;lang=zh_CN&amp;ascene=0&amp;session_us=gh_b840974cfe99" rel="noopener noreferrer" target="_blank" arialabel="开源项目" class="nav-link"><i class="icon iconfont icon-note"></i>开源项目<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/chenyl8848/chenyl8848.github.io" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" arialabelledby="outlook"><title id="outlook" lang="en">outlook icon</title><g fill="currentColor"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></g></svg><div class="outlook-dropdown"><!----></div></button></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/server/docker/" class="nav-link sidebar-link sidebar-page" arialabel="Docker"><i class="icon iconfont icon-docker"></i>Docker<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/server/docker/Docker.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" arialabel="Docker 万字入门教程"><!---->Docker 万字入门教程<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel><!----><!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_1-docker-简介" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1. Docker 简介"><!---->1. Docker 简介<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_1-1-官方定义" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.1 官方定义"><!---->1.1 官方定义<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_1-2-docker-的起源" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.2 Docker 的起源"><!---->1.2 Docker 的起源<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_1-3-docker-的优势" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.3 Docker 的优势"><!---->1.3 Docker 的优势<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_1-4-docker-和虚拟机的区别" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.4 Docker 和虚拟机的区别"><!---->1.4 Docker 和虚拟机的区别<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_2-docker-的安装" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2. Docker 的安装"><!---->2. Docker 的安装<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_2-1-安装-docker-centos7-x" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.1 安装 Docker(centos7.x)"><!---->2.1 安装 Docker(centos7.x)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_2-2-bash-安装-通用所有平台" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2.2 bash 安装(通用所有平台)"><!---->2.2 bash 安装(通用所有平台)<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_3-docker-的核心架构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3. Docker 的核心架构"><!---->3. Docker 的核心架构<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_4-docker-配置阿里镜像加速服务" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4. Docker 配置阿里镜像加速服务"><!---->4. Docker 配置阿里镜像加速服务<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_4-1-docker-运行流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.1 Docker 运行流程"><!---->4.1 Docker 运行流程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_4-2-docker-配置阿里云镜像加速" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.2 Docker 配置阿里云镜像加速"><!---->4.2 Docker 配置阿里云镜像加速<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_5-docker-的入门应用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5. Docker 的入门应用"><!---->5. Docker 的入门应用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_6-docker-常用命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6. Docker 常用命令"><!---->6. Docker 常用命令<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_6-1-辅助命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.1 辅助命令"><!---->6.1 辅助命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_6-2-images-镜像命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.2 Images 镜像命令"><!---->6.2 Images 镜像命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_6-3-contrainer-容器命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.3 Contrainer 容器命令"><!---->6.3 Contrainer 容器命令<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_7-docker-的镜像原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7. Docker 的镜像原理"><!---->7. Docker 的镜像原理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_7-1-镜像是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1 镜像是什么？"><!---->7.1 镜像是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_7-2-为什么一个镜像会那么大" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2 为什么一个镜像会那么大？"><!---->7.2 为什么一个镜像会那么大？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_7-3-docker-镜像原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3 Docker 镜像原理"><!---->7.3 Docker 镜像原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_7-4-为什么-docker-镜像要采用这种分层结构呢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.4 为什么 Docker 镜像要采用这种分层结构呢?"><!---->7.4 为什么 Docker 镜像要采用这种分层结构呢?<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_8-docker-安装常用服务" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.Docker 安装常用服务"><!---->8.Docker 安装常用服务<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_8-1-安装-mysql" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.1 安装 MySQL"><!---->8.1 安装 MySQL<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_8-2-安装-redis" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.2 安装 Redis"><!---->8.2 安装 Redis<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_8-3-安装-nginx" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.3 安装 Nginx"><!---->8.3 安装 Nginx<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_8-4-安装-tomcat" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.4 安装 Tomcat"><!---->8.4 安装 Tomcat<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_8-5-安装-mongodb-数据库" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.5 安装 MongoDB 数据库"><!---->8.5 安装 MongoDB 数据库<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_8-6-安装-elasticsearch" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="8.6 安装 ElasticSearch"><!---->8.6 安装 ElasticSearch<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_10-docker-中出现如下错误解决方案" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="10. Docker 中出现如下错误解决方案"><!---->10. Docker 中出现如下错误解决方案<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_11-dockerfile" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="11. Dockerfile"><!---->11. Dockerfile<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_11-1-什么是-dockerfile" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="11.1 什么是 Dockerfile"><!---->11.1 什么是 Dockerfile<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_11-2-dockerfile-解析过程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="11.2 Dockerfile 解析过程"><!---->11.2 Dockerfile 解析过程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_11-3-dockerfile-的保留命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="11.3 Dockerfile 的保留命令"><!---->11.3 Dockerfile 的保留命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_11-4-dockerfile-构建-springboot-项目部署" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="11.4 Dockerfile 构建 SpringBoot 项目部署"><!---->11.4 Dockerfile 构建 SpringBoot 项目部署<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_12-高级网络配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="12. 高级网络配置"><!---->12. 高级网络配置<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_12-1-说明" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="12.1 说明"><!---->12.1 说明<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_12-2-docker-网络操作命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="12.2 Docker 网络操作命令"><!---->12.2 Docker 网络操作命令<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_12-3-容器之间使用网络通信" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="12.3 容器之间使用网络通信"><!---->12.3 容器之间使用网络通信<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_13-高级数据卷配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="13. 高级数据卷配置"><!---->13. 高级数据卷配置<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_13-1-说明" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="13.1 说明"><!---->13.1 说明<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_13-2-数据卷操作命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="13.2 数据卷操作命令"><!---->13.2 数据卷操作命令<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_14-docker-compose" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="14. Docker Compose"><!---->14. Docker Compose<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_14-1-简介" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="14.1 简介"><!---->14.1 简介<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_14-2-安装与卸载" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="14.2 安装与卸载"><!---->14.2 安装与卸载<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_14-3-docker-compose-使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="14.3 Docker Compose 使用"><!---->14.3 Docker Compose 使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_14-4-docker-compose-模板文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="14.4 docker-compose 模板文件"><!---->14.4 docker-compose 模板文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_14-5-docker-compose-常用命令" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="14.5 docker-compose 常用命令"><!---->14.5 docker-compose 常用命令<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_15-docker-可视化工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="15. Docker 可视化工具"><!---->15. Docker 可视化工具<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_15-1-安装-portainer" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="15.1 安装 Portainer"><!---->15.1 安装 Portainer<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/server/docker/Docker.html#_15-2-登录和使用-portainer" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="15.2 登录和使用 Portainer"><!---->15.2 登录和使用 Portainer<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/server/docker/Docker_deploy.html" class="nav-link sidebar-link sidebar-page" arialabel="Docker 部署中间件"><!---->Docker 部署中间件<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Docker 万字入门教程</h1><div class="article-info"><span class="author-info" arialabel="作者🖊" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://chenyl8848.github.io" target="_blank" rel="noopener noreferrer">Java陈序员</a></span><span property="author" content="Java陈序员"></span></span><!----><span class="date-info" arialabel="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2022年4月10日</span><meta property="datePublished" content="2022-04-10T00:00:00.000Z"></span><span class="category-info" arialabel="分类🌈" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category category3 clickable" role="navigation">容器</li><meta property="articleSection" content="容器"></ul></span><span arialabel="标签🏷" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag tag4 clickable" role="navigation">Docker</li></ul><meta property="keywords" content="Docker"></span><span class="reading-time-info" arialabel="阅读时间⌛" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" arialabelledby="timer"><title id="timer" lang="en">timer icon</title><g fill="currentColor"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></g></svg><span>大约 36 分钟</span><meta property="timeRequired" content="PT36M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#" class="router-link-active router-link-exact-active toc-link level2"></a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_1-docker-简介" class="router-link-active router-link-exact-active toc-link level2">1. Docker 简介</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_1-1-官方定义" class="router-link-active router-link-exact-active toc-link level3">1.1 官方定义</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_1-2-docker-的起源" class="router-link-active router-link-exact-active toc-link level3">1.2 Docker 的起源</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_1-3-docker-的优势" class="router-link-active router-link-exact-active toc-link level3">1.3 Docker 的优势</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_1-4-docker-和虚拟机的区别" class="router-link-active router-link-exact-active toc-link level3">1.4 Docker 和虚拟机的区别</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_2-docker-的安装" class="router-link-active router-link-exact-active toc-link level2">2. Docker 的安装</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_2-1-安装-docker-centos7-x" class="router-link-active router-link-exact-active toc-link level3">2.1 安装 Docker(centos7.x)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_2-2-bash-安装-通用所有平台" class="router-link-active router-link-exact-active toc-link level3">2.2 bash 安装(通用所有平台)</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_3-docker-的核心架构" class="router-link-active router-link-exact-active toc-link level2">3. Docker 的核心架构</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_4-docker-配置阿里镜像加速服务" class="router-link-active router-link-exact-active toc-link level2">4. Docker 配置阿里镜像加速服务</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_4-1-docker-运行流程" class="router-link-active router-link-exact-active toc-link level3">4.1 Docker 运行流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_4-2-docker-配置阿里云镜像加速" class="router-link-active router-link-exact-active toc-link level3">4.2 Docker 配置阿里云镜像加速</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_5-docker-的入门应用" class="router-link-active router-link-exact-active toc-link level2">5. Docker 的入门应用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_6-docker-常用命令" class="router-link-active router-link-exact-active toc-link level2">6. Docker 常用命令</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_6-1-辅助命令" class="router-link-active router-link-exact-active toc-link level3">6.1 辅助命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_6-2-images-镜像命令" class="router-link-active router-link-exact-active toc-link level3">6.2 Images 镜像命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_6-3-contrainer-容器命令" class="router-link-active router-link-exact-active toc-link level3">6.3 Contrainer 容器命令</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_7-docker-的镜像原理" class="router-link-active router-link-exact-active toc-link level2">7. Docker 的镜像原理</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_7-1-镜像是什么" class="router-link-active router-link-exact-active toc-link level3">7.1 镜像是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_7-2-为什么一个镜像会那么大" class="router-link-active router-link-exact-active toc-link level3">7.2 为什么一个镜像会那么大？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_7-3-docker-镜像原理" class="router-link-active router-link-exact-active toc-link level3">7.3 Docker 镜像原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_7-4-为什么-docker-镜像要采用这种分层结构呢" class="router-link-active router-link-exact-active toc-link level3">7.4 为什么 Docker 镜像要采用这种分层结构呢?</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_8-docker-安装常用服务" class="router-link-active router-link-exact-active toc-link level2">8.Docker 安装常用服务</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_8-1-安装-mysql" class="router-link-active router-link-exact-active toc-link level3">8.1 安装 MySQL</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_8-2-安装-redis" class="router-link-active router-link-exact-active toc-link level3">8.2 安装 Redis</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_8-3-安装-nginx" class="router-link-active router-link-exact-active toc-link level3">8.3 安装 Nginx</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_8-4-安装-tomcat" class="router-link-active router-link-exact-active toc-link level3">8.4 安装 Tomcat</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_8-5-安装-mongodb-数据库" class="router-link-active router-link-exact-active toc-link level3">8.5 安装 MongoDB 数据库</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_8-6-安装-elasticsearch" class="router-link-active router-link-exact-active toc-link level3">8.6 安装 ElasticSearch</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_10-docker-中出现如下错误解决方案" class="router-link-active router-link-exact-active toc-link level2">10. Docker 中出现如下错误解决方案</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_11-dockerfile" class="router-link-active router-link-exact-active toc-link level2">11. Dockerfile</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_11-1-什么是-dockerfile" class="router-link-active router-link-exact-active toc-link level3">11.1 什么是 Dockerfile</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_11-2-dockerfile-解析过程" class="router-link-active router-link-exact-active toc-link level3">11.2 Dockerfile 解析过程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_11-3-dockerfile-的保留命令" class="router-link-active router-link-exact-active toc-link level3">11.3 Dockerfile 的保留命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_11-4-dockerfile-构建-springboot-项目部署" class="router-link-active router-link-exact-active toc-link level3">11.4 Dockerfile 构建 SpringBoot 项目部署</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_12-高级网络配置" class="router-link-active router-link-exact-active toc-link level2">12. 高级网络配置</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_12-1-说明" class="router-link-active router-link-exact-active toc-link level3">12.1 说明</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_12-2-docker-网络操作命令" class="router-link-active router-link-exact-active toc-link level3">12.2 Docker 网络操作命令</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_12-3-容器之间使用网络通信" class="router-link-active router-link-exact-active toc-link level3">12.3 容器之间使用网络通信</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_13-高级数据卷配置" class="router-link-active router-link-exact-active toc-link level2">13. 高级数据卷配置</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_13-1-说明" class="router-link-active router-link-exact-active toc-link level3">13.1 说明</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_13-2-数据卷操作命令" class="router-link-active router-link-exact-active toc-link level3">13.2 数据卷操作命令</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_14-docker-compose" class="router-link-active router-link-exact-active toc-link level2">14. Docker Compose</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_14-1-简介" class="router-link-active router-link-exact-active toc-link level3">14.1 简介</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_14-2-安装与卸载" class="router-link-active router-link-exact-active toc-link level3">14.2 安装与卸载</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_14-3-docker-compose-使用" class="router-link-active router-link-exact-active toc-link level3">14.3 Docker Compose 使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_14-4-docker-compose-模板文件" class="router-link-active router-link-exact-active toc-link level3">14.4 docker-compose 模板文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_14-5-docker-compose-常用命令" class="router-link-active router-link-exact-active toc-link level3">14.5 docker-compose 常用命令</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_15-docker-可视化工具" class="router-link-active router-link-exact-active toc-link level2">15. Docker 可视化工具</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_15-1-安装-portainer" class="router-link-active router-link-exact-active toc-link level3">15.1 安装 Portainer</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/server/docker/Docker.html#_15-2-登录和使用-portainer" class="router-link-active router-link-exact-active toc-link level3">15.2 登录和使用 Portainer</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h1 id="docker-万字入门教程" tabindex="-1"><a class="header-anchor" href="#docker-万字入门教程" aria-hidden="true">#</a> Docker 万字入门教程</h1><blockquote><p><a href="https://www.bilibili.com/video/BV1ZT4y1K75K?spm_id_from=333.999.0.0" target="_blank" rel="noopener noreferrer">学习视频【编程不良人】<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.docker.com/get-started" target="_blank" rel="noopener noreferrer">官方文档地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://docker_practice.gitee.io/zh-cn/" target="_blank" rel="noopener noreferrer">中文参考手册<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a> <img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/Docker_Mindmap.png" alt="" loading="lazy"></h2><h2 id="_1-docker-简介" tabindex="-1"><a class="header-anchor" href="#_1-docker-简介" aria-hidden="true">#</a> 1. Docker 简介</h2><h3 id="_1-1-官方定义" tabindex="-1"><a class="header-anchor" href="#_1-1-官方定义" aria-hidden="true">#</a> 1.1 官方定义</h3><p><strong>官方介绍</strong>：</p><ul><li>We have a complete container solution for you - no matter who you are and where you are on your containerization journey.</li><li>翻译：我们为你提供了一个完整的容器解决方案，不管你是谁。不管你在哪，你都可以开始容器的的旅程。</li></ul><p><strong>官方定义</strong>：Docker 是一个容器技术。</p><ul><li>官网首页</li></ul><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20201220213306128.png" alt="" loading="lazy"></p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20201220214210994.png" alt="" loading="lazy"></p><h3 id="_1-2-docker-的起源" tabindex="-1"><a class="header-anchor" href="#_1-2-docker-的起源" aria-hidden="true">#</a> 1.2 Docker 的起源</h3><p>Docker 最初是 dotCloud 公司创始人 Solomon Hykes 在法国期间发起的一个公司内部项目，它是基于 dotCloud 公司多年云服务技术的一次革新，并于 2013 年 3 月以 Apache2.0 授权协议开源，主要项目代码在 GitHub 上进行维护。Docker 项目后来还加入了 Linux 基金会，并成立推动开放容器联盟(OCI).</p><p>Docker 自开源后受到广泛的关注和讨论，由于 Docker 项目的火爆，在 2013 年底，dotCloud 公司决定改名为 Docker. Docker 最初是在 Ubuntu 12.04 上开发实现的；Red Hat 则从 RHEL 6.5 开始对 Docker 进行支持；Google 也在其 PaaS 产品中广泛应用 Docker.</p><p>Docker 使用 Google 公司推出的 Go 语言进行开发实现，基于 Linux 内核的 cgroup、namespace, 以及 OverlayFS 类的 Union FS 等技术，对进程进行封装隔离，属于操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。</p><h3 id="_1-3-docker-的优势" tabindex="-1"><a class="header-anchor" href="#_1-3-docker-的优势" aria-hidden="true">#</a> 1.3 Docker 的优势</h3><ul><li><p>在开发的时候，在本机测试环境可以跑，生产环境跑不起来。</p><p>这里我们拿 Java Web 应用程序举例，我们一个 Java Web 应用程序涉及很多东西，比如 JDK、Tomcat、MySQL 等软件环境。当这些其中某一项版本不一致的时候，可能就会导致应用程序跑不起来这种情况。Docker 则将程序以及使用软件环境直接打包在一起，无论在那个机器上保证了环境一致。</p><p><strong>优势1：一致的运行环境，更轻松的迁移。</strong></p></li><li><p>服务器自己的程序挂了，结果发现是别人程序出了问题把内存吃完了，自己程序因为内存不够就挂了。</p><p>这种也是一种比较常见的情况，如果你的程序重要性不是特别高的话，公司基本上不可能让你的程序独享一台服务器的，这时候你的服务器就会跟公司其他人的程序共享一台服务器，所以不可避免地就会受到其他程序的干扰，导致自己的程序出现问题。Docker 就很好解决了环境隔离的问题，别人程序不会影响到自己的程序。</p><p><strong>优势2：对进程进行封装隔离，容器与容器之间互不影响，更高效的利用系统资源。</strong></p></li><li><p>公司要弄一个活动，可能会有大量的流量进来，公司需要再多部署几十台服务器。</p><p>在没有 Docker 的情况下，要在几天内部署几十台服务器，这对运维来说是一件非常折磨人的事，而且每台服务器的环境还不一定一样，就会出现各种问题，最后部署地头皮发麻。用 Docker 的话，我只需要将程序打包到镜像，你要多少台服务，我就跑多少容器，极大地提高了部署效率。</p><p><strong>优势3：通过镜像复制 N 多个环境一致容器。</strong></p></li></ul><h3 id="_1-4-docker-和虚拟机的区别" tabindex="-1"><a class="header-anchor" href="#_1-4-docker-和虚拟机的区别" aria-hidden="true">#</a> 1.4 Docker 和虚拟机的区别</h3><p>关于 Docker 与虚拟机的区别，在网上找到的一张图，非常直观形象地展示出来，话不多说，直接上图。</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20201220222456675.png" alt="" loading="lazy"></p><p><strong>比较上面两张图，我们发现虚拟机是携带操作系统，本身很小的应用程序却因为携带了操作系统而变得非常大，很笨重</strong>。Docker是不携带操作系统的，所以 Docker 的应用就非常的轻巧。另外在调用宿主机的 CPU、磁盘等等这些资源的时候，拿内存举例，虚拟机是利用 Hypervisor 去虚拟化内存，整个调用过程是<strong>虚拟内存-&gt;虚拟物理内存-&gt;真正物理内存</strong>，但是 Docker 是利用 Docker Engine 去调用宿主的的资源，这时候过程是<strong>虚拟内存-&gt;真正物理内存</strong>。</p><table><thead><tr><th></th><th>传统虚拟机</th><th>Docker容器</th></tr></thead><tbody><tr><td>磁盘占用</td><td>几个GB到几十个GB左右</td><td>几十MB到几百MB左右</td></tr><tr><td>CPU内存占用</td><td>虚拟操作系统非常占用CPU和内存</td><td>Docker引擎占用极低</td></tr><tr><td>启动速度</td><td>（从开机到运行项目）几分钟</td><td>（从开启容器到运行项目）几秒</td></tr><tr><td>安装管理</td><td>需要专门的运维技术</td><td>安装、管理方便</td></tr><tr><td>应用部署</td><td>每次部署都费时费力</td><td>从第二次部署开始轻松简捷</td></tr><tr><td>耦合性</td><td>多个应用服务安装到一起，容易互相影响</td><td>每个应用服务一个容器，达成隔离</td></tr><tr><td>系统依赖</td><td>无</td><td>需求相同或相似的内核，目前推荐是Linux</td></tr></tbody></table><hr><h2 id="_2-docker-的安装" tabindex="-1"><a class="header-anchor" href="#_2-docker-的安装" aria-hidden="true">#</a> 2. Docker 的安装</h2><h3 id="_2-1-安装-docker-centos7-x" tabindex="-1"><a class="header-anchor" href="#_2-1-安装-docker-centos7-x" aria-hidden="true">#</a> 2.1 安装 Docker(centos7.x)</h3><ul><li>卸载原始 Docker</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum remove <span class="token function">docker</span> <span class="token punctuation">\</span>
                docker-client <span class="token punctuation">\</span>
                docker-client-latest <span class="token punctuation">\</span>
                docker-common <span class="token punctuation">\</span>
                docker-latest <span class="token punctuation">\</span>
                docker-latest-logrotate <span class="token punctuation">\</span>
                docker-logrotate <span class="token punctuation">\</span>
                docker-engine
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>安装 Docker 依赖</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils <span class="token punctuation">\</span>
  device-mapper-persistent-data <span class="token punctuation">\</span>
  lvm2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>设置 Docker 的 yum 源</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum-config-manager <span class="token punctuation">\</span>
    --add-repo <span class="token punctuation">\</span>
    https://download.docker.com/linux/centos/docker-ce.repo
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>安装最新版的 Docker</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>指定版本安装 Docker</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum list docker-ce --showduplicates <span class="token operator">|</span> <span class="token function">sort</span> -r

<span class="token comment"># sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce-18.09.5-3.el7 docker-ce-cli-18.09.5-3.el7 containerd.io
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>启动 Docker</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
<span class="token function">sudo</span> systemctl start <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>关闭 Docker</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl stop <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>测试 Docker 是否安装</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">docker</span> --version
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-2-bash-安装-通用所有平台" tabindex="-1"><a class="header-anchor" href="#_2-2-bash-安装-通用所有平台" aria-hidden="true">#</a> 2.2 bash 安装(通用所有平台)</h3><p>在测试或开发环境中 Docker 官方为了简化安装流程，提供了一套便捷的安装脚本，CentOS 系统上可以使用这套脚本安装。另外可以通过 <code>--mirror</code> 选项使用国内源进行安装。</p><p>执行这个命令后，脚本就会自动的将一切准备工作做好，并且把 Docker 的稳定(stable)版本安装在系统中。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -fsSL get.docker.com -o get-docker.sh
<span class="token function">sudo</span> <span class="token function">sh</span> get-docker.sh --mirror Aliyun
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>启动 Docker</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
<span class="token function">sudo</span> systemctl start <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>创建 Docker 用户组</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">groupadd</span> <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>将当前用户加入 Docker 组</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">usermod</span> -aG <span class="token function">docker</span> <span class="token environment constant">$USER</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>测试 Docker 是否安装</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> --version
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><hr><h2 id="_3-docker-的核心架构" tabindex="-1"><a class="header-anchor" href="#_3-docker-的核心架构" aria-hidden="true">#</a> 3. Docker 的核心架构</h2><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200404111908085-0291323.png" alt="" loading="lazy"></p><ul><li><code>镜像</code>：一个镜像代表一个应用环境，他是一个只读的文件，如 MySQL 镜像、Tomcat 镜像、Nginx 镜像等</li><li><code>容器</code>：镜像每次运行之后就是产生一个容器，就是正在运行的镜像，特点就是可读可写</li><li><code>仓库</code>：用来存放镜像的位置，类似于 Maven 仓库，也是镜像下载和上传的位置</li><li><code>dockerFile</code>Docker 生成镜像配置文件，用来书写自定义镜像的一些配置</li><li><code>tar</code>：一个对镜像打包的文件，日后可以还原成镜像</li></ul><hr><h2 id="_4-docker-配置阿里镜像加速服务" tabindex="-1"><a class="header-anchor" href="#_4-docker-配置阿里镜像加速服务" aria-hidden="true">#</a> 4. Docker 配置阿里镜像加速服务</h2><h3 id="_4-1-docker-运行流程" tabindex="-1"><a class="header-anchor" href="#_4-1-docker-运行流程" aria-hidden="true">#</a> 4.1 Docker 运行流程</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200404120356784.png" alt="" loading="lazy"></p><h3 id="_4-2-docker-配置阿里云镜像加速" tabindex="-1"><a class="header-anchor" href="#_4-2-docker-配置阿里云镜像加速" aria-hidden="true">#</a> 4.2 Docker 配置阿里云镜像加速</h3><ul><li>访问阿里云登录自己账号查看 Docker 镜像加速服务，并依照如下命令进行修改</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">&#39;EOF&#39;
{
  &quot;registry-mirrors&quot;: [&quot;https://lz2nib3q.mirror.aliyuncs.com&quot;]
}
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>验证 Docker 的镜像加速是否生效</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker info</span>
		<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
    <span class="token number">127.0</span>.0.0/8
   Registry Mirrors:
    <span class="token string">&#39;https://lz2nib3q.mirror.aliyuncs.com/&#39;</span>
   Live Restore Enabled: <span class="token boolean">false</span>
   Product License: Community Engine
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr><h2 id="_5-docker-的入门应用" tabindex="-1"><a class="header-anchor" href="#_5-docker-的入门应用" aria-hidden="true">#</a> 5. Docker 的入门应用</h2><blockquote><p>docker run hello-world</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run hello-world</span>

Hello from Docker<span class="token operator">!</span>
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 <span class="token number">1</span>. The Docker client contacted the Docker daemon.
 <span class="token number">2</span>. The Docker daemon pulled the <span class="token string">&quot;hello-world&quot;</span> image from the Docker Hub.
    <span class="token punctuation">(</span>amd64<span class="token punctuation">)</span>
 <span class="token number">3</span>. The Docker daemon created a new container from that image <span class="token function">which</span> runs the
    executable that produces the output you are currently reading.
 <span class="token number">4</span>. The Docker daemon streamed that output to the Docker client, <span class="token function">which</span> sent it
    to your terminal.

To try something <span class="token function">more</span> ambitious, you can run an Ubuntu container with:
 $ <span class="token function">docker</span> run -it ubuntu <span class="token function">bash</span>

Share images, automate workflows, and <span class="token function">more</span> with a <span class="token function">free</span> Docker ID:
 https://hub.docker.com/

For <span class="token function">more</span> examples and ideas, visit:
 https://docs.docker.com/get-started/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><hr><h2 id="_6-docker-常用命令" tabindex="-1"><a class="header-anchor" href="#_6-docker-常用命令" aria-hidden="true">#</a> 6. Docker 常用命令</h2><h3 id="_6-1-辅助命令" tabindex="-1"><a class="header-anchor" href="#_6-1-辅助命令" aria-hidden="true">#</a> 6.1 辅助命令</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.安装完成辅助命令</span>
  docker version	--------------------------	查看 Docker 的信息
  docker info		--------------------------	查看更详细的信息
  docker --help	--------------------------	帮助命令
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_6-2-images-镜像命令" tabindex="-1"><a class="header-anchor" href="#_6-2-images-镜像命令" aria-hidden="true">#</a> 6.2 Images 镜像命令</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.查看本机中所有镜像</span>
  docker images	--------------------------	列出本地所有镜像
		-a			列出所有镜像（包含中间映像层）
  	-q			只显示镜像id

<span class="token title important"><span class="token punctuation">#</span> 2.搜索镜像</span>
	docker search [options] 镜像名	-------------------	去 dockerhub 上查询当前镜像
		-s 指定值		列出收藏数不少于指定值的镜像
  	--no-trunc	  显示完整的镜像信息

<span class="token title important"><span class="token punctuation">#</span> 3.从仓库下载镜像</span>
	docker pull 镜像名[:TAG|@DIGEST]	----------------- 下载镜像

<span class="token title important"><span class="token punctuation">#</span> 4.删除镜像</span>
	docker rmi 镜像名	--------------------------  删除镜像
		-f		强制删除
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_6-3-contrainer-容器命令" tabindex="-1"><a class="header-anchor" href="#_6-3-contrainer-容器命令" aria-hidden="true">#</a> 6.3 Contrainer 容器命令</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.运行容器</span>
	docker run 镜像名	--------------------------	镜像名新建并启动容器
    --name 					别名为容器起一个名字
    -d							启动守护式容器（在后台启动容器）
    -p 							映射端口号：原始端口号		 指定端口号启动

<span class="token code keyword">	例：docker run -it --name myTomcat -p 8888:8080 tomcat
      docker run -d --name myTomcat -P tomcat</span>

<span class="token title important"><span class="token punctuation">#</span> 2.查看运行的容器</span>
	docker ps					--------------------------	列出所有正在运行的容器
    -a			正在运行的和历史运行过的容器
    -q			静默模式，只显示容器编号

<span class="token title important"><span class="token punctuation">#</span> 3.停止|关闭|重启容器</span>
	docker start   容器名字或者容器id  --------------- 开启容器
	docker restart 容器名或者容器id    --------------- 重启容器
	docker stop  容器名或者容器id 	    ------------------ 正常停止容器运行
	docker kill  容器名或者容器id      ------------------ 立即停止容器运行

<span class="token title important"><span class="token punctuation">#</span> 4.删除容器</span>
	docker rm -f 容器id和容器名     
	docker rm -f $(docker ps -aq)		--------------------------	删除所有容器

<span class="token title important"><span class="token punctuation">#</span> 5.查看容器内进程</span>
	docker top 容器id或者容器名 ------------------ 查看容器内的进程

<span class="token title important"><span class="token punctuation">#</span> 6.查看查看容器内部细节</span>
	docker inspect 容器id 		------------------ 查看容器内部细节

<span class="token title important"><span class="token punctuation">#</span> 7.查看容器的运行日志</span>
	docker logs [OPTIONS] 容器id或容器名	------------------ 查看容器日志
    -t			 加入时间戳
    -f			 跟随最新的日志打印
    --tail 	 数字	显示最后多少条

<span class="token title important"><span class="token punctuation">#</span> 8.进入容器内部</span>
	docker exec [options] 容器id 容器内命令 ------------------ 进入容器执行命令
		-i		以交互模式运行容器，通常与-t一起使用
    -t		分配一个伪终端    shell窗口   bash 

<span class="token title important"><span class="token punctuation">#</span> 9.容器和宿主机之间复制文件</span>
	docker cp 文件|目录 容器id:容器路径           -----------------   将宿主机复制到容器内部
	docker cp 容器id:容器内资源路径 宿主机目录路径  -----------------   将容器内资源拷贝到主机上

<span class="token title important"><span class="token punctuation">#</span> 10.数据卷(volum)实现与宿主机共享目录</span>
	docker run -v 宿主机的路径|任意别名:/容器内的路径 镜像名

  注意: 
      <span class="token list punctuation">1.</span> 如果是宿主机路径必须是绝对路径，宿主机目录会覆盖容器内目录内容
      <span class="token list punctuation">2.</span> 如果是别名则会在 Docker 运行容器时自动在宿主机中创建一个目录，并将容器目录文件复制到宿主机中

<span class="token title important"><span class="token punctuation">#</span> 11.打包镜像</span>
		docker save 镜像名 -o  名称.tar

<span class="token title important"><span class="token punctuation">#</span> 12.载入镜像</span>
		docker load -i 名称.tar

<span class="token title important"><span class="token punctuation">#</span> 13.容器打包成新的镜像</span>
	  docker commit -m &quot;描述信息&quot; -a &quot;作者信息&quot; （容器id或者名称）打包的镜像名称:标签
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><hr><h2 id="_7-docker-的镜像原理" tabindex="-1"><a class="header-anchor" href="#_7-docker-的镜像原理" aria-hidden="true">#</a> 7. Docker 的镜像原理</h2><h3 id="_7-1-镜像是什么" tabindex="-1"><a class="header-anchor" href="#_7-1-镜像是什么" aria-hidden="true">#</a> 7.1 镜像是什么？</h3><p>镜像是一种轻量级的，可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时所需的库、环境变量和配置文件。</p><h3 id="_7-2-为什么一个镜像会那么大" tabindex="-1"><a class="header-anchor" href="#_7-2-为什么一个镜像会那么大" aria-hidden="true">#</a> 7.2 为什么一个镜像会那么大？</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200404142950068.png" alt="" loading="lazy"></p><blockquote><p><strong>镜像就像是花卷</strong>。</p></blockquote><p><strong>UnionFS（联合文件系统）</strong>：Union 文件系统是一种分层，轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下。</p><p>Union 文件系统是 Docker 镜像的基础。这种文件系统特性：就是一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p><h3 id="_7-3-docker-镜像原理" tabindex="-1"><a class="header-anchor" href="#_7-3-docker-镜像原理" aria-hidden="true">#</a> 7.3 Docker 镜像原理</h3><blockquote><p><strong>Docker 的镜像实际是由一层一层的文件系统组成</strong>。</p></blockquote><ul><li><p>bootfs（boot file system）主要包含 bootloader 和 kernel. bootloader 主要是引导加载 kernel，Linux 刚启动时会加载 bootfs 文件系统。在 Docker 镜像的最底层就是 bootfs.这一层与 Linux/Unix 系统是一样的，包含 boot 加载器（bootloader）和内核(kernel).当 boot 加载完后，整个内核就都在内存中了，此时内存的使用权已由 bootfs 转交给内核，此时会卸载 bootfs.</p></li><li><p>rootfs（root file system），在 bootfs 之上，包含的就是典型的 Linux 系统中的 /dev、/proc、/bin、/etc 等标准的目录和文件。rootfs 就是各种不同的操作系统发行版，比如 Ubuntu/CentOS 等等。</p></li><li><p>我们平时安装进虚拟机的 Centos都有 1 到几个GB，为什么 Docker 这里才 200MB？对于一个精简的 OS,rootfs 可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接使用 Host 的 Kernal,自己只需要提供 rootfs 就行了。由此可见不同的 Linux 发行版，他们的 bootfs 是一致的，rootfs 会有差别，因此不同的发行版可以共用 bootfs.</p></li></ul><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/1567585172(1).jpg" alt="" loading="lazy"></p><h3 id="_7-4-为什么-docker-镜像要采用这种分层结构呢" tabindex="-1"><a class="header-anchor" href="#_7-4-为什么-docker-镜像要采用这种分层结构呢" aria-hidden="true">#</a> 7.4 为什么 Docker 镜像要采用这种分层结构呢?</h3><blockquote><p><strong>最大的一个好处就是资源共享</strong>。</p></blockquote><p>比如：有多个镜像都是从相同的 base 镜像构建而来的，那么宿主机只需在磁盘中保存一份 base 镜像。同时内存中也只需要加载一份 base 镜像，就可以为所有容器服务了，而且镜像的每一层都可以被共享。</p><p>Docker 镜像都是只读的。当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称为容器层，容器层之下都叫镜像层。</p><hr><h2 id="_8-docker-安装常用服务" tabindex="-1"><a class="header-anchor" href="#_8-docker-安装常用服务" aria-hidden="true">#</a> 8.Docker 安装常用服务</h2><h3 id="_8-1-安装-mysql" tabindex="-1"><a class="header-anchor" href="#_8-1-安装-mysql" aria-hidden="true">#</a> 8.1 安装 MySQL</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.拉取mysql镜像到本地</span>
	docker pull mysql:tag (tag不加默认最新版本)
	
<span class="token title important"><span class="token punctuation">#</span> 2.运行mysql服务</span>
	docker run --name mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:tag  						  --没有暴露外部端口外部不能连接
	docker run --name mysql -e MYSQL_ROOT_PASSWORD=root -p 3306:3306 -d  mysql:tag  --没有暴露外部端口

<span class="token title important"><span class="token punctuation">#</span> 3.进入mysql容器</span>
	docker exec -it 容器名称|容器id bash

<span class="token title important"><span class="token punctuation">#</span> 4.外部查看mysql日志</span>
	docker logs 容器名称|容器id

<span class="token title important"><span class="token punctuation">#</span> 5.使用自定义配置参数</span>
	docker run --name mysql -v /root/mysql/conf.d:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root -d mysql:tag

<span class="token title important"><span class="token punctuation">#</span> 6.将容器数据位置与宿主机位置挂载保证数据安全</span>
	docker run --name mysql -v /root/mysql/data:/var/lib/mysql -v /root/mysql/conf.d:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root -p 3306:3306 -d mysql:tag

<span class="token title important"><span class="token punctuation">#</span> 7.通过其他客户端访问 如在window系统|macos系统使用客户端工具访问</span>
	
<span class="token title important"><span class="token punctuation">#</span> 8.将 MySQL 数据库备份为 SQL 文件</span>
	docker exec mysql|容器id sh -c &#39;exec mysqldump --all-databases -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#39; &gt; /root/all-databases.sql  --导出全部数据
	docker exec mysql sh -c &#39;exec mysqldump --databases 库表 -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#39; &gt; /root/all-databases.sql  --导出指定库数据
	docker exec mysql sh -c &#39;exec mysqldump --no-data --databases 库表 -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#39; &gt; /root/all-databases.sql  --导出指定库数据不要数据

<span class="token title important"><span class="token punctuation">#</span> 9.执行 SQL 文件到 MySQL 中</span>
	docker exec -i mysql sh -c &#39;exec mysql -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#39; &lt; /root/xxx.sql
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_8-2-安装-redis" tabindex="-1"><a class="header-anchor" href="#_8-2-安装-redis" aria-hidden="true">#</a> 8.2 安装 Redis</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.在 Docker Hub 搜索 Redis 镜像</span>
	docker search redis

<span class="token title important"><span class="token punctuation">#</span> 2.拉取 Redis 镜像到本地</span>
	docker pull redis

<span class="token title important"><span class="token punctuation">#</span> 3.启动 Redis 服务运行容器</span>
	docker run --name redis -d redis:tag (没有暴露外部端口)
	docker run --name redis -p 6379:6379 -d redis:tag (暴露外部宿主机端口为6379进行连接) 

<span class="token title important"><span class="token punctuation">#</span> 4.查看启动日志</span>
	docker logs -t -f 容器id|容器名称

<span class="token title important"><span class="token punctuation">#</span> 5.进入容器内部查看</span>
	docker exec -it 容器id|名称 bash  

<span class="token title important"><span class="token punctuation">#</span> 6.加载外部自定义配置启动redis容器</span>
	默认情况下 Redis 官方镜像中没有 redis.conf 配置文件，需要去官网下载指定版本的配置文件
	<span class="token list punctuation">1.</span> wget http://download.redis.io/releases/redis-5.0.8.tar.gz  下载官方安装包
	<span class="token list punctuation">2.</span> 将官方安装包中配置文件进行复制到宿主机指定目录中如 /root/redis/redis.conf 文件
	<span class="token list punctuation">3.</span> 修改需要自定义的配置
		 bind 0.0.0.0 开启远程权限
		 appenonly yes 开启aof持久化
	<span class="token list punctuation">4.</span> 加载配置启动
	docker run --name redis -v /root/redis:/usr/local/etc/redis -p 6379:6379 -d redis redis-server /usr/local/etc/redis/redis.conf  

<span class="token title important"><span class="token punctuation">#</span> 7.将数据目录挂在到本地保证数据安全</span>
	docker run --name redis -v /root/redis/data:/data -v /root/redis/redis.conf:/usr/local/etc/redis/redis.conf -p 6379:6379 -d redis redis-server 					/usr/local/etc/redis/redis.conf  
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_8-3-安装-nginx" tabindex="-1"><a class="header-anchor" href="#_8-3-安装-nginx" aria-hidden="true">#</a> 8.3 安装 Nginx</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.在 Docker Hub 搜索 Nginx</span>
	docker search nginx

<span class="token title important"><span class="token punctuation">#</span> 2.拉取 Nginx 镜像到本地</span>
	[root@localhost ~]# docker pull nginx
    Using default tag: latest
    latest: Pulling from library/nginx
    afb6ec6fdc1c: Pull complete 
    b90c53a0b692: Pull complete 
    11fa52a0fdc0: Pull complete 
    Digest: sha256:30dfa439718a17baafefadf16c5e7c9d0a1cde97b4fd84f63b69e13513be7097
    Status: Downloaded newer image for nginx:latest
    docker.io/library/nginx:latest

<span class="token title important"><span class="token punctuation">#</span> 3.启动 Nginx 容器</span>
		docker run -p 80:80 --name nginx01 -d nginx

<span class="token title important"><span class="token punctuation">#</span> 4.进入容器</span>
		docker exec -it nginx01 /bin/bash
		查找目录:  whereis nginx
		配置文件:  /etc/nginx/nginx.conf

<span class="token title important"><span class="token punctuation">#</span> 5.复制配置文件到宿主机</span>
		docker cp nginx01(容器id|容器名称):/etc/nginx/nginx.conf 宿主机名录

<span class="token title important"><span class="token punctuation">#</span> 6.挂在nginx配置以及html到宿主机外部</span>
		docker run --name nginx02 -v /root/nginx/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/html:/usr/share/nginx/html -p 80:80 -d nginx		
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_8-4-安装-tomcat" tabindex="-1"><a class="header-anchor" href="#_8-4-安装-tomcat" aria-hidden="true">#</a> 8.4 安装 Tomcat</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.在 Docker Hub 搜索 Tomcat</span>
	docker search tomcat

<span class="token title important"><span class="token punctuation">#</span> 2.下载 Tomcat 镜像</span>
	docker pull tomcat

<span class="token title important"><span class="token punctuation">#</span> 3.运行 Tomcat 镜像</span>
	docker run -p 8080:8080 -d --name mytomcat tomcat

<span class="token title important"><span class="token punctuation">#</span> 4.进入 Tomcat 容器</span>
	docker exec -it mytomcat /bin/bash

<span class="token title important"><span class="token punctuation">#</span> 5.将 webapps 目录挂载在外部</span>
	docker run -p 8080:8080 -v /root/webapps:/usr/local/tomcat/webapps -d --name mytomcat tomcat

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_8-5-安装-mongodb-数据库" tabindex="-1"><a class="header-anchor" href="#_8-5-安装-mongodb-数据库" aria-hidden="true">#</a> 8.5 安装 MongoDB 数据库</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.运行 MongoDB</span>
	docker run -d -p 27017:27017 --name mymongo mongo  ---无须权限
	docker logs -f mymongo --查看mongo运行日志

<span class="token title important"><span class="token punctuation">#</span> 2.进入 MongoDB 容器</span>
	docker exec -it mymongo /bin/bash
	直接执行 mongo 命令进行操作

<span class="token title important"><span class="token punctuation">#</span> 3.常见具有权限的容器</span>
	docker run --name  mymongo  -p 27017:27017  -d mongo --auth

<span class="token title important"><span class="token punctuation">#</span> 4.进入容器配置用户名密码</span>
	mongo
  <span class="token title important"><span class="token punctuation">#</span> 选择admin库</span>
	use admin
  <span class="token title important"><span class="token punctuation">#</span> 创建用户,此用户创建成功,则后续操作都需要用户认证</span>
	db.createUser({user:&quot;root&quot;,pwd:&quot;root&quot;,roles:[{role:&#39;root&#39;,db:&#39;admin&#39;}]})
	exit

<span class="token title important"><span class="token punctuation">#</span> 5.将 MongoDB 中数据目录映射到宿主机中</span>
	docker run -d -p 27017:27017 -v /root/mongo/data:/data/db --name mymongo mongo 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_8-6-安装-elasticsearch" tabindex="-1"><a class="header-anchor" href="#_8-6-安装-elasticsearch" aria-hidden="true">#</a> 8.6 安装 ElasticSearch</h3><blockquote><p>注意：<strong>需要调高 JVM 线程数限制数量</strong>。</p></blockquote><ol start="0"><li>拉取镜像运行 ElasticSearch</li></ol><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.拉取 ElasticSearch 镜像</span>
	docker pull elasticsearch:6.4.2

<span class="token title important"><span class="token punctuation">#</span> 2.查看 Docker 镜像</span>
	docker images

<span class="token title important"><span class="token punctuation">#</span> 3.运行 ElasticSearch 镜像</span>
	docker run -p 9200:9200 -p 9300:9300 elasticsearch:6.4.2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>若启动出现如下错误，按照如下步骤修改。</p><ul><li><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200602184321790.png" alt="" loading="lazy"></li></ul><ol><li>预先配置</li></ol><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.在 CentOS 虚拟机中，修改配置 sysctl.conf</span>
	vim /etc/sysctl.conf

<span class="token title important"><span class="token punctuation">#</span> 2.加入如下配置</span>
	vm.max_map_count=262144 

<span class="token title important"><span class="token punctuation">#</span> 3.启用配置</span>
	sysctl -p
	注：这一步是为了防止启动容器时，报出如下错误：bootstrap checks failed max virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>启动 EleasticSearch 容器</li></ol><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 0.复制容器中 data 目录到宿主机中</span>
	docker cp 容器id:/usr/share/share/elasticsearch/data /root/es

<span class="token title important"><span class="token punctuation">#</span> 1.运行 EleasticSearch 容器，指定 JVM 内存大小并指定 IK 分词器位置</span>
	docker run -d --name es -p 9200:9200 -p 9300:9300 -e ES_JAVA_OPTS=&quot;-Xms128m -Xmx128m&quot; -v /root/es/plugins:/usr/share/elasticsearch/plugins -v /root/es/data:/usr/share/elasticsearch/data elasticsearch:6.4.2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>安装 IK 分词器</li></ol><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.下载对应版本的 IK 分词器</span>
	wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.4.2/elasticsearch-analysis-ik-6.4.2.zip

<span class="token title important"><span class="token punctuation">#</span> 2.解压到 plugins 文件夹中</span>
	yum install -y unzip
	unzip -d ik elasticsearch-analysis-ik-6.4.2.zip

<span class="token title important"><span class="token punctuation">#</span> 3.添加自定义扩展词和停用词</span>
	cd plugins/elasticsearch/config
	vim IKAnalyzer.cfg.xml
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment</span><span class="token punctuation">&gt;</span></span>IK Analyzer 扩展配置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comment</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span>
<span class="token code keyword">		&lt;entry key=&quot;ext_dict&quot;&gt;ext_dict.dic&lt;/entry&gt;
		</span><span class="token comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span>
<span class="token code keyword">		&lt;entry key=&quot;ext_stopwords&quot;&gt;ext_stopwords.dic&lt;/entry&gt;
	&lt;/properties&gt;</span>

<span class="token title important"><span class="token punctuation">#</span> 4.在 IK 分词器目录下 config 目录中创建 ext_dict.dic 文件，编码一定要为 UTF-8 才能生效</span>
	vim ext_dict.dic 加入扩展词即可

<span class="token title important"><span class="token punctuation">#</span> 5. 在 IK 分词器目录下 config 目录中创建 ext_stopword.dic 文件 </span>
	vim ext_stopwords.dic 加入停用词即可

<span class="token title important"><span class="token punctuation">#</span> 6.重启容器生效</span>
	docker restart 容器id

<span class="token title important"><span class="token punctuation">#</span> 7.将此容器提交成为一个新的镜像</span>
	docker commit -a=&quot;xiaochen&quot; -m=&quot;es with IKAnalyzer&quot; 容器id xiaochen/elasticsearch:6.4.2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ol start="4"><li>安装 Kibana</li></ol><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.下载 Kibana 镜像到本地</span>
	docker pull kibana:6.4.2

<span class="token title important"><span class="token punctuation">#</span> 2.启动 Kibana 容器</span>
	docker run -d --name kibana -e ELASTICSEARCH_URL=http://10.15.0.3:9200 -p 5601:5601 kibana:6.4.2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h2 id="_10-docker-中出现如下错误解决方案" tabindex="-1"><a class="header-anchor" href="#_10-docker-中出现如下错误解决方案" aria-hidden="true">#</a> 10. Docker 中出现如下错误解决方案</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker search mysql 或者 docker pull 这些命令无法使用</span>
Error response from daemon: Get https://index.docker.io/v1/search?q<span class="token operator">=</span>mysql<span class="token operator">&amp;</span><span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token number">25</span>: x509: certificate has expired or is not yet valid
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200602183429286.png" alt="" loading="lazy"></p><p><strong>注意</strong>：<strong>这个错误的原因在于是系统的时间和 Docker Hub 时间不一致，需要做系统时间与网络时间同步</strong>。</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.安装时间同步</span>
	sudo yum -y install ntp ntpdate

<span class="token title important"><span class="token punctuation">#</span> 2.同步时间</span>
	sudo ntpdate cn.pool.ntp.org

<span class="token title important"><span class="token punctuation">#</span> 3.查看本机时间</span>
	date

<span class="token title important"><span class="token punctuation">#</span> 4.重新测试</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200602183718623.png" alt="" loading="lazy"></p><h2 id="_11-dockerfile" tabindex="-1"><a class="header-anchor" href="#_11-dockerfile" aria-hidden="true">#</a> 11. Dockerfile</h2><h3 id="_11-1-什么是-dockerfile" tabindex="-1"><a class="header-anchor" href="#_11-1-什么是-dockerfile" aria-hidden="true">#</a> 11.1 什么是 Dockerfile</h3><p>Dockerfile 可以认为是<strong>Docker 镜像的描述文件，是由一系列命令和参数构成的脚本</strong>。主要作用是<strong>用来构建 Docker 镜像的构建文件</strong>。</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200404111908085.png" alt="" loading="lazy"></p><p><strong>通过架构图可以看出通过 DockerFile 可以直接构建镜像</strong>。</p><h3 id="_11-2-dockerfile-解析过程" tabindex="-1"><a class="header-anchor" href="#_11-2-dockerfile-解析过程" aria-hidden="true">#</a> 11.2 Dockerfile 解析过程</h3><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200603181253804.png" alt="" loading="lazy"></p><h3 id="_11-3-dockerfile-的保留命令" tabindex="-1"><a class="header-anchor" href="#_11-3-dockerfile-的保留命令" aria-hidden="true">#</a> 11.3 Dockerfile 的保留命令</h3><p>官方说明：https://docs.docker.com/engine/reference/builder/</p><table><thead><tr><th>保留字</th><th>作用</th></tr></thead><tbody><tr><td><strong>FROM</strong></td><td><strong>当前镜像是基于哪个镜像的</strong> <code>第一个指令必须是FROM</code></td></tr><tr><td>MAINTAINER</td><td>镜像维护者的姓名和邮箱地址</td></tr><tr><td><strong>RUN</strong></td><td><strong>构建镜像时需要运行的指令</strong></td></tr><tr><td><strong>EXPOSE</strong></td><td><strong>当前容器对外暴露出的端口号</strong></td></tr><tr><td><strong>WORKDIR</strong></td><td><strong>指定在创建容器后，终端默认登录进来的工作目录，一个落脚点</strong></td></tr><tr><td><strong>ENV</strong></td><td><strong>用来在构建镜像过程中设置环境变量</strong></td></tr><tr><td><strong>ADD</strong></td><td><strong>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar包</strong></td></tr><tr><td><strong>COPY</strong></td><td><strong>类似于ADD，拷贝文件和目录到镜像中<br>将从构建上下文目录中原路径的文件/目录复制到新的一层的镜像内的目标路径位置</strong></td></tr><tr><td><strong>VOLUME</strong></td><td><strong>容器数据卷，用于数据保存和持久化工作</strong></td></tr><tr><td><strong>CMD</strong></td><td><strong>指定一个容器启动时要运行的命令<br>Dockerfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换</strong></td></tr><tr><td><strong>ENTRYPOINT</strong></td><td><strong>指定一个容器启动时要运行的命令<br>ENTRYPOINT的目的和CMD一样，都是在指定容器启动程序及其参数</strong></td></tr></tbody></table><h4 id="_11-3-1-from-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-1-from-命令" aria-hidden="true">#</a> 11.3.1 FROM 命令</h4><p>基于哪个镜像进行构建新的镜像，在构建时会自动从 Docker Hub拉取 base 镜像，<strong>必须作为 Dockerfile 的第一个指令出现</strong>。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span>  &lt;image&gt;</span>
<span class="token instruction"><span class="token keyword">FROM</span>  &lt;image&gt;[:&lt;tag&gt;]     使用版本不写为latest</span>
<span class="token instruction"><span class="token keyword">FROM</span>  &lt;image&gt;[@&lt;digest&gt;]  使用摘要</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_11-3-2-maintainer-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-2-maintainer-命令" aria-hidden="true">#</a> 11.3.2 MAINTAINER 命令</h4><p>镜像维护者的姓名和邮箱地址[废弃]。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">MAINTAINER</span> &lt;name&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_11-3-3-run-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-3-run-命令" aria-hidden="true">#</a> 11.3.3 RUN 命令</h4><p>RUN 命令将在当前映像之上的新层中执行任何命令并提交结果，生成的提交映像将用于 Dockerfile 中的下一步。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">RUN</span> &lt;command&gt; (shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows)</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo hello</span>

<span class="token instruction"><span class="token keyword">RUN</span> [<span class="token string">&quot;executable&quot;</span>, <span class="token string">&quot;param1&quot;</span>, <span class="token string">&quot;param2&quot;</span>] (exec form)</span>
<span class="token instruction"><span class="token keyword">RUN</span> [<span class="token string">&quot;/bin/bash&quot;</span>, <span class="token string">&quot;-c&quot;</span>, <span class="token string">&quot;echo hello&quot;</span>]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_11-3-4-expose-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-4-expose-命令" aria-hidden="true">#</a> 11.3.4 EXPOSE 命令</h4><p>用来指定构建的镜像在运行为容器时对外暴露的端口。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">EXPOSE</span> 80/tcp  如果没有显示指定则默认暴露都是tcp</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80/udp</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_11-3-5-cmd-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-5-cmd-命令" aria-hidden="true">#</a> 11.3.5 CMD 命令</h4><p>用来为启动的容器指定执行的命令，<strong>在 Dockerfile 中只能有一条 CMD 指令。如果列出多个命令，则只有最后一个命令才会生效</strong>。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;executable&quot;</span>,<span class="token string">&quot;param1&quot;</span>,<span class="token string">&quot;param2&quot;</span>] (exec form, this is the preferred form)</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;param1&quot;</span>,<span class="token string">&quot;param2&quot;</span>] (as default parameters to ENTRYPOINT)</span>
<span class="token instruction"><span class="token keyword">CMD</span> command param1 param2 (shell form)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_11-3-6-workdir-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-6-workdir-命令" aria-hidden="true">#</a> 11.3.6 WORKDIR 命令</h4><p>用来为 Dockerfile 中的任何 RUN、CMD、ENTRYPOINT、COPY 和 ADD 指令设置工作目录。如果 WORKDIR 不存在，即使它没有在任何后续 Dockerfile 指令中使用，它也将被创建。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">WORKDIR</span> /path/to/workdir</span>

<span class="token instruction"><span class="token keyword">WORKDIR</span> /a</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> b</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> c</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>注意：WORKDIR 指令可以在 Dockerfile 中多次使用。如果提供了相对路径，则该路径将与先前 WORKDIR 指令的路径相对</strong>。</p><h4 id="_11-3-7-env-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-7-env-命令" aria-hidden="true">#</a> 11.3.7 ENV 命令</h4><p>用来为构建镜像设置环境变量，这个值将出现在构建阶段中所有后续指令的环境中。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span>
<span class="token instruction"><span class="token keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_11-3-8-add-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-8-add-命令" aria-hidden="true">#</a> 11.3.8 ADD 命令</h4><p>用来从 context 上下文复制新文件、目录或远程文件url，并将它们添加到位于指定路径的映像文件系统中。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">ADD</span> hom* /mydir/       通配符添加多个文件</span>
<span class="token instruction"><span class="token keyword">ADD</span> hom?.txt /mydir/   通配符添加</span>
<span class="token instruction"><span class="token keyword">ADD</span> test.txt relativeDir/  可以指定相对路径</span>
<span class="token instruction"><span class="token keyword">ADD</span> test.txt /absoluteDir/ 也可以指定绝对路径</span>
<span class="token instruction"><span class="token keyword">ADD</span> url </span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_11-3-9-copy-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-9-copy-命令" aria-hidden="true">#</a> 11.3.9 COPY 命令</h4><p>用来将 context 目录中指定文件复制到镜像的指定目录中。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">COPY</span> src dest</span>
<span class="token instruction"><span class="token keyword">COPY</span> [<span class="token string">&quot;&lt;src&gt;&quot;</span>,... <span class="token string">&quot;&lt;dest&gt;&quot;</span>]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_11-3-10-volume-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-10-volume-命令" aria-hidden="true">#</a> 11.3.10 VOLUME 命令</h4><p>用来定义容器运行时可以挂在到宿主机的目录。</p><p>语法：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">VOLUME</span> [<span class="token string">&quot;/data&quot;</span>]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_11-3-11-entrypoint命令" tabindex="-1"><a class="header-anchor" href="#_11-3-11-entrypoint命令" aria-hidden="true">#</a> 11.3.11 ENTRYPOINT命令</h4><p>用来指定容器启动时执行命令和 CMD 类似。</p><p>语法:</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code>  [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> command param1 param2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>ENTRYPOINT 指令，往往用于设置容器启动后的<strong>第一个命令</strong>，这对一个容器来说往往是固定的。</li><li>CMD 指令，往往用于设置容器启动的<strong>第一个命令的默认参数</strong>，这对一个容器来说可以是变化的。</li></ul><h4 id="_11-3-11-entrypoint-命令" tabindex="-1"><a class="header-anchor" href="#_11-3-11-entrypoint-命令" aria-hidden="true">#</a> 11.3.11 ENTRYPOINT 命令</h4><h3 id="_11-4-dockerfile-构建-springboot-项目部署" tabindex="-1"><a class="header-anchor" href="#_11-4-dockerfile-构建-springboot-项目部署" aria-hidden="true">#</a> 11.4 Dockerfile 构建 SpringBoot 项目部署</h3><ol><li><p>准备 SpringBoot 可运行项目 <img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200605172151266.png" alt="" loading="lazy"></p></li><li><p>将可运行项目放入 Linux 虚拟机中 <img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200605172340380.png" alt="" loading="lazy"></p></li><li><p>编写 Dockerfile</p></li></ol><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> openjdk:8</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /ems</span>
<span class="token instruction"><span class="token keyword">ADD</span> ems.jar /ems</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 8989</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;java&quot;</span>,<span class="token string">&quot;-jar&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;ems.jar&quot;</span>]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="4"><li>构建镜像</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ems<span class="token punctuation">]</span><span class="token comment"># docker build -t ems .</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="5"><li>运行镜像</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ems<span class="token punctuation">]</span><span class="token comment"># docker run -p 8989:8989 ems</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="6"><li>访问项目</li></ol><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//10.15.0.8:8989/ems/login.html</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20200605173141636.png" alt="" loading="lazy"></p><hr><h2 id="_12-高级网络配置" tabindex="-1"><a class="header-anchor" href="#_12-高级网络配置" aria-hidden="true">#</a> 12. 高级网络配置</h2><h3 id="_12-1-说明" tabindex="-1"><a class="header-anchor" href="#_12-1-说明" aria-hidden="true">#</a> 12.1 说明</h3><p>当 Docker 启动时，会自动在主机上创建一个 <code>docker0</code> 虚拟网桥，实际上是 Linux 的一个 bridge，可以理解为一个软件交换机，它会在挂载到它的网口之间进行转发。</p><p>同时，Docker 随机分配一个本地未占用的私有网段（在 <a href="https://tools.ietf.org/html/rfc1918" target="_blank" rel="noopener noreferrer">RFC1918<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中定义）中的一个地址给 <code>docker0</code> 接口。比如典型的 <code>172.17.42.1</code>，掩码为 <code>255.255.0.0</code>。此后启动的容器内的网口也会自动分配一个同一网段（<code>172.17.0.0/16</code>）的地址。</p><p>当创建一个 Docker 容器的时候，同时会创建了一对 <code>veth pair</code> 接口（当数据包发送到一个接口时，另外一个接口也可以收到相同的数据包）。这对接口一端在容器内，即 <code>eth0</code>；另一端在本地并被挂载到 <code>docker0</code> 网桥，名称以 <code>veth</code> 开头（例如 <code>vethAQI2QT</code>）。通过这种方式，主机可以跟容器通信，容器之间也可以相互通信。Docker 就创建了在主机和所有容器之间一个虚拟共享网络。</p><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20201125105847896.png" alt="" loading="lazy"></p><h3 id="_12-2-docker-网络操作命令" tabindex="-1"><a class="header-anchor" href="#_12-2-docker-网络操作命令" aria-hidden="true">#</a> 12.2 Docker 网络操作命令</h3><ul><li>查看网络信息</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> network <span class="token function">ls</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>创建一个网桥</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> network create -d bridge 网桥名称
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>删除一个网桥</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> network <span class="token function">rm</span> 网桥名称
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_12-3-容器之间使用网络通信" tabindex="-1"><a class="header-anchor" href="#_12-3-容器之间使用网络通信" aria-hidden="true">#</a> 12.3 容器之间使用网络通信</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1.查询当前网络配置</span>
  docker network ls
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>NETWORK ID          NAME                DRIVER              SCOPE
8e424e5936b7        bridge              bridge              <span class="token builtin class-name">local</span>
17d974db02da        docker_gwbridge     bridge              <span class="token builtin class-name">local</span>
d6c326e433f7        <span class="token function">host</span>                <span class="token function">host</span>                <span class="token builtin class-name">local</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 2.创建桥接网络</span>
  docker network create -d bridge info
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker network create -d bridge info</span>
6e4aaebff79b1df43a064e0e8fdab08f52d64ce34db78dd5184ce7aaaf550a2f
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
8e424e5936b7        bridge              bridge              <span class="token builtin class-name">local</span>
17d974db02da        docker_gwbridge     bridge              <span class="token builtin class-name">local</span>
d6c326e433f7        <span class="token function">host</span>                <span class="token function">host</span>                <span class="token builtin class-name">local</span>
6e4aaebff79b        info                bridge              <span class="token builtin class-name">local</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 3.启动容器指定使用网桥</span>
  docker run -d -p 8890:80 --name nginx001 --network info nginx 
  docker run -d -p 8891:80 --name nginx002 --network info nginx 
	
  注意：一旦指定网桥后--name指定名字就是主机名，多个容器指定在同一个网桥时，可以在任意一个容器中使用主机名与容器进行互通。
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 8890:80 --name nginx001 --network info nginx </span>
c315bcc94e9ddaa36eb6c6f16ca51592b1ac8bf1ecfe9d8f01d892f3f10825fe
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 8891:80 --name nginx002 --network info nginx</span>
f8682db35dd7fb4395f90edb38df7cad71bbfaba71b6a4c6e2a3a525cb73c2a5
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
f8682db35dd7        nginx               <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">3</span> seconds ago       Up <span class="token number">2</span> seconds        <span class="token number">0.0</span>.0.0:8891-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx002
c315bcc94e9d        nginx               <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes        <span class="token number">0.0</span>.0.0:8890-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx001
b63169d43792        mysql:5.7.19        <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> minutes ago       Up <span class="token number">7</span> minutes        <span class="token number">3306</span>/tcp               mysql_mysql.1.s75qe5kkpwwttyf0wrjvd2cda
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it f8682db35dd7 /bin/bash</span>
root@f8682db35dd7:/<span class="token comment"># curl http://nginx001</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><hr><h2 id="_13-高级数据卷配置" tabindex="-1"><a class="header-anchor" href="#_13-高级数据卷配置" aria-hidden="true">#</a> 13. 高级数据卷配置</h2><h3 id="_13-1-说明" tabindex="-1"><a class="header-anchor" href="#_13-1-说明" aria-hidden="true">#</a> 13.1 说明</h3><p><strong>数据卷</strong>是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：</p><ul><li><code>数据卷</code> 可以在容器之间共享和重用</li><li>对 <code>数据卷</code> 的修改会立马生效</li><li>对 <code>数据卷</code> 的更新，不会影响镜像</li><li><code>数据卷</code> 默认会一直存在，即使容器被删除</li></ul><blockquote><p>注意：<code>数据卷</code> 的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会复制到数据卷中（仅数据卷为空时会复制）。</p></blockquote><h3 id="_13-2-数据卷操作命令" tabindex="-1"><a class="header-anchor" href="#_13-2-数据卷操作命令" aria-hidden="true">#</a> 13.2 数据卷操作命令</h3><ul><li>创建数据卷</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker volume create my-vol</span>
my-vol
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>查看数据卷</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker volume inspect my-vol       </span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;CreatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2020-11-25T11:43:56+08:00&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Mountpoint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/my-vol/_data&quot;</span>,
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;my-vol&quot;</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>挂载数据卷</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name web  -v my-vol:/usr/share/nginx/html  nginx</span>
<span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># docker inspect web</span>
				<span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;my-vol&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/my-vol/_data&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/share/nginx/html&quot;</span>,
                <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;z&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>删除数据卷</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> volume <span class="token function">rm</span> my-vol
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><hr><h2 id="_14-docker-compose" tabindex="-1"><a class="header-anchor" href="#_14-docker-compose" aria-hidden="true">#</a> 14. Docker Compose</h2><h3 id="_14-1-简介" tabindex="-1"><a class="header-anchor" href="#_14-1-简介" aria-hidden="true">#</a> 14.1 简介</h3><p><code> Docker Compose</code> 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟 <code>OpenStack</code> 中的 <code>Heat</code> 十分类似。</p><p>其代码目前在 https://github.com/docker/compose 上开源。</p><p><code>Docker Compose</code> 定位是<strong>定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）</strong>，其前身是开源项目 Fig.</p><p>通过前面的介绍，我们知道使用一个 <code>Dockerfile</code> 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。</p><p><code>Docker Compose</code> 恰好满足了这样的需求。它允许用户通过一个单独的 <code>docker-compose.yml</code> 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</p><p><code>Docker Compose</code> 中有两个重要的概念：</p><ul><li>服务 (<code>service</code>)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</li><li>项目 (<code>project</code>)：由一组关联的应用容器组成的一个完整业务单元，在 <code>docker-compose.yml</code> 文件中定义。</li></ul><p><code>Docker Compose</code> 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。</p><p><code>Docker Compose</code> 项目由 Python 编写，实现上调用了 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以在其上利用 <code>Docker Compose</code> 来进行编排管理。</p><h3 id="_14-2-安装与卸载" tabindex="-1"><a class="header-anchor" href="#_14-2-安装与卸载" aria-hidden="true">#</a> 14.2 安装与卸载</h3><ol><li>安装</li></ol><ul><li>Linux</li></ul><p>在 Linux 上的也安装十分简单，从官方 GitHub Release 处直接下载编译好的二进制文件即可。例如，在 Linux64 位系统上直接下载对应的二进制包。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.25.5/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>MacOS、Window</li></ul><p>Docker Compose 可以通过 Python 的包管理工具 pip 进行安装，也可以直接下载编译好的二进制文件使用，甚至能够直接在 Docker 容器中运行。</p><blockquote><p><code>Docker Desktop for Mac/Windows 自带 docker-compose 二进制文件，安装 Docker 之后可以直接使用</code>。</p></blockquote><ol start="2"><li>bash 命令补全</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -L https://raw.githubusercontent.com/docker/compose/1.25.5/contrib/completion/bash/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="3"><li>卸载</li></ol><p>如果是二进制包方式安装的，删除二进制文件即可。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> /usr/local/bin/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="4"><li>测试安装成功</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker-compose</span> --version
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_14-3-docker-compose-使用" tabindex="-1"><a class="header-anchor" href="#_14-3-docker-compose-使用" aria-hidden="true">#</a> 14.3 Docker Compose 使用</h3><ol><li>相关概念</li></ol><p>首先介绍几个术语。</p><ul><li>服务 (<code>service</code>)：一个应用容器，实际上可以运行多个相同镜像的实例。</li><li>项目 (<code>project</code>)：由一组关联的应用容器组成的一个完整业务单元。一个项目可以由多个服务（容器）关联而成，<code>Docker Compose</code> 面向项目进行管理。</li></ul><ol start="2"><li>场景</li></ol><p>最常见的项目是 Web 网站，该项目应该包含 Web 应用和缓存。</p><ul><li>SpringBoot 应用</li><li>MySQL 服务</li><li>Redis 服务</li><li>ElasticSearch 服务</li><li>.......</li></ul><ol start="3"><li>docker-compose 模板</li></ol><blockquote><p>参考文档：https://docker_practice.gitee.io/zh-cn/compose/compose_file.html</p></blockquote><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.0&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysqldb</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.19
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3306:3306&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/mysql/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
      <span class="token punctuation">-</span> /root/mysql/logs<span class="token punctuation">:</span>/logs
      <span class="token punctuation">-</span> /root/mysql/data<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> root
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ems
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> redis

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>4.0.14
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;6379:6379&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ems
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/redis/data<span class="token punctuation">:</span>/data
    <span class="token key atrule">command</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>server
    
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">ems</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ol start="4"><li>通过 docker-compose 运行一组容器</li></ol><blockquote><p>参考文档：https://docker_practice.gitee.io/zh-cn/compose/commands.html</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 前台启动一组服务</span>
<span class="token function">docker-compose</span> up

<span class="token comment"># 后台启动一组服务 </span>
<span class="token function">docker-compose</span> up -d
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_14-4-docker-compose-模板文件" tabindex="-1"><a class="header-anchor" href="#_14-4-docker-compose-模板文件" aria-hidden="true">#</a> 14.4 docker-compose 模板文件</h3><p>模板文件是使用 <code>Docker Compose</code> 的核心，涉及到的指令关键字也比较多。但大家不用担心，这里面大部分指令跟 <code>docker run</code> 相关参数的含义都是类似的。</p><p>默认的模板文件名称为 <code>docker-compose.yml</code>，格式为 YAML 格式。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> examples/web
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;80:80&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/data&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注意每个服务都必须通过 <code>image</code> 指令指定镜像或 <code>build</code> 指令（需要 Dockerfile）等来自动构建生成镜像。</p><p>如果使用 <code>build</code> 指令，在 <code>Dockerfile</code> 中设置的选项(例如：<code>CMD</code>, <code>EXPOSE</code>, <code>VOLUME</code>, <code>ENV</code> 等) 将会自动被获取，无需在 <code>docker-compose.yml</code> 中重复设置。</p><p>下面分别介绍各个指令的用法。</p><ul><li><code>build</code></li></ul><p>指定 <code>Dockerfile</code> 所在文件夹的路径（可以是绝对路径，或者相对 docker-compose.yml 文件的路径）。<code>Docker Compose</code> 将会利用它自动构建这个镜像，然后使用这个镜像。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./dir
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>也可以使用 <code>context</code> 指令指定 <code>Dockerfile</code> 所在文件夹的路径。</p><p>使用 <code>dockerfile</code> 指令指定 <code>Dockerfile</code> 文件名。</p><p>使用 <code>arg</code> 指令指定构建镜像时的变量。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span>
      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./dir
      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile<span class="token punctuation">-</span>alternate
      <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token key atrule">buildno</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><code>command</code></li></ul><p>覆盖容器启动后默认执行的命令。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">command</span><span class="token punctuation">:</span> echo &quot;hello world&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>container_name</code></li></ul><p>指定容器名称。默认将会使用 <code>项目名称_服务名称_序号</code> 这样的格式。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">container_name</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>web<span class="token punctuation">-</span>container
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>注意: 指定容器名称后，该服务将无法进行扩展（scale），因为 Docker 不允许多个容器具有相同的名称。</p></blockquote><ul><li><code>depends_on</code></li></ul><p>解决容器的依赖、启动先后的问题。以下例子中会先启动 <code>redis</code>、<code>db</code> 再启动 <code>web</code>.</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
      <span class="token punctuation">-</span> redis

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>注意：<code>web</code> 服务不会等待 <code>redis</code> <code>db</code> 「完全启动」之后才启动。</p></blockquote><ul><li><code>env_file</code></li></ul><p>从文件中获取环境变量，可以为单独的文件路径或列表。</p><p>如果通过 <code>docker-compose -f FILE</code> 方式来指定 Docker Compose 模板文件，则 <code>env_file</code> 中变量的路径会基于模板文件路径。</p><p>如果有变量名称与 <code>environment</code> 指令冲突，则按照惯例，以后者为准。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>env_file: .env

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>环境变量文件中每一行必须符合格式，支持 <code>#</code> 开头的注释行。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># common.env: Set development environment</span>
<span class="token assign-left variable">PROG_ENV</span><span class="token operator">=</span>development
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>environment</code></li></ul><p>设置环境变量。你可以使用数组或字典两种格式。</p><p>只给定名称的变量会自动获取运行 Docker Compose 主机上对应变量的值，可以用来防止泄露不必要的数据。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span> development
  <span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span>

<span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> RACK_ENV=development
  <span class="token punctuation">-</span> SESSION_SECRET
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果变量名称或者值中用到 <code>true|false，yes|no</code> 等表达 <a href="https://yaml.org/type/bool.html" target="_blank" rel="noopener noreferrer">布尔<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 含义的词汇，最好放到引号里，避免 YAML 自动解析某些内容为对应的布尔语义。这些特定词汇，包括</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>y<span class="token operator">|</span>Y<span class="token operator">|</span><span class="token function">yes</span><span class="token operator">|</span>Yes<span class="token operator">|</span>YES<span class="token operator">|</span>n<span class="token operator">|</span>N<span class="token operator">|</span>no<span class="token operator">|</span>No<span class="token operator">|</span>NO<span class="token operator">|</span><span class="token boolean">true</span><span class="token operator">|</span>True<span class="token operator">|</span>TRUE<span class="token operator">|</span><span class="token boolean">false</span><span class="token operator">|</span>False<span class="token operator">|</span>FALSE<span class="token operator">|</span>on<span class="token operator">|</span>On<span class="token operator">|</span>ON<span class="token operator">|</span>off<span class="token operator">|</span>Off<span class="token operator">|</span>OFF
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>healthcheck</code></li></ul><p>通过命令检查容器是否健康运行。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CMD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;curl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">interval</span><span class="token punctuation">:</span> 1m30s
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s
  <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>image</code></li></ul><p>指定为镜像名称或镜像 ID。如果镜像在本地不存在，<code>Docker Compose</code> 将会尝试拉取这个镜像。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu
<span class="token key atrule">image</span><span class="token punctuation">:</span> orchardup/postgresql
<span class="token key atrule">image</span><span class="token punctuation">:</span> a4bc65fd
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>networks</code></li></ul><p>配置容器连接的网络。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token key atrule">some-service</span><span class="token punctuation">:</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> some<span class="token punctuation">-</span>network
     <span class="token punctuation">-</span> other<span class="token punctuation">-</span>network

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">some-network</span><span class="token punctuation">:</span>
  <span class="token key atrule">other-network</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><code>ports</code></li></ul><p>暴露端口信息。</p><p>使用宿主端口：容器端口 <code>(HOST:CONTAINER)</code> 格式，或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">ports</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;3000&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;8000:8000&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;49100:22&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;127.0.0.1:8001:8001&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>注意：当使用 <code>HOST:CONTAINER</code> 格式来映射端口时，如果你使用的容器端口小于 60 并且没放到引号里，可能会得到错误结果，因为 <code>YAML</code> 会自动解析 <code>xx:yy</code> 这种数字格式为 60 进制。为避免出现这种问题，建议数字串都采用引号包括起来的字符串格式。</strong></p><ul><li><code>sysctls</code></li></ul><p>配置容器内核参数。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">sysctls</span><span class="token punctuation">:</span>
  <span class="token key atrule">net.core.somaxconn</span><span class="token punctuation">:</span> <span class="token number">1024</span>
  <span class="token key atrule">net.ipv4.tcp_syncookies</span><span class="token punctuation">:</span> <span class="token number">0</span>

<span class="token key atrule">sysctls</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> net.core.somaxconn=1024
  <span class="token punctuation">-</span> net.ipv4.tcp_syncookies=0
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>ulimits</code></li></ul><p>指定容器的 ulimits 限制值。</p><p>例如，指定最大进程数为 65535，指定文件句柄数为 20000（软限制，应用可以随时修改，不能超过硬限制） 和 40000（系统硬限制，只能 root 用户提高）。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">ulimits</span><span class="token punctuation">:</span>
    <span class="token key atrule">nproc</span><span class="token punctuation">:</span> <span class="token number">65535</span>
    <span class="token key atrule">nofile</span><span class="token punctuation">:</span>
      <span class="token key atrule">soft</span><span class="token punctuation">:</span> <span class="token number">20000</span>
      <span class="token key atrule">hard</span><span class="token punctuation">:</span> <span class="token number">40000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>volumes</code></li></ul><p>数据卷所挂载路径设置。可以设置为宿主机路径(<code>HOST:CONTAINER</code>)或者数据卷名称(<code>VOLUME:CONTAINER</code>)，并且可以设置访问模式 （<code>HOST:CONTAINER:ro</code>）。</p><p>该指令中路径支持相对路径。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> /var/lib/mysql
 <span class="token punctuation">-</span> cache/<span class="token punctuation">:</span>/tmp/cache
 <span class="token punctuation">-</span> ~/configs<span class="token punctuation">:</span>/etc/configs/<span class="token punctuation">:</span>ro
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果路径为数据卷名称，必须在文件中配置数据卷。</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">my_src</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8.0</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mysql_data<span class="token punctuation">:</span>/var/lib/mysql

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql_data</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_14-5-docker-compose-常用命令" tabindex="-1"><a class="header-anchor" href="#_14-5-docker-compose-常用命令" aria-hidden="true">#</a> 14.5 docker-compose 常用命令</h3><ol><li>命令对象与格式</li></ol><p>对于 Docker Compose 来说，大部分命令的对象既可以是项目本身，也可以指定为项目中的服务或者容器。如果没有特别的说明，命令对象将是项目，这意味着项目中所有的服务都会受到命令影响。</p><p>执行 <code>docker-compose [COMMAND] --help</code> 或者 <code>docker-compose help [COMMAND]</code> 可以查看具体某个命令的使用格式。</p><p><code>docker-compose</code> 命令的基本的使用格式是</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker-compose</span> <span class="token punctuation">[</span>-f<span class="token operator">=</span><span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARGS<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>命令选项</li></ol><ul><li><code>-f, --file FILE</code> 指定使用的 Compose 模板文件，默认为 <code>docker-compose.yml</code>，可以多次指定。</li><li><code>-p, --project-name NAME</code> 指定项目名称，默认将使用所在目录名称作为项目名。</li><li><code>--x-networking</code> 使用 Docker 的可拔插网络后端特性</li><li><code>--x-network-driver DRIVER</code> 指定网络后端的驱动，默认为 <code>bridge</code></li><li><code>--verbose</code> 输出更多调试信息。</li><li><code>-v, --version</code> 打印版本并退出。</li></ul><ol start="3"><li>命令使用说明</li></ol><ul><li><code>up</code></li></ul><p>格式为：<code>docker-compose up [options] [SERVICE...]</code>.</p><blockquote><ul><li>该命令十分强大，它将尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一系列操作。</li><li>链接的服务都将会被自动启动，除非已经处于运行状态。</li><li>可以说，大部分时候都可以直接通过该命令来启动一个项目。</li><li>默认情况，<code>docker-compose up</code> 启动的容器都在前台，控制台将会同时打印所有容器的输出信息，可以很方便进行调试。</li><li>当通过 <code>Ctrl-C</code> 停止命令时，所有容器将会停止。</li><li>如果使用 <code>docker-compose up -d</code>，将会在后台启动并运行所有的容器。一般推荐生产环境下使用该选项。</li><li>默认情况，如果服务容器已经存在，<code>docker-compose up</code> 将会尝试停止容器，然后重新创建（保持使用 <code>volumes-from</code> 挂载的卷），以保证新启动的服务匹配 <code>docker-compose.yml</code> 文件的最新内容</li></ul></blockquote><ul><li><code>down</code></li></ul><p>此命令将会停止 <code>up</code> 命令所启动的容器，并移除网络。</p><ul><li><code>exec</code></li></ul><p>进入指定的容器。</p><ul><li><code>ps</code></li></ul><p>列出项目中目前的所有容器。</p><p>格式为：<code>docker-compose ps [options] [SERVICE...]</code>.</p><p>选项：<code>-q</code> 只打印容器的 ID 信息。</p><ul><li><code>restart</code></li></ul><p>重启项目中的服务。</p><p>格式为：<code>docker-compose restart [options] [SERVICE...]</code>.</p><p>选项：<code>-t, --timeout TIMEOUT</code> 指定重启前停止容器的超时（默认为 10 秒）。</p><ul><li><code>rm</code></li></ul><p>删除所有（停止状态的）服务容器。推荐先执行 <code>docker-compose stop</code> 命令来停止容器。</p><p>格式为：<code>docker-compose rm [options] [SERVICE...]</code>.</p><p>选项：</p><ul><li><p><code>-f, --force</code> 强制直接删除，包括非停止状态的容器。一般尽量不要使用该选项。</p></li><li><p><code>-v</code> 删除容器所挂载的数据卷。</p></li><li><p><code>start</code></p></li></ul><p>启动已经存在的服务容器。</p><p>格式为：<code>docker-compose start [SERVICE...]</code>。</p><ul><li><code>stop</code></li></ul><p>停止已经处于运行状态的容器，但不删除它。通过 <code>docker-compose start</code> 可以再次启动这些容器。</p><p>格式为：<code>docker-compose stop [options] [SERVICE...]</code>.</p><p>选项：<code>-t, --timeout TIMEOUT</code> 停止容器时候的超时（默认为 10 秒）。</p><ul><li><code>top</code></li></ul><p>查看各个服务容器内运行的进程。</p><ul><li><code>unpause</code></li></ul><p>恢复处于暂停状态中的服务。</p><p>格式为 <code>docker-compose unpause [SERVICE...]</code>.</p><hr><h2 id="_15-docker-可视化工具" tabindex="-1"><a class="header-anchor" href="#_15-docker-可视化工具" aria-hidden="true">#</a> 15. Docker 可视化工具</h2><h3 id="_15-1-安装-portainer" tabindex="-1"><a class="header-anchor" href="#_15-1-安装-portainer" aria-hidden="true">#</a> 15.1 安装 Portainer</h3><blockquote><p>官方安装说明：<code>http://www.yunweipai.com/go?_=8fe4813824aHR0cHM6Ly93d3cucG9ydGFpbmVyLmlvL2luc3RhbGxhdGlvbi8=</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker pull  portainer/portainer</span>

<span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker volume create portainer_data</span>
portainer_data
<span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</span>
20db26b67b791648c2ef6aee444a5226a9c897ebcf0160050e722dbf4a4906e3
<span class="token punctuation">[</span>root@ubuntu1804 ~<span class="token punctuation">]</span><span class="token comment">#docker ps </span>
CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                                            NAMES
20db26b67b79        portainer/portainer   <span class="token string">&quot;/portainer&quot;</span>        <span class="token number">5</span> seconds ago       Up <span class="token number">4</span> seconds        <span class="token number">0.0</span>.0.0:8000-<span class="token operator">&gt;</span><span class="token number">8000</span>/tcp, <span class="token number">0.0</span>.0.0:9000-<span class="token operator">&gt;</span><span class="token number">9000</span>/tcp   portainer
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_15-2-登录和使用-portainer" tabindex="-1"><a class="header-anchor" href="#_15-2-登录和使用-portainer" aria-hidden="true">#</a> 15.2 登录和使用 Portainer</h3><blockquote><p>用浏览器访问：<code>http://localhost:9000</code></p></blockquote><p><img src="https://chen-coding.oss-cn-shenzhen.aliyuncs.com/server/container /01/image-20201223231707738.png" alt="" loading="lazy"></p><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/chenyl8848/chenyl8848.github.io/edit/master/docs/server/docker/Docker.md" rel="noopener noreferrer" target="_blank" arialabel="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2024/10/10 03:26:59</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 1063415880@qq.com">chenyl8848</span>,<!--]--><!--[--><span class="contributor" title="email: 1063415880@qq.com">cyl</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/server/docker/" class="nav-link active prev" arialabel="Docker"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><i class="icon iconfont icon-docker"></i>Docker</div></a><a href="/server/docker/Docker_deploy.html" class="nav-link next" arialabel="Docker 部署中间件"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">Docker 部署中间件<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><giscus-widget repo="chenyl8848/chenyl8848.github.io" repoId="R_kgDOHJ-qSQ" category="Announcements" categoryId="DIC_kwDOHJ-qSc4COg8Z" lang="zh-CN" theme="light" mapping="pathname" inputPosition="top" reactionsEnabled="1" emitMetadata="0"></giscus-widget></div><!----></main><!--]--><footer class="footer-wrapper"><div class="footer">没有最好，只有更好！</div><div class="copyright">Copyright © 2025 Java陈序员</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.06d697e7.js" defer></script>
  </body>
</html>
